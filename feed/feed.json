{
  "version": "https://jsonfeed.org/version/1",
  "title": "Cutreblog",
  "home_page_url": "https://reeseschultz.github.io",
  "feed_url": "https://example.com/feed/feed.json",
  "description": "Blog de Alejandro Montes",
  "author": {
    "name": "Reese Schultz",
    "url": "https://reeseschultz.github.io"
  },
  "items": [{
      "id": "https://reeseschultz.github.io/post/cortafuegos-iii:-perimetral-sobre-escenario./",
      "url": "https://reeseschultz.github.io/post/cortafuegos-iii:-perimetral-sobre-escenario./",
      "title": "Cortafuegos III: Perimetral sobre escenario.",
      "content_html": "<p><strong>Sobre el escenario creado en el m√≥dulo de servicios con las m√°quinas Alfa (Router), Bravo (DMZ), Charlie y Delta (LAN) y empleando iptables o nftables, configura un cortafuegos perimetral en la m√°quina Alfa de forma que el escenario siga funcionando completamente teniendo en cuenta los siguientes puntos:</strong></p>\n<ul>\n<li><strong>Pol√≠tica por defecto DROP para las cadenas INPUT, FORWARD y OUTPUT.</strong></li>\n<li><strong>Se pueden usar las extensiones que creamos adecuadas, pero al menos debe implementarse seguimiento de la conexi√≥n.</strong></li>\n<li><strong>Debemos implementar que el cortafuegos funcione despu√©s de un reinicio de la m√°quina.</strong></li>\n<li><strong>Debes indicar pruebas de funcionamiento de todas las reglas.</strong></li>\n<li><strong>El cortafuego debe cumplir al menos estas reglas:</strong></li>\n</ul>\n<h3 id=\"la-m%C3%A1quina-alfa-tiene-un-servidor-ssh-escuchando-por-el-puerto-22%2C-pero-al-acceder-desde-el-exterior-habr%C3%A1-que-conectar-al-puerto-2222.\" tabindex=\"-1\">La m√°quina Alfa tiene un servidor ssh escuchando por el puerto 22, pero al acceder desde el exterior habr√° que conectar al puerto 2222.</h3>\n<p>Antes que nada permitiremos el tr√°fico ssh a alfa para que no se interrumpa la conexi√≥n al aplicar las pol√≠ticas drop:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -t nat -A PREROUTING -p tcp --dport 2222 -i ens3 -j DNAT --to 10.0.0.148:22<br>root@alfa:/home/usuario# iptables -A INPUT -i ens3 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A OUTPUT -o ens3 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Pruebo que funciona la conexi√≥n ssh desde el exterior a trav√©s del puerto 22:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ ssh -A usuario@172.22.200.13 -p 2222<br>Linux alfa 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Sun Mar  5 09:20:39 2023 from 172.29.0.70<br>usuario@alfa:~$ </code></pre>\n<p>Ahora pongo las pol√≠ticas por defecto para input, output y forward:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -P INPUT DROP<br>root@alfa:/home/usuario# iptables -P OUTPUT DROP<br>root@alfa:/home/usuario# iptables -P FORWARD DROP</code></pre>\n<h3 id=\"desde-delta-y-bravo-se-debe-permitir-la-conexi%C3%B3n-ssh-por-el-puerto-22-a-la-m%C3%A1quina-alfa.\" tabindex=\"-1\">Desde Delta y Bravo se debe permitir la conexi√≥n ssh por el puerto 22 a la m√°quina Alfa.</h3>\n<p>Primero para poder trabajar correctamente sobre el escenario, a√±ado reglas para que desde alfa se pueda conectar por ssh tanto a la red interna(charlie y delta) como a la red dmz(bravo):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A OUTPUT -d 192.168.0.0/24 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A INPUT -s 192.168.0.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A OUTPUT -d 172.16.0.0/16 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A INPUT -s 172.16.0.0/16 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Ahora, a√±ado las reglas para que delta pueda conectarse por ssh a alga:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A OUTPUT -d 192.168.0.3/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A INPUT -s 192.168.0.3/24 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</code></pre>\n<p>Lo mismo pero las reglas para Bravo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A OUTPUT -d 172.16.0.200/16 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A INPUT -s 172.16.0.200/16 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT</code></pre>\n<p>Realizo ssh desde delta a alfa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ ssh usuario@192.168.0.1<br>Linux alfa 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Sun Mar  5 09:59:07 2023 from 172.29.0.70<br>usuario@alfa:~$ <br></code></pre>\n<p>Realizo ssh desde bravo a alfa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ ssh usuario@172.16.0.1<br>Linux alfa 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Sun Mar  5 10:01:17 2023 from 192.168.0.3<br>usuario@alfa:~$ <br></code></pre>\n<h3 id=\"la-m%C3%A1quina-alfa-debe-tener-permitido-el-tr%C3%A1fico-para-la-interfaz-loopback.\" tabindex=\"-1\">La m√°quina Alfa debe tener permitido el tr√°fico para la interfaz loopback.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A INPUT -i lo -p icmp -j ACCEPT<br>root@alfa:/home/usuario# iptables -A OUTPUT -o lo -p icmp -j ACCEPT</code></pre>\n<p>ping a la loopback:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# ping 127.0.0.1<br>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.<br>64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.143 ms<br>64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.106 ms<br>64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.067 ms<br>64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.096 ms<br>^C<br>--- 127.0.0.1 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3056ms<br>rtt min/avg/max/mdev = 0.067/0.103/0.143/0.027 ms<br>root@alfa:/home/usuario# <br></code></pre>\n<h3 id=\"a-la-m%C3%A1quina-alfa-se-le-puede-hacer-ping-desde-la-dmz%2C-pero-desde-la-lan-se-le-debe-rechazar-la-conexi%C3%B3n-(reject)-y-desde-el-exterior-se-rechazar%C3%A1-de-manera-silenciosa.\" tabindex=\"-1\">A la m√°quina Alfa se le puede hacer ping desde la DMZ, pero desde la LAN se le debe rechazar la conexi√≥n (REJECT) y desde el exterior se rechazar√° de manera silenciosa.</h3>\n<p>Las reglas para que desde la red DMZ puedan hacer ping a bravo son las siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A INPUT -s 172.16.0.0/16 -p icmp -m icmp --icmp-type echo-request -j ACCEPT<br>root@alfa:/home/usuario# iptables -A OUTPUT -d 172.16.0.0/16 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT</code></pre>\n<p>Ping desde la red dmz a alfa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ ping 172.16.0.1<br>PING 172.16.0.1 (172.16.0.1) 56(84) bytes of data.<br>64 bytes from 172.16.0.1: icmp_seq=1 ttl=64 time=0.395 ms<br>64 bytes from 172.16.0.1: icmp_seq=2 ttl=64 time=0.881 ms<br>64 bytes from 172.16.0.1: icmp_seq=3 ttl=64 time=0.697 ms<br>64 bytes from 172.16.0.1: icmp_seq=4 ttl=64 time=0.929 ms<br>^C<br>--- 172.16.0.1 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3059ms<br>rtt min/avg/max/mdev = 0.395/0.725/0.929/0.209 ms</code></pre>\n<p>Las reglas usadas para rechazar la conexi√≥n desde la red LAN son las siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A INPUT -s 192.168.0.0/24 -p icmp -m icmp --icmp-type echo-request -j REJECT<br>root@alfa:/home/usuario# iptables -A OUTPUT -d 192.168.0.0/24 -p icmp -m icmp --icmp-type echo-reply -j REJECT</code></pre>\n<p>Prueba de que no funciona el ping desde la lan:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ ping 192.168.0.1<br>PING 192.168.0.1 (192.168.0.1) 56(84) bytes of data.<br>^C<br>--- 192.168.0.1 ping statistics ---<br>12 packets transmitted, 0 received, 100% packet loss, time 11247ms</code></pre>\n<p>Con rechazar de manera silenciosa nos referimos a que se rechaza directamente con las pol√≠ticas drop que hemos puesto al principio. Para ello pruebo que desde el exterior tampoco podemos hacer ping a alfa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ ping 172.22.200.13<br>PING 172.22.200.13 (172.22.200.13) 56(84) bytes of data.<br>^C<br>--- 172.22.200.13 ping statistics ---<br>4 packets transmitted, 0 received, 100% packet loss, time 3073ms<br></code></pre>\n<h3 id=\"la-m%C3%A1quina-alfa-puede-hacer-ping-a-la-lan%2C-la-dmz-y-al-exterior.\" tabindex=\"-1\">La m√°quina Alfa puede hacer ping a la LAN, la DMZ y al exterior.</h3>\n<p>Con estas reglas aceptamos que alga haga ping a todo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A OUTPUT -p icmp -m icmp --icmp-type echo-request -j ACCEPT<br>root@alfa:/home/usuario# iptables -A INPUT -p icmp -m icmp --icmp-type echo-reply -j ACCEPT</code></pre>\n<p>Prueba de ping a la LAN, DMZ y exterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# ping 192.168.0.2<br>PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.<br>64 bytes from 192.168.0.2: icmp_seq=1 ttl=64 time=0.232 ms<br>64 bytes from 192.168.0.2: icmp_seq=2 ttl=64 time=0.101 ms<br>64 bytes from 192.168.0.2: icmp_seq=3 ttl=64 time=0.106 ms<br>^C<br>--- 192.168.0.2 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2032ms<br>rtt min/avg/max/mdev = 0.101/0.146/0.232/0.060 ms<br>root@alfa:/home/usuario# ping 192.168.0.3<br>PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.<br>64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.103 ms<br>64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.105 ms<br>64 bytes from 192.168.0.3: icmp_seq=3 ttl=64 time=0.099 ms<br>^C<br>--- 192.168.0.3 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2041ms<br>rtt min/avg/max/mdev = 0.099/0.102/0.105/0.002 ms<br>root@alfa:/home/usuario# ping 172.16.0.200<br>PING 172.16.0.200 (172.16.0.200) 56(84) bytes of data.<br>64 bytes from 172.16.0.200: icmp_seq=1 ttl=64 time=0.889 ms<br>64 bytes from 172.16.0.200: icmp_seq=2 ttl=64 time=0.890 ms<br>64 bytes from 172.16.0.200: icmp_seq=3 ttl=64 time=1.04 ms<br>^C<br><br>root@alfa:/home/usuario# ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=40.6 ms<br>64 bytes from 8.8.8.8: icmp_seq=2 ttl=111 time=40.4 ms<br>64 bytes from 8.8.8.8: icmp_seq=3 ttl=111 time=40.5 ms<br>64 bytes from 8.8.8.8: icmp_seq=4 ttl=111 time=40.7 ms<br>^C<br>--- 8.8.8.8 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3006ms<br>rtt min/avg/max/mdev = 40.398/40.544/40.682/0.116 ms<br>root@alfa:/home/usuario# <br></code></pre>\n<h3 id=\"desde-la-m%C3%A1quina-bravo-se-puede-hacer-ping-y-conexi%C3%B3n-ssh-a-las-m%C3%A1quinas-de-la-lan.\" tabindex=\"-1\">Desde la m√°quina Bravo se puede hacer ping y conexi√≥n ssh a las m√°quinas de la LAN.</h3>\n<p>Permitir ping desde bravo a la LAN:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A FORWARD -s 172.16.0.200/16 -d 192.168.0.0/24 -p icmp -m icmp --icmp-type echo-request -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -d 172.16.0.200/16 -s 192.168.0.0/24 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT</code></pre>\n<p>Pruebo que funciona el ping:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ ping 192.168.0.2<br>PING 192.168.0.2 (192.168.0.2) 56(84) bytes of data.<br>64 bytes from 192.168.0.2: icmp_seq=1 ttl=63 time=0.921 ms<br>64 bytes from 192.168.0.2: icmp_seq=2 ttl=63 time=0.888 ms<br>64 bytes from 192.168.0.2: icmp_seq=3 ttl=63 time=0.990 ms<br>64 bytes from 192.168.0.2: icmp_seq=4 ttl=63 time=0.916 ms<br>^C<br>--- 192.168.0.2 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3004ms<br>rtt min/avg/max/mdev = 0.888/0.928/0.990/0.037 ms<br>[usuario@bravo ~]$ ping 192.168.0.3<br>PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.<br>64 bytes from 192.168.0.3: icmp_seq=1 ttl=63 time=0.372 ms<br>64 bytes from 192.168.0.3: icmp_seq=2 ttl=63 time=0.869 ms<br>64 bytes from 192.168.0.3: icmp_seq=3 ttl=63 time=0.939 ms<br>^C<br>--- 192.168.0.3 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2053ms<br>rtt min/avg/max/mdev = 0.372/0.726/0.939/0.252 ms<br>[usuario@bravo ~]$ <br></code></pre>\n<p>Permitir ssh desde bravo a la LAN:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A FORWARD -s 172.16.0.200/16 -d 192.168.0.0/24 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -d 172.16.0.200/16 -s 192.168.0.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT<br></code></pre>\n<p>ssh desde bravo a la LAN:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ ssh ubuntu@192.168.0.2<br>The authenticity of host '192.168.0.2 (192.168.0.2)' can't be established.<br>ED25519 key fingerprint is SHA256:z9xxpXd5midX9yWZZYnriMe0GiGsB6EyvICFXTngapc.<br>This key is not known by any other names<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '192.168.0.2' (ED25519) to the list of known hosts.<br>ubuntu@192.168.0.2's password: <br>Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.10.0-21-amd64 x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br>Last login: Tue Feb 14 09:39:47 2023 from 192.168.0.1<br>ubuntu@charlie:~$ <br></code></pre>\n<h3 id=\"desde-cualquier-m%C3%A1quina-de-la-lan-se-puede-conectar-por-ssh-a-la-m%C3%A1quina-bravo.\" tabindex=\"-1\">Desde cualquier m√°quina de la LAN se puede conectar por ssh a la m√°quina Bravo.</h3>\n<p>Las reglas usadas son las siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A FORWARD -s 192.168.0.0/24 -d 172.16.0.200/16 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -s 172.16.0.200/16 -d 192.168.0.0/24 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Me conecto desde charlie a bravo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@charlie:~$ ssh usuario@172.16.0.200<br>Last login: Sun Mar  5 12:45:52 2023 from 172.16.0.1<br>[usuario@bravo ~]$ <br></code></pre>\n<p>Me conecto desde delta a bravo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ ssh usuario@172.16.0.200<br>The authenticity of host '172.16.0.200 (172.16.0.200)' can't be established.<br>ECDSA key fingerprint is SHA256:LB+A+mITUMpM9cur6VRckSO/0uVzUYjPGAcNUopJwZ0.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '172.16.0.200' (ECDSA) to the list of known hosts.<br>Last login: Sun Mar  5 12:46:44 2023 from 192.168.0.2<br>[usuario@bravo ~]$ <br></code></pre>\n<h3 id=\"configura-la-m%C3%A1quina-alfa-para-que-las-m%C3%A1quinas-de-lan-y-dmz-puedan-acceder-al-exterior.\" tabindex=\"-1\">Configura la m√°quina Alfa para que las m√°quinas de LAN y DMZ puedan acceder al exterior.</h3>\n<p>Configuraci√≥n para que la LAN salga al exterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o ens3 -j MASQUERADE<br>root@alfa:/home/usuario# iptables -A FORWARD -i br0 -o ens3 -p icmp -m icmp --icmp-type echo-request -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o br0 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT</code></pre>\n<p>Prueba de que funciona correctamente desde la LAN:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>64 bytes from 8.8.8.8: icmp_seq=1 ttl=110 time=40.6 ms<br>64 bytes from 8.8.8.8: icmp_seq=2 ttl=110 time=41.0 ms<br>64 bytes from 8.8.8.8: icmp_seq=3 ttl=110 time=40.9 ms<br>64 bytes from 8.8.8.8: icmp_seq=4 ttl=110 time=40.9 ms<br>^C<br>--- 8.8.8.8 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3005ms<br>rtt min/avg/max/mdev = 40.614/40.854/41.031/0.152 ms</code></pre>\n<p>Reglas para que la DMZ salga al exterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -t nat -A POSTROUTING -s 172.16.0.0/16 -o ens3 -j MASQUERADE<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens4 -o ens3 -p icmp -m icmp --icmp-type echo-request -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o ens4 -p icmp -m icmp --icmp-type echo-reply -j ACCEPT</code></pre>\n<p>Prueba de que funciona correctamente desde la DMZ:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>64 bytes from 8.8.8.8: icmp_seq=1 ttl=110 time=40.8 ms<br>64 bytes from 8.8.8.8: icmp_seq=2 ttl=110 time=41.1 ms<br>64 bytes from 8.8.8.8: icmp_seq=3 ttl=110 time=41.7 ms<br>^C<br>--- 8.8.8.8 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2003ms<br>rtt min/avg/max/mdev = 40.762/41.189/41.672/0.373 ms<br></code></pre>\n<h3 id=\"las-m%C3%A1quinas-de-la-lan-pueden-hacer-ping-al-exterior-y-navegar.\" tabindex=\"-1\">Las m√°quinas de la LAN pueden hacer ping al exterior y navegar.</h3>\n<p>Primero para que pueda navegar debe resolver correctamente las direcciones dns, entonces tendremos que permitir el tr√°fico dns en nuestro escenario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A OUTPUT -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A INPUT -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -t nat -A PREROUTING -p udp -i ens3 --dport 53 -j DNAT --to 192.168.0.2<br>root@alfa:/home/usuario# iptables -A FORWARD -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>En el apartado anterior hemos configurado el ping, ahora configuraremos que pueda navegar en el exterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A FORWARD -i br0 -o ens3 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o br0 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i br0 -o ens3 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o br0 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Prueba desde charlie:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@charlie:~$ curl google.es<br>&lt;HTML>&lt;HEAD>&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"><br>&lt;TITLE>301 Moved&lt;/TITLE>&lt;/HEAD>&lt;BODY><br>&lt;H1>301 Moved&lt;/H1><br>The document has moved<br>&lt;A HREF=\"http://www.google.es/\">here&lt;/A>.<br>&lt;/BODY>&lt;/HTML></code></pre>\n<p>Prueba desde delta:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ curl google.es<br>&lt;HTML>&lt;HEAD>&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"><br>&lt;TITLE>301 Moved&lt;/TITLE>&lt;/HEAD>&lt;BODY><br>&lt;H1>301 Moved&lt;/H1><br>The document has moved<br>&lt;A HREF=\"http://www.google.es/\">here&lt;/A>.<br>&lt;/BODY>&lt;/HTML></code></pre>\n<h3 id=\"la-m%C3%A1quina-bravo-puede-navegar.-instala-un-servidor-web%2C-un-servidor-ftp-y-un-servidor-de-correos-si-no-los-tienes-a%C3%BAn.\" tabindex=\"-1\">La m√°quina Bravo puede navegar. Instala un servidor web, un servidor ftp y un servidor de correos si no los tienes a√∫n.</h3>\n<p>Usar√© delta para el servidor de correos ya que tiene instalado un servidor de correos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -A FORWARD -i ens4 -o ens3 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o ens4 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens4 -o ens3 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o ens4 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Pruebo de que bravo puede navegar:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ curl google.es<br>&lt;HTML>&lt;HEAD>&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"><br>&lt;TITLE>301 Moved&lt;/TITLE>&lt;/HEAD>&lt;BODY><br>&lt;H1>301 Moved&lt;/H1><br>The document has moved<br>&lt;A HREF=\"http://www.google.es/\">here&lt;/A>.<br>&lt;/BODY>&lt;/HTML></code></pre>\n<h3 id=\"configura-la-m%C3%A1quina-alfa-para-que-los-servicios-web-y-ftp-sean-accesibles-desde-el-exterior.\" tabindex=\"-1\">Configura la m√°quina Alfa para que los servicios web y ftp sean accesibles desde el exterior.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# iptables -t nat -A PREROUTING -p tcp -i ens3 --dport 80 -j DNAT --to 172.16.0.200<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o ens4 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens4 -o ens3 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -t nat -A PREROUTING -p tcp -i ens3 --dport 21 -j DNAT --to 172.16.0.200<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens3 -o ens4 -p tcp --dport 21 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@alfa:/home/usuario# iptables -A FORWARD -i ens4 -o ens3 -p tcp --sport 21 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Prueba de que es accesible desde el exterior el servidor web:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ curl 172.22.200.13<br>&lt;!doctype html><br>&lt;html lang=\"en\" class=\"no-js\"><br>&lt;head><br>    &lt;meta charset=\"utf-8\"><br>    &lt;meta http-equiv=\"x-ua-compatible\" content=\"ie=edge\"><br>    &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"><br>    &lt;link rel=\"canonical\" href=\"https://html5-templates.com/\" /><br>    &lt;title>Bootstrap Template With Sticky Menu&lt;/title><br>    &lt;meta name=\"description\" content=\"Simplified Bootstrap template with sticky menu\"><br>    &lt;link href=\"css/bootstrap.min.css\" rel=\"stylesheet\"><br>    &lt;link href=\"css/sticky-menu.css\" rel=\"stylesheet\"><br>&lt;/head><br>&lt;body id=\"page-top\" data-spy=\"scroll\" data-target=\".navbar-fixed-top\"><br>    &lt;nav class=\"navbar navbar-default navbar-fixed-top\" role=\"navigation\"><br>        &lt;div class=\"container\"><br>            &lt;div class=\"navbar-header page-scroll\"><br>                &lt;button type=\"button\" class=\"navbar-toggle\" data-toggle=\"collapse\" data-target=\".navbar-ex1-collapse\"><br>                    &lt;span class=\"sr-only\">Toggle menu&lt;/span><br>                    &lt;span class=\"icon-bar\">&lt;/span><br>                    &lt;span class=\"icon-bar\">&lt;/span><br>                    &lt;span class=\"icon-bar\">&lt;/span><br>                &lt;/button><br>                &lt;a class=\"navbar-brand page-scroll\" href=\"#page-top\">Welcome&lt;/a><br>            &lt;/div><br><br>            &lt;div class=\"collapse navbar-collapse navbar-ex1-collapse\"><br>                &lt;ul class=\"nav navbar-nav\"><br>                    &lt;li class=\"hidden\"><br>                        &lt;a class=\"page-scroll\" href=\"#page-top\">&lt;/a><br>                    &lt;/li><br>                    &lt;li><br>                        &lt;a class=\"page-scroll\" href=\"#about\">About&lt;/a><br>                    &lt;/li><br>                    &lt;li><br>                        &lt;a class=\"page-scroll\" href=\"#whatwedo\">What We Do&lt;/a><br>                    &lt;/li><br>                    &lt;li><br>                        &lt;a class=\"page-scroll\" href=\"#contact\">Contact&lt;/a><br>                    &lt;/li><br>                &lt;/ul><br>            &lt;/div>\t&lt;!-- .navbar-collapse --><br>        &lt;/div>\t\t&lt;!-- .container --><br>    &lt;/nav><br>    &lt;!-- Welcome   --><br>    &lt;section id=\"welcome\" class=\"welcome-section\"><br>        &lt;div class=\"container\"><br>            &lt;div class=\"row\"><br>                &lt;div class=\"col-lg-12\"><br>                    &lt;h1>Curso: Introducci√≥n Docker&lt;/h1><br>                    &lt;h2>Aplicaci√≥n escrita en PHP&lt;/h2><br>                    &lt;p>Fecha: &lt;strong><br>                        05/03/2023                    &lt;/strong>&lt;/p><br>                    &lt;a class=\"btn btn-primary page-scroll\" href=\"#about\">Click To Scroll Down!&lt;/a><br>                &lt;/div><br>            &lt;/div><br>        &lt;/div><br>    &lt;/section><br><br>    &lt;!-- About --><br>    &lt;section id=\"about\" class=\"about-section\"><br>        &lt;div class=\"container\"><br>            &lt;div class=\"row\"><br>                &lt;div class=\"col-lg-12\"><br>                    &lt;h1>About&lt;/h1><br>                &lt;/div><br>            &lt;/div><br>        &lt;/div><br>    &lt;/section><br><br>    &lt;!-- What we do Section --><br>    &lt;section id=\"whatwedo\" class=\"whatwedo-section\"><br>        &lt;div class=\"container\"><br>            &lt;div class=\"row\"><br>                &lt;div class=\"col-lg-12\"><br>                    &lt;h1>What We Do&lt;/h1><br>                &lt;/div><br>            &lt;/div><br>        &lt;/div><br>    &lt;/section><br><br>    &lt;!-- Contact Section --><br>    &lt;section id=\"contact\" class=\"contact-section\"><br>        &lt;div class=\"container\"><br>            &lt;div class=\"row\"><br>                &lt;div class=\"col-lg-12\"><br>                    &lt;h1>Contact Section&lt;/h1><br>                &lt;/div><br>            &lt;/div><br>        &lt;/div><br>    &lt;/section><br>\t<br>\t&lt;a id=\"back2Top\" title=\"Back to top\" href=\"#\">&amp;#10148;&lt;/a><br>\t<br>    &lt;!-- jQuery --><br>    &lt;script src=\"js/jquery.js\">&lt;/script><br><br>    &lt;!-- Bootstrap Core JavaScript --><br>    &lt;script src=\"js/bootstrap.min.js\">&lt;/script><br><br>    &lt;!-- Scrolling Nav JavaScript --><br>    &lt;script src=\"js/jquery.easing.min.js\">&lt;/script><br>    &lt;script src=\"js/sticky-menu.js\">&lt;/script><br><br>&lt;/body><br><br>&lt;/html></code></pre>\n<h3 id=\"el-servidor-web-y-el-servidor-ftp-deben-ser-accesibles-desde-la-lan-y-desde-el-exterior.\" tabindex=\"-1\">El servidor web y el servidor ftp deben ser accesibles desde la LAN y desde el exterior.</h3>\n<h3 id=\"el-servidor-de-correos-s%C3%B3lo-debe-ser-accesible-desde-la-lan.\" tabindex=\"-1\">El servidor de correos s√≥lo debe ser accesible desde la LAN.</h3>\n<h3 id=\"en-la-m%C3%A1quina-charlie-instala-un-servidor-mysql-si-no-lo-tiene-a%C3%BAn.-a-este-servidor-se-puede-acceder-desde-la-dmz%2C-pero-no-desde-el-exterior.\" tabindex=\"-1\">En la m√°quina Charlie instala un servidor mysql si no lo tiene a√∫n. A este servidor se puede acceder desde la DMZ, pero no desde el exterior.</h3>\n<h3 id=\"evita-ataques-dos-por-icmp-flood%2C-limitando-el-n%C3%BAmero-de-peticiones-por-segundo-desde-una-misma-ip.\" tabindex=\"-1\">Evita ataques DoS por ICMP Flood, limitando el n√∫mero de peticiones por segundo desde una misma IP.</h3>\n<h3 id=\"evita-ataques-dos-por-syn-flood.\" tabindex=\"-1\">Evita ataques DoS por SYN Flood.</h3>\n<h3 id=\"evita-que-realicen-escaneos-de-puertos-a-alfa.\" tabindex=\"-1\">Evita que realicen escaneos de puertos a Alfa.</h3>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-03-01T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/practica:-kubernetes./",
      "url": "https://reeseschultz.github.io/post/practica:-kubernetes./",
      "title": "Pr√°ctica: Kubernetes.",
      "content_html": "<p>En IAW has creado dos im√°genes de dos aplicaciones: bookmedik (php) y polls (python django). Elige una de ellas y despli√©gala en kubernetes. Para ello vamos a hacer dos ejercicios:</p>\n<h3 id=\"ejercicio1%3A-despliegue-en-minikube.\" tabindex=\"-1\">Ejercicio1: Despliegue en minikube.</h3>\n<p><strong>Escribe los ficheros yaml que te posibilitan desplegar la aplicaci√≥n en minikube. Recuerda que la base de datos debe tener un volumen para hacerla persistente. Debes crear ficheros para los deployments, services, ingress, vol√∫menes,‚Ä¶</strong></p>\n<p><strong>Despliega la aplicaci√≥n en minikube.</strong></p>\n<p>Lo primero que haremos ser√° crear el ConfigMap y un Secret para guardar variables de entorno:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/bookmedik$ kubectl create cm cm-mariadb --from-literal=mysql_usuario=bookmedik  --from-literal=basededatos=bookmedik<br>configmap/cm-mariadb created<br>alemd@debian:~/minikube/bookmedik$ kubectl create secret generic secret-mariadb --from-literal=password=bookmedik --from-literal=rootpass=root</code></pre>\n<p>Ahora creo el vol√∫men persistente de la base de datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/bookmedik$ nano pvc-bookmedik.yaml<br><br>apiVersion: v1<br>kind: PersistentVolumeClaim<br>metadata:<br>    name: pvc-bookmedik<br>spec:<br>  accessModes:<br>    - ReadWriteOnce<br>  resources:<br>    requests:<br>      storage: 3Gi<br></code></pre>\n<p>Desplegamos la base de datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: mariadb<br>  labels:<br>    app: mariadb<br>    tier: backend<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: mariadb<br>      tier: backend<br>  template:<br>    metadata:<br>      labels:<br>        app: mariadb<br>        tier: backend<br>    spec:<br>      volumes:<br>        - name: volumen-mariadb<br>          persistentVolumeClaim:<br>            claimName: pvc-bookmedik<br>      containers:<br>        - name: contenedor-mariadb<br>          image: mariadb<br>          env:<br>            - name: MARIADB_ROOT_PASSWORD<br>              valueFrom:<br>                secretKeyRef:<br>                  name: secret-mariadb<br>                  key: rootpass<br>            - name: MARIADB_DATABASE<br>              valueFrom:<br>                configMapKeyRef:<br>                  name: cm-mariadb<br>                  key: basededatos<br>            - name: MARIADB_USER<br>              valueFrom:<br>                configMapKeyRef:<br>                  name: cm-mariadb<br>                  key: mysql_usuario<br>            - name: MARIADB_PASSWORD<br>              valueFrom:<br>                secretKeyRef:<br>                  name: secret-mariadb<br>                  key: password<br>          ports:<br>            - name: mariadb-server<br>              containerPort: 3306<br>          volumeMounts:<br>            - mountPath: \"/var/lib/mysql\"<br>              name: volumen-mariadb</code></pre>\n<p>Creamos tambi√©n el servicio de mariadb:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: mariadb<br>  labels:<br>    app: mariadb<br>    tier: backend<br>spec:<br>  type: ClusterIP<br>  ports:<br>  - port: 3306<br>    targetPort: mariadb-server<br>  selector:<br>    app: mariadb<br>    tier: backend<br></code></pre>\n<p>Lo desplegamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/bookmedik$ kubectl apply -f .<br>deployment.apps/mariadb created<br>persistentvolumeclaim/pvc-bookmedik created<br>service/mariadb created</code></pre>\n<p>Ahora crearemos el despliegue de bookmedik:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: bookmedik<br>  labels:<br>    app: bookmedik<br>    tier: frontend<br>spec:<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: bookmedik<br>      tier: frontend<br>  template:<br>    metadata:<br>      labels:<br>        app: bookmedik<br>        tier: frontend<br>    spec:<br>      containers:<br>      - name: contenedor-bookmedik<br>        image: alemd01/bookmedik:v1<br>        env:<br>          - name: USUARIO_BOOKMEDIK<br>            valueFrom:<br>              configMapKeyRef:<br>                name: cm-mariadb<br>                key: mysql_usuario<br>          - name: CONTRA_BOOKMEDIK<br>            valueFrom:<br>              secretKeyRef:<br>                name: secret-mariadb<br>                key: password<br>          - name: DATABASE_HOST<br>            value: mariadb<br>          - name: NOMBRE_DB<br>            valueFrom:<br>              configMapKeyRef:<br>                name: cm-mariadb<br>                key: basededatos<br>        ports:<br>          - name: http-server<br>            containerPort: 80</code></pre>\n<p>Ahora, por √∫ltimo, crearemos el servicio de bookmedik:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: bookmedik<br>  labels:<br>    app: bookmedik<br>    tier: frontend<br>spec:<br>  type: NodePort<br>  ports:<br>  - port: 80<br>    targetPort: http-server<br>  selector:<br>    app: bookmedik<br>    tier: frontend<br></code></pre>\n<p>Lanzamos todo nuevamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/bookmedik$ kubectl apply -f .<br>deployment.apps/bookmedik created<br>service/bookmedik created<br>deployment.apps/mariadb unchanged<br>service/mariadb unchanged<br>persistentvolumeclaim/pvc-bookmedik unchanged</code></pre>\n<p>Comprobamos que se ha creado todo correctamente:</p>\n<p><img src=\"/img/SRI-K8S-P.2.png\" alt=\"SRI-K8S-P.2.png\"></p>\n<p>Entramos a trav√©s de la IP a bookmedik.</p>\n<p><img src=\"/img/SRI-K8S-P.1.png\" alt=\"SRI-K8S-P.1.png\"></p>\n<p>Para facilitarnos la tarea proceder√© a crear un ingress para poder acceder a trav√©s de nombre:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: networking.k8s.io/v1<br>kind: Ingress<br>metadata:<br>  name: bookmedik-ing<br>spec:<br>  rules:<br>  - host: www.amontes-bookmedik.org<br>    http:<br>      paths:<br>      - path: /<br>        pathType: Prefix<br>        backend:<br>          service:<br>            name: bookmedik<br>            port:<br>              number: 80<br></code></pre>\n<p>Lo levantamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/bookmedik$ kubectl apply -f bookmedik-ingress.yaml <br>ingress.networking.k8s.io/bookmedik-ing created</code></pre>\n<p>Lo a√±adimos al /etc/hosts y accedemos a trav√©s de la direcci√≥n:</p>\n<p><img src=\"/img/SRI-K8S-P.3.png\" alt=\"SRI-K8S-P.3.png\"></p>\n<p>Comprobamos nuevamente que se loguea correctamente:</p>\n<p><img src=\"/img/SRI-K8S-P.4.png\" alt=\"SRI-K8S-P.4.png\"></p>\n<h3 id=\"ejercicio2%3A-despliegue-en-otra-distribuci%C3%B3n-de-kubernetes.\" tabindex=\"-1\">Ejercicio2: Despliegue en otra distribuci√≥n de kubernetes.</h3>\n<p><strong>Instala un cl√∫ster de kubernetes (m√°s de un nodo). Tienes distintas opciones para construir un cluster de kubernetes: Alternativas para instalaci√≥n simple de k8s.</strong></p>\n<p><strong>Realiza el despliegue de la aplicaci√≥n en el nuevo cl√∫ster. Es posible que no tenga instalado un ingress controller, por lo que no va a funcionar el ingress (puedes buscar como hacer la instalaci√≥n: por ejemplo el nginx controller).</strong></p>\n<p><strong>Escala la aplicaci√≥n y ejecuta kubectl get pods -o wide para ver c√≥mo se ejecutan en los distintos nodos del cl√∫ster.</strong></p>\n<p>En mi caso por variar un poco, crear√© el cluster con Kind. Tendremos que usar una m√°quina donde hemos instalado previamente Docker, yo usar√© una m√°quina limpia de proxmox.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ docker --version<br>Docker version 20.10.5+dfsg1, build 55c4c88</code></pre>\n<p>Como podemos comprobar, ya tenemos instalado docker, entonces, lo primero que haremos para instalar kind, es bajar el binario, darle permisos de ejecuci√≥n y moverlo a un directorio accesible desde $PATH:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ curl -Lo ./kind https://kind.sigs.k8s.io/dl/v0.17.0/kind-linux-amd64<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--  100    98  100    98    0     0    426      0 --:--:-- --:--:-- --:--:--   426<br>  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0<br>  1 6766k    1  128k    0     0   196k      0  0:00:34 --:--:--  0:00:34  100 6766k  100 6766k    0     0  3954k      0  0:00:01  0:00:01 --:--:-- 6100 6766k  100 6766k    0     0  3941k      0  0:00:01  0:00:01 --:--:-- 6239k<br>usuario@kind:~$ chmod +x ./kind<br>usuario@kind:~$ sudo mv ./kind /usr/local/bin/kind</code></pre>\n<p>Verificamos que est√° instalado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ kind version<br>kind v0.17.0 go1.19.2 linux/amd64</code></pre>\n<p>Ahora procederemos a la creaci√≥n del cluster, para ello crearemos un yaml con los nodos que tendr√° el cluster:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Cluster<br><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> kind.x<span class=\"token punctuation\">-</span>k8s.io/v1alpha4<br><span class=\"token key atrule\">nodes</span><span class=\"token punctuation\">:</span><br><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> control<span class=\"token punctuation\">-</span>plane<br><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> worker<br><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">role</span><span class=\"token punctuation\">:</span> worker</code></pre>\n<p>En este fichero indicamos que tenemos un nodo controlador y dos nodos ‚Äúworker‚Äù. Ahora crearemos el cluster:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ kind create cluster --config=config.yaml<br>Creating cluster \"kind\" ...<br> ‚úì Ensuring node image (kindest/node:v1.25.3) üñº<br> ‚úì Preparing nodes üì¶ üì¶ üì¶  <br> ‚úì Writing configuration üìú <br> ‚úì Starting control-plane üïπÔ∏è <br> ‚úì Installing CNI üîå <br> ‚úì Installing StorageClass üíæ <br> ‚úì Joining worker nodes üöú <br>Set kubectl context to \"kind-kind\"<br>You can now use your cluster with:<br><br>kubectl cluster-info --context kind-kind<br><br>Not sure what to do next? üòÖ  Check out https://kind.sigs.k8s.io/docs/user/quick-start/</code></pre>\n<p>Muestro los cluster y los nodos creados:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ kind get clusters<br>kind<br>usuario@kind:~$ kind get nodes<br>kind-worker<br>kind-control-plane<br>kind-worker2</code></pre>\n<p>Muestro desde docker los contenedores que se han creado:</p>\n<p><img src=\"/img/SRI-K8S-P.5.png\" alt=\"SRI-K8S-P.5.png\"></p>\n<p>Una vez tengamos nuestro cluster en marcha, instalaremos kubectl para interactuar con este. Los comandos usados son los siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ curl -LO \"https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl\"<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--  100   138  100   138    0     0    831      0 --:--:-- --:--:-- --:--:--  100   138  100   138    0     0    831      0 --:--:-- --:--:-- --:--:--   826<br> 16 45.8M   16 7758k    0     0  4804k      0  0:00:09  0:00:01  0:00:08 4 22 45.8M   22 10.2M    0     0  4923k      0  0:00:09  0:00:02  0:00:07 5 53 45.8M   53 24.2M    0     0  7966k      0  0:00:05  0:00:03  0:00:02 1100 45.8M  100 45.8M    0     0  11.3M      0  0:00:04  0:00:04 --:--:-- 15.7M<br>usuario@kind:~$ sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl<br>usuario@kind:~$ chmod +x kubectl<br>usuario@kind:~$ sudo mv ./kubectl /usr/local/bin/kubectl<br>usuario@kind:~$ kubectl version --client<br>WARNING: This version information is deprecated and will be replaced with the output from kubectl version --short.  Use --output=yaml|json to get the full version.<br>Client Version: version.Info{Major:\"1\", Minor:\"26\", GitVersion:\"v1.26.2\", GitCommit:\"fc04e732bb3e7198d2fa44efa5457c7c6f8c0f5b\", GitTreeState:\"clean\", BuildDate:\"2023-02-22T13:39:03Z\", GoVersion:\"go1.19.6\", Compiler:\"gc\", Platform:\"linux/amd64\"}<br>Kustomize Version: v4.5.7<br></code></pre>\n<p>Ahora desde kubectl mostraremos que el cl√∫ster est√° creado correctamente para verificar que funciona tanto kubectl como el cl√∫ster est√© bien montado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ kubectl get nodes<br>NAME                 STATUS   ROLES           AGE   VERSION<br>kind-control-plane   Ready    control-plane   11m   v1.25.3<br>kind-worker          Ready    &lt;none>          10m   v1.25.3<br>kind-worker2         Ready    &lt;none>          10m   v1.25.3</code></pre>\n<p>Una vez hecho esto, proceder√© a desplegar la aplicaci√≥n de bookmedik, para ello lo primero que haremos ser√° crear los ConfigMap y el secret:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~$ kubectl create cm cm-mariadb --from-literal=mysql_usuario=bookmedik  --from-literal=basededatos=bookmedik<br>configmap/cm-mariadb created<br>usuario@kind:~$ kubectl create secret generic secret-mariadb --from-literal=password=bookmedik --from-literal=rootpass=root<br>secret/secret-mariadb created</code></pre>\n<p>Ahora nos pasamos a nuestra m√°quina los ficheros yaml con los que hemos desplegado bookmedik en el ejercicio anterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ scp -r bookmedik/ usuario@172.22.7.238:bookmedik<br>mariadb-deployment.yaml                 100% 1346     4.8KB/s   00:00    <br>bookmedik-deployment.yaml               100%  997    10.1KB/s   00:00    <br>bookmedik-service.yaml                  100%  228     3.1KB/s   00:00    <br>pvc-bookmedik.yaml                      100%  164     1.4KB/s   00:00    <br>mariadb-srv.yaml                        100%  226     2.6KB/s   00:00    <br>bookmedik-ingress.yaml                  100%  301     4.2KB/s   00:00   </code></pre>\n<p>Ahora desplegamos todo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~/bookmedik$ kubectl apply -f .<br>deployment.apps/bookmedik created<br>ingress.networking.k8s.io/bookmedik-ing created<br>service/bookmedik created<br>deployment.apps/mariadb created<br>service/mariadb created<br>persistentvolumeclaim/pvc-bookmedik created</code></pre>\n<p>Comprobamos que se ha creado correctamente todo:</p>\n<p><img src=\"/img/SRI-K8S-P.6.png\" alt=\"SRI-K8S-P.6.png\"></p>\n<p>Ahora hacemos un escalado en el despliegue:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@kind:~/bookmedik$ kubectl scale deployment/bookmedik --replicas=3<br>deployment.apps/bookmedik scaled</code></pre>\n<p>Vemos que los pods est√°n repartidos en distintos nodos:</p>\n<p><img src=\"/img/SRI-K8S-P.7.png\" alt=\"SRI-K8S-P.7.png\"></p>\n<p>Por √∫ltimo, y no menos importante, probar√© que la aplicaci√≥n funciona correctamente:</p>\n<p><img src=\"/img/SRI-K8S-P.8.png\" alt=\"SRI-K8S-P.8.png\"></p>\n<p>El ingress nginx no funciona, estuve probando diferentes configuraciones pero no he conseguido que funcione.</p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-27T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/practica-2:-implantacion-de-aplicaciones-web-python-en-docker./",
      "url": "https://reeseschultz.github.io/post/practica-2:-implantacion-de-aplicaciones-web-python-en-docker./",
      "title": "Pr√°ctica 2: Implantaci√≥n de aplicaciones web Python en docker.",
      "content_html": "<p>Queremos desplegar en docker la aplicaci√≥n escrita en python django: tutorial de django, que desplegamos en la tarea Despliegue de aplicaciones python.</p>\n<p>Tienes que tener en cuenta los siguientes aspectos:</p>\n<ul>\n<li>La aplicaci√≥n debe guardar los datos en una base de datos mariadb.</li>\n<li>La aplicaci√≥n se podr√° configurar para indicar los par√°metros de conexi√≥n a la base de datos: usuario, contrase√±a, host y base de datos.</li>\n<li>La aplicaci√≥n deber√° tener creado un usuario administrador para el acceso.</li>\n</ul>\n<h3 id=\"crea-una-imagen-docker-para-poder-desplegar-un-contenedor-con-la-aplicaci%C3%B3n.-la-imagen-la-puedes-hacer-desde-una-imagen-base-o-desde-la-imagen-oficial-de-python.\" tabindex=\"-1\">Crea una imagen docker para poder desplegar un contenedor con la aplicaci√≥n. La imagen la puedes hacer desde una imagen base o desde la imagen oficial de python.</h3>\n<p>Vamos a crear una red para que ambos contenedores se conecten:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker network create django-net<br>d57e165b54b222fa43b8ba34e8cdf9c745d99850d45ba512b76b7d53446172f3</code></pre>\n<p>Creamos el contenedor de mariadb con las siguientes variables:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker run -d --name mariadb -v vol_polls:/var/lib/mysql --network django-net -e MARIADB_ROOT_PASSWORD=root -e MARIADB_USER=django -e MARIADB_PASSWORD=django -e MARIADB_DATABASE=django mariadb<br>24ceb57a2f2a8426f75f4592d0ff5cb8a654f7735962ec17a40b7c3282625810<br></code></pre>\n<p>Ahora modificaremos nuestro django_tutorial ya modificado en anteriores pr√°cticas y haremos que coja los par√°metros de la base de datos por variables de entorno. Para ello editaremos lo siguiente en el <a href=\"http://settings.py\">settings.py</a>:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">import os<br><br>BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))</code></pre>\n<p>Y en el apartado DATABASE ponemos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">DATABASES = {<br>    'default': {<br>        'ENGINE': 'django.db.backends.mysql',<br>        'NAME': os.environ.get(\"BASE_DATOS\"),<br>        'USER': os.environ.get('USUARIO'),<br>        'PASSWORD': os.environ.get(\"CONTRA\"),<br>        'HOST': os.environ.get('HOST'),<br>        'PORT': '3306',<br>    }<br>}</code></pre>\n<p>Tambi√©n modificaremos los siguientes apartados:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ALLOWED_HOSTS = [os.environ.get(\"ALLOWED_HOSTS\")]<br>STATIC_ROOT = os.path.join(BASE_DIR, 'static')<br>STATIC_URL = '/static/'<br>CSRF_TRUSTED_ORIGINS = ['http://*.alejandro-montes.es','http://*.127.0.0.1','https://*.alejandro-montes.es','https://*.127.0.0.1']</code></pre>\n<p>Ahora creamos un dockerfile:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">FROM python:3<br>WORKDIR /usr/src/app<br>MAINTAINER Alejandro Montes Delgado \"aaleemd11@gmail.com\"<br>RUN apt-get install git &amp;&amp; pip install --root-user-action=ignore --upgrade pip &amp;&amp; pip install --root-user-action=ignore django mysqlclient<br>RUN git clone https://github.com/alemd01/django_tutorial.git /usr/src/app &amp;&amp; mkdir static <br>ADD ./django_polls.sh /usr/src/app/<br>RUN chmod +x /usr/src/app/django_polls.sh<br>ENV ALLOWED_HOSTS=*<br>ENV HOST=mariadb<br>ENV USUARIO=django<br>ENV CONTRA=django<br>ENV BASE_DATOS=django<br>ENV DJANGO_SUPERUSER_PASSWORD=admin<br>ENV DJANGO_SUPERUSER_USERNAME=admin<br>ENV DJANGO_SUPERUSER_EMAIL=admin@example.org<br>CMD [\"/usr/src/app/django_polls.sh\"]</code></pre>\n<p>Este dockerfile hace referencia a un script, que es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">#! /bin/sh<br><br>python3 manage.py makemigrations<br>python3 manage.py migrate<br>python3 manage.py createsuperuser --noinput<br>python3 manage.py collectstatic --no-input<br>python3 manage.py runserver 0.0.0.0:8006</code></pre>\n<p>Ahora contruimos la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/django$ docker build -t alemd01/django_tutorial:v1 .<br>Sending build context to Docker daemon   15.3MB<br>Step 1/16 : FROM python:3<br>3: Pulling from library/python<br>1e4aec178e08: Already exists <br>6c1024729fee: Already exists <br>c3aa11fbc85a: Already exists <br>aa54add66b3a: Already exists <br>9e3a60c2bce7: Already exists <br>3b2123ce9d0d: Already exists <br>05df7720fcb8: Already exists <br>972ab8743e38: Already exists <br>c6510153b089: Already exists <br>Digest: sha256:86b2fe5e3cf5b979f4b21849ad340762f4a15129583c8134c6c2dc4a880942e6<br>Status: Downloaded newer image for python:3<br> ---> a41622906035<br>Step 2/16 : WORKDIR /usr/src/app<br> ---> Running in 8ee7c5e5e76c<br>Removing intermediate container 8ee7c5e5e76c<br> ---> 50b45c704853<br>Step 3/16 : MAINTAINER Alejandro Montes Delgado \"aaleemd11@gmail.com\"</code></pre>\n<p>Listamos las im√°genes para verificar que se ha creado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/django$ docker image ls<br>REPOSITORY                TAG       IMAGE ID       CREATED          SIZE<br>alemd01/django_tutorial   v1        936a3553d4ee   12 seconds ago   1GB<br>python                    3         a41622906035   2 days ago       925MB<br></code></pre>\n<h3 id=\"crea-un-docker-compose-para-desplegar-los-contenedores-necesarios.-configura-los-vol%C3%BAmenes-que-creas-necesarios-para-que-la-aplicaci%C3%B3n-sea-persistente.\" tabindex=\"-1\">Crea un docker-compose para desplegar los contenedores necesarios. Configura los vol√∫menes que creas necesarios para que la aplicaci√≥n sea persistente.</h3>\n<p>Ahora con docker compose crearemos el escenario. El contenido del docker compose es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">version: '3.7'<br>services:<br>  django-tutorial:<br>    container_name: django-tutorial<br>    image: alemd01/django_tutorial:v1<br>    restart: always<br>    environment:<br>      ALLOWED_HOSTS: \"*\"<br>      HOST: bd_mariadb_django<br>      USUARIO: django<br>      CONTRA: django<br>      BASE_DATOS: django<br>      DJANGO_SUPERUSER_PASSWORD: admin<br>      DJANGO_SUPERUSER_USERNAME: admin<br>      DJANGO_SUPERUSER_EMAIL: admin@admin.org<br>    ports:<br>      - 8084:8006<br>    depends_on:<br>      - db_django<br>  db_django:<br>    container_name: bd_mariadb_django<br>    image: mariadb:latest<br>    restart: always<br>    environment:<br>      MARIADB_ROOT_PASSWORD: root<br>      MARIADB_DATABASE: django<br>      MARIADB_USER: django<br>      MARIADB_PASSWORD: django<br>    volumes:<br>      - mariadb_data_django:/var/lib/mysql<br><br>volumes:<br>    mariadb_data_django:<br></code></pre>\n<p>Levantamos el escenario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/django$ docker-compose up -d<br>Creating network \"django_default\" with the default driver<br>Creating volume \"django_mariadb_data_django\" with default driver<br>Creating bd_mariadb_django ... done<br>Creating django-tutorial   ... done</code></pre>\n<p>Verificamos que se han creado correctamente los contenedores:</p>\n<p><img src=\"/img/IAW-DOCKER-2.1.png\" alt=\"IAW-DOCKER-2.1.png\"></p>\n<p>Accedemos a nuestro django a trav√©s de internet:</p>\n<p><img src=\"/img/IAW-DOCKER-2.2.png\" alt=\"IAW-DOCKER-2.2.png\"></p>\n<p>Nos logueamos en la zona de administraci√≥n para verificar que funciona:</p>\n<p><img src=\"/img/IAW-DOCKER-2.3.png\" alt=\"IAW-DOCKER-2.3.png\"></p>\n<h3 id=\"una-vez-probada-en-el-entorno-de-desarrollo%2C-despliega-la-aplicaci%C3%B3n-en-tu-vps-usando-el-docker-compose-y-configurando-el-nginx-como-proxy-inveso-para-acceder-por-nombre-a-la-aplicaci%C3%B3n.\" tabindex=\"-1\">Una vez probada en el entorno de desarrollo, despliega la aplicaci√≥n en tu VPS usando el docker-compose y configurando el nginx como proxy inveso para acceder por nombre a la aplicaci√≥n.</h3>\n<p>Lo primero que haremos ser√° subir la imagen a dockerhub:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/django$ docker push alemd01/django_tutorial:v1<br>The push refers to repository [docker.io/alemd01/django_tutorial]<br>8881bf95f7f1: Pushed <br>328379340940: Pushed <br>8d465b69d17c: Pushed <br>ecfce2c62c6a: Pushed <br>0dd588580c52: Pushed <br>a875c3488142: Mounted from library/python <br>dd5a8632e1df: Mounted from library/python <br>43281466799e: Mounted from library/python <br>17efc79ac0fe: Mounted from library/python <br>0b6859e9fff1: Mounted from library/python <br>11829b3be9c0: Mounted from library/python <br>dc8e1d8b53e9: Mounted from library/python <br>9d49e0bc68a4: Mounted from library/python <br>8e396a1aad50: Mounted from alemd01/bookmedik <br>v1: digest: sha256:c7cc58e1486f4d147198321cc6b0d63a09390e1e1435d97f7906d3ac24c92f5e size: 3264</code></pre>\n<p>Ahora en nuestro proovedor de dns a√±adiremos una entrada cname para django:</p>\n<p><img src=\"/img/IAW-DOCKER-2.4.png\" alt=\"IAW-DOCKER-2.4.png\"></p>\n<p>Una vez hecho esto, es momento de ir a nuestro vps y lo primero que haremos ser√° generar un certificado para nuestro virtualhost:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd# certbot certonly --standalone -d django.alejandro-montes.es<br>Saving debug log to /var/log/letsencrypt/letsencrypt.log<br>Plugins selected: Authenticator standalone, Installer None<br>Attempting to parse the version 1.32.2 renewal configuration file found at /etc/letsencrypt/renewal/mail.alejandro-montes.es.conf with version 1.12.0 of Certbot. This might not work.<br>Requesting a certificate for django.alejandro-montes.es<br>Performing the following challenges:<br>http-01 challenge for django.alejandro-montes.es<br>Waiting for verification...<br>Cleaning up challenges<br><br>IMPORTANT NOTES:<br> - Congratulations! Your certificate and chain have been saved at:<br>   /etc/letsencrypt/live/django.alejandro-montes.es/fullchain.pem<br>   Your key file has been saved at:<br>   /etc/letsencrypt/live/django.alejandro-montes.es/privkey.pem<br>   Your certificate will expire on 2023-05-28. To obtain a new or<br>   tweaked version of this certificate in the future, simply run<br>   certbot again. To non-interactively renew *all* of your<br>   certificates, run \"certbot renew\"<br> - If you like Certbot, please consider supporting our work by:<br><br>   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate<br>   Donating to EFF:                    https://eff.org/donate-le<br></code></pre>\n<p>Ahora levantaremos el docker compose que es exactamente el mismo que usamos en desarrollo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd/docker/django# docker-compose up -d<br>Creating bd_mariadb_django ... done<br>Creating django-tutorial   ... done</code></pre>\n<p>Ahora crearemos un proxy inverso a trav√©s de un virtualhost de ngninx para poder acceder a la aplicaci√≥n mediante un nombre:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">server {<br>        listen 80;<br>        listen [::]:80;<br><br>        server_name django.alejandro-montes.es;<br><br>        return 301 https://$host$request_uri;<br>}<br><br>server {<br>        listen 443 ssl http2;<br>        listen [::]:443 ssl http2;<br><br>        ssl    on;<br>        ssl_certificate /etc/letsencrypt/live/django.alejandro-montes.es/fullchain.pem;<br>        ssl_certificate_key /etc/letsencrypt/live/django.alejandro-montes.es/privkey.pem;<br><br>        index index.html index.php index.htm index.nginx-debian.html;<br><br>        server_name django.alejandro-montes.es;<br><br>        location / {<br>                proxy_pass http://localhost:8084;<br>                include proxy_params;<br>        }<br>}</code></pre>\n<p>Lo activamos mediante un enlace simb√≥lico:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd/docker/django# ln -s /etc/nginx/sites-available/django /etc/nginx/sites-enabled/django</code></pre>\n<p>Reiniciamos nginx para que se apliquen los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd/docker/django# systemctl restart nginx</code></pre>\n<p>Accedemos a trav√©s de internet a la url:</p>\n<p><img src=\"/img/IAW-DOCKER-2.5.png\" alt=\"IAW-DOCKER-2.5.png\"></p>\n<p>Entramos en la zona de administraci√≥n:</p>\n<p><strong>A√ëADIR CSFR(HECHO Y NO FUNCIONA)</strong> LIADA GORDA NENEEEEE</p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-27T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/movimiento-de-datos/",
      "url": "https://reeseschultz.github.io/post/movimiento-de-datos/",
      "title": "Movimiento de datos",
      "content_html": "<h3 id=\"realiza-una-exportaci%C3%B3n-del-esquema-de-scott-usando-oracle-data-pump-con-las-siguientes-condiciones%3A\" tabindex=\"-1\">Realiza una exportaci√≥n del esquema de SCOTT usando Oracle Data Pump con las siguientes condiciones:</h3>\n<ul>\n<li><strong>Exporta tanto la estructura de las tablas como los datos de las mismas.</strong></li>\n<li><strong>Excluye la tabla BONUS y los departamentos con menos de dos empleados.</strong></li>\n<li><strong>Realiza una estimaci√≥n previa del tama√±o necesario para el fichero de exportaci√≥n.</strong></li>\n<li><strong>Programa la operaci√≥n para dentro de 2 minutos.</strong></li>\n<li><strong>Genera un archivo de log en el directorio ra√≠z.</strong></li>\n</ul>\n<p>Lo primero que haremos ser√° crear un directorio donde se guardar√° la exportaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ sudo mkdir /opt/oracle/export</code></pre>\n<p>Ahora nos conectamos con un usuario con privilegios y creamos un directorio objeto en la base de datos, le damos permiso de lectura y escritura en el directorio y le damos privilegios para que pueda exportar:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> CREATE DIRECTORY BD_EXPORT AS '/opt/oracle/export';<br><br>Directorio creado.<br><br>SQL> GRANT READ,WRITE ON DIRECTORY BD_EXPORT TO SCOTT;<br><br>Concesion terminada correctamente.<br><br><br>SQL> GRANT  DATAPUMP_EXP_FULL_DATABASE TO SCOTT;<br><br>Concesion terminada correctamente.<br></code></pre>\n<p>Ejecutamos el siguiente comando para ver la estimaci√≥n del tama√±o del fichero de exportaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ expdp scott/TIGER schemas=scott exclude=table:\\\"IN \\(\\'BONUS\\'\\)\\\" directory=BD_EXPORT ESTIMATE_ONLY=YES<br><br>Export: Release 19.0.0.0.0 - Production on Sun Feb 26 16:23:01 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Connected to: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production<br><br>Advertencia: Las operaciones de Oracle Data Pump no se necesitan normalmente cuando se conecta a la raiz o al elemento inicial de una base de datos del contenedor.<br><br>Iniciando \"SCOTT\".\"SYS_EXPORT_SCHEMA_01\":  scott/******** schemas=scott exclude=table:\"IN ('BONUS')\" directory=BD_EXPORT ESTIMATE_ONLY=YES <br>Estimacion en curso mediante el metodo BLOCKS...<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/TABLE_DATA<br>.  estimado \"SCOTT\".\"EMP\"                                 896 MB<br>.  estimado \"SCOTT\".\"DEPT\"                                 64 KB<br>Estimacion total mediante el metodo BLOCKS: 896.0 MB<br>El trabajo \"SCOTT\".\"SYS_EXPORT_SCHEMA_01\" ha terminado correctamente en Dom Feb 26 16:23:10 2023 elapsed 0 00:00:08<br><br></code></pre>\n<p>Creamos un script para realizar la exportaci√≥n y lo ejecutamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">echo \"La exportaci√≥n se realizar√° en 2 minutos...\"<br>sleep 120<br>expdp scott/TIGER schemas=scott exclude=table:\\\"IN \\(\\'BONUS\\'\\)\\\" directory=BD_EXPORT dumpfile=SCOTT.dmp logfile=SCOTT.log<br></code></pre>\n<p>Lo ejecutamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ ./export.sh <br>La exportaci√≥n se realizar√° en 2 minutos...<br><br>Export: Release 19.0.0.0.0 - Production on Sat Feb 25 21:09:00 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Connected to: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production<br><br>Advertencia: Las operaciones de Oracle Data Pump no se necesitan normalmente cuando se conecta a la raiz o al elemento inicial de una base de datos del contenedor.<br><br>Iniciando \"SCOTT\".\"SYS_EXPORT_SCHEMA_01\":  scott/******** schemas=scott exclude=table:\"IN ('BONUS')\" directory=BD_EXPORT dumpfile=SCOTT.dmp logfile=SCOTT.log <br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/TABLE_DATA<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/INDEX/STATISTICS/INDEX_STATISTICS<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICS<br>Procesando el tipo de objeto SCHEMA_EXPORT/STATISTICS/MARKER<br>Procesando el tipo de objeto SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMA<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/TABLE<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/GRANT/OWNER_GRANT/OBJECT_GRANT<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/COMMENT<br>Procesando el tipo de objeto SCHEMA_EXPORT/PROCEDURE/PROCEDURE<br>Procesando el tipo de objeto SCHEMA_EXPORT/PROCEDURE/ALTER_PROCEDURE<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/INDEX/INDEX<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/CONSTRAINT/CONSTRAINT<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/CONSTRAINT/REF_CONSTRAINT<br>. . \"SCOTT\".\"EMP\"                               22.41 KB      14 filas exportadas<br>. . \"SCOTT\".\"DEPT\"                              6.046 KB       5 filas exportadas<br>La tabla maestra \"SCOTT\".\"SYS_EXPORT_SCHEMA_01\" se ha cargado/descargado correctamente<br>******************************************************************************<br>El juego de archivos de volcado para SCOTT.SYS_EXPORT_SCHEMA_01 es:<br>  /opt/oracle/export/SCOTT.dmp<br>El trabajo \"SCOTT\".\"SYS_EXPORT_SCHEMA_01\" ha terminado correctamente en Sab Feb 25 21:09:14 2023 elapsed 0 00:00:13<br></code></pre>\n<p>No he podido excluir los departamentos con menos de dos empleados debido a que usando el par√°metro query e indicando que para la tabla dept coja los que tienen m√°s de dos empleados, no me funcionaba. Adjunto el par√°metro query y su contenido:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">query=DEPT:\\\"WHERE \\(SELECT COUNT\\(*\\) FROM EMP WHERE EMP.DEPTNO = DEPT.DEPTNO\\) \\> 1\\\"</code></pre>\n<h3 id=\"importa-el-fichero-obtenido-anteriormente-usando-oracle-data-pump-pero-en-un-usuario-distinto-de-la-misma-base-de-datos.\" tabindex=\"-1\">Importa el fichero obtenido anteriormente usando Oracle Data Pump pero en un usuario distinto de la misma base de datos.</h3>\n<p>Primero le damos permisos de lectura y escritura sobre el directorio donde est√° almacenada la exportaci√≥n al usuario en el que la importaremos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> GRANT READ, WRITE ON DIRECTORY BD_EXPORT TO alemd;<br><br>Concesion terminada correctamente.<br></code></pre>\n<p>Antes de realizar la importaci√≥n, al usuario en el cual la realizaremos, le concederemos privilegios sobre importaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> GRANT IMP_FULL_DATABASE TO alemd;<br><br>Concesion terminada correctamente.<br></code></pre>\n<p>Con el comando impdp importaremos la exportaci√≥n realizada anteriormente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ impdp alemd/usuario schemas=SCOTT directory=BD_EXPORT dumpfile=SCOTT.dmp logfile=SCOTTimport.log <br><br>Import: Release 19.0.0.0.0 - Production on Sun Feb 26 13:37:10 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Connected to: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production<br><br>Advertencia: Las operaciones de Oracle Data Pump no se necesitan normalmente cuando se conecta a la raiz o al elemento inicial de una base de datos del contenedor.<br><br>La tabla maestra \"ALEMD\".\"SYS_IMPORT_SCHEMA_01\" se ha cargado/descargado correctamente<br>Iniciando \"ALEMD\".\"SYS_IMPORT_SCHEMA_01\":  alemd/******** schemas=SCOTT directory=BD_EXPORT dumpfile=SCOTT.dmp logfile=SCOTTimport.log <br>Procesando el tipo de objeto SCHEMA_EXPORT/ROLE_GRANT<br>Procesando el tipo de objeto SCHEMA_EXPORT/DEFAULT_ROLE<br>Procesando el tipo de objeto SCHEMA_EXPORT/PRE_SCHEMA/PROCACT_SCHEMA<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/TABLE<br>ORA-39151: La tabla \"SCOTT\".\"EMP\" existe. Todos los metadados dependientes y los datos se omitiran debido table_exists_action de omitir<br><br>ORA-39151: La tabla \"SCOTT\".\"DEPT\" existe. Todos los metadados dependientes y los datos se omitiran debido table_exists_action de omitir<br><br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/TABLE_DATA<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/GRANT/OWNER_GRANT/OBJECT_GRANT<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/FGA_POLICY<br>ORA-39083: Fallo de creacion del tipo de objeto FGA_POLICY con el error:<br>ORA-28101: la politica ya existe<br><br>El sql que falla es:<br>BEGIN DBMS_FGA.ADD_POLICY('SCOTT','EMP','POLICY_EJ4','SAL > 2000','','','',TRUE,'INSERT',DBMS_FGA.DB_EXTENDED,DBMS_FGA.ANY_COLUMNS,'SYS'); END;<br><br>Procesando el tipo de objeto SCHEMA_EXPORT/PROCEDURE/PROCEDURE<br>ORA-31684: El tipo de objeto PROCEDURE:\"SCOTT\".\"ADD_10000_EMP\" ya existe<br><br>ORA-31684: El tipo de objeto PROCEDURE:\"SCOTT\".\"ADD_100000_EMP\" ya existe<br><br>Procesando el tipo de objeto SCHEMA_EXPORT/PROCEDURE/ALTER_PROCEDURE<br>ORA-39111: Se ha saltado el tipo de objeto dependiente ALTER_PROCEDURE:\"SCOTT\".\"ADD_100000_EMP\", ya existe el tipo de objeto base PROCEDURE:\"SCOTT\".\"ADD_100000_EMP\"<br><br>ORA-39111: Se ha saltado el tipo de objeto dependiente ALTER_PROCEDURE:\"SCOTT\".\"ADD_10000_EMP\", ya existe el tipo de objeto base PROCEDURE:\"SCOTT\".\"ADD_10000_EMP\"<br><br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/INDEX/INDEX<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/CONSTRAINT/CONSTRAINT<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/INDEX/STATISTICS/INDEX_STATISTICS<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/CONSTRAINT/REF_CONSTRAINT<br>Procesando el tipo de objeto SCHEMA_EXPORT/TABLE/STATISTICS/TABLE_STATISTICS<br>Procesando el tipo de objeto SCHEMA_EXPORT/STATISTICS/MARKER<br>El trabajo \"ALEMD\".\"SYS_IMPORT_SCHEMA_01\" ha terminado con 7 error(es) en Dom Feb 26 13:37:19 2023 elapsed 0 00:00:08<br></code></pre>\n<p>Salen errores, porque no es el primer intento con ese usuario y se han duplicado cosas. A continuaci√≥n nos conectaremos con el usuario y realizaremos una consulta a la tabla DEPT.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT DNAME FROM SCOTT.DEPT;<br><br>DNAME<br>--------------<br>PRUEBA<br>ACCOUNTING<br>RESEARCH<br>SALES<br>OPERATIONS<br></code></pre>\n<p>Tenemos que indicar el esquema al consultar la tabla debido a que hemos realizado la exportaci√≥n del esquema y al realizar la importaci√≥n, el esquema se ha importado.</p>\n<h3 id=\"realiza-una-exportaci%C3%B3n-de-la-estructura-de-todas-las-tablas-de-la-base-de-datos-usando-el-comando-expdp-de-oracle-data-pump-probando-al-menos-cinco-de-las-posibles-opciones-que-ofrece-dicho-comando-y-document%C3%A1ndolas-adecuadamente.\" tabindex=\"-1\">Realiza una exportaci√≥n de la estructura de todas las tablas de la base de datos usando el comando expdp de Oracle Data Pump probando al menos cinco de las posibles opciones que ofrece dicho comando y document√°ndolas adecuadamente.</h3>\n<p>La exportaci√≥n la realizo usando el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ expdp system/usuario DIRECTORY=BD_EXPORT DUMPFILE=full_export.dmp FULL=YES CONTENT=METADATA_ONLY exclude=table:\\\"IN \\(\\'SCOTT.DEPT\\'\\)\\\" <br><br>Export: Release 19.0.0.0.0 - Production on Sun Feb 26 16:29:46 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Connected to: Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production<br><br>Advertencia: Las operaciones de Oracle Data Pump no se necesitan normalmente cuando se conecta a la raiz o al elemento inicial de una base de datos del contenedor.<br><br>Iniciando \"SYSTEM\".\"SYS_EXPORT_FULL_01\":  system/******** DIRECTORY=BD_EXPORT DUMPFILE=full_export.dmp FULL=YES CONTENT=METADATA_ONLY exclude=table:\"IN ('SCOTT.DEPT')\" <br>Procesando el tipo de objeto DATABASE_EXPORT/EARLY_OPTIONS/VIEWS_AS_TABLES/TABLE_DATA<br>Procesando el tipo de objeto DATABASE_EXPORT/NORMAL_OPTIONS/TABLE_DATA<br>Procesando el tipo de objeto DATABASE_EXPORT/NORMAL_OPTIONS/VIEWS_AS_TABLES/TABLE_DATA<br><br>.<br>.<br>.<br>.<br>.<br><br>La tabla maestra \"SYSTEM\".\"SYS_EXPORT_FULL_01\" se ha cargado/descargado correctamente<br>******************************************************************************<br>El juego de archivos de volcado para SYSTEM.SYS_EXPORT_FULL_01 es:<br>  /opt/oracle/export/full_export.dmp<br>El trabajo \"SYSTEM\".\"SYS_EXPORT_FULL_01\" ha terminado correctamente en Dom Feb 26 16:36:18 2023 elapsed 0 00:06:31<br></code></pre>\n<p>Ahora, explicar√© todos los par√°metros usados:</p>\n<ul>\n<li>\n<p>DIRECTORY: Con este par√°metro indicamos el directorio donde se guardar√° el dump, como vemos indica BD_EXPORT, esto lo hemos creados desde la terminal de sqlplus con el <code>CREATE DIRECTORY</code>, que indicamos un nombre del directorio y la ruta.</p>\n</li>\n<li>\n<p>DUMPFILE: Es el nombre del archivo donde se guarda la exportaci√≥n.</p>\n</li>\n<li>\n<p>FULL: Indicamos que la exportaci√≥n es de la base de datos al completo.</p>\n</li>\n<li>\n<p>CONTENT: Con este par√°metro, indicamos el contenido. Podemos indicar ALL que es por defecto e indica todo el contenido, DATA_ONLY solo guarda datos y METADATA_ONLY solo guarda metadatos como la estruct√∫ras de tablas.</p>\n</li>\n<li>\n<p>EXCLUDE: Con este par√°metros indicamos lo que queremos excluir, ya sea a trav√©s de una expresi√≥n regular, una tabla, un esquema‚Ä¶</p>\n</li>\n</ul>\n<h3 id=\"intenta-realizar-operaciones-similares-de-importaci%C3%B3n-y-exportaci%C3%B3n-con-las-herramientas-proporcionadas-con-mysql-desde-l%C3%ADnea-de-comandos%2C-documentando-el-proceso.\" tabindex=\"-1\">Intenta realizar operaciones similares de importaci√≥n y exportaci√≥n con las herramientas proporcionadas con MySQL desde l√≠nea de comandos, documentando el proceso.</h3>\n<p>Vamos a realizar una exportaci√≥n de la base de datos SCOTT y la importaremos en una base de datos llamada import:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@debian:/home/usuario# mysqldump -u root SCOTT > mariadbexport.sql<br>root@debian:/home/usuario# ls<br>alemd.key  gonzalonazareno.crt\tPRACTICA_DOCKER<br>docker\t   mariadbexport.sql</code></pre>\n<p>Con este comando, hemos exportado la base de datos SCOTT al fichero mariadbexport.sql. Ahora Crearemos una base de datos totalmente limpia llamada import que es donde importaremos el dump.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">MariaDB [(none)]> CREATE DATABASE IMPORT_SCOTT;<br>Query OK, 1 row affected (0,001 sec)<br><br>MariaDB [(none)]> EXIT<br>Bye</code></pre>\n<p>Ahora ejecutamos el siguiente comando para importar los datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@debian:/home/usuario# mysql -u root IMPORT_SCOTT &lt; mariadbexport.sql</code></pre>\n<p>Nos conectamos a la base de datos y mostramos que se han creado las tablas correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@debian:/home/usuario# mysql<br>Welcome to the MariaDB monitor.  Commands end with ; or \\g.<br>Your MariaDB connection id is 35<br>Server version: 10.5.18-MariaDB-0+deb11u1 Debian 11<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.<br><br>MariaDB [(none)]> use IMPORT_SCOTT<br>Reading table information for completion of table and column names<br>You can turn off this feature to get a quicker startup with -A<br><br>Database changed<br>MariaDB [IMPORT_SCOTT]> show tables;<br>+------------------------+<br>| Tables_in_IMPORT_SCOTT |<br>+------------------------+<br>| DEPT                   |<br>| EMP                    |<br>+------------------------+<br>2 rows in set (0,000 sec)</code></pre>\n<p>Ahora realizar√© una consulta para probar que los datos est√°n insertados correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">MariaDB [IMPORT_SCOTT]> SELECT * FROM DEPT;<br>+--------+------------+----------+<br>| DEPTNO | DNAME      | LOC      |<br>+--------+------------+----------+<br>|     10 | ACCOUNTING | NEW YORK |<br>|     20 | RESEARCH   | DALLAS   |<br>|     30 | SALES      | CHICAGO  |<br>|     40 | OPERATIONS | BOSTON   |<br>+--------+------------+----------+<br>4 rows in set (0,001 sec)<br></code></pre>\n<h3 id=\"intenta-realizar-operaciones-similares-de-importaci%C3%B3n-y-exportaci%C3%B3n-con-las-herramientas-proporcionadas-con-postgres-desde-l%C3%ADnea-de-comandos%2C-documentando-el-proceso.\" tabindex=\"-1\">Intenta realizar operaciones similares de importaci√≥n y exportaci√≥n con las herramientas proporcionadas con Postgres desde l√≠nea de comandos, documentando el proceso.</h3>\n<p>En nuestra base de datos postgres, tenemos la base de datos de un aeropuerto, y procederemos a realizar una exportaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ pg_dump -U postgres aeropuerto > aeropuertodump.sql<br>postgres@PostgreSQL:~$ ls<br>11  aeropuertodump.sql\tinstantclient_21_1  oracle_fdw\tPG_11_201809051</code></pre>\n<p>Ahora lo importaremos en la base de datos import_aeropuerto:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ psql -U postgres -d import_aeropuerto &lt; aeropuertodump.sql <br>SET<br>SET<br>SET<br>SET<br>SET<br> set_config <br>------------<br> <br>(1 fila)<br><br>SET<br>SET<br>SET<br>SET<br>CREATE FUNCTION<br>ALTER FUNCTION<br>CREATE FUNCTION<br>ALTER FUNCTION<br>SET<br>SET<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>CREATE TABLE<br>ALTER TABLE<br>COPY 8<br>COPY 6<br>COPY 6<br>COPY 20<br>COPY 3<br>COPY 4<br>COPY 10<br>COPY 18<br>COPY 12<br>COPY 3<br>COPY 12<br>COPY 5<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>CREATE TRIGGER<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>ALTER TABLE<br>GRANT<br></code></pre>\n<p>Nos conectamos a la base de datos y mostramos que se ha importado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ psql<br>psql (11.17 (Debian 11.17-0+deb10u1))<br>Digite ¬´help¬ª para obtener ayuda.<br><br>postgres=# \\c import_aeropuerto<br>Ahora est√° conectado a la base de datos ¬´import_aeropuerto¬ª con el usuario ¬´postgres¬ª.<br>import_aeropuerto=# \\d<br>              Listado de relaciones<br> Esquema |       Nombre        | Tipo  |  Due√±o   <br>---------+---------------------+-------+----------<br> public  | aeronaves           | tabla | postgres<br> public  | aeropuertos         | tabla | postgres<br> public  | auxiliares          | tabla | postgres<br> public  | auxiliaresdeviaje   | tabla | postgres<br> public  | copilotos           | tabla | postgres<br> public  | modelos             | tabla | postgres<br> public  | pasajeros           | tabla | postgres<br> public  | pasajerosembarcados | tabla | postgres<br> public  | personal            | tabla | postgres<br> public  | pilotos             | tabla | postgres<br> public  | viajes              | tabla | postgres<br> public  | vuelos              | tabla | postgres<br>(12 filas)<br></code></pre>\n<p>Hacemos una consulta a la tabla pilotos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">import_aeropuerto=# select * from pilotos;<br> numpasaporte <br>--------------<br> CVF000126<br> DSA000777<br> EJK000333<br>(3 filas)<br></code></pre>\n<h3 id=\"exporta-los-documentos-de-una-colecci%C3%B3n-de-mongodb-que-cumplan-una-determinada-condici%C3%B3n-e-imp%C3%B3rtalos-en-otra-base-de-datos.\" tabindex=\"-1\">Exporta los documentos de una colecci√≥n de MongoDB que cumplan una determinada condici√≥n e imp√≥rtalos en otra base de datos.</h3>\n<p>Tenemos una colecci√≥n con algunos restaurantes de estados unidos. Vamos a exportar los restaurantes que sean del barrio del Bronx y de tipo de comida Americana:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/vagrant# mongoexport -u admin --db admin --collection restaurants -q \"{ \\\"borough\\\": \\\"Bronx\\\", \\\"cuisine\\\": \\\"American\\\" }\" --out restaurantes_americanos_bronx.json<br>Enter password for mongo user:<br><br>2023-02-26T18:43:11.396+0000\tconnected to: mongodb://localhost/<br>2023-02-26T18:43:11.524+0000\texported 822 records<br>root@mongodb:/home/vagrant# ls<br>primer-dataset.json  restaurantes_americanos_bronx.json</code></pre>\n<p>Ahora lo importaremos en una base de datos llamada prueba:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/vagrant# mongoimport -u alemd --db prueba --collection restaurants --file restaurantes_americanos_bronx.json<br>Enter password for mongo user:<br><br>2023-02-26T19:01:51.176+0000\tconnected to: mongodb://localhost/<br>2023-02-26T19:01:51.777+0000\t822 document(s) imported successfully. 0 document(s) failed to import.</code></pre>\n<p>Nos conectamos y haremos una consulta para ver que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/vagrant# mongosh -u alemd -p --authenticationDatabase prueba<br>Enter password: *******<br>Current Mongosh Log ID:\t63fbacdc88222b513ba0b957<br>Connecting to:\t\tmongodb://&lt;credentials>@127.0.0.1:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;authSource=prueba&amp;appName=mongosh+1.7.1<br>Using MongoDB:\t\t6.0.4<br>Using Mongosh:\t\t1.7.1<br><br>For mongosh info see: https://docs.mongodb.com/mongodb-shell/<br><br>Enterprise test> use prueba<br>switched to db prueba<br>Enterprise prueba> db.restaurants.findOne()<br>{<br>  _id: ObjectId(\"63fba382a0e597287f628a4a\"),<br>  address: {<br>    building: '2300',<br>    coord: [ -73.8786113, 40.8502883 ],<br>    street: 'Southern Boulevard',<br>    zipcode: '10460'<br>  },<br>  borough: 'Bronx',<br>  cuisine: 'American',<br>  grades: [<br>    {<br>      date: ISODate(\"2014-05-28T00:00:00.000Z\"),<br>      grade: 'A',<br>      score: 11<br>    },<br>    { date: ISODate(\"2013-06-19T00:00:00.000Z\"), grade: 'A', score: 4 },<br>    { date: ISODate(\"2012-06-15T00:00:00.000Z\"), grade: 'A', score: 3 }<br>  ],<br>  name: 'Wild Asia',<br>  restaurant_id: '40357217'<br>}</code></pre>\n<h3 id=\"sqlloader-es-una-herramienta-que-sirve-para-cargar-grandes-vol%C3%BAmenes-de-datos-en-una-instancia-de-oracle.-exportad-los-datos-de-una-base-de-datos-completa-desde-postgres-a-texto-plano-con-delimitadores-y-emplead-sqlloader-para-realizar-el-proceso-de-carga-de-dichos-datos-a-una-instancia-oracle.-deb%C3%A9is-documentar-todo-el-proceso%2C-explicando-los-distintos-ficheros-de-configuraci%C3%B3n-y-de-log-que-tiene-sqlloader.\" tabindex=\"-1\">SQLLoader es una herramienta que sirve para cargar grandes vol√∫menes de datos en una instancia de ORACLE. Exportad los datos de una base de datos completa desde Postgres a texto plano con delimitadores y emplead SQLLoader para realizar el proceso de carga de dichos datos a una instancia ORACLE. Deb√©is documentar todo el proceso, explicando los distintos ficheros de configuraci√≥n y de log que tiene SQLLoader.</h3>\n<p>Lo primero que haremos ser√° en postgres exportar la base de datos del aeropuerto como un archivo csv delimitado por coma. Para ello, he creado un procedimiento que me crear√° por cada tabla de la base de datos un fichero csv con los datos de cada tabla:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres=# CREATE OR REPLACE FUNCTION exportar_tablas_a_csv(<br>    _nombre_de_la_base_de_datos TEXT,<br>    _ruta TEXT<br>)<br>RETURNS VOID AS $$<br>DECLARE<br>    _nombre_de_la_tabla TEXT;<br>BEGIN<br>    FOR _nombre_de_la_tabla IN<br>        SELECT table_name<br>        FROM information_schema.tables<br>        WHERE table_schema = 'public'<br>        AND table_type = 'BASE TABLE'<br>    LOOP<br>        EXECUTE format(<br>            'COPY %I TO %L WITH (FORMAT CSV, DELIMITER \",\", HEADER)',<br>            _nombre_de_la_tabla,<br>            _ruta || _nombre_de_la_tabla || '.csv'<br>        );<br>    END LOOP;<br>END;<br>$$ LANGUAGE plpgsql;<br>CREATE FUNCTION<br></code></pre>\n<p>Ahora ejecutamos el procedimiento:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">aeropuerto=# SELECT exportar_tablas_a_csv('SCOTT', '/var/lib/postgresql/');<br> exportar_tablas_a_csv <br>-----------------------<br> <br>(1 fila)<br></code></pre>\n<p>Como vemos, tenemos las tablas emp y dept en ficheros csv:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ ls<br>11\t    dept.csv  instantclient_21_1  PG_11_201809051<br>aeropuerto  emp.csv   oracle_fdw<br></code></pre>\n<p>Ahora creamos los archivos de control que usaremos para importar cada tabla:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">OPTIONS (SKIP=1)<br>LOAD DATA<br>INFILE '/home/alemd/oracle/dept.csv'<br>INTO TABLE DEPT<br>FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '\"'<br>TRAILING NULLCOLS<br>(deptno, DNAME, LOC)</code></pre>\n<p>Ahora muestro el fichero de control de la tabla emp:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">OPTIONS (SKIP=1)<br>LOAD DATA<br>INFILE '/home/alemd/oracle/emp.csv'<br>INTO TABLE emp<br>FIELDS TERMINATED BY ',' OPTIONALLY ENCLOSED BY '\"'<br>TRAILING NULLCOLS<br>(EMPNO,<br>ENAME,<br>JOB,<br>MGR,<br>HIREDATE DATE \"YYYY-MM-DD HH24:MI:SS\",<br>SAL DECIMAL EXTERNAL (7),<br>COMM DECIMAL EXTERNAL (7),<br>DEPTNO)</code></pre>\n<p>La opci√≥n skip=1, hace que no inserte la primera fila, que en el fichero csv ser√≠a el nombre de las columnas, con load data indicamos que cargue los datos desde el archivo emp.csv a la tabla emp y est√° separado por una coma y opcionalmente cerrado por una comilla doble. Por √∫ltimo, indicamos el nombre de las columnas, y si necesita alg√∫n formato concreto como una fecha o un n√∫mero decimal.</p>\n<p>Ejecutamos el sql loader para la tabla dept, como vemos se han cargado correctamente los datos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/oracle$ sqlldr SCOTT/TIGER control=/home/alemd/oracle/dept.ctl log=/home/alemd/oracle/dept.log<br><br>SQL*Loader: Release 19.0.0.0.0 - Production on Mon Feb 27 00:15:41 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Path used:      Conventional<br>Commit point reached - logical record count 4<br><br>Table DEPT:<br>  4 Rows successfully loaded.<br><br>Check the log file:<br>  /home/alemd/oracle/dept.log<br>for more information about the load.</code></pre>\n<p>Ejecutamos el sql loader para la tabla emp:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/oracle$ sqlldr SCOTT/TIGER control=/home/alemd/oracle/emp.ctl log=/home/alemd/oracle/emp.log<br><br>SQL*Loader: Release 19.0.0.0.0 - Production on Wed Mar 1 10:39:05 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Path used:      Conventional<br>Commit point reached - logical record count 14<br><br>Table EMP:<br>  14 Rows successfully loaded.<br><br>Check the log file:<br>  /home/alemd/oracle/emp.log<br>for more information about the load.</code></pre>\n<p>Ahora veremos el log:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/oracle$ cat dept.log <br><br>SQL*Loader: Release 19.0.0.0.0 - Production on Mon Feb 27 00:15:41 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Control File:   /home/alemd/oracle/dept.ctl<br>Data File:      /home/alemd/oracle/dept.csv<br>  Bad File:     /home/alemd/oracle/dept.bad<br>  Discard File:  none specified<br> <br> (Allow all discards)<br><br>Number to load: ALL<br>Number to skip: 1<br>Errors allowed: 50<br>Bind array:     250 rows, maximum of 1048576 bytes<br>Continuation:    none specified<br>Path used:      Conventional<br><br>Table DEPT, loaded from every logical record.<br>Insert option in effect for this table: INSERT<br>TRAILING NULLCOLS option in effect<br><br>   Column Name                  Position   Len  Term Encl Datatype<br>------------------------------ ---------- ----- ---- ---- ---------------------<br>DEPTNO                              FIRST     *   ,  O(\") CHARACTER            <br>DNAME                                NEXT     *   ,  O(\") CHARACTER            <br>LOC                                  NEXT     *   ,  O(\") CHARACTER            <br><br><br>Table DEPT:<br>  4 Rows successfully loaded.<br>  0 Rows not loaded due to data errors.<br>  0 Rows not loaded because all WHEN clauses were failed.<br>  0 Rows not loaded because all fields were null.<br><br><br>Space allocated for bind array:                 193500 bytes(250 rows)<br>Read   buffer bytes: 1048576<br><br>Total logical records skipped:          1<br>Total logical records read:             4<br>Total logical records rejected:         0<br>Total logical records discarded:        0<br><br>Run began on Mon Feb 27 00:15:41 2023<br>Run ended on Mon Feb 27 00:15:41 2023<br><br>Elapsed time was:     00:00:00.10<br>CPU time was:         00:00:00.03<br></code></pre>\n<p>Este log indica que en la tabla dept hemos tenido 4 filas cargadas correctamente. Ahora vemos el log de la tabla EMP:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL*Loader: Release 19.0.0.0.0 - Production on Wed Mar 1 10:39:05 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>Control File:   /home/alemd/oracle/emp.ctl<br>Data File:      /home/alemd/oracle/emp.csv<br>  Bad File:     /home/alemd/oracle/emp.bad<br>  Discard File:  none specified<br> <br> (Allow all discards)<br><br>Number to load: ALL<br>Number to skip: 1<br>Errors allowed: 50<br>Bind array:     250 rows, maximum of 1048576 bytes<br>Continuation:    none specified<br>Path used:      Conventional<br><br>Table EMP, loaded from every logical record.<br>Insert option in effect for this table: APPEND<br>TRAILING NULLCOLS option in effect<br><br>   Column Name                  Position   Len  Term Encl Datatype<br>------------------------------ ---------- ----- ---- ---- ---------------------<br>EMPNO                               FIRST     *   ,  O(\") CHARACTER            <br>ENAME                                NEXT     *   ,  O(\") CHARACTER            <br>JOB                                  NEXT     *   ,  O(\") CHARACTER            <br>MGR                                  NEXT     *   ,  O(\") CHARACTER            <br>HIREDATE                             NEXT     *   ,  O(\") DATE YYYY-MM-DD HH24:MI:SS<br>SAL                                  NEXT     7   ,  O(\") CHARACTER            <br>COMM                                 NEXT     7   ,  O(\") CHARACTER            <br>DEPTNO                               NEXT     *   ,  O(\") CHARACTER            <br><br><br>Table EMP:<br>  14 Rows successfully loaded.<br>  0 Rows not loaded due to data errors.<br>  0 Rows not loaded because all WHEN clauses were failed.<br>  0 Rows not loaded because all fields were null.<br><br><br>Space allocated for bind array:                 392000 bytes(250 rows)<br>Read   buffer bytes: 1048576<br><br>Total logical records skipped:          1<br>Total logical records read:            14<br>Total logical records rejected:         0<br>Total logical records discarded:        0<br><br>Run began on Wed Mar 01 10:39:05 2023<br>Run ended on Wed Mar 01 10:39:05 2023<br><br>Elapsed time was:     00:00:00.10<br>CPU time was:         00:00:00.03</code></pre>\n<p>Vemos tambi√©n que se ha insertado correctamente. Por √∫ltimo muestro que se han insertado los registros correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT * FROM DEPT;<br><br>    DEPTNO DNAME\t  LOC<br>---------- -------------- -------------<br>\t10 ACCOUNTING\t  NEW YORK<br>\t20 RESEARCH\t  DALLAS<br>\t30 SALES\t  CHICAGO<br>\t40 OPERATIONS\t  BOSTON<br><br>SQL> SELECT * FROM EMP;<br><br>     EMPNO ENAME      JOB\t       MGR HIREDATE\t   SAL\t     COMM<br>---------- ---------- --------- ---------- -------- ---------- ----------<br>    DEPTNO<br>----------<br>      7839 KING       PRESIDENT \t 1 17/11/81\t  5000\t\t0<br>\t10<br><br>      7698 BLAKE      MANAGER\t      7839 01/05/81\t  2850\t\t0<br>\t30<br><br>      7782 CLARK      MANAGER\t      7839 09/06/81\t  2450\t\t0<br>\t10<br><br><br>     EMPNO ENAME      JOB\t       MGR HIREDATE\t   SAL\t     COMM<br>---------- ---------- --------- ---------- -------- ---------- ----------<br>    DEPTNO<br>----------<br>      7566 JONES      MANAGER\t      7839 02/04/81\t  2975\t\t0<br>\t20<br><br>      7788 SCOTT      ANALYST\t      7566 19/04/01\t  3000\t\t0<br>\t20<br><br>      7902 FORD       ANALYST\t      7566 03/12/81\t  3000\t\t0<br>\t20<br><br><br>     EMPNO ENAME      JOB\t       MGR HIREDATE\t   SAL\t     COMM<br>---------- ---------- --------- ---------- -------- ---------- ----------<br>    DEPTNO<br>----------<br>      7369 SMITH      CLERK\t      7902 17/12/80\t   800\t\t0<br>\t20<br><br>      7499 ALLEN      SALESMAN\t      7698 20/02/81\t  1600\t      300<br>\t30<br><br>      7521 WARD       SALESMAN\t      7698 22/02/81\t  1250\t      500<br>\t30<br><br><br>     EMPNO ENAME      JOB\t       MGR HIREDATE\t   SAL\t     COMM<br>---------- ---------- --------- ---------- -------- ---------- ----------<br>    DEPTNO<br>----------<br>      7654 MARTIN     SALESMAN\t      7698 28/09/81\t  1250\t     1400<br>\t30<br><br>      7844 TURNER     SALESMAN\t      7698 08/09/81\t  1500\t\t0<br>\t30<br><br>      7876 ADAMS      CLERK\t      7788 23/05/01\t  1100\t\t0<br>\t20<br><br><br>     EMPNO ENAME      JOB\t       MGR HIREDATE\t   SAL\t     COMM<br>---------- ---------- --------- ---------- -------- ---------- ----------<br>    DEPTNO<br>----------<br>      7900 JAMES      CLERK\t      7698 03/12/81\t   950\t\t0<br>\t30<br><br>      7934 MILLER     CLERK\t      7782 23/01/82\t  1300\t\t0<br>\t10<br><br><br>14 filas seleccionadas.<br></code></pre>\n<p>El √∫ltimo ejercicio ha sido realizado con la ayuda de mi compa√±era Mar√≠a Jes√∫s.</p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-25T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-k8s-vii./",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-k8s-vii./",
      "title": "Ejercicios de K8s VII.",
      "content_html": "<h3 id=\"instalaci%C3%B3n-de-un-cms-con-helm.\" tabindex=\"-1\">Instalaci√≥n de un CMS con Helm.</h3>\n<p>Vamos a instalar el CMS Wordpress usando Helm. Para ello, realiza los siguientes pasos:</p>\n<h4 id=\"1.-instala-la-%C3%BAltima-versi%C3%B3n-de-helm.\" tabindex=\"-1\">1. Instala la √∫ltima versi√≥n de Helm.</h4>\n<p>Para instalar helm, tenemos que seguir los siguientes pasos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ curl https://baltocdn.com/helm/signing.asc | gpg --dearmor | sudo tee /usr/share/keyrings/helm.gpg > /dev/null<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--    0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--  100  1700  100  1700    0     0   2014      0 --:--:-- --:--:-- --:--:--  2016</code></pre>\n<p>Instalamos el siguiente paquete:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ sudo apt-get install apt-transport-https --yes<br>Leyendo lista de paquetes... Hecho<br>Creando √°rbol de dependencias... Hecho<br>Leyendo la informaci√≥n de estado... Hecho<br>apt-transport-https ya est√° en su versi√≥n m√°s reciente (2.2.4).<br>0 actualizados, 0 nuevos se instalar√°n, 0 para eliminar y 98 no actualizados.</code></pre>\n<p>Ejecutamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main\" | sudo tee /etc/apt/sources.list.d/helm-stable-debian.list<br>deb [arch=amd64 signed-by=/usr/share/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main</code></pre>\n<p>Realizamos un update:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ sudo apt update<br>Obj:1 http://repository.spotify.com stable InRelease<br>Obj:2 http://download.virtualbox.org/virtualbox/debian bullseye InRelease<br>Obj:3 https://deb.debian.org/debian bullseye InRelease                   <br>Obj:4 https://security.debian.org/debian-security bullseye-security InRelease<br>Obj:5 http://packages.microsoft.com/repos/code stable InRelease          <br>Obj:6 https://deb.debian.org/debian bullseye-backports InRelease         <br>Obj:7 https://deb.debian.org/debian bullseye-updates InRelease           <br>Des:8 https://baltocdn.com/helm/stable/debian all InRelease [7.651 B]    <br>Des:9 https://baltocdn.com/helm/stable/debian all/main amd64 Packages [3.268 B]<br>Descargados 10,9 kB en 2s (5.884 B/s)<br>Leyendo lista de paquetes... Hecho<br>Creando √°rbol de dependencias... Hecho<br>Leyendo la informaci√≥n de estado... Hecho<br>Se pueden actualizar 98 paquetes. Ejecute ¬´apt list --upgradable¬ª para verlos.</code></pre>\n<p>Instalamos helm:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ sudo apt install helm<br>Leyendo lista de paquetes... Hecho<br>Creando √°rbol de dependencias... Hecho<br>Leyendo la informaci√≥n de estado... Hecho<br>Se instalar√°n los siguientes paquetes NUEVOS:<br>  helm<br>0 actualizados, 1 nuevos se instalar√°n, 0 para eliminar y 98 no actualizados.<br>Se necesita descargar 15,0 MB de archivos.<br>Se utilizar√°n 46,9 MB de espacio de disco adicional despu√©s de esta operaci√≥n.<br>Des:1 https://baltocdn.com/helm/stable/debian all/main amd64 helm amd64 3.11.1-1 [15,0 MB]<br>Descargados 15,0 MB en 40s (373 kB/s)                                    <br>Seleccionando el paquete helm previamente no seleccionado.<br>(Leyendo la base de datos ... 373507 ficheros o directorios instalados act<br>ualmente.)<br>Preparando para desempaquetar .../helm_3.11.1-1_amd64.deb ...<br>Desempaquetando helm (3.11.1-1) ...<br>Configurando helm (3.11.1-1) ...<br>Procesando disparadores para man-db (2.9.4-2) ...</code></pre>\n<p>Como podemos comprobar se ha instalado correctamente helm:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ helm version<br>version.BuildInfo{Version:\"v3.11.1\", GitCommit:\"293b50c65d4d56187cd4e2f390f0ada46b4c4737\", GitTreeState:\"clean\", GoVersion:\"go1.18.10\"}</code></pre>\n<h4 id=\"2.-a%C3%B1ade-el-repositorio-de-bitnami\" tabindex=\"-1\">2. A√±ade el repositorio de bitnami</h4>\n<p>Para a√±adir el repositorio de bitnami, ejecutamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ helm repo add bitnami https://charts.bitnami.com/bitnami<br>\"bitnami\" has been added to your repositories</code></pre>\n<p>Listamos los repositorios y vemos que lo tenemos a√±adido:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ helm repo list<br>NAME   \tURL                               <br>bitnami\thttps://charts.bitnami.com/bitnami</code></pre>\n<h4 id=\"3.-busca-el-chart-de-bitnami-para-la-instalaci%C3%B3n-de-wordpress.\" tabindex=\"-1\">3. Busca el chart de bitnami para la instalaci√≥n de Wordpress.</h4>\n<p>Actualizamos el repositorio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ helm repo update<br>Hang tight while we grab the latest from your chart repositories...<br>...Successfully got an update from the \"bitnami\" chart repository<br>Update Complete. ‚éàHappy Helming!‚éà</code></pre>\n<p>Y buscamos el chart de bitnami para instalar Wordpress:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ helm search repo wordpress<br>NAME                   \tCHART VERSION\tAPP VERSION\tDESCRIPTION                                       <br>bitnami/wordpress      \t15.2.45      \t6.1.1      \tWordPress is the world's most popular blogging ...<br>bitnami/wordpress-intel\t2.1.31       \t6.1.1      \tDEPRECATED WordPress for Intel is the most popu...</code></pre>\n<h4 id=\"4.-busca-la-documentaci%C3%B3n-del-chart-y-comprueba-los-par%C3%A1metros-para-cambiar-el-tipo-de-service-y-el-nombre-del-blog.\" tabindex=\"-1\">4. Busca la documentaci√≥n del chart y comprueba los par√°metros para cambiar el tipo de Service y el nombre del blog.</h4>\n<p>Los par√°metros que tenemos que usar para cambiar el tipo de service es <code>--set service.type=</code> y para cambiar el nombre del blog usamos  <code>--set wordpressBlogName=</code>. A continuaci√≥n muestro el comando completo.</p>\n<h4 id=\"5.-instala-el-chart-definiendo-el-tipo-del-service-como-nodeport-y-poniendo-tu-nombre-como-nombre-del-blog.\" tabindex=\"-1\">5. Instala el chart definiendo el tipo del Service como NodePort y poniendo tu nombre como nombre del blog.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ helm install servidor-web bitnami/wordpress --set service.type=NodePort --set wordpressBlogName=amontes<br>NAME: serverweb<br>LAST DEPLOYED: Thu Feb 23 08:54:04 2023<br>NAMESPACE: default<br>STATUS: deployed<br>REVISION: 1<br>TEST SUITE: None<br>NOTES:<br>CHART NAME: wordpress<br>CHART VERSION: 15.2.45<br>APP VERSION: 6.1.1<br><br>** Please be patient while the chart is being deployed **<br><br>Your WordPress site can be accessed through the following DNS name from within your cluster:<br><br>    serverweb-wordpress.default.svc.cluster.local (port 80)<br><br>To access your WordPress site from outside the cluster follow the steps below:<br><br>1. Get the WordPress URL by running these commands:<br><br>   export NODE_PORT=$(kubectl get --namespace default -o jsonpath=\"{.spec.ports[0].nodePort}\" services serverweb-wordpress)<br>   export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath=\"{.items[0].status.addresses[0].address}\")<br>   echo \"WordPress URL: http://$NODE_IP:$NODE_PORT/\"<br>   echo \"WordPress Admin URL: http://$NODE_IP:$NODE_PORT/admin\"<br><br>2. Open a browser and access WordPress using the obtained URL.<br><br>3. Login with the following credentials below to see your blog:<br><br>  echo Username: user<br>  echo Password: $(kubectl get secret --namespace default serverweb-wordpress -o jsonpath=\"{.data.wordpress-password}\" | base64 -d)<br></code></pre>\n<h4 id=\"6.-comprueba-los-pods%2C-replicaset%2C-deployment-y-services-que-se-han-creado.\" tabindex=\"-1\">6. Comprueba los Pods, ReplicaSet, Deployment y Services que se han creado.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get all<br>NAME                                          READY   STATUS    RESTARTS   AGE<br>pod/servidor-web-mariadb-0                    1/1     Running   0          2m25s<br>pod/servidor-web-wordpress-86cfdd7869-hpzqt   1/1     Running   1          2m25s<br><br>NAME                             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE<br>service/kubernetes               ClusterIP   10.96.0.1       &lt;none>        443/TCP                      12m<br>service/servidor-web-mariadb     ClusterIP   10.104.242.8    &lt;none>        3306/TCP                     2m26s<br>service/servidor-web-wordpress   NodePort    10.107.162.99   &lt;none>        80:30535/TCP,443:32693/TCP   2m26s<br><br>NAME                                     READY   UP-TO-DATE   AVAILABLE   AGE<br>deployment.apps/servidor-web-wordpress   1/1     1            1           2m25s<br><br>NAME                                                DESIRED   CURRENT   READY   AGE<br>replicaset.apps/servidor-web-wordpress-86cfdd7869   1         1         1       2m25s<br><br>NAME                                    READY   AGE<br>statefulset.apps/servidor-web-mariadb   1/1     2m25s<br></code></pre>\n<h4 id=\"7.-accede-a-la-aplicaci%C3%B3n.\" tabindex=\"-1\">7. Accede a la aplicaci√≥n.</h4>\n<p><img src=\"/img/SRI-K8S-VII.1.png\" alt=\"SRI-K8S-VII.1.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-23T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/cortafuegos-ii:-perimetral-con-nftables./",
      "url": "https://reeseschultz.github.io/post/cortafuegos-ii:-perimetral-con-nftables./",
      "title": "Cortafuegos II: Perimetral con nftables.",
      "content_html": "<h3 id=\"despliegue-del-escenario.\" tabindex=\"-1\">Despliegue del escenario.</h3>\n<p>Antes que nada, lo primero que haremos ser√° desplegar la receta heat escenario2.yaml en OpenStack. Para que funcione tendremos que cambiar el ID de la imagen que usa por uno actualizado con debian 11. El id que he usado yo es el siguiente <code>6d992898-7e4f-44b9-a681-6dcf32d24a1f</code>, este ID se puede encontrar en el apartado de Computaci√≥n de OpenStack, en Im√°genes, seleccionamos la imagen que vamos a usar para las m√°quinas del escenario, en este caso Debian 11 y copiamos el ID.</p>\n<h3 id=\"configuraci%C3%B3n-de-rutas-por-defecto.\" tabindex=\"-1\">Configuraci√≥n de rutas por defecto.</h3>\n<p>En lan configuramos las rutas por defecto:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ sudo ip route del default<br>debian@lan:~$ sudo ip route add default via 192.168.100.2</code></pre>\n<h3 id=\"preparaci%C3%B3n-del-escenario-con-nftables\" tabindex=\"-1\">Preparaci√≥n del escenario con nftables</h3>\n<h4 id=\"crear-las-tablas-filter-y-nat.\" tabindex=\"-1\">Crear las tablas filter y nat.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add table inet filter<br>root@router-fw:/home/debian# nft add table inet nat</code></pre>\n<h4 id=\"crear-las-cadenas-de-filter.\" tabindex=\"-1\">Crear las cadenas de filter.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add chain inet filter input { type filter hook input priority 0 \\; counter \\; policy accept \\; }<br>root@router-fw:/home/debian#  nft add chain inet filter output { type filter hook output priority 0 \\; counter \\; policy accept \\; }<br>root@router-fw:/home/debian#  nft add chain inet filter forward { type filter hook forward priority 0 \\; counter \\; policy accept \\; }</code></pre>\n<h4 id=\"crear-las-cadenas-de-nat.\" tabindex=\"-1\">Crear las cadenas de nat.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add chain inet nat prerouting { type nat hook prerouting priority 0 \\; }<br>root@router-fw:/home/debian#  nft add chain inet nat postrouting { type nat hook postrouting priority 100 \\; }</code></pre>\n<h4 id=\"tr%C3%A1fico-ssh-entrante-al-firewall.\" tabindex=\"-1\">Tr√°fico ssh entrante al firewall.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter input ip saddr 172.29.0.0/16 tcp dport 22 ct state new,established counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter output ip daddr 172.29.0.0/16 tcp sport 22 ct state established counter accept</code></pre>\n<h4 id=\"pol%C3%ADticas-por-defecto.\" tabindex=\"-1\">Pol√≠ticas por defecto.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft chain inet filter input { policy drop \\; }<br>root@router-fw:/home/debian#  nft chain inet filter output { policy drop \\; }<br>root@router-fw:/home/debian#  nft chain inet filter forward { policy drop \\; }</code></pre>\n<p>Llegados a este punto, no podremos ni hacer ping a la lo ni a internet ni realizar un ssh ya que est√° todo restringido:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# ping 127.0.0.1<br>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.<br>^C<br>--- 127.0.0.1 ping statistics ---<br>3 packets transmitted, 0 received, 100% packet loss, time 2045ms<br><br>root@router-fw:/home/debian# ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>^C<br>--- 8.8.8.8 ping statistics ---<br>4 packets transmitted, 0 received, 100% packet loss, time 3073ms<br><br>root@router-fw:/home/debian# exit<br>exit<br>debian@router-fw:~$ ssh debian@192.168.100.10<br>^C</code></pre>\n<h4 id=\"activamos-el-bit-de-forwarding.\" tabindex=\"-1\">Activamos el bit de forwarding.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# echo 1 > /proc/sys/net/ipv4/ip_forward</code></pre>\n<h4 id=\"snat.\" tabindex=\"-1\">SNAT.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet nat postrouting oifname \"ens3\" ip saddr 192.168.100.0/24 counter masquerade</code></pre>\n<h4 id=\"permitimos-el-ssh-desde-el-cortafuego-a-la-lan.\" tabindex=\"-1\">Permitimos el ssh desde el cortafuego a la LAN.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter output oifname \"ens4\" ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter input iifname \"ens4\" ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept</code></pre>\n<p>Ahora probamos que el ssh a la m√°quina lan s√≠ funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@router-fw:~$ ssh debian@192.168.100.10<br>Linux lan 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Wed Feb 22 18:17:21 2023 from 192.168.100.2<br>debian@lan:~$ </code></pre>\n<h4 id=\"permitimos-tr%C3%A1fico-para-la-interfaz-loopback.\" tabindex=\"-1\">Permitimos tr√°fico para la interfaz loopback.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter output oifname \"lo\" counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter input iifname \"lo\" counter accept</code></pre>\n<p>Probamos que vuelve a funcionar el ping a la lo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# ping 127.0.0.1<br>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.<br>64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.122 ms<br>64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.546 ms<br>64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.077 ms<br>^C<br>--- 127.0.0.1 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2005ms<br>rtt min/avg/max/mdev = 0.077/0.248/0.546/0.211 ms</code></pre>\n<h4 id=\"peticiones-y-respuestas-protocolo-icmp.\" tabindex=\"-1\">Peticiones y respuestas protocolo ICMP.</h4>\n<p>Para permitir que a la m√°quina router-fw le hagan ping desde fuera ejecutamos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter input iifname \"ens3\" icmp type echo-request counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter output oifname \"ens3\" icmp type echo-reply counter accept</code></pre>\n<p>Probamos que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ ping 172.22.200.17<br>PING 172.22.200.17 (172.22.200.17) 56(84) bytes of data.<br>64 bytes from 172.22.200.17: icmp_seq=1 ttl=61 time=310 ms<br>64 bytes from 172.22.200.17: icmp_seq=2 ttl=61 time=332 ms<br>64 bytes from 172.22.200.17: icmp_seq=3 ttl=61 time=355 ms<br>64 bytes from 172.22.200.17: icmp_seq=4 ttl=61 time=174 ms<br>^C<br>--- 172.22.200.17 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3004ms<br>rtt min/avg/max/mdev = 173.704/292.667/355.466/70.578 ms</code></pre>\n<p>Ahora permito que puedan hacer ping desde el cortafuegos a la lan:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter output oifname \"ens4\" icmp type echo-request counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter input iifname \"ens4\" icmp type echo-reply counter accept</code></pre>\n<p>Pruebo que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# ping 192.168.100.10<br>PING 192.168.100.10 (192.168.100.10) 56(84) bytes of data.<br>64 bytes from 192.168.100.10: icmp_seq=1 ttl=64 time=4.31 ms<br>64 bytes from 192.168.100.10: icmp_seq=2 ttl=64 time=5.72 ms<br>64 bytes from 192.168.100.10: icmp_seq=3 ttl=64 time=2.02 ms<br>64 bytes from 192.168.100.10: icmp_seq=4 ttl=64 time=6.16 ms<br>^C<br>--- 192.168.100.10 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3007ms<br>rtt min/avg/max/mdev = 2.022/4.554/6.164/1.614 ms</code></pre>\n<h4 id=\"reglas-forward.\" tabindex=\"-1\">Reglas forward.</h4>\n<h5 id=\"permitir-hacer-ping-desde-la-lan.\" tabindex=\"-1\">Permitir hacer ping desde la LAN.</h5>\n<p>Configuramos las siguientes reglas para que pueda haber tr√°fico icmp desde la lan a internet:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 icmp type echo-request counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip daddr 192.168.100.0/24 icmp type echo-reply counter accept</code></pre>\n<p>Realizamos un ping a 1.1.1.1 para probar que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ ping 1.1.1.1<br>PING 1.1.1.1 (1.1.1.1) 56(84) bytes of data.<br>64 bytes from 1.1.1.1: icmp_seq=1 ttl=51 time=45.5 ms<br>64 bytes from 1.1.1.1: icmp_seq=2 ttl=51 time=44.0 ms<br>64 bytes from 1.1.1.1: icmp_seq=3 ttl=51 time=46.1 ms<br>64 bytes from 1.1.1.1: icmp_seq=4 ttl=51 time=45.4 ms<br>64 bytes from 1.1.1.1: icmp_seq=5 ttl=51 time=46.0 ms<br>^C<br>--- 1.1.1.1 ping statistics ---<br>5 packets transmitted, 5 received, 0% packet loss, time 4008ms<br>rtt min/avg/max/mdev = 44.020/45.400/46.062/0.744 ms</code></pre>\n<h5 id=\"consultas-y-respuestas-dns-desde-la-lan.\" tabindex=\"-1\">Consultas y respuestas DNS desde la LAN.</h5>\n<p>Usamos las siguientes reglas para que desde la lan haya consultas y respuestas dns:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 udp dport 53 ct state new,established counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip daddr 192.168.100.0/24 udp sport 53 ct state established counter accept</code></pre>\n<p>Pruebo que funciona con dig:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ dig @8.8.8.8 www.google.es<br><br>; &lt;&lt;>> DiG 9.16.33-Debian &lt;&lt;>> @8.8.8.8 www.google.es<br>; (1 server found)<br>;; global options: +cmd<br>;; Got answer:<br>;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 42599<br>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1<br><br>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 512<br>;; QUESTION SECTION:<br>;www.google.es.\t\t\tIN\tA<br><br>;; ANSWER SECTION:<br>www.google.es.\t\t300\tIN\tA\t142.250.184.163<br><br>;; Query time: 72 msec<br>;; SERVER: 8.8.8.8#53(8.8.8.8)<br>;; WHEN: Wed Feb 22 19:20:50 UTC 2023<br>;; MSG SIZE  rcvd: 58</code></pre>\n<h5 id=\"permitimos-la-navegaci%C3%B3n-web-desde-la-lan.\" tabindex=\"-1\">Permitimos la navegaci√≥n web desde la LAN.</h5>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip protocol tcp ip saddr 192.168.100.0/24 tcp dport { 80,443 } ct state new,established counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip protocol tcp ip daddr 192.168.100.0/24 tcp sport { 80,443 } ct state established counter accept</code></pre>\n<p>Pruebo que funciona con curl:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ curl google.es<br>&lt;HTML>&lt;HEAD>&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"><br>&lt;TITLE>301 Moved&lt;/TITLE>&lt;/HEAD>&lt;BODY><br>&lt;H1>301 Moved&lt;/H1><br>The document has moved<br>&lt;A HREF=\"http://www.google.es/\">here&lt;/A>.<br>&lt;/BODY>&lt;/HTML></code></pre>\n<h5 id=\"permitimos-el-acceso-a-nuestro-servidor-web-de-la-lan-desde-el-exterior.\" tabindex=\"-1\">Permitimos el acceso a nuestro servidor web de la LAN desde el exterior.</h5>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip daddr 192.168.100.0/24 tcp dport 80 ct state new,established counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 tcp sport 80 ct state established counter accept</code></pre>\n<p>Necesitamos una regla DNAT:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet nat prerouting iifname \"ens3\" tcp dport 80 counter dnat ip to 192.168.100.10</code></pre>\n<p>Probamos que funciona, para ello instalar√© apache en la lan:</p>\n<h3 id=\"permite-poder-hacer-conexiones-ssh-al-exterior-desde-la-m%C3%A1quina-cortafuegos.\" tabindex=\"-1\">Permite poder hacer conexiones ssh al exterior desde la m√°quina cortafuegos.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet filter output oifname \"ens3\" tcp dport 22 ct state new,established counter accept<br>root@router-fw:/home/debian# nft add rule inet filter input iifname \"ens3\" tcp sport 22 ct state established counter accept</code></pre>\n<p>Me conecto a mi host para verificar que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# ssh alemd@172.29.0.70<br>The authenticity of host '172.29.0.70 (172.29.0.70)' can't be established.<br>ECDSA key fingerprint is SHA256:P4VynMzXNSUoRSzuUrFgWShiT4hYwT/y6DqQ7Sf/ujs.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '172.29.0.70' (ECDSA) to the list of known hosts.<br>alemd@172.29.0.70's password: <br>Linux debian 5.19.0-0.deb11.2-amd64 #1 SMP PREEMPT_DYNAMIC Debian 5.19.11-1~bpo11+1 (2022-10-03) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>You have new mail.<br>Last login: Tue Feb 14 13:13:33 2023 from 172.22.200.42<br>alemd@debian:~$ </code></pre>\n<h3 id=\"permite-hacer-consultas-dns-desde-la-m%C3%A1quina-cortafuegos-s%C3%B3lo-al-servidor-192.168.202.2.-comprueba-que-no-puedes-hacer-un-dig-%401.1.1.1.\" tabindex=\"-1\">Permite hacer consultas DNS desde la m√°quina cortafuegos s√≥lo al servidor 192.168.202.2. Comprueba que no puedes hacer un dig @1.1.1.1.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet filter output ip daddr 192.168.202.2 udp dport 53 ct state new,established counter accept<br>root@router-fw:/home/debian# nft add rule inet filter input ip saddr 192.168.202.2 udp sport 53 ct state established counter accept</code></pre>\n<p>Pruebo que desde papion funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# dig @192.168.202.2 www.google.es<br><br>; &lt;&lt;>> DiG 9.16.33-Debian &lt;&lt;>> @192.168.202.2 www.google.es<br>; (1 server found)<br>;; global options: +cmd<br>;; Got answer:<br>;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 56690<br>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 9<br><br>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>; COOKIE: 9f7eecd40b7f37f141ffcfbd63f7b1e31322ad62a64d5bcb (good)<br>;; QUESTION SECTION:<br>;www.google.es.\t\t\tIN\tA<br><br>;; ANSWER SECTION:<br>www.google.es.\t\t300\tIN\tA\t142.250.184.3<br><br>;; AUTHORITY SECTION:<br>google.es.\t\t66802\tIN\tNS\tns3.google.com.<br>google.es.\t\t66802\tIN\tNS\tns1.google.com.<br>google.es.\t\t66802\tIN\tNS\tns4.google.com.<br>google.es.\t\t66802\tIN\tNS\tns2.google.com.<br><br>;; ADDITIONAL SECTION:<br>ns1.google.com.\t\t63807\tIN\tA\t216.239.32.10<br>ns2.google.com.\t\t63807\tIN\tA\t216.239.34.10<br>ns3.google.com.\t\t63807\tIN\tA\t216.239.36.10<br>ns4.google.com.\t\t63807\tIN\tA\t216.239.38.10<br>ns1.google.com.\t\t63807\tIN\tAAAA\t2001:4860:4802:32::a<br>ns2.google.com.\t\t63807\tIN\tAAAA\t2001:4860:4802:34::a<br>ns3.google.com.\t\t63807\tIN\tAAAA\t2001:4860:4802:36::a<br>ns4.google.com.\t\t63807\tIN\tAAAA\t2001:4860:4802:38::a<br><br>;; Query time: 67 msec<br>;; SERVER: 192.168.202.2#53(192.168.202.2)<br>;; WHEN: Thu Feb 23 18:35:15 UTC 2023<br>;; MSG SIZE  rcvd: 344</code></pre>\n<p>Y ahora pruebo desde la 1.1.1.1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# dig @1.1.1.1 www.google.es<br><br>; &lt;&lt;>> DiG 9.16.33-Debian &lt;&lt;>> @1.1.1.1 www.google.es<br>; (1 server found)<br>;; global options: +cmd<br>;; connection timed out; no servers could be reached<br></code></pre>\n<h3 id=\"permite-que-la-m%C3%A1quina-cortafuegos-pueda-navegar-por-internet.\" tabindex=\"-1\">Permite que la m√°quina cortafuegos pueda navegar por internet.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet filter output oifname \"ens3\" ip protocol tcp tcp dport { 80,443 } ct state new,established counter accept<br>root@router-fw:/home/debian# nft add rule inet filter input iifname \"ens3\" ip protocol tcp tcp sport { 80,443 } ct state established counter accept</code></pre>\n<p>Compruebo que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# curl google.es<br>&lt;HTML>&lt;HEAD>&lt;meta http-equiv=\"content-type\" content=\"text/html;charset=utf-8\"><br>&lt;TITLE>301 Moved&lt;/TITLE>&lt;/HEAD>&lt;BODY><br>&lt;H1>301 Moved&lt;/H1><br>The document has moved<br>&lt;A HREF=\"http://www.google.es/\">here&lt;/A>.<br>&lt;/BODY>&lt;/HTML></code></pre>\n<h3 id=\"los-equipos-de-la-red-local-deben-poder-tener-conexi%C3%B3n-al-exterior.\" tabindex=\"-1\">Los equipos de la red local deben poder tener conexi√≥n al exterior.</h3>\n<p>Este paso est√° realizado anteriormente, no vuelvo a repetirlo para no duplicar informaci√≥n.</p>\n<h3 id=\"permitimos-el-ssh-desde-el-cortafuego-a-la-lan\" tabindex=\"-1\">Permitimos el ssh desde el cortafuego a la LAN</h3>\n<p>Este paso tambi√©n est√° realizado anteriormente.</p>\n<h3 id=\"permitimos-hacer-ping-desde-la-lan-a-la-m%C3%A1quina-cortafuegos.\" tabindex=\"-1\">Permitimos hacer ping desde la LAN a la m√°quina cortafuegos.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian#  nft add rule inet filter input iifname \"ens4\" icmp type echo-request counter accept<br>root@router-fw:/home/debian#  nft add rule inet filter output oifname \"ens4\" icmp type echo-reply counter accept</code></pre>\n<p>Probamos a hacer ping desde la lan al firewall:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ ping 192.168.100.2<br>PING 192.168.100.2 (192.168.100.2) 56(84) bytes of data.<br>64 bytes from 192.168.100.2: icmp_seq=1 ttl=64 time=2.36 ms<br>64 bytes from 192.168.100.2: icmp_seq=2 ttl=64 time=2.97 ms<br>64 bytes from 192.168.100.2: icmp_seq=3 ttl=64 time=2.52 ms<br>64 bytes from 192.168.100.2: icmp_seq=4 ttl=64 time=4.40 ms<br>^C<br>--- 192.168.100.2 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3007ms<br>rtt min/avg/max/mdev = 2.361/3.061/4.399/0.803 ms<br></code></pre>\n<h3 id=\"permite-realizar-conexiones-ssh-desde-los-equipos-de-la-lan\" tabindex=\"-1\">Permite realizar conexiones ssh desde los equipos de la LAN</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept<br>root@router-fw:/home/debian# nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip daddr 192.168.100.0/24 tcp sport 22 ct state established counter accept</code></pre>\n<p>Pruebo a realizar un ssh a mi host desde la lan:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ ssh alemd@172.29.0.70<br>The authenticity of host '172.29.0.70 (172.29.0.70)' can't be established.<br>ECDSA key fingerprint is SHA256:P4VynMzXNSUoRSzuUrFgWShiT4hYwT/y6DqQ7Sf/ujs.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '172.29.0.70' (ECDSA) to the list of known hosts.<br>alemd@172.29.0.70's password: <br>Linux debian 5.19.0-0.deb11.2-amd64 #1 SMP PREEMPT_DYNAMIC Debian 5.19.11-1~bpo11+1 (2022-10-03) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>You have new mail.<br>Last login: Thu Feb 23 19:29:53 2023 from 172.22.200.17<br>alemd@debian:~$ <br></code></pre>\n<h3 id=\"instala-un-servidor-de-correos-en-la-m%C3%A1quina-de-la-lan.-permite-el-acceso-desde-el-exterior-y-desde-el-cortafuego-al-servidor-de-correos.-para-probarlo-puedes-ejecutar-un-telnet-al-puerto-25-tcp.\" tabindex=\"-1\">Instala un servidor de correos en la m√°quina de la LAN. Permite el acceso desde el exterior y desde el cortafuego al servidor de correos. Para probarlo puedes ejecutar un telnet al puerto 25 tcp.</h3>\n<p>Permito el acceso desde el exterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip daddr 192.168.100.0/24 tcp dport 25 counter accept<br>root@router-fw:/home/debian# nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 tcp sport 25 counter accept<br>root@router-fw:/home/debian# nft add rule inet nat prerouting iifname \"ens3\" tcp dport 25 counter dnat ip to 192.168.100.10</code></pre>\n<p>Ahora instalamos postfix y lo probamos desde mi host con telnet:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ telnet 172.22.200.17 25<br>Trying 172.22.200.17...<br>Connected to 172.22.200.17.<br>Escape character is '^]'.<br>220 lan.novalocal ESMTP Postfix (Debian/GNU)</code></pre>\n<p>Ahora permito el acceso desde el firewall:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet filter output ip daddr 192.168.100.10 tcp dport 25 counter accept<br>root@router-fw:/home/debian# nft add rule inet filter input ip saddr 192.168.100.10 tcp sport 25 counter accept</code></pre>\n<p>Pruebo que funciona desde el firewall:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# telnet 192.168.100.10 25<br>Trying 192.168.100.10...<br>Connected to 192.168.100.10.<br>Escape character is '^]'.<br>220 lan.novalocal ESMTP Postfix (Debian/GNU)</code></pre>\n<h3 id=\"permite-poder-hacer-conexiones-ssh-desde-exterior-a-la-lan\" tabindex=\"-1\">Permite poder hacer conexiones ssh desde exterior a la LAN</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip daddr 192.168.100.0/24 tcp dport 22 ct state new,established counter accept<br>root@router-fw:/home/debian# nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 tcp sport 22 ct state established counter accept<br>root@router-fw:/home/debian# nft add rule inet nat prerouting iifname \"ens3\" tcp dport 22 counter dnat ip to 192.168.100.10</code></pre>\n<p>Me conecto desde mi host:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ ssh debian@172.22.200.17<br>The authenticity of host '172.22.200.17 (172.22.200.17)' can't be established.<br>ECDSA key fingerprint is SHA256:9RvhywkwaWaGJ74PhMORwkJ7ky7SkDy+eZ5Jjn3agvQ.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '172.22.200.17' (ECDSA) to the list of known hosts.<br>Linux lan 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Thu Feb 23 19:35:07 2023 from 192.168.100.2<br>debian@lan:~$ </code></pre>\n<h3 id=\"modifica-la-regla-anterior%2C-para-que-al-acceder-desde-el-exterior-por-ssh-tengamos-que-conectar-al-puerto-2222%2C-aunque-el-servidor-ssh-este-configurado-para-acceder-por-el-puerto-22.\" tabindex=\"-1\">Modifica la regla anterior, para que al acceder desde el exterior por ssh tengamos que conectar al puerto 2222, aunque el servidor ssh este configurado para acceder por el puerto 22.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# sudo nft add rule inet nat prerouting iifname \"ens3\" tcp dport 2222 counter dnat ip to 192.168.100.10:22</code></pre>\n<p>Pruebo que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ ssh -p 2222 debian@172.22.200.17<br>Linux lan 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Thu Feb 23 19:55:37 2023 from 172.29.0.70<br>debian@lan:~$ </code></pre>\n<h3 id=\"permite-hacer-consultas-dns-desde-la-lan-s%C3%B3lo-al-servidor-192.168.202.2.-comprueba-que-no-puedes-hacer-un-dig-%401.1.1.1.\" tabindex=\"-1\">Permite hacer consultas DNS desde la LAN s√≥lo al servidor 192.168.202.2. Comprueba que no puedes hacer un dig @1.1.1.1.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# nft -a list ruleset | grep 53<br>\t\tip saddr 172.29.0.0/16 tcp dport 22 ct state established,new counter packets 5318 bytes 372360 accept # handle 8<br>\t\tip saddr 192.168.202.2 udp sport 53 ct state established counter packets 55 bytes 19786 accept # handle 31<br>\t\tip daddr 192.168.202.2 udp dport 53 ct state established,new counter packets 55 bytes 3712 accept # handle 30<br>\t\tiifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 udp dport 53 ct state established,new counter packets 202 bytes 13946 accept # handle 20<br>\t\tiifname \"ens3\" oifname \"ens4\" ip daddr 192.168.100.0/24 udp sport 53 ct state established counter packets 202 bytes 79854 accept # handle 21</code></pre>\n<p>Como vemos tenemos que eliminar los handle 20 y 21.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# sudo nft delete rule inet filter forward handle 20 <br>root@router-fw:/home/debian# sudo nft delete rule inet filter forward handle 21</code></pre>\n<p>Ahora a√±adimos las nuevas reglas:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@router-fw:/home/debian# sudo nft add rule inet filter forward iifname \"ens4\" oifname \"ens3\" ip saddr 192.168.100.0/24 ip daddr 192.168.202.2 udp dport 53 ct state new,established counter accept<br>root@router-fw:/home/debian# sudo nft add rule inet filter forward iifname \"ens3\" oifname \"ens4\" ip saddr 192.168.202.2 ip daddr 192.168.100.0/24 udp sport 53 ct state established counter accept</code></pre>\n<p>Realizo consultas a papion:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ dig @192.168.202.2 google.es<br><br>; &lt;&lt;>> DiG 9.16.33-Debian &lt;&lt;>> @192.168.202.2 google.es<br>; (1 server found)<br>;; global options: +cmd<br>;; Got answer:<br>;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 45495<br>;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 4, ADDITIONAL: 9<br><br>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>; COOKIE: 7f256c5d9934b3162b2837d563f7c7eb8fff0cd52a78e95c (good)<br>;; QUESTION SECTION:<br>;google.es.\t\t\tIN\tA<br><br>;; ANSWER SECTION:<br>google.es.\t\t300\tIN\tA\t142.250.185.3<br><br>;; AUTHORITY SECTION:<br>google.es.\t\t61162\tIN\tNS\tns2.google.com.<br>google.es.\t\t61162\tIN\tNS\tns4.google.com.<br>google.es.\t\t61162\tIN\tNS\tns1.google.com.<br>google.es.\t\t61162\tIN\tNS\tns3.google.com.<br><br>;; ADDITIONAL SECTION:<br>ns1.google.com.\t\t58167\tIN\tA\t216.239.32.10<br>ns2.google.com.\t\t58167\tIN\tA\t216.239.34.10<br>ns3.google.com.\t\t58167\tIN\tA\t216.239.36.10<br>ns4.google.com.\t\t58167\tIN\tA\t216.239.38.10<br>ns1.google.com.\t\t58167\tIN\tAAAA\t2001:4860:4802:32::a<br>ns2.google.com.\t\t58167\tIN\tAAAA\t2001:4860:4802:34::a<br>ns3.google.com.\t\t58167\tIN\tAAAA\t2001:4860:4802:36::a<br>ns4.google.com.\t\t58167\tIN\tAAAA\t2001:4860:4802:38::a<br><br>;; Query time: 76 msec<br>;; SERVER: 192.168.202.2#53(192.168.202.2)<br>;; WHEN: Thu Feb 23 20:09:20 UTC 2023<br>;; MSG SIZE  rcvd: 340</code></pre>\n<p>Consulto a la ip 1.1.1.1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@lan:~$ dig @1.1.1.1 google.es<br><br>; &lt;&lt;>> DiG 9.16.33-Debian &lt;&lt;>> @1.1.1.1 google.es<br>; (1 server found)<br>;; global options: +cmd<br>;; connection timed out; no servers could be reached</code></pre>\n<h3 id=\"permite-que-los-equipos-de-la-lan-puedan-navegar-por-internet.\" tabindex=\"-1\">Permite que los equipos de la LAN puedan navegar por internet.</h3>\n<p>Este paso se ha realizado anteriormente.</p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-21T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-k8s-vi./",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-k8s-vi./",
      "title": "Ejercicios de K8s VI.",
      "content_html": "<h3 id=\"desplegando-un-servidor-web-persistente.\" tabindex=\"-1\">Desplegando un servidor web persistente.</h3>\n<p><strong>Siguiendo la gu√≠a explicada en el Ejemplo 2: Gesti√≥n din√°mica de vol√∫menes, vamos a crear un servidor web que permita la ejecuci√≥n de scripts PHP con almacenamiento persistente.</strong></p>\n<p><strong>Para realizar esta actividad vamos a usar asignaci√≥n din√°mica de vol√∫menes y puedes usar, como modelos, los ficheros del ejemplo 2.</strong></p>\n<p><strong>Realiza los siguientes pasos:</strong></p>\n<h4 id=\"crea-un-fichero-yaml-para-definir-un-recurso-persistentvolumenclaim-que-se-llame-pvc-webserver-y-para-solicitar-un-volumen-de-2gb.\" tabindex=\"-1\">Crea un fichero yaml para definir un recurso PersistentVolumenClaim que se llame pvc-webserver y para solicitar un volumen de 2Gb.</h4>\n<p>El contenido del fichero es el siguiente:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pvc<span class=\"token punctuation\">-</span>webserver<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span><br>    <span class=\"token punctuation\">-</span> ReadWriteOnce<br>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 2Gi</code></pre>\n<h4 id=\"crea-el-recurso-y-comprueba-que-se-ha-asociado-un-volumen-de-forma-din%C3%A1mica-a-la-solicitud.\" tabindex=\"-1\">Crea el recurso y comprueba que se ha asociado un volumen de forma din√°mica a la solicitud.</h4>\n<p>Creamos el recurso con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl apply -f pvc-webserver.yaml<br>persistentvolumeclaim/pvc-webserver created</code></pre>\n<p>Y lo visualizamos con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl get pv,pvc<br>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                   STORAGECLASS   REASON   AGE<br>persistentvolume/pvc-f30ccc20-4f70-48e4-923c-b9d541348327   2Gi        RWO            Delete           Bound    default/pvc-webserver   standard                27s<br><br>NAME                                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br>persistentvolumeclaim/pvc-webserver   Bound    pvc-f30ccc20-4f70-48e4-923c-b9d541348327   2Gi        RWO            standard       28s</code></pre>\n<h4 id=\"crea-un-fichero-yaml-para-desplegar-un-servidor-web-desde-la-imagen-php%3A7.4-apache%2C-asocia-el-volumen-al-pod-que-se-va-a-crear-e-indica-el-punto-de-montaje-en-el-documentroot-del-servidor%3A-%2Fvar%2Fwww%2Fhtml.\" tabindex=\"-1\">Crea un fichero yaml para desplegar un servidor web desde la imagen php:7.4-apache, asocia el volumen al Pod que se va a crear e indica el punto de montaje en el DocumentRoot del servidor: /var/www/html.</h4>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> servidorweb<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> apache<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> apache<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> apache<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volumen<span class=\"token punctuation\">-</span>servidorweb<br>          <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span><br>            <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> pvc<span class=\"token punctuation\">-</span>webserver<br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contenedor<span class=\"token punctuation\">-</span>apache<span class=\"token punctuation\">-</span>php<br>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> php<span class=\"token punctuation\">:</span>7.4<span class=\"token punctuation\">-</span>apache<br>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>server<br>              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span><br>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/var/www/html\"</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volumen<span class=\"token punctuation\">-</span>servidorweb</code></pre>\n<h4 id=\"despliega-el-servidor-y-crea-un-fichero-info.php-en-%2Fvar%2Fwww%2Fhtml%2C-con-el-siguiente-contenido%3A-%3C%3Fphp-phpinfo()%3B-%3F%3E.\" tabindex=\"-1\">Despliega el servidor y crea un fichero info.php en /var/www/html, con el siguiente contenido: &lt;?php phpinfo(); ?&gt;.</h4>\n<p>Desplegamos el servidor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl apply -f servidorweb-php.yaml <br>deployment.apps/servidorweb created</code></pre>\n<p>Ahora creamos un service:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ nano web-service.yaml</code></pre>\n<p>Con el siguiente contenido:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> servicio<span class=\"token punctuation\">-</span>servidorweb<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort<br>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> service<span class=\"token punctuation\">-</span>http<br>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>server<br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> apache</code></pre>\n<p>Creamos el service:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl apply -f web-service.yaml<br>service/servicio-servidorweb created</code></pre>\n<p>Ahora ejecutamos el siguiente comando para a√±adir el info.php al servidor web:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl exec pod/servidorweb-6d46fd9685-vhqjq -- bash -c \"echo '&lt;?php phpinfo(); ?>' > /var/www/html/info.php\"</code></pre>\n<h4 id=\"define-y-crea-un-service-nodeport%2C-accede-desde-un-navegador-al-fichero-info.php-y-comprueba-que-se-visualiza-de-forma-correcta.\" tabindex=\"-1\">Define y crea un Service NodePort, accede desde un navegador al fichero info.php y comprueba que se visualiza de forma correcta.</h4>\n<p>El Service NodePort est√° creado m√°s arriba.</p>\n<p>Probamos que funciona accediendo a trav√©s de la IP y el puerto:</p>\n<p><img src=\"/img/SRI-K8S-VI.1.png\" alt=\"SRI-K8S-VI.1.png\"></p>\n<h4 id=\"comprobemos-la-persistencia%3A-elimina-el-deployment%2C-vuelve-a-crearlo-y-vuelve-a-acceder-desde-el-navegador-al-fichero-info.php.-%C2%BFse-sigue-visualizando%3F\" tabindex=\"-1\">Comprobemos la persistencia: elimina el Deployment, vuelve a crearlo y vuelve a acceder desde el navegador al fichero info.php. ¬øSe sigue visualizando?</h4>\n<p>Eliminamos el deployment:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl delete deployments.apps servidorweb<br>deployment.apps \"servidorweb\" deleted</code></pre>\n<p>Volvemos a crearlo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl apply -f servidorweb-php.yaml<br>deployment.apps/servidorweb created</code></pre>\n<p>Volvemos a acceder a la p√°gina:</p>\n<p><img src=\"/img/SRI-K8S-VI.2.png\" alt=\"SRI-K8S-VI.2.png\"></p>\n<p>Como vemos funciona correctamente.</p>\n<h3 id=\"haciendo-persistente-la-aplicaci%C3%B3n-guestbook.\" tabindex=\"-1\">Haciendo persistente la aplicaci√≥n GuestBook.</h3>\n<p><strong>En este ejercicio vamos a volver a desplegar nuestra aplicaci√≥n GuestBook, que realizamos en el taller 4 y 5, para a√±adirle persistencia a la base de datos redis.</strong></p>\n<p><strong>Por lo tanto necesitaremos solicitar un volumen, que se asociar√° de forma din√°mica.</strong></p>\n<p><strong>Creando el despliegue de redis para que guarde la informaci√≥n en un directorio.</strong></p>\n<p><strong>Si estudiamos la documentaci√≥n de la imagen redis en Docker Hub, para que la informaci√≥n de la base de datos se guarde en un directorio /data del contenedor hay que ejecutar con docker:</strong></p>\n<p><code>docker run --name some-redis -d redis redis-server --appendonly yes</code></p>\n<p><strong>Es decir, hay que crear el contenedor ejecutando el proceso redis-server con los argumentos --appendonly yes.</strong></p>\n<p><strong>Por lo tanto tenemos que cambiar el fichero de definici√≥n del Deployment de redis, redis-deployment.yaml de la siguiente manera:</strong></p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>        <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volumen<span class=\"token punctuation\">-</span>redis<br>          <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span><br>            <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> xxxxxxxxxxxx<br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contenedor<span class=\"token punctuation\">-</span>redis<br>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<br>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"redis-server\"</span><span class=\"token punctuation\">]</span><br>          <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"--appendonly\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"yes\"</span><span class=\"token punctuation\">]</span><br>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>server<br>              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span><br>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> xxxxxxxxxxxx<br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volumen<span class=\"token punctuation\">-</span>redis</code></pre>\n<p><strong>Hemos usado el par√°metro command para ejecutar el proceso, y el par√°metro args para indicar los argumentos.</strong></p>\n<p><strong>Nota: Los valores xxxxxxxxxxxx tendr√°s que rellenarlos durante la realizaci√≥n de la actividad.</strong></p>\n<p><strong>Pasos a seguir</strong></p>\n<p><strong>Realiza los siguientes pasos:</strong></p>\n<h4 id=\"1.-crea-un-fichero-yaml-para-definir-un-recurso-persistentvolumenclaim-que-se-llame-pvc-redis-y-para-solicitar-un-volumen-de-3gb.\" tabindex=\"-1\">1. Crea un fichero yaml para definir un recurso PersistentVolumenClaim que se llame pvc-redis y para solicitar un volumen de 3Gb.</h4>\n<p>El contenido del fichero es el siguiente:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> pvc<span class=\"token punctuation\">-</span>redis<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span><br>    <span class=\"token punctuation\">-</span> ReadWriteOnce<br>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 3Gi</code></pre>\n<h4 id=\"2.-crea-el-recurso-y-comprueba-que-se-ha-asociado-un-volumen-de-forma-din%C3%A1mica-a-la-solicitud.\" tabindex=\"-1\">2. Crea el recurso y comprueba que se ha asociado un volumen de forma din√°mica a la solicitud.</h4>\n<p>Creamos el recurso:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl apply -f pvc-redis.yaml <br>persistentvolumeclaim/pvc-redis created</code></pre>\n<p>Ahora comprobamos que se ha asociado el volumen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl get pv,pvc<br>NAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                   STORAGECLASS   REASON   AGE<br>persistentvolume/pvc-25b35b29-616c-488d-9f94-0e9e95321da3   3Gi        RWO            Delete           Bound    default/pvc-redis       standard                47s<br>persistentvolume/pvc-f30ccc20-4f70-48e4-923c-b9d541348327   2Gi        RWO            Delete           Bound    default/pvc-webserver   standard                47m<br><br>NAME                                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br>persistentvolumeclaim/pvc-redis       Bound    pvc-25b35b29-616c-488d-9f94-0e9e95321da3   3Gi        RWO            standard       47s<br>persistentvolumeclaim/pvc-webserver   Bound    pvc-f30ccc20-4f70-48e4-923c-b9d541348327   2Gi        RWO            standard       47m</code></pre>\n<h4 id=\"3.-modifica-el-fichero-del-despliegue-de-redis%2C-modificando-las-xxxxxxxxxxxx-por-los-valores-correctos%3A-el-nombre-del-persistentvolumenclaim-y-el-directorio-de-montaje-en-el-contenedor-(como-hemos-visto-anteriormente-es-%2Fdata).\" tabindex=\"-1\">3. Modifica el fichero del despliegue de redis, modificando las xxxxxxxxxxxx por los valores correctos: el nombre del PersistentVolumenClaim y el directorio de montaje en el contenedor (como hemos visto anteriormente es /data).</h4>\n<p>Queda de la siguiente forma el yaml:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>        <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volumen<span class=\"token punctuation\">-</span>redis<br>          <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span><br>            <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> pvc<span class=\"token punctuation\">-</span>redis<br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contenedor<span class=\"token punctuation\">-</span>redis<br>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<br>          <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"redis-server\"</span><span class=\"token punctuation\">]</span><br>          <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"--appendonly\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"yes\"</span><span class=\"token punctuation\">]</span><br>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>server<br>              <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span><br>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"/data\"</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> volumen<span class=\"token punctuation\">-</span>redis</code></pre>\n<h4 id=\"4.-crea-el-despliegue-de-redis.-el-despliegue-de-la-aplicaci%C3%B3n-guestbook-y-la-creaci%C3%B3n-de-los-services-de-acceso-se-hace-con-los-ficheros-que-ya-utilizamos-anteriormente%3A-guestbook-deployment.yaml%2C-guestbook-srv.yaml-y-redis-srv.yaml.\" tabindex=\"-1\">4. Crea el despliegue de redis. El despliegue de la aplicaci√≥n guestbook y la creaci√≥n de los Services de acceso se hace con los ficheros que ya utilizamos anteriormente: guestbook-deployment.yaml, guestbook-srv.yaml y redis-srv.yaml.</h4>\n<p>Desplegamos guestbook con los fichero del taller anterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f guestbook-deployment.yaml<br>deployment.apps/guestbook created</code></pre>\n<p>Desplegamos el servicio de guestbook:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f service-guestbook.yaml <br>service/guestbook created</code></pre>\n<p>Desplegamos el servicio de redis:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f service-guestbook2.yaml <br>service/redis created</code></pre>\n<p>Desplegamos el nuevo redis:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ cd taller6/<br>alemd@debian:~/minikube/taller6$ kubectl apply -f redis-despliegue.yaml <br>deployment.apps/redis created</code></pre>\n<h4 id=\"5.-accede-a-la-aplicaci%C3%B3n-y-escribe-algunos-mensajes.\" tabindex=\"-1\">5. Accede a la aplicaci√≥n y escribe algunos mensajes.</h4>\n<p><img src=\"/img/SRI-K8S-VI.3.png\" alt=\"SRI-K8S-VI.3.png\"></p>\n<h4 id=\"6.-comprobemos-la-persistencia%3A-elimina-el-despliegue-de-redis%2C-vuelve-a-crearlo%2C-vuelve-a-acceder-desde-el-navegador-y-comprueba-que-los-mensajes-no-se-han-perdido.\" tabindex=\"-1\">6. Comprobemos la persistencia: elimina el despliegue de redis, vuelve a crearlo, vuelve a acceder desde el navegador y comprueba que los mensajes no se han perdido.</h4>\n<p>Eliminamos y volvemos a crear el despliegue:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/taller6$ kubectl delete deployments.apps redis <br>deployment.apps \"redis\" deleted<br>alemd@debian:~/minikube/taller6$ kubectl apply -f redis-despliegue.yaml <br>deployment.apps/redis created</code></pre>\n<p>Accedo nuevamente al navegador:</p>\n<p><img src=\"/img/SRI-K8S-VI.4.png\" alt=\"SRI-K8S-VI.4.png\"></p>\n<h3 id=\"haciendo-persistente-la-aplicaci%C3%B3n-nextcloud.\" tabindex=\"-1\">Haciendo persistente la aplicaci√≥n Nextcloud.</h3>\n<p><strong>Esta actividad es la continuaci√≥n de la actividad realizada en el taller 5.</strong></p>\n<p><strong>Siguiendo la gu√≠a que hemos desarrollado en Ejemplo 3: Wordpress con almacenamiento persistente vamos a configurar el despliegue de Nextcloud para que use vol√∫menes (vamos a usar dos vol√∫menes, uno para la aplicaci√≥n y otro para la base de datos) para que la informaci√≥n no se pierda.</strong></p>\n<p><strong>Realiza los siguientes pasos:</strong></p>\n<h4 id=\"1.-crea-los-ficheros-yaml-para-definir-los-recursos-persistentvolumenclaim-para-solicitar-dos-vol%C3%BAmenes-de-4gb.\" tabindex=\"-1\">1. Crea los ficheros yaml para definir los recursos PersistentVolumenClaim para solicitar dos vol√∫menes de 4Gb.</h4>\n<p>El contenido del pvc para nextcloud es el siguiente:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nextcloud<span class=\"token punctuation\">-</span>pvc<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span><br>    <span class=\"token punctuation\">-</span> ReadWriteOnce<br>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 4Gi</code></pre>\n<p>El contenido del pvc para mariadb es el siguiente:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>pvc<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span><br>    <span class=\"token punctuation\">-</span> ReadWriteOnce<br>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 4Gi</code></pre>\n<h4 id=\"2.-crea-esos-recursos-y-comprueba-que-se-ha-asociado-un-volumen-de-forma-din%C3%A1mica-a-cada-solicitud.\" tabindex=\"-1\">2. Crea esos recursos y comprueba que se ha asociado un volumen de forma din√°mica a cada solicitud.</h4>\n<p>Creamos los recursos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/nextcloud$ kubectl apply -f nextcloud-pvc.yaml <br>persistentvolumeclaim/nextcloud-pvc created<br>alemd@debian:~/minikube/nextcloud$ kubectl apply -f mariadb-pvc.yaml <br>persistentvolumeclaim/mariadb-pvc created</code></pre>\n<p>Comprobamos que se han creado correctamente:</p>\n<p><img src=\"/img/SRI-K8S-VI.5.png\" alt=\"SRI-K8S-VI.5.png\"></p>\n<h4 id=\"3.-modifica-los-ficheros-de-despliegue-de-la-aplicaci%C3%B3n-y-la-base-de-datos-para-asociar-los-vol%C3%BAmenes-a-cada-uno.-seg%C3%BAn-la-documentaci%C3%B3n-de-la-imagen-nextcloud-en-docker-hub%2C-la-forma-m%C3%A1s-sencilla-de-hacer-persistente-la-aplicaci%C3%B3n-es-montar-el-volumen-en-el-directorio%2Fvar%2Fwww%2Fhtml%2F.\" tabindex=\"-1\">3. Modifica los ficheros de despliegue de la aplicaci√≥n y la base de datos para asociar los vol√∫menes a cada uno. Seg√∫n la documentaci√≥n de la imagen Nextcloud en Docker Hub, la forma m√°s sencilla de hacer persistente la aplicaci√≥n es montar el volumen en el directorio/var/www/html/.</h4>\n<p>Modificamos el fichero <code>nextcloud-deployment.yaml</code>.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nextcloud<span class=\"token punctuation\">-</span>deployment<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contenedor<span class=\"token punctuation\">-</span>nextcloud<br>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nextcloud<br>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>port<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">-</span>port<br>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nextcloud<span class=\"token punctuation\">-</span>vol<br>              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /var/www/html<br>          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_HOST<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>host<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_HOST<br>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nextcloud<span class=\"token punctuation\">-</span>vol<br>          <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span><br>            <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> nextcloud<span class=\"token punctuation\">-</span>pvc</code></pre>\n<p>Modificamos el fichero <code>mariadb-deployment.yaml</code>.</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>deployment<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contenedor<span class=\"token punctuation\">-</span>mariadb<br>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mariadb<br>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> db<span class=\"token punctuation\">-</span>port<br>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>vol<br>              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /var/lib/mysql<br>          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_ROOT_PASSWORD<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>vol<br>          <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span><br>            <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>pvc</code></pre>\n<p>Aplicamos los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/nextcloud$ kubectl apply -f mariadb-deployment.yaml<br>deployment.apps/mariadb-deployment configured<br>alemd@debian:~/minikube/nextcloud$ kubectl apply -f nextcloud-deployment.yaml<br>deployment.apps/nextcloud-deployment configured</code></pre>\n<h4 id=\"4.-accede-a-la-aplicaci%C3%B3n%2C-config%C3%BArala-y-sube-un-fichero.\" tabindex=\"-1\">4. Accede a la aplicaci√≥n, config√∫rala y sube un fichero.</h4>\n<p>Accedemos a la aplicaci√≥n y la instalamos. Una vez instalada subimos un fichero. He creado el fichero <a href=\"http://persistente.md\">persistente.md</a>:</p>\n<p><img src=\"/img/SRI-K8S-VI.6.png\" alt=\"SRI-K8S-VI.6.png\"></p>\n<h4 id=\"5.-comprobemos-la-persistencia%3A-elimina-los-despliegues%2C-vuelve-a-crearlos-y-vuelve-a-acceder-desde-el-navegador-y-comprueba-que-la-aplicaci%C3%B3n-est%C3%A1-configurada-y-mantiene-el-fichero-que-hab%C3%ADas-subido.\" tabindex=\"-1\">5. Comprobemos la persistencia: elimina los despliegues, vuelve a crearlos y vuelve a acceder desde el navegador y comprueba que la aplicaci√≥n est√° configurada y mantiene el fichero que hab√≠as subido.</h4>\n<p>Eliminamos los despliegues:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/nextcloud$ kubectl delete deployments.apps nextcloud-deployment<br>deployment.apps \"nextcloud-deployment\" deleted<br>alemd@debian:~/minikube/nextcloud$ kubectl delete deployments.apps mariadb-deployment <br>deployment.apps \"mariadb-deployment\" deleted</code></pre>\n<p>Volvemos a crear los despliegues:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/nextcloud$ kubectl apply -f nextcloud-deployment.yaml<br>deployment.apps/nextcloud-deployment created<br>alemd@debian:~/minikube/nextcloud$ kubectl apply -f mariadb-deployment.yaml<br>deployment.apps/mariadb-deployment created</code></pre>\n<p>Y volvemos a acceder a la aplicaci√≥n:</p>\n<p><img src=\"/img/SRI-K8S-VI.7.png\" alt=\"SRI-K8S-VI.7.png\"></p>\n<p>Como vemos nos pide volver a iniciar sesi√≥n. Metemos el usuario y contrase√±a que indicamos al configurar nextcloud:</p>\n<p><img src=\"/img/SRI-K8S-VI.8.png\" alt=\"SRI-K8S-VI.8.png\"></p>\n<p>Al iniciar sesi√≥n vemos que sigue creado el fichero <code>persistente.md</code></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-20T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/auditorias-de-bases-de-datos./",
      "url": "https://reeseschultz.github.io/post/auditorias-de-bases-de-datos./",
      "title": "Auditor√≠as de bases de datos.",
      "content_html": "<h3 id=\"activa-desde-sql*plus-la-auditor%C3%ADa-de-los-intentos-de-acceso-exitosos-al-sistema.-comprueba-su-funcionamiento.\" tabindex=\"-1\">Activa desde SQL*Plus la auditor√≠a de los intentos de acceso exitosos al sistema. Comprueba su funcionamiento.</h3>\n<p>Lo primero que haremos es comprobar que las auditor√≠as est√°n activadas en nuestra base de datos. Para ello ejecutaremos lO siguiente:</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SHOW</span> PARAMETER AUDIT<span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/GBD-audit-1.png\" alt=\"GBD-audit-1.png\"></p>\n<p>Como se aprecia, el valor de audit_trail es DB, si no estuvieran activadas, aparecer√≠a none. Si queremos activarlos tenemos que ejecutar la siguiente consulta y reiniciar el sistema:</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">ALTER</span> SYSTEM <span class=\"token keyword\">SET</span> audit_trail<span class=\"token operator\">=</span>db scope<span class=\"token operator\">=</span>spfile<span class=\"token punctuation\">;</span></code></pre>\n<p>Una vez hecho este par√©ntesis, procederemos a realizar el ejercicio. Para auditar los intentos exitosos de acceso, tenemos que ejecutar el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> AUDIT CREATE SESSION BY ACCESS;<br><br>Auditoria terminada correctamente.<br></code></pre>\n<p>Ahora realizamos intentos exitosos de login y ejecutamos lo siguiente para ver si se han registrados los intentos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT OS_USERNAME, USERNAME, EXTENDED_TIMESTAMP, ACTION_NAME FROM DBA_AUDIT_SESSION;<br><br>OS_USERNAME<br>--------------------------------------------------------------------------------<br>USERNAME<br>--------------------------------------------------------------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>alemd<br>PRUEBA<br>20/02/23 09:28:09,091698 +01:00<br>LOGON<br><br>OS_USERNAME<br>--------------------------------------------------------------------------------<br>USERNAME<br>--------------------------------------------------------------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>alemd<br>PRUEBA2<br>20/02/23 09:28:15,544590 +01:00<br>LOGON<br><br>OS_USERNAME<br>--------------------------------------------------------------------------------<br>USERNAME<br>--------------------------------------------------------------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>alemd<br>ALEMD<br>20/02/23 09:28:19,944716 +01:00<br>LOGON<br></code></pre>\n<p>Como vemos indica que el usuario del sistema alemd se ha intentado conectar a los usuarios de la base de datos prueba, prueba2 y alemd, indica la fecha y hora del intento, y LOGON que indica que ha intentado conectar.</p>\n<p>Si queremos volver a desactivar la auditor√≠a ejecutamos el siguiente comando:</p>\n<pre class=\"language-sql\"><code class=\"language-sql\">NOAUDIT <span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">SESSION</span> WHENEVER <span class=\"token operator\">NOT</span> SUCCESSFUL<span class=\"token punctuation\">;</span></code></pre>\n<h3 id=\"realiza-un-procedimiento-en-pl%2Fsql-que-te-muestre-los-accesos-fallidos-junto-con-el-motivo-de-los-mismos%2C-transformando-el-c%C3%B3digo-de-error-almacenado-en-un-mensaje-de-texto-comprensible.-contempla-todos-los-motivos-posibles-para-que-un-acceso-sea-fallido.\" tabindex=\"-1\">Realiza un procedimiento en PL/SQL que te muestre los accesos fallidos junto con el motivo de los mismos, transformando el c√≥digo de error almacenado en un mensaje de texto comprensible. Contempla todos los motivos posibles para que un acceso sea fallido.</h3>\n<p>Adjunto los m√≥dulos de programaci√≥n necesarios para la resoluci√≥n del ejercicio:</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> P_EXPLICA <span class=\"token punctuation\">(</span>P_CODIGO DBA_AUDIT_SESSION<span class=\"token punctuation\">.</span>RETURNCODE<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span><br><span class=\"token operator\">IS</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token keyword\">CASE</span> P_CODIGO <br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">911</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'CONTIENE UN CAR√ÅCTER INV√ÅLIDO.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">1004</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'EL ACCESO HA SIDO DENEGADO.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">1017</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'EL USUARIO/CONTRASE√ëA NO ES V√ÅLIDO.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">1045</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'EL USUARIO NO TIENE EL PERMISO CREATE SESSION.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28000</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LA CUENTA EST√Å BLOQUEADA.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28001</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LA CONTRASE√ëA HA CADUCADO.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28002</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LA CONTRASE√ëA VA A CADUCAR PRONTO, DEBER√çAS CAMBIARLA.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28003</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LA CONTRASE√ëA NO ES LO BASTANTE COMPLEJA.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28007</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'NO PUEDES REUTILIZAR LA CONTRASE√ëA.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28008</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'CONTRASE√ëA ANTIGUA INV√ÅLIDA.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28009</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LA CONEXI√ìN A SYS DEBE SER A TRAV√âS DE SYSDBA O SYSOPER.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28011</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LA CONTRASE√ëA VA A CADUCAR PRONTO, DEBER√çAS CAMBIARLA.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">WHEN</span> <span class=\"token number\">28009</span> <span class=\"token keyword\">THEN</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LA CONTRASE√ëA ORIGINAL NO SE HA INTRODUCIDO.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \t<span class=\"token keyword\">ELSE</span><br>    \t\tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'P√ìNGASE EN CONTACTO CON EL ADMINISTRADOR PARA SABER LA RAZ√ìN.'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">END</span> <span class=\"token keyword\">CASE</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br><br><span class=\"token keyword\">CREATE</span> <span class=\"token operator\">OR</span> <span class=\"token keyword\">REPLACE</span> <span class=\"token keyword\">PROCEDURE</span> P_ACCESSFAILED <br><span class=\"token operator\">IS</span><br>    <span class=\"token keyword\">CURSOR</span> C_INTENTOS_FALLIDOS <span class=\"token operator\">IS</span> <br>    <span class=\"token keyword\">SELECT</span> OS_USERNAME<span class=\"token punctuation\">,</span> USERNAME<span class=\"token punctuation\">,</span> EXTENDED_TIMESTAMP<span class=\"token punctuation\">,</span> RETURNCODE <br>    <span class=\"token keyword\">FROM</span> DBA_AUDIT_SESSION<span class=\"token punctuation\">;</span><br>    V_REG C_INTENTOS_FALLIDOS<span class=\"token operator\">%</span>ROWTYPE<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token keyword\">FOR</span> V_REG <span class=\"token operator\">IN</span> C_INTENTOS_FALLIDOS <span class=\"token keyword\">LOOP</span><br>    \tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'INTENTO FALLIDO DE ACCESO'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'USUARIO DEL SISTEMA: '</span><span class=\"token operator\">||</span>V_REG<span class=\"token punctuation\">.</span>OS_USERNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'USUARIO DE LA BASE DE DATOS: '</span><span class=\"token operator\">||</span>V_REG<span class=\"token punctuation\">.</span>USERNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'FECHA Y HORA: '</span><span class=\"token operator\">||</span>V_REG<span class=\"token punctuation\">.</span>EXTENDED_TIMESTAMP<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \tP_EXPLICA<span class=\"token punctuation\">(</span>V_REG<span class=\"token punctuation\">.</span>RETURNCODE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    \tDBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span>CHR<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p>Ejecutamos el procedimiento:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> EXEC P_ACCESSFAILED;<br>INTENTO FALLIDO DE ACCESO<br>USUARIO DEL SISTEMA: alemd<br>USUARIO DE LA BASE DE DATOS: PRUEBA<br>FECHA Y HORA: 20/02/23 09:28:09,091698 +01:00<br>EL USUARIO/CONTRASE??A NO ES V??LIDO.<br>\t<br>INTENTO FALLIDO DE ACCESO<br>USUARIO DEL SISTEMA: alemd<br>USUARIO DE LA BASE DE DATOS: PRUEBA2<br>FECHA Y HORA: 20/02/23 09:28:15,544590 +01:00<br>EL USUARIO/CONTRASE??A NO ES V??LIDO.<br>\t<br>INTENTO FALLIDO DE ACCESO<br>USUARIO DEL SISTEMA: alemd<br>USUARIO DE LA BASE DE DATOS: ALEMD<br>FECHA Y HORA: 20/02/23 09:28:19,944716 +01:00<br>EL USUARIO/CONTRASE??A NO ES V??LIDO.</code></pre>\n<h3 id=\"activa-la-auditor%C3%ADa-de-las-operaciones-dml-realizadas-por-scott.-comprueba-su-funcionamiento.\" tabindex=\"-1\">Activa la auditor√≠a de las operaciones DML realizadas por SCOTT. Comprueba su funcionamiento.</h3>\n<p>Para activar la auditor√≠a en operaciones DML, ejecutamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> AUDIT INSERT TABLE, UPDATE TABLE, DELETE TABLE BY SCOTT;<br><br>Auditoria terminada correctamente.<br></code></pre>\n<p>Ahora nos conectamos con el usuario SCOTT y realizaremos algunos insert, update y deletes.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> UPDATE DEPT SET LOC='SEVILLA' WHERE DEPTNO='30';<br><br>1 fila actualizada.<br><br>SQL> DELETE FROM EMP WHERE EMPNO='1234';<br><br>1 fila suprimida.<br><br>SQL> DELETE FROM EMP WHERE EMPNO='1298';<br><br>1 fila suprimida.<br><br>SQL> INSERT INTO DEPT VALUES (60,'PRUEBA','PRUEBA');<br><br>1 fila creada.<br></code></pre>\n<p>Ahora ejecutamos la siguiente consulta para ver si se han registrado los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT USERNAME, OBJ_NAME, ACTION_NAME, EXTENDED_TIMESTAMP FROM DBA_AUDIT_OBJECT;<br><br>USERNAME<br>--------------------------------------------------------------------------------<br>OBJ_NAME<br>--------------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>SCOTT<br>DEPT<br>INSERT<br>20/02/23 10:19:30,519384 +01:00<br><br><br>USERNAME<br>--------------------------------------------------------------------------------<br>OBJ_NAME<br>--------------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>SCOTT<br>DEPT<br>UPDATE<br>20/02/23 10:16:50,299983 +01:00<br><br><br>USERNAME<br>--------------------------------------------------------------------------------<br>OBJ_NAME<br>--------------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>SCOTT<br>EMP<br>DELETE<br>20/02/23 10:17:17,481421 +01:00<br><br><br>USERNAME<br>--------------------------------------------------------------------------------<br>OBJ_NAME<br>--------------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>SCOTT<br>EMP<br>DELETE<br>20/02/23 10:17:30,738806 +01:00<br><br><br>USERNAME<br>--------------------------------------------------------------------------------<br>OBJ_NAME<br>--------------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>SCOTT<br>EMP<br>DELETE<br>20/02/23 10:18:41,838448 +01:00<br><br><br>USERNAME<br>--------------------------------------------------------------------------------<br>OBJ_NAME<br>--------------------------------------------------------------------------------<br>ACTION_NAME<br>----------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>SCOTT<br>EMP<br>DELETE<br>20/02/23 10:18:55,888517 +01:00<br><br><br>6 filas seleccionadas.<br></code></pre>\n<p>Vemos como nos indica el usuario, la tabla a la que afecta, la acci√≥n realizada y la fecha.</p>\n<h3 id=\"realiza-una-auditor%C3%ADa-de-grano-fino-para-almacenar-informaci%C3%B3n-sobre-la-inserci%C3%B3n-de-empleados-con-sueldo-superior-a-2000-en-la-tabla-emp-de-scott.\" tabindex=\"-1\">Realiza una auditor√≠a de grano fino para almacenar informaci√≥n sobre la inserci√≥n de empleados con sueldo superior a 2000 en la tabla emp de scott.</h3>\n<p>Lo primero que haremos ser√° crear el procedimiento que controla la inserci√≥n de los empleados del departamento:</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">BEGIN</span><br>    DBMS_FGA<span class=\"token punctuation\">.</span>ADD_POLICY <span class=\"token punctuation\">(</span><br>        object_schema      <span class=\"token operator\">=</span><span class=\"token operator\">></span>  <span class=\"token string\">'SCOTT'</span><span class=\"token punctuation\">,</span><br>        object_name        <span class=\"token operator\">=</span><span class=\"token operator\">></span>  <span class=\"token string\">'EMP'</span><span class=\"token punctuation\">,</span><br>        policy_name        <span class=\"token operator\">=</span><span class=\"token operator\">></span>  <span class=\"token string\">'policy_ej4'</span><span class=\"token punctuation\">,</span><br>        audit_condition    <span class=\"token operator\">=</span><span class=\"token operator\">></span>  <span class=\"token string\">'SAL > 2000'</span><span class=\"token punctuation\">,</span><br>        statement_types    <span class=\"token operator\">=</span><span class=\"token operator\">></span>  <span class=\"token string\">'INSERT'</span><br>    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p>Ahora insertaremos varios registros para comprobar si se registran en la auditor√≠a:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> INSERT INTO EMP VALUES (1234, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-DD-YYYY'), 2500, NULL, 20);<br><br>1 fila creada.<br><br>SQL> INSERT INTO EMP VALUES (1235, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-DD-YYYY'), 2001, NULL, 20);<br><br>1 fila creada.<br><br>SQL> INSERT INTO EMP VALUES (1236, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-DD-YYYY'), 1999, NULL, 20);<br><br>1 fila creada.<br></code></pre>\n<p>He insertado una fila con el salario con 2500, otra con 2001 y otra fila con 1999, solo tienen que aparecer 2 registros en la auditor√≠a. Ejecutaremos la siguiente consulta para ver si se han registrado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT DB_USER, OBJECT_NAME, SQL_TEXT, EXTENDED_TIMESTAMP FROM DBA_FGA_AUDIT_TRAIL WHERE POLICY_NAME='POLICY_EJ4';<br><br>DB_USER<br>--------------------------------------------------------------------------------<br>OBJECT_NAME<br>--------------------------------------------------------------------------------<br>SQL_TEXT<br>--------------------------------------------------------------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>SCOTT<br>EMP<br>INSERT INTO EMP VALUES (1234, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-D<br>D-YYYY'), 2500, NULL, 20)<br>20/02/23 19:12:39,241404 +01:00<br><br>DB_USER<br>--------------------------------------------------------------------------------<br>OBJECT_NAME<br>--------------------------------------------------------------------------------<br>SQL_TEXT<br>--------------------------------------------------------------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br><br>SCOTT<br>EMP<br>INSERT INTO EMP VALUES (1235, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-D<br>D-YYYY'), 2001, NULL, 20)<br><br>DB_USER<br>--------------------------------------------------------------------------------<br>OBJECT_NAME<br>--------------------------------------------------------------------------------<br>SQL_TEXT<br>--------------------------------------------------------------------------------<br>EXTENDED_TIMESTAMP<br>---------------------------------------------------------------------------<br>20/02/23 19:12:45,600793 +01:00</code></pre>\n<p>Como vemos, solo se han registrado los insert que tienen el salario mayor a 2000.</p>\n<h3 id=\"explica-la-diferencia-entre-auditar-una-operaci%C3%B3n-by-access-o-by-session-ilustr%C3%A1ndolo-con-ejemplos.\" tabindex=\"-1\">Explica la diferencia entre auditar una operaci√≥n by access o by session ilustr√°ndolo con ejemplos.</h3>\n<p>La diferencia entre by access y by session, radica en c√≥mo la vista DBA_AUDIT_TRAIL registra las acciones:</p>\n<ul>\n<li>\n<p><strong>By access</strong>: Inserta un registro en la auditor√≠a por cada declaraci√≥n auditada.</p>\n</li>\n<li>\n<p><strong>By session</strong>: Agrupa los registro cuando la sesi√≥n y la acci√≥n coinciden. Solo funciona para declaraciones que no sean DDL.</p>\n</li>\n</ul>\n<blockquote>\n<p><em>Desde Oracle 11gR2 el by session est√° deshabilitado y todas las auditor√≠as se hacen by access.</em></p>\n</blockquote>\n<p>Veamos con un ejemplo la diferencia que puede resultar m√°s sencillo de entender:</p>\n<p>S√≠ ejecutamos la siguiente consulta, nos muestra todas las acciones que se han realizado desde que la tabla est√° siendo auditada.</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">SELECT</span>  <span class=\"token keyword\">timestamp</span><span class=\"token punctuation\">,</span> os_username<span class=\"token punctuation\">,</span> obj_name<span class=\"token punctuation\">,</span>userhost<span class=\"token punctuation\">,</span> username<span class=\"token punctuation\">,</span><span class=\"token keyword\">action</span><span class=\"token punctuation\">,</span>action_name<span class=\"token punctuation\">,</span> ses_actions<br><span class=\"token keyword\">FROM</span>    dba_audit_trail<br><span class=\"token keyword\">WHERE</span>   obj_name <span class=\"token operator\">=</span> <span class=\"token string\">'EMP'</span><span class=\"token punctuation\">;</span></code></pre>\n<p>S√≠ esta tabla estuviese auditada by session agrupar√≠a los registros por sesi√≥n y acci√≥n, es decir, si tenemos 3 inserts para la tabla EMP en una misma sesi√≥n solo lo muestra una vez, sin embargo si estuviese auditada by access, mostrar√≠a los 3 inserts.</p>\n<h3 id=\"documenta-las-diferencias-entre-los-valores-db-y-db%2C-extended-del-par%C3%A1metro-audit_trail-de-oracle.-demu%C3%A9stralas-poniendo-un-ejemplo-de-la-informaci%C3%B3n-sobre-una-operaci%C3%B3n-concreta-recopilada-con-cada-uno-de-ellos.\" tabindex=\"-1\">Documenta las diferencias entre los valores db y db, extended del par√°metro audit_trail de ORACLE. Demu√©stralas poniendo un ejemplo de la informaci√≥n sobre una operaci√≥n concreta recopilada con cada uno de ellos.</h3>\n<p>Ambos valores indican que las auditor√≠as est√°n activadas en el sistema, y la diferencia se encuentra en que <code>db, extended</code> almacena datos que se corresponden con la tabla <code>SQLBLIND</code> y <code>SQLTEXT</code> en la tabla <code>SYS.AUD$</code>, mientras que <code>db</code> no almacena esa informaci√≥n.</p>\n<p>Para cambiar el valor de <code>db</code> a <code>db, extended</code>, ejecutamos la siguiente sentencia:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> ALTER SYSTEM SET audit_trail = DB,EXTENDED SCOPE=SPFILE;<br><br>Sistema modificado.<br></code></pre>\n<p>Reiniciamos oracle para que se apliquen los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SHUTDOWN<br>Base de datos cerrada.<br>Base de datos desmontada.<br>Instancia ORACLE cerrada.<br>SQL> STARTUP<br>Instancia ORACLE iniciada.<br><br>Total System Global Area 3573545736 bytes<br>Fixed Size\t\t    9141000 bytes<br>Variable Size\t\t  738197504 bytes<br>Database Buffers\t 2818572288 bytes<br>Redo Buffers\t\t    7634944 bytes<br>Base de datos montada.<br>Base de datos abierta.<br>SQL></code></pre>\n<p>Comprobamos que se han aplicado correctamente los cambios:</p>\n<p><img src=\"/img/GBD-audit-2.png\" alt=\"GBD-audit-2.png\"></p>\n<p>Ahora, desde el usuario SCOTT realizaremos dos deletes y dos inserts:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> DELETE FROM EMP WHERE EMPNO = 111;<br><br>1 fila suprimida.<br><br>SQL> DELETE FROM EMP WHERE EMPNO = 112;<br><br>1 fila suprimida.<br><br>SQL> INSERT INTO EMP VALUES (111, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-DD-YYYY'), 2500, NULL, 20);<br><br>1 fila creada.<br><br>SQL> INSERT INTO EMP VALUES (112, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-DD-YYYY'), 2500, NULL, 20);<br><br>1 fila creada.<br></code></pre>\n<p>Ahora veremos que se ha guardado tambi√©n en la vista SYS.AUD$:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT SQLTEXT FROM SYS.AUD$ WHERE CURRENT_USER = 'SCOTT';<br><br>SQLTEXT<br>--------------------------------------------------------------------------------<br><br><br><br><br><br><br><br><br><br><br><br><br>SQLTEXT<br>--------------------------------------------------------------------------------<br><br><br><br>DELETE FROM EMP WHERE EMPNO = 111<br>DELETE FROM EMP WHERE EMPNO = 112<br>INSERT INTO EMP VALUES (111, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-DD<br>INSERT INTO EMP VALUES (112, 'SMITH', 'CLERK', 7902, TO_DATE('01-01-1999','MM-DD<br><br>18 filas seleccionadas.<br><br>SQL> </code></pre>\n<p>Como vemos, indica que hay 18 filas pero solo muestra 4 registros de SQLTEXT, que son los que se han registrado desde que he indicado el valor <code>DB, EXTENDED</code> en el par√°metro <code>audit_trail</code>.</p>\n<h3 id=\"averigua-si-en-postgres-se-pueden-realizar-los-cuatro-primeros-apartados.-si-es-as%C3%AD%2C-documenta-el-proceso-adecuadamente.\" tabindex=\"-1\">Averigua si en Postgres se pueden realizar los cuatro primeros apartados. Si es as√≠, documenta el proceso adecuadamente.</h3>\n<h3 id=\"averigua-si-en-mysql-se-pueden-realizar-los-apartados-1%2C-3-y-4.-si-es-as%C3%AD%2C-documenta-el-proceso-adecuadamente.\" tabindex=\"-1\">Averigua si en MySQL se pueden realizar los apartados 1, 3 y 4. Si es as√≠, documenta el proceso adecuadamente.</h3>\n<p>Lo primero que tenemos que hacer es editar el fichero de configuraci√≥n para activar los registros de accesos exitosos y fallidos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/usuario# nano /etc/mysql/mariadb.conf.d/50-server.cnf </code></pre>\n<p>Descomentamos las 2 primeras l√≠neas:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">general_log_file       = /var/log/mysql/mysql.log<br>general_log            = 1<br>log_error = /var/log/mysql/error.log</code></pre>\n<p>Cambiamos el due√±o del log de mysql a mysql y reiniciamos el servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/usuario# chown mysql: /var/log/mysql/<br>root@mongodb:/home/usuario# systemctl restart mysql<br>root@mongodb:/home/usuario# systemctl restart mariadb</code></pre>\n<p>Accedemos varias veces con usuarios inexistentes y existentes para que se guarde en el log y lo visualizamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/usuario# cat /var/log/mysql/error.log</code></pre>\n<p>En este log nos muestra el acceso denegado, muestro la √∫ltima l√≠nea:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">2023-02-22 11:13:59 39 [Warning] Access denied for user 'prueba'@'localhost' (using password: NO)</code></pre>\n<p>Este log nos muestra la conexi√≥n y los comandos usados durante esa sesi√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/usuario# cat /var/log/mysql/mysql.log</code></pre>\n<p>El contenido de la √∫ltima conexi√≥n es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">230222 11:16:13\t    40 Connect\talemd@localhost as anonymous on <br>\t\t    40 Query\tselect @@version_comment limit 1<br>230222 11:16:16\t    40 Query\tshow users<br>230222 11:16:21\t    40 Query\tshow databases<br>230222 11:16:25\t    40 Query\tselect * from dual<br>230222 11:16:30\t    40 Quit\t</code></pre>\n<p>M√°s all√° de este log, con mysql no se puede hacer mucho m√°s de auditor√≠as, a no ser, que instalemos un plugin de auditor√≠a:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/usuario# mysql<br>Welcome to the MariaDB monitor.  Commands end with ; or \\g.<br>Your MariaDB connection id is 41<br>Server version: 10.3.36-MariaDB-0+deb10u2-log Debian 10<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.<br><br>MariaDB [(none)]> INSTALL SONAME 'server_audit';<br>Query OK, 0 rows affected (0,045 sec)<br></code></pre>\n<p>Una vez tengamos instalado el plugin, necesitamos activarlo editando el fichero de configuraci√≥n de mysql.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/usuario# nano /etc/mysql/mariadb.conf.d/50-server.cnf</code></pre>\n<p>En el apartado server, a√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">server_audit_events=CONNECT,QUERY,TABLE<br>server_audit_logging=ON<br>server_audit_incl_users=alemd</code></pre>\n<p>Reiniciamos el servicio y probaremos a crear una peque√±a tabla en la base de datos alemd e insertaremos registros en esa tabla.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">CREATE TABLE ALUMNO (<br>\tNOMBRE VARCHAR(30),<br>\tAPELLIDO1 VARCHAR(30),<br>\tAPELLIDO2 VARCHAR(30)<br>)<br><br>INSERT INTO ALUMNO VALUES ('JUAN','PEREZ','LOPEZ');<br>INSERT INTO ALUMNO VALUES ('JUAN','PEREZ','LOPEZ');<br>INSERT INTO ALUMNO VALUES ('JUAN','PEREZ','LOPEZ');</code></pre>\n<p>Si visualizamos el siguiente log, vemos que nos indica los inserts realizados:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/usuario# cat /var/lib/mysql/server_audit.log </code></pre>\n<p>El contenido es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">20230222 11:43:36,mongodb,alemd,localhost,37,64,QUERY,prueba,'INSERT INTO ALUMNO VALUES (\\'JUAN\\',\\'PEREZ\\',\\'LOPEZ\\')',0<br>20230222 11:43:37,mongodb,alemd,localhost,37,65,WRITE,prueba,ALUMNO,<br>20230222 11:43:37,mongodb,alemd,localhost,37,65,QUERY,prueba,'INSERT INTO ALUMNO VALUES (\\'JUAN\\',\\'PEREZ\\',\\'LOPEZ\\')',0<br>20230222 11:43:38,mongodb,alemd,localhost,37,66,WRITE,prueba,ALUMNO,<br>20230222 11:43:38,mongodb,alemd,localhost,37,66,QUERY,prueba,'INSERT INTO ALUMNO VALUES (\\'JUAN\\',\\'PEREZ\\',\\'LOPEZ\\')',0<br>20230222 11:43:53,mongodb,alemd,localhost,37,0,DISCONNECT,prueba,,0</code></pre>\n<p>Nos muestra la hora, el nombre de la m√°quina(mongodb), el usuario de la base de datos, la conexi√≥n que es localhost, sobre que tabla se realiza y que es lo que hace. Como es una tabla sencilla sin primary key, yo he usado varias veces el mismo registro.</p>\n<h3 id=\"averigua-las-posibilidades-que-ofrece-mongodb-para-auditar-los-cambios-que-va-sufriendo-un-documento.-demuestra-su-funcionamiento.\" tabindex=\"-1\">Averigua las posibilidades que ofrece MongoDB para auditar los cambios que va sufriendo un documento. Demuestra su funcionamiento.</h3>\n<p>La √∫nica versi√≥n de MongoDB que nos permite realizar auditor√≠as es MongoDB Enterprise. Tendremos 3 opciones para realizar auditor√≠as:</p>\n<ul>\n<li>Que se guarden en el <code>syslog</code></li>\n<li>Que se guarden en un fichero JSON o BSON.</li>\n<li>O hacer que aparezcan en la consola.</li>\n</ul>\n<p>Lo primero que haremos, ser√° ver las distintas maneras de habilitar las auditor√≠as:</p>\n<ol>\n<li>\n<p>Desde la consola, habilitar la auditor√≠a en el syslog.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">mongod --dbpath /var/lib/mongodb/ --auditDestination syslog</code></pre>\n</li>\n<li>\n<p>Desde la consola, habilitar la auditor√≠a en un fichero JSON o BSON.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">mongod --dbpath /var/lib/mongodb/ --auditDestination file --auditFormat [JSON|BSON] --auditPath /var/lib/mongodb/[auditLog.json|auditLog.bson]</code></pre>\n</li>\n<li>\n<p>Desde la consola, habilitar la auditor√≠a en la consola.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">mongod --dbpath /var/lib/mongodb/ --auditDestination console</code></pre>\n</li>\n<li>\n<p>Desde el fichero de configuraci√≥n de mongodb, habilitar las auditor√≠as en el syslog.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">nano /etc/mongod.conf<br><br>storage:<br>  dbPath: /var/lib/mongodb/<br>auditLog:<br>  destination: syslog</code></pre>\n</li>\n<li>\n<p>Desde el fichero de configuraci√≥n de mongodb, habilitar las auditor√≠as en un fichero JSON o BSON.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">nano /etc/mongod.conf<br><br>storage:<br>  dbPath: /var/lib/mongodb/<br>auditLog:<br>  destination: file<br>  format: [JSON|BSON]<br>  path: /var/lib/mongodb/[auditLog.json|auditLog.bson]</code></pre>\n</li>\n<li>\n<p>Desde el fichero de configuraci√≥n de mongodb, habilitar las auditor√≠as en la consola.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">storage:<br>  dbPath: /var/lib/mongodb/<br>auditLog:<br>  destination: console</code></pre>\n</li>\n</ol>\n<p>La opci√≥n que yo he elegido, ha sido desde la terminal, habilitar las auditor√≠as usando un fichero JSON:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/vagrant# mongod --dbpath /var/lib/mongodb/ --auditDestination file --auditFormat JSON --auditPath /var/lib/mongodb/auditLog.json</code></pre>\n<p>Si hacemos un cat al fichero nos muestra que funciona correctamente:</p>\n<pre class=\"language-json\"><code class=\"language-json\">root@mongodb<span class=\"token operator\">:</span>/home/vagrant# cat /var/lib/mongodb/auditLog.json | jq<br><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"atype\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"startup\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T13:19:29.635+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"uuid\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$binary\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"TV6jVkoZSsW96vJFM/dq9g==\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"$type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"04\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"local\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"roles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"param\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>      <span class=\"token property\">\"auditLog\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>        <span class=\"token property\">\"destination\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"file\"</span><span class=\"token punctuation\">,</span><br>        <span class=\"token property\">\"format\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"JSON\"</span><span class=\"token punctuation\">,</span><br>        <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/mongodb/auditLog.json\"</span><br>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>      <span class=\"token property\">\"storage\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>        <span class=\"token property\">\"dbPath\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/var/lib/mongodb/\"</span><br>      <span class=\"token punctuation\">}</span><br>    <span class=\"token punctuation\">}</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><br><span class=\"token punctuation\">}</span><br><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"atype\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"createDatabase\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T13:19:32.583+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"uuid\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$binary\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"TV6jVkoZSsW96vJFM/dq9g==\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"$type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"04\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"local\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"roles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"param\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"ns\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"admin\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><br><span class=\"token punctuation\">}</span><br></code></pre>\n<p>Realizo algunas operaciones y las muestro:</p>\n<p>Aqu√≠ nos muestra que hemos creado una base de datos.</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"atype\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"createDatabase\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T13:19:33.696+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"uuid\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$binary\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DWSnKPyfQqqYzkg/S+VBbg==\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"$type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"04\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"local\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"roles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"param\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"ns\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"config\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><br><span class=\"token punctuation\">}</span></code></pre>\n<p>Aqu√≠ nos muestra que hemos creado una colecci√≥n.</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"atype\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"createCollection\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T13:19:33.696+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"uuid\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$binary\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"DWSnKPyfQqqYzkg/S+VBbg==\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"$type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"04\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"local\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"roles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"param\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"ns\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"config.system.sessions\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><br><span class=\"token punctuation\">}</span></code></pre>\n<p>Aqu√≠ nos muestra que nos deslogueamos</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"atype\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"logout\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T13:21:23.017+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"uuid\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$binary\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"mmU3D1a+R1K9BAYKB6HfzQ==\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"$type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"04\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"local\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"isSystemUser\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"users\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"roles\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"param\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"reason\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Client has disconnected\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"initialUsers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><br>      <span class=\"token punctuation\">{</span><br>        <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"__system\"</span><span class=\"token punctuation\">,</span><br>        <span class=\"token property\">\"db\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"local\"</span><br>      <span class=\"token punctuation\">}</span><br>    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"updatedUsers\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><br><span class=\"token punctuation\">}</span><br></code></pre>\n<h3 id=\"averigua-si-en-mongodb-se-pueden-auditar-los-accesos-a-una-colecci%C3%B3n-concreta.-demuestra-su-funcionamiento.\" tabindex=\"-1\">Averigua si en MongoDB se pueden auditar los accesos a una colecci√≥n concreta. Demuestra su funcionamiento.</h3>\n<p>S√≠, se pueden auditar los accesos a una colecci√≥n concreta. Seguiremos los siguientes pasos:</p>\n<ol>\n<li>\n<p>Conectados al usuario admin. crearemos una base de datos donde se guardar√° la colecci√≥n y creamos la colecci√≥n que vamos a auditar:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Enterprise test> use prueba<br>switched to db prueba<br>Enterprise prueba> db.createCollection(\"alumno\")<br>{ ok: 1 }</code></pre>\n</li>\n<li>\n<p>Insertamos datos en la colecci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Enterprise prueba> db.alumno.insertMany( [<br>...   { nombre: \"Ale\", id: 1 },<br>...   { nombre: \"Manolo\", id: 2 },<br>...   { nombre: \"Paco\", id: 3 }<br>... ] )<br>{<br>  acknowledged: true,<br>  insertedIds: {<br>    '0': ObjectId(\"63f6298e92eef3c4cdabb572\"),<br>    '1': ObjectId(\"63f6298e92eef3c4cdabb573\"),<br>    '2': ObjectId(\"63f6298e92eef3c4cdabb574\")<br>  }<br>}</code></pre>\n</li>\n<li>\n<p>Le damos al usuario admin permisos de root y ejecutamos el comando con el que se va a activar la auditor√≠a:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Enterprise admin> db.grantRolesToUser('admin', [{ role: 'root', db: 'admin' }])<br>{ ok: 1 }<br>Enterprise admin> db.setLogLevel(3, \"accessControl\")<br>{<br>  was: {<br>    verbosity: 0,<br>    accessControl: { verbosity: -1 },<br>    assert: { verbosity: -1 },<br>    command: { verbosity: -1 },<br>    control: { verbosity: -1 },<br>    executor: { verbosity: -1 },<br>    geo: { verbosity: -1 },<br>    index: { verbosity: -1 },<br>    network: {<br>      verbosity: -1,<br>      asio: { verbosity: -1 },<br>      bridge: { verbosity: -1 },<br>      connectionPool: { verbosity: -1 }<br>    },<br>    processHealth: { verbosity: -1 },<br>    query: { verbosity: -1 },<br>    replication: {<br>      verbosity: -1,<br>      election: { verbosity: -1 },<br>      heartbeats: { verbosity: -1 },<br>      initialSync: { verbosity: -1 },<br>      rollback: { verbosity: -1 }<br>    },<br>    sharding: {<br>      verbosity: -1,<br>      rangeDeleter: { verbosity: -1 },<br>      shardingCatalogRefresh: { verbosity: -1 },<br>      migration: { verbosity: -1 },<br>      reshard: { verbosity: -1 },<br>      migrationPerf: { verbosity: -1 }<br>    },<br>    storage: {<br>      verbosity: -1,<br>      recovery: { verbosity: -1 },<br>      journal: { verbosity: -1 },<br>      wt: {<br>        verbosity: -1,<br>        wtBackup: { verbosity: -1 },<br>        wtCheckpoint: { verbosity: -1 },<br>        wtCompact: { verbosity: -1 },<br>        wtEviction: { verbosity: -1 },<br>        wtHS: { verbosity: -1 },<br>        wtRecovery: { verbosity: -1 },<br>        wtRTS: { verbosity: -1 },<br>        wtSalvage: { verbosity: -1 },<br>        wtTiered: { verbosity: -1 },<br>        wtTimestamp: { verbosity: -1 },<br>        wtTransaction: { verbosity: -1 },<br>        wtVerify: { verbosity: -1 },<br>        wtWriteLog: { verbosity: -1 }<br>      }<br>    },<br>    write: { verbosity: -1 },<br>    ftdc: { verbosity: -1 },<br>    tracking: { verbosity: -1 },<br>    transaction: { verbosity: -1 },<br>    tenantMigration: { verbosity: -1 },<br>    test: { verbosity: -1 }<br>  },<br>  ok: 1<br>}</code></pre>\n</li>\n<li>\n<p>Creamos un usuario que pueda acceder a la base de datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Enterprise prueba> db.createUser({<br>... user: \"alemd\",<br>... pwd: \"usuario\",<br>... roles: [{ role: \"readWrite\", db: \"prueba\"}]<br>... });<br>{ ok: 1 }</code></pre>\n</li>\n<li>\n<p>Nos logueamos con el usuario y realizamos una consulta a la colecci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@mongodb:/home/vagrant# mongosh -u alemd -p --authenticationDatabase prueba<br>Enter password: *******<br>Current Mongosh Log ID:\t63f62d37e3bae1519b4d1fac<br>Connecting to:\t\tmongodb://&lt;credentials>@127.0.0.1:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;authSource=prueba&amp;appName=mongosh+1.7.1<br>Using MongoDB:\t\t6.0.4<br>Using Mongosh:\t\t1.7.1<br><br>For mongosh info see: https://docs.mongodb.com/mongodb-shell/<br><br>Enterprise test> use prueba<br>switched to db prueba<br>Enterprise prueba> db.alumno.find()<br>[<br>  { _id: ObjectId(\"63f6298e92eef3c4cdabb572\"), nombre: 'Ale', id: 1 },<br>  {<br>    _id: ObjectId(\"63f6298e92eef3c4cdabb573\"),<br>    nombre: 'Manolo',<br>    id: 2<br>  },<br>  { _id: ObjectId(\"63f6298e92eef3c4cdabb574\"), nombre: 'Paco', id: 3 }<br>]</code></pre>\n</li>\n<li>\n<p>Creamos un usuario sin permisos y volvemos a realizar una consulta a la colecci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Enterprise admin> db.createRole({<br>...    role: \"ninguno\",<br>...    privileges: [<br>...       { resource: { db: \"prueba\", collection: \"\" }, actions: [\"remove\"] }<br>...    ],<br>...    roles: []<br>... })<br>{ ok: 1 }<br>Enterprise admin> db.createUser(<br>...   {<br>...     user: \"usuario1\",<br>...     pwd: \"usuario\",<br>...     roles: [\"ninguno\"]<br>...   }<br>... )<br>{ ok: 1 }<br>Enterprise admin> exit<br>root@mongodb:/home/vagrant# mongosh -u usuario1 -p --authenticationDatabase<br>Enter password: *******<br>Current Mongosh Log ID:\t63f62e9e3d9f637adb8fedd1<br>Connecting to:\t\tmongodb://&lt;credentials>@127.0.0.1:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;appName=mongosh+1.7.1<br>Using MongoDB:\t\t6.0.4<br>Using Mongosh:\t\t1.7.1<br><br>For mongosh info see: https://docs.mongodb.com/mongodb-shell/<br><br>Enterprise test> use prueba<br>switched to db prueba<br>Enterprise prueba> db.alumno.find()<br>MongoServerError: not authorized on prueba to execute command { find: \"alumno\", filter: {}, lsid: { id: UUID(\"2c12c016-9e3f-4d64-9f09-d5830df633cd\") }, $db: \"prueba\" }</code></pre>\n</li>\n<li>\n<p>Consultamos el log y veremos los accesos de la colecci√≥n:</p>\n<p>Aqu√≠ nos muestra una autenticaci√≥n fallada para el usuario alemd en la base de datos admin.</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"t\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T14:56:40.449+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"s\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"I\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"c\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ACCESS\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20249</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ctx\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"conn74\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"msg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Authentication failed\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"attr\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"mechanism\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"SCRAM-SHA-256\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"speculative\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"principalName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"alemd\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"authenticationDatabase\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"127.0.0.1:36046\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"extraInfo\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"UserNotFound: Could not find user \\\"alemd\\\" for db \\\"admin\\\"\"</span><br>  <span class=\"token punctuation\">}</span><br><span class=\"token punctuation\">}</span></code></pre>\n<p>Aqu√≠ nos muestra un loggeo exitoso:</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"t\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T15:02:58.635+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"s\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"I\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"c\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ACCESS\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20250</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ctx\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"conn101\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"msg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Authentication succeeded\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"attr\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"mechanism\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"SCRAM-SHA-256\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"speculative\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"principalName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"usuario1\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"authenticationDatabase\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"admin\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"127.0.0.1:33724\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"extraInfo\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><br>  <span class=\"token punctuation\">}</span><br><span class=\"token punctuation\">}</span></code></pre>\n<p>Aqu√≠ nos muestra el intento fallido de acceso a una colecci√≥n:</p>\n<pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"t\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T15:02:45.500+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"s\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"D1\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"c\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ACCESS\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20238</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ctx\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"AuthorizationManager-9\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"msg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Getting user record\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"attr\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>      <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"usuario1\"</span><span class=\"token punctuation\">,</span><br>      <span class=\"token property\">\"db\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prueba\"</span><br>    <span class=\"token punctuation\">}</span><br>  <span class=\"token punctuation\">}</span><br><span class=\"token punctuation\">}</span><br><span class=\"token punctuation\">{</span><br>  <span class=\"token property\">\"t\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"$date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2023-02-22T15:02:45.500+00:00\"</span><br>  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"s\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"I\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"c\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ACCESS\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token number\">20249</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"ctx\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"conn95\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"msg\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Authentication failed\"</span><span class=\"token punctuation\">,</span><br>  <span class=\"token property\">\"attr\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><br>    <span class=\"token property\">\"mechanism\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"SCRAM-SHA-1\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"speculative\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"principalName\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"usuario1\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"authenticationDatabase\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"prueba\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"remote\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"127.0.0.1:54242\"</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"extraInfo\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span><br>    <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"UserNotFound: Could not find user \\\"usuario1\\\" for db \\\"prueba\\\"\"</span><br>  <span class=\"token punctuation\">}</span><br><span class=\"token punctuation\">}</span></code></pre>\n</li>\n</ol>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-20T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-k8s-v./",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-k8s-v./",
      "title": "Ejercicios de K8s V.",
      "content_html": "<h3 id=\"configurando-nuestra-aplicaci%C3%B3n-temperaturas.\" tabindex=\"-1\">Configurando nuestra aplicaci√≥n Temperaturas.</h3>\n<p><strong>En un ejemplo anterior: Ejemplo completo: Desplegando y accediendo a la aplicaci√≥n Temperaturas hab√≠amos desplegado una aplicaci√≥n formada por dos microservicios que nos permit√≠a visualizar las temperaturas de municipios.</strong></p>\n<p><strong>Recordamos que el componente frontend hace peticiones al componente backend utilizando el nombre temperaturas-backend, que es el nombre que asignamos al Service ClusterIP para el acceso al backend.</strong></p>\n<p><strong>Vamos a cambiar la configuraci√≥n de la aplicaci√≥n para indicar otro nombre.</strong></p>\n<p><strong>Podemos configurar el nombre del servidor backend al que vamos acceder desde el frontend modificando la variable de entorno TEMP_SERVER a la hora de crear el despliegue del frontend.</strong></p>\n<p><strong>Por defecto el valor de esa variable es:</strong></p>\n<p><code>TEMP_SERVER temperaturas-backend:5000</code></p>\n<p><strong>Vamos a modificar esta variable en el despliegue del frontend y cambiaremos el nombre del Service del backend para que coincidan, para ello realiza los siguientes pasos:</strong></p>\n<h4 id=\"1.-crea-un-recurso-configmap-con-un-dato-que-tenga-como-clave-servidor_temperaturas-y-como-contenido-servidor-temperaturas%3A5000.\" tabindex=\"-1\">1. Crea un recurso ConfigMap con un dato que tenga como clave SERVIDOR_TEMPERATURAS y como contenido servidor-temperaturas:5000.</h4>\n<p>Creo el recurso ConfigMap:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl create cm temperaturas --from-literal=SERVIDOR_TEMPERATURAS=servidor-temperaturas:5000<br>configmap/temperaturas created</code></pre>\n<p>Podemos ver el recurso utilizando el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl describe cm temperaturas<br>Name:         temperaturas<br>Namespace:    default<br>Labels:       &lt;none><br>Annotations:  &lt;none><br><br>Data<br>====<br>SERVIDOR_TEMPERATURAS:<br>----<br>servidor-temperaturas:5000<br><br>BinaryData<br>====<br><br>Events:  &lt;none></code></pre>\n<h4 id=\"2.-modifica-el-fichero-de-despliegue-del-frontend%3A-frontend-deployment.yaml-para-a%C3%B1adir-la-modificaci%C3%B3n-de-la-variable-temp_server-con-el-valor-que-hemos-guardado-en-el-configmap.\" tabindex=\"-1\">2. Modifica el fichero de despliegue del frontend: frontend-deployment.yaml para a√±adir la modificaci√≥n de la variable TEMP_SERVER con el valor que hemos guardado en el ConfigMap.</h4>\n<p>El fichero queda de la siguiente manera:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: temperaturas-frontend<br>  labels:<br>    app: temperaturas<br>    tier: frontend<br>spec:<br>  replicas: 3<br>  selector:<br>    matchLabels:<br>      app: temperaturas<br>      tier: frontend<br>  template:<br>    metadata:<br>      labels:<br>        app: temperaturas<br>        tier: frontend<br>    spec:<br>      containers:<br>      - name: contenedor-temperaturas<br>        image: iesgn/temperaturas_frontend<br>        ports:<br>          - name: http-server<br>            containerPort: 3000<br>        env:<br>          - name: TEMP_SERVER<br>            valueFrom:<br>              configMapKeyRef:<br>                name: temperaturas<br>                key: SERVIDOR_TEMPERATURAS</code></pre>\n<h4 id=\"3.-realiza-el-despliegue-y-crea-el-service-para-acceder-al-frontend.\" tabindex=\"-1\">3. Realiza el despliegue y crea el Service para acceder al frontend.</h4>\n<p>fichero del frontend service:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: temperaturas-frontend<br>  labels:<br>    app: temperaturas<br>    tier: frontend<br>spec:<br>  type: NodePort<br>  ports:<br>  - port: 3000<br>    targetPort: http-server<br>  selector:<br>    app: temperaturas<br>    tier: frontend</code></pre>\n<h4 id=\"4.-despliega-el-microservicio-backend.\" tabindex=\"-1\">4. Despliega el microservicio backend.</h4>\n<p>Muestro el fichero del despliegue del backend:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: temperaturas-backend<br>  labels:<br>    app: temperaturas<br>    tier: backend<br>spec:<br>  replicas: 1<br>  selector:<br>    matchLabels:<br>      app: temperaturas<br>      tier: backend<br>  template:<br>    metadata:<br>      labels:<br>        app: temperaturas<br>        tier: backend<br>    spec:<br>      containers:<br>        - name: contendor-servidor-temperaturas<br>          image: iesgn/temperaturas_backend<br>          ports:<br>            - name: api-server<br>              containerPort: 5000</code></pre>\n<h4 id=\"5.-modifica-el-fichero-backend-srv.yaml-para-cambiar-el-nombre-del-service-por-servidor-temperaturas-y-crea-el-service.\" tabindex=\"-1\">5. Modifica el fichero backend-srv.yaml para cambiar el nombre del Service por servidor-temperaturas y crea el Service.</h4>\n<p>Muestro el fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: v1<br>kind: Service<br>metadata:<br>  name: servidor-temperaturas<br>  labels:<br>    app: temperaturas<br>    tier: backend<br>spec:<br>  type: ClusterIP<br>  ports:<br>  - port: 5000<br>    targetPort: api-server<br>  selector:<br>    app: temperaturas<br>    tier: backend</code></pre>\n<h4 id=\"6.-accede-a-la-aplicaci%C3%B3n-usando-el-puerto-asignado-al-service-nodeport-del-frontend-o-creando-el-recurso-ingress.\" tabindex=\"-1\">6. Accede a la aplicaci√≥n usando el puerto asignado al Service NodePort del frontend o creando el recurso Ingress.</h4>\n<p><img src=\"/img/SRI-K8S-V.1.png\" alt=\"SRI-K8S-V.1.png\"></p>\n<h3 id=\"despliegue-y-acceso-de-la-aplicaci%C3%B3n-nextcloud.\" tabindex=\"-1\">Despliegue y acceso de la aplicaci√≥n Nextcloud.</h3>\n<p><strong>Bas√°ndonos en el Ejemplo completo: Despliegue y acceso a Wordpress + MariaDB vamos a realizar el despliegue de la aplicaci√≥n NextCloud + MariaDB. Para ello ten en cuenta lo siguiente:</strong></p>\n<ul>\n<li>\n<p><strong>El despliegue de la base de datos se har√≠a de la misma forma que encontramos en el ejemplo de Wordpress, pero para esta actividad vamos a usar la imagen mariadb:10.5.</strong></p>\n</li>\n<li>\n<p><strong>Seg√∫n la documentaci√≥n de NextCloud en DockerHub las variables de entorno que tienes que modificar ser√≠an: MYSQL_DATABASE, MYSQL_USER, MYSQL_PASSWORD y MYSQL_HOST.</strong></p>\n</li>\n<li>\n<p><strong>Al igual que en el ejemplo utiliza un recurso ConfigMap para guardar los valores de configuraci√≥n no sensibles, y un recurso Secret para los datos sensibles.</strong></p>\n</li>\n<li>\n<p><strong>4. Utiliza los ficheros yaml del ejemplo haciendo las modificaciones oportunas.</strong></p>\n</li>\n</ul>\n<p>Lo primero que haremos ser√° crear los recursos ConfigMap y Secret.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/nextcloud$ kubectl create cm cm-nextcloud --from-literal=MYSQL_DATABASE=mariadb --from-literal=MYSQL_USER=mariadb<br>configmap/cm-nextcloud created<br>alemd@debian:~/minikube/nextcloud$ kubectl create secret generic secret-nextcloud --from-literal=MYSQL_PASSWORD=mariadb<br>secret/secret-nextcloud created<br>alemd@debian:~/minikube/nextcloud$ kubectl create cm cm-host --from-literal=MYSQL_HOST=mariadb-service<br>configmap/cm-host created</code></pre>\n<p>Ahora, adjunto el deployment de mariadb:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>deployment<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contenedor<span class=\"token punctuation\">-</span>mariadb<br>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mariadb<br>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> db<span class=\"token punctuation\">-</span>port<br>          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_ROOT_PASSWORD<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD</code></pre>\n<p>El service de mariadb:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">-</span>service<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> database<br>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> db<span class=\"token punctuation\">-</span>port<br>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP</code></pre>\n<p>El deployment de nextcloud:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nextcloud<span class=\"token punctuation\">-</span>deployment<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>      <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>        <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> contenedor<span class=\"token punctuation\">-</span>nextcloud<br>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nextcloud<br>          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>port<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span><br>              <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">-</span>port<br>          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span><br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_DATABASE<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_USER<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> secret<span class=\"token punctuation\">-</span>nextcloud<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_PASSWORD<br>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> MYSQL_HOST<br>              <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span><br>                <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span><br>                  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>host<br>                  <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> MYSQL_HOST</code></pre>\n<p>El service de nextcloud:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nextcloud<span class=\"token punctuation\">-</span>service<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nextcloud<br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> frontend<br>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>sv<span class=\"token punctuation\">-</span>port<br>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>port<br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">-</span>sv<span class=\"token punctuation\">-</span>port<br>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> https<span class=\"token punctuation\">-</span>port<br>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort</code></pre>\n<p>Ahora levantamos los deployments y los services:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube/nextcloud$ kubectl apply -f mariadb-deployment.yaml <br>deployment.apps/mariadb-deployment created<br>alemd@debian:~/minikube/nextcloud$ kubectl apply -f mariadb-service.yaml <br>service/mariadb-service created<br>alemd@debian:~/minikube/nextcloud$ kubectl apply -f nextcloud-deployment.yaml <br>deployment.apps/nextcloud-deployment created<br>alemd@debian:~/minikube/nextcloud$ kubectl apply -f nextcloud-service.yaml<br>service/nextcloud-service created</code></pre>\n<p>Ya podemos acceder a nuestro nextcloud:</p>\n<p><img src=\"/img/SRI-K8S-5.1.png\" alt=\"SRI-K8S-5.1.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-16T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/practica:-implantacion-de-aplicaciones-web-php-en-docker./",
      "url": "https://reeseschultz.github.io/post/practica:-implantacion-de-aplicaciones-web-php-en-docker./",
      "title": "Pr√°ctica: Implantaci√≥n de aplicaciones web PHP en docker.",
      "content_html": "<p>Imaginemos que el equipo de desarrollo de nuestra empresa ha desarrollado una aplicaci√≥n PHP que se llama BookMedik (<a href=\"https://github.com/evilnapsis/bookmedik\">https://github.com/evilnapsis/bookmedik</a>).</p>\n<p>Queremos crear una imagen Docker para implantar dicha aplicaci√≥n.</p>\n<p>Tenemos que tener en cuenta los siguientes aspectos:</p>\n<p><strong>Contenedor mariadb</strong></p>\n<ul>\n<li>Es necesario que nuestra aplicaci√≥n guarde su informaci√≥n en un contenedor docker mariadb.</li>\n<li>El script para generar la base de datos y los registros lo encuentras en el repositorio y se llama schema.sql. Debes crear un usuario con su contrase√±a en la base de datos. La base de datos se llama bookmedik y se crea al ejecutar el script.</li>\n<li>Ejecuta el contenedor mariadb y carga los datos del script schema.sql. Para m√°s informaci√≥n.</li>\n<li>El contenedor mariadb debe tener un volumen para guardar la base de datos.</li>\n</ul>\n<p><strong>Contenedor bookmedik</strong></p>\n<ul>\n<li>Vamos a crear tres versiones de la imagen que nos permite implantar la aplicaci√≥n PHP.</li>\n<li>La imagen debe crear las variables de entorno necesarias con datos de conexi√≥n por defecto.</li>\n<li>Al crear un contenedor a partir de estas im√°genes se ejecutar√° un script bash que realizar√° las siguientes tareas:\n<ul>\n<li>Modifique el fichero core\\controller\\Database.php para que lea las variables de entorno. Para obtener las variables de entorno en PHP usar la funci√≥n getenv. Para m√°s informaci√≥n.</li>\n<li>Inicialice la base de datos con el fichero schema.sql.</li>\n<li>Ejecute el servidor web.</li>\n</ul>\n</li>\n<li>El contenedor que creas debe tener un volumen para guardar los logs del servidor web.</li>\n<li>La imagen la tienes que crear en tu entorno de desarrollo con el comando docker build.</li>\n</ul>\n<hr>\n<p>Lo primero que haremos ser√° crear un contenedor con la imagen de mariadb con las variables de entorno que nos han indicado y crearemos una nueva red para la aplicaci√≥n web.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica$ docker network create red_bookmedik<br>f5873a0d59ee09ca18fed495a0cdae9b9dbd4251e926ee083c77cd906a696b86<br>usuario@debian:~/docker/practica$ docker run -d --name bd_mariadb -v bookmedik_vol:/var/lib/mysql --network red_bookmedik -e MARIADB_ROOT_PASSWORD=root -e MARIADB_DATABASE=bookmedik -e MARIADB_USER=bookmedik -e MARIADB_PASSWORD=bookmedik mariadb<br>fcc6779f9140829742d3db89892d38d5103a31902001090fb8901fd1fe690669</code></pre>\n<h3 id=\"creaci%C3%B3n-de-una-imagen-docker-con-una-aplicaci%C3%B3n-web-desde-una-imagen-base.\" tabindex=\"-1\">Creaci√≥n de una imagen docker con una aplicaci√≥n web desde una imagen base.</h3>\n<ul>\n<li><strong>Vamos a crear una imagen que se llame usuario/bookmedik:v1.</strong></li>\n</ul>\n<p>En primer lugar, haremos un fork al repositorio de bookmedik y lo clonaremos a nuestro equipo. Editaremos el fichero schema.sql y quitaremos las siguientes l√≠neas:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">create database bookmedik;<br>use bookmedik;</code></pre>\n<p>Ahora, modificaremos el fichero <code>Database.php</code> para que se configure con las variables de entorno que indicamos al crear el contenedor.</p>\n<p>la ruta es la siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica/bookmedik$ nano core/controller/Database.php</code></pre>\n<p>El fichero queda de la siguiente manera:</p>\n<pre class=\"language-php\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span><br><span class=\"token keyword\">class</span> <span class=\"token class-name-definition class-name\">Database</span> <span class=\"token punctuation\">{</span><br>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token variable\">$db</span><span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token variable\">$con</span><span class=\"token punctuation\">;</span><br>        <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">Database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><br>                <span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token operator\">=</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'USUARIO_BOOKMEDIK'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">pass</span><span class=\"token operator\">=</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'CONTRA_BOOKMEDIK'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">host</span><span class=\"token operator\">=</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'DATABASE_HOST'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">ddbb</span><span class=\"token operator\">=</span><span class=\"token function\">getenv</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'NOMBRE_DB'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>        <span class=\"token punctuation\">}</span><br><br>        <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><br>                <span class=\"token variable\">$con</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">mysqli</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">host</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">user</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">pass</span><span class=\"token punctuation\">,</span><span class=\"token variable\">$this</span><span class=\"token operator\">-></span><span class=\"token property\">ddbb</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>                <span class=\"token variable\">$con</span><span class=\"token operator\">-></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"set sql_mode=''\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>                <span class=\"token keyword\">return</span> <span class=\"token variable\">$con</span><span class=\"token punctuation\">;</span><br>        <span class=\"token punctuation\">}</span><br><br>        <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">function</span> <span class=\"token function-definition function\">getCon</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><br>                <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token variable\">$con</span><span class=\"token operator\">==</span><span class=\"token constant\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token variable\">$db</span><span class=\"token operator\">==</span><span class=\"token constant\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span><br>                        <span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token variable\">$db</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Database</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>                        <span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token variable\">$con</span> <span class=\"token operator\">=</span> <span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>                <span class=\"token punctuation\">}</span><br>                <span class=\"token keyword\">return</span> <span class=\"token keyword static-context\">self</span><span class=\"token operator\">::</span><span class=\"token variable\">$con</span><span class=\"token punctuation\">;</span><br>        <span class=\"token punctuation\">}</span><br><span class=\"token punctuation\">}</span><br><span class=\"token delimiter important\">?></span></span></code></pre>\n<p>Una vez hecho esto, ya podremos crear el Dockerfile con el que crearemos la imagen.</p>\n<ul>\n<li><strong>Crea una imagen docker con la aplicaci√≥n desde una imagen base de debian o ubuntu.</strong></li>\n</ul>\n<p>El contenido del Dockerfile es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">FROM debian:bullseye<br>MAINTAINER Alejandro Montes \"alejandro@alejandro-montes.es\"<br>RUN apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install apache2 libapache2-mod-php php php-mysql mariadb-client -y &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/*<br>ADD bookmedik /var/www/html/<br>ADD script.sh /opt/<br>RUN chmod +x /opt/script.sh &amp;&amp; rm /var/www/html/index.html<br>ENTRYPOINT [\"/opt/script.sh\"]</code></pre>\n<p>Como vemos, el Dockerfile ejecuta un script, el contenido del script es el siguiente:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#! /bin/sh</span><br><br>mysql -u <span class=\"token variable\">$USUARIO_BOOKMEDIK</span> --password<span class=\"token operator\">=</span><span class=\"token variable\">$CONTRA_BOOKMEDIK</span> -h <span class=\"token variable\">$DATABASE_HOST</span> <span class=\"token variable\">$NOMBRE_DB</span> <span class=\"token operator\">&lt;</span> /var/www/html/schema.sql<br><br>/usr/sbin/apache2ctl -D FOREGROUND</code></pre>\n<p>Una vez hecho esto, ya podemos crear la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica$ docker build -t alemd01/bookmedik:v1 .<br>Sending build context to Docker daemon   5.78MB<br>Step 1/7 : FROM debian:bullseye<br>bullseye: Pulling from library/debian<br>1e4aec178e08: Pull complete <br>Digest: sha256:43ef0c6c3585d5b406caa7a0f232ff5a19c1402aeb415f68bcd1cf9d10180af8<br>Status: Downloaded newer image for debian:bullseye<br> ---> 54e726b437fb<br>Step 2/7 : MAINTAINER Alejandro Montes \"alejandro@alejandro-montes.es\"<br> ---> Running in 1647cfd1e95c<br>Removing intermediate container 1647cfd1e95c<br> ---> a59b1bdf1432<br>Step 3/7 : RUN apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install apache2 libapache2-mod-php php php-mysql mariadb-client -y &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/*<br> ---> Running in 0f4011dfed2b</code></pre>\n<p>Como podemos ver la imagen se ha creado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica$ docker images<br>REPOSITORY                TAG          IMAGE ID       CREATED          SIZE<br>alemd01/bookmedik         v1           d30f6251c040   14 minutes ago   302MB<br>debian                    bullseye     54e726b437fb   10 days ago      124MB<br>alemd01/mi_servidor_web   v2           4c59dc832620   12 days ago      239MB<br>alemd01/mi_servidor_web   v1           b1421e4328a1   12 days ago      239MB<br>nextcloud                 latest       2af5f013b660   2 weeks ago      1.02GB<br>debian                    latest       20473158e8b3   2 weeks ago      124MB<br>mariadb                   10.5         817e0c16a766   2 weeks ago      402MB<br>mariadb                   latest       039bd724508b   2 weeks ago      410MB<br>httpd                     2.4          6e794a483258   4 weeks ago      145MB<br>ubuntu                    latest       6b7dfa7e8fdb   2 months ago     77.8MB<br>php                       7.4-apache   20a3732f422b   3 months ago     453MB<br>hello-world               latest       feb5d9fea6a5   17 months ago    13.3kB</code></pre>\n<h3 id=\"despliegue-en-el-entorno-de-desarrollo.\" tabindex=\"-1\">Despliegue en el entorno de desarrollo.</h3>\n<ul>\n<li><strong>Crea un script con docker-compose que levante el escenario con los dos contenedores.</strong></li>\n<li><strong>Recuerda que para acceder a la aplicaci√≥n: Usuario: admin, contrase√±a: admin.</strong></li>\n</ul>\n<p>Vamos a crear el fichero docker-compose con la configuraci√≥n necesaria para levantar los dos contenedores:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.1'</span><br><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">bookmedik</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> bookmedik<span class=\"token punctuation\">-</span>app<br>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alemd01/bookmedik<span class=\"token punctuation\">:</span>v1<br>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always<br>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">USUARIO_BOOKMEDIK</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">CONTRA_BOOKMEDIK</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">DATABASE_HOST</span><span class=\"token punctuation\">:</span> bd_mariadb<br>      <span class=\"token key atrule\">NOMBRE_DB</span><span class=\"token punctuation\">:</span> bookmedik<br>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> 8081<span class=\"token punctuation\">:</span><span class=\"token number\">80</span><br>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> db<br>  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> bd_mariadb<br>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mariadb<br>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always<br>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">MARIADB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> root<br>      <span class=\"token key atrule\">MARIADB_DATABASE</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">MARIADB_USER</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">MARIADB_PASSWORD</span><span class=\"token punctuation\">:</span> bookmedik<br>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> mariadb_data<span class=\"token punctuation\">:</span>/var/lib/mysql<br><span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">mariadb_data</span><span class=\"token punctuation\">:</span></code></pre>\n<p>Levantamos los contenedores:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica$ docker-compose up -d<br>Creating bd_mariadb ... done<br>Creating bookmedik-app ... done</code></pre>\n<p>Muestro que est√°n creados:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica$ docker ps<br>CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS                  NAMES<br>5cc92c18f18c   alemd01/bookmedik:v1   \"/opt/script.sh\"         11 minutes ago   Up 11 minutes   0.0.0.0:8081->80/tcp   bookmedik-app<br>9045e0b5dd8a   mariadb                \"docker-entrypoint.s‚Ä¶\"   11 minutes ago   Up 11 minutes   3306/tcp               bd_mariadb</code></pre>\n<p>Muestro que la aplicaci√≥n funciona:</p>\n<p><img src=\"/img/IAW-P7-T1.1.png\" alt=\"IAW-P7-T1.1.png\"></p>\n<h3 id=\"creaci%C3%B3n-de-una-imagen-docker-con-una-aplicaci%C3%B3n-web-desde-una-imagen-php.\" tabindex=\"-1\">Creaci√≥n de una imagen docker con una aplicaci√≥n web desde una imagen PHP.</h3>\n<ul>\n<li><strong>Vamos a crear una imagen que se llame usuario/bookmedik:v2.</strong></li>\n<li><strong>Realiza la imagen docker de la aplicaci√≥n a partir de la imagen oficial PHP que encuentras en docker hub. Lee la documentaci√≥n de la imagen para configurar una imagen con apache2 y php, adem√°s seguramente tengas que instalar alguna extensi√≥n de php.</strong></li>\n<li><strong>Modifica el fichero docker-compose.yml` para probar esta imagen.</strong></li>\n</ul>\n<p>Adjunto el Dockerfile:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">FROM php:7.4-apache-bullseye<br>MAINTAINER Alejandro Montes Delgado \"aaleemd11@gmail.com\"<br>RUN apt update &amp;&amp; apt upgrade -y &amp;&amp; docker-php-ext-install mysqli pdo pdo_mysql &amp;&amp; apt install mariadb-client -y &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/*<br>ADD bookmedik /var/www/html/<br>ADD script.sh /opt/<br>RUN chmod +x /opt/script.sh<br>ENTRYPOINT [\"/opt/script.sh\"]</code></pre>\n<p>Creamos la imagen nueva:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica/tarea3$ docker build -t alemd01/bookmedik:v2 .Sending build context to Docker daemon   5.78MB<br>Step 1/7 : FROM php:7.4-apache-bullseye<br>7.4-apache-bullseye: Pulling from library/php<br>Digest: sha256:c9d7e608f73832673479770d66aacc8100011ec751d1905ff63fae3fe2e0ca6d<br>Status: Downloaded newer image for php:7.4-apache-bullseye<br> ---> 20a3732f422b<br>Step 2/7 : MAINTAINER Alejandro Montes Delgado \"aaleemd11@gmail.com\"<br> ---> Running in 8a5fb4ef6046<br>Removing intermediate container 8a5fb4ef6046<br> ---> 62d2489e4625<br>Step 3/7 : RUN apt update &amp;&amp; apt upgrade -y &amp;&amp; docker-php-ext-install mysqli pdo pdo_mysql &amp;&amp; apt install mariadb-client -y &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/*<br> ---> Running in 50204a750e86</code></pre>\n<p>Ahora en el docker-compose cambiamos la version a v2:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.1'</span><br><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">bookmedik</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> bookmedik<span class=\"token punctuation\">-</span>app<br>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alemd01/bookmedik<span class=\"token punctuation\">:</span>v2<br>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always<br>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">USUARIO_BOOKMEDIK</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">CONTRA_BOOKMEDIK</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">DATABASE_HOST</span><span class=\"token punctuation\">:</span> bd_mariadb<br>      <span class=\"token key atrule\">NOMBRE_DB</span><span class=\"token punctuation\">:</span> bookmedik<br>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> 8081<span class=\"token punctuation\">:</span><span class=\"token number\">80</span><br>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> db<br>  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> bd_mariadb<br>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mariadb<br>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always<br>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">MARIADB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> root<br>      <span class=\"token key atrule\">MARIADB_DATABASE</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">MARIADB_USER</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">MARIADB_PASSWORD</span><span class=\"token punctuation\">:</span> bookmedik<br>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> mariadb_data<span class=\"token punctuation\">:</span>/var/lib/mysql<br><span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">mariadb_data</span><span class=\"token punctuation\">:</span></code></pre>\n<p>Levantamos los contenedores(tenemos que borrar los contenedores anteriores si no se han borrado):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica/tarea3$ docker-compose up -d<br>Creating bd_mariadb ... done<br>Creating bookmedik-app ... done</code></pre>\n<p>Compruebo que los contenedores se han creado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica/tarea3$ docker ps<br>CONTAINER ID   IMAGE                  COMMAND                  CREATED              STATUS              PORTS                  NAMES<br>27288d25383b   alemd01/bookmedik:v2   \"/opt/script.sh\"         About a minute ago   Up About a minute   0.0.0.0:8081->80/tcp   bookmedik-app<br>17cb7aba76cd   mariadb                \"docker-entrypoint.s‚Ä¶\"   About a minute ago   Up About a minute   3306/tcp               bd_mariadb</code></pre>\n<p>Accedo nuevamente a bookmedik:</p>\n<p><img src=\"/img/IAW-P7-T1.2.png\" alt=\"IAW-P7-T1.2.png\"></p>\n<h3 id=\"ejecuci%C3%B3n-de-una-aplicaci%C3%B3n-php-en-docker-con-nginx-(optativa).\" tabindex=\"-1\">Ejecuci√≥n de una aplicaci√≥n PHP en docker con nginx (OPTATIVA).</h3>\n<ul>\n<li><strong>Vamos a crear una imagen que se llame usuario/bookmedik:v3.</strong></li>\n<li><strong>En este caso queremos usar un contenedor que utilice nginx para servir la aplicaci√≥n PHP. Puedes crear la imagen desde una imagen base debian o ubuntu o desde la imagen oficial de nginx.</strong></li>\n<li><strong>Vamos a crear otro contenedor que sirva php-fpm.</strong></li>\n<li><strong>Para que funcione de forma adecuada el php-fpm tiene que tener acceso al directorio donde se encuentra la aplicaci√≥n.</strong></li>\n<li><strong>Y finalmente nuestro contenedor con la aplicaci√≥n.</strong></li>\n<li><strong>Crea un script con docker compose que levante el escenario con los tres contenedores.</strong></li>\n</ul>\n<p><em>SIN HACER</em></p>\n<h3 id=\"puesta-en-producci%C3%B3n-de-nuestra-aplicaci%C3%B3n.\" tabindex=\"-1\">Puesta en producci√≥n de nuestra aplicaci√≥n.</h3>\n<ul>\n<li><strong>Elige una de las tres im√°genes y s√∫bela a Docker Hub.</strong></li>\n</ul>\n<p>He elegido la versi√≥n v2, realizamos un docker push para subir la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica$ docker push alemd01/bookmedik:v2<br>The push refers to repository [docker.io/alemd01/bookmedik]<br>b29d0d6e7e6e: Pushed <br>1da8c39d9650: Pushed <br>57f2b3e3056d: Pushed <br>9a664d5dd358: Pushed <br>3d33242bf117: Mounted from library/php <br>529016396883: Mounted from library/php <br>5464bcc3f1c2: Mounted from library/php <br>28192e867e79: Mounted from library/php <br>d173e78df32e: Mounted from library/php <br>0be1ec4fbfdc: Mounted from library/php <br>30fa0c430434: Mounted from library/php <br>a538c5a6e4e0: Mounted from library/php <br>e5d40f64dcb4: Mounted from library/php <br>44148371c697: Mounted from library/php <br>797a7c0590e0: Mounted from library/php <br>f60117696410: Mounted from library/php <br>ec4a38999118: Mounted from library/php <br>v2: digest: sha256:f12b29054e777e6b27a0672dfed50d4e8b752837c1d355db6a0e6cb8faded808 size: 3872</code></pre>\n<p>En nuestro proveedor de DNS, registramos un nuevo subdominio para bookmedik:</p>\n<p><img src=\"/img/IAW-P7-T1.3.png\" alt=\"IAW-P7-T1.3.png\"></p>\n<p>Ahora en el vps creamos un certificado para ese subdominio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:~# certbot certonly --standalone -d bookmedik.alejandro-montes.es<br>Saving debug log to /var/log/letsencrypt/letsencrypt.log<br>Plugins selected: Authenticator standalone, Installer None<br>Attempting to parse the version 1.32.2 renewal configuration file found at /etc/letsencrypt/renewal/mail.alejandro-montes.es.conf with version 1.12.0 of Certbot. This might not work.<br>Requesting a certificate for bookmedik.alejandro-montes.es<br>Performing the following challenges:<br>http-01 challenge for bookmedik.alejandro-montes.es<br>Waiting for verification...<br>Cleaning up challenges<br><br>IMPORTANT NOTES:<br> - Congratulations! Your certificate and chain have been saved at:<br>   /etc/letsencrypt/live/bookmedik.alejandro-montes.es/fullchain.pem<br>   Your key file has been saved at:<br>   /etc/letsencrypt/live/bookmedik.alejandro-montes.es/privkey.pem<br>   Your certificate will expire on 2023-05-25. To obtain a new or<br>   tweaked version of this certificate in the future, simply run<br>   certbot again. To non-interactively renew *all* of your<br>   certificates, run \"certbot renew\"<br> - If you like Certbot, please consider supporting our work by:<br><br>   Donating to ISRG / Let's Encrypt:   https://letsencrypt.org/donate<br>   Donating to EFF:                    https://eff.org/donate-le<br></code></pre>\n<ul>\n<li><strong>En tu VPS instala Docker y utilizando el docker-compose.yml correspondiente, crea un contenedor en ella de la aplicaci√≥n.</strong></li>\n</ul>\n<p>Ahora procederemos a la instalaci√≥n de docker y docker-compose:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:~$ sudo apt install docker.io docker-compose<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following packages were automatically installed and are no longer required:<br>  libevent-2.1-7 libgnutls-dane0 libunbound8<br>Use 'sudo apt autoremove' to remove them.<br>The following additional packages will be installed:<br>  cgroupfs-mount containerd libintl-perl libintl-xs-perl<br>  libmodule-find-perl libmodule-scandeps-perl libproc-processtable-perl<br>  libsort-naturally-perl libyaml-0-2 needrestart python3-attr<br>  python3-cached-property python3-docker python3-dockerpty<br>  python3-docopt python3-importlib-metadata python3-jsonschema<br>  python3-more-itertools python3-pyrsistent python3-texttable<br>  python3-websocket python3-yaml python3-zipp runc tini<br>Suggested packages:<br>  containernetworking-plugins docker-doc aufs-tools btrfs-progs<br>  debootstrap rinse rootlesskit xfsprogs zfs-fuse | zfsutils-linux<br>  needrestart-session | libnotify-bin iucode-tool python-attr-doc<br>  python-jsonschema-doc<br>Recommended packages:<br>  criu</code></pre>\n<p>creamos el siguiente docker-compose para levantar el escenario:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.1'</span><br><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">bookmedik</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> bookmedik<span class=\"token punctuation\">-</span>app<br>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> alemd01/bookmedik<span class=\"token punctuation\">:</span>v2<br>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always<br>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">USUARIO_BOOKMEDIK</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">CONTRA_BOOKMEDIK</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">DATABASE_HOST</span><span class=\"token punctuation\">:</span> bd_mariadb<br>      <span class=\"token key atrule\">NOMBRE_DB</span><span class=\"token punctuation\">:</span> bookmedik<br>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> 8088<span class=\"token punctuation\">:</span><span class=\"token number\">80</span><br>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> db<br>  <span class=\"token key atrule\">db</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> bd_mariadb<br>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mariadb<br>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always<br>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">MARIADB_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> root<br>      <span class=\"token key atrule\">MARIADB_DATABASE</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">MARIADB_USER</span><span class=\"token punctuation\">:</span> bookmedik<br>      <span class=\"token key atrule\">MARIADB_PASSWORD</span><span class=\"token punctuation\">:</span> bookmedik<br>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> mariadb_data<span class=\"token punctuation\">:</span>/var/lib/mysql<br><span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">mariadb_data</span><span class=\"token punctuation\">:</span><br></code></pre>\n<p>Simplemente he cambiado el puerto porque ya est√° en uso. Ahora levantamos el escenario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd/docker# docker-compose up -d<br>Creating network \"docker_default\" with the default driver<br>Creating volume \"docker_mariadb_data\" with default driver<br>Pulling db (mariadb:)...<br>latest: Pulling from library/mariadb<br>10ac4908093d: Pulling fs layer<br>44779101e748: Downloading [=====================>                         10ac4908093d: Downloading [>                                              10ac4908093d: Downloading [=====================>                             ]   12.8MB/30.43MB<br>10ac4908093d: Downloading [===============================================10ac4908093d: Download complete<br>10ac4908093d: Extracting [>                                                  ]  327.7kB/30.43MBd complete<br><br>10ac4908093d: Extracting [====>                                              ]  2.621MB/30.43MBd complete<br><br>86f876b891f6: Downloading [>                                              10ac4908093d: Extracting [======>                                            ]  3.932MB/30.43MBding [==========>                                    10ac4908093d: Pull complete<br>44779101e748: Pull complete<br>a721db3e3f3d: Pull complete<br>1850a929b84a: Pull complete<br>c3aa31fb301e: Pull complete<br>86f876b891f6: Pull complete<br>fe3602f5cecf: Pull complete<br>8fe289a9f834: Pull complete<br>Digest: sha256:dd0f492b6b6e7bb4aa707181b799d4efe42cb3a9f6012ec3dbaf326d402151e8<br>Status: Downloaded newer image for mariadb:latest<br>Creating bd_mariadb ... done<br>Creating bookmedik-app ... done</code></pre>\n<ul>\n<li><strong>Configura el nginx de tu VPS para que haga de proxy inverso y nos permita acceder a la aplicaci√≥n con <a href=\"https://bookmedik.tudominio.xxx\">https://bookmedik.tudominio.xxx</a>.</strong></li>\n</ul>\n<p>Ahora tendremos que configurar un virtualhost en nuestro vps:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:~# nano /etc/nginx/sites-available/bookmedik</code></pre>\n<p>El contenido del fichero es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">server {<br>        listen 80;<br>        listen [::]:80;<br><br>        server_name bookmedik.alejandro-montes.es;<br><br>        return 301 https://$host$request_uri;<br>}<br><br>server {<br>        listen 443 ssl http2;<br>        listen [::]:443 ssl http2;<br><br>        ssl    on;<br>        ssl_certificate /etc/letsencrypt/live/bookmedik.alejandro-montes.es/fullchain.pem;<br>        ssl_certificate_key     /etc/letsencrypt/live/bookmedik.alejandro-montes.es/privkey.pem;<br><br>        index index.html index.php index.htm index.nginx-debian.html;<br><br>        server_name bookmedik.alejandro-montes.es;<br><br>        location / {<br>                proxy_pass http://localhost:8088;<br>                include proxy_params;<br>        }<br><br>}</code></pre>\n<p>Una vez creado el virtualhost, tenemos que crear el enlace simb√≥lico:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:~# ln -s /etc/nginx/sites-available/bookmedik /etc/nginx/sites-enabled/bookmedik</code></pre>\n<p>Lo que queda, es reiniciar nginx y probar que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:~# systemctl restart nginx</code></pre>\n<p><img src=\"/img/IAW-P7-T1.4.png\" alt=\"IAW-P7-T1.4.png\"></p>\n<h3 id=\"modificaci%C3%B3n-de-la-aplicaci%C3%B3n.\" tabindex=\"-1\">Modificaci√≥n de la aplicaci√≥n.</h3>\n<ul>\n<li><strong>En el entorno de desarrollo vamos a hacer una modificaci√≥n de la aplicaci√≥n. Por ejemplo modifica el fichero core/app/view/login-view.php y pon tu nombre en la l√≠nea <code>&lt;h4 class=&quot;title&quot;&gt;Acceder a BookMedik&lt;/h4&gt;</code>.</strong></li>\n<li><strong>Vamos a trabajar con la primera imagen que construimos. Vuelve a crear la imagen con la etiqueta v1_2.</strong></li>\n<li><strong>Cambia el docker-compose para probar el cambio.</strong></li>\n<li><strong>Modifica la aplicaci√≥n en producci√≥n.</strong></li>\n</ul>\n<p>Lo primero que haremos ser√° editar el fichero login-view.php y la l√≠nea tiene que quedar de la siguiente forma:</p>\n<pre class=\"language-php\"><code class=\"language-php\">      <span class=\"token operator\">&lt;</span>h4 <span class=\"token keyword\">class</span><span class=\"token operator\">=</span><span class=\"token string double-quoted-string\">\"title\"</span><span class=\"token operator\">></span>Alejandro Montes delgado<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>h4<span class=\"token operator\">></span></code></pre>\n<p>Construimos nuevamente la imagen con la etiqueta v1_2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica/tarea5$ docker build -t alemd01/bookmedik:v1_2 .<br>Sending build context to Docker daemon  5.782MB<br>Step 1/7 : FROM debian:bullseye<br> ---> 54e726b437fb<br>Step 2/7 : MAINTAINER Alejandro Montes \"alejandro@alejandro-montes.es\"<br> ---> Using cache<br> ---> 6170a85f83e3<br>Step 3/7 : RUN apt update &amp;&amp; apt upgrade -y &amp;&amp; apt install apache2 libapache2-mod-php php php-mysql mariadb-client -y &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/*<br> ---> Using cache<br> ---> c2019c7047c1<br>Step 4/7 : ADD bookmedik /var/www/html/<br> ---> 943a8e7040b8<br>Step 5/7 : ADD script.sh /opt/<br> ---> 9aa836a5e135<br>Step 6/7 : RUN chmod +x /opt/script.sh &amp;&amp; rm /var/www/html/index.html<br> ---> Running in e0df57437824<br>Removing intermediate container e0df57437824<br> ---> a9a6a4b3f1f6<br>Step 7/7 : ENTRYPOINT [\"/opt/script.sh\"]<br> ---> Running in eea03e1f5bce<br>Removing intermediate container eea03e1f5bce<br> ---> 9bc356ec059d<br>Successfully built 9bc356ec059d<br>Successfully tagged alemd01/bookmedik:v1_2</code></pre>\n<p>Modificamos el docker compose para aplicar el cambio solo tenemos que cambiar la etiqueta y poner la nueva:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">    image: alemd01/bookmedik:v1_2</code></pre>\n<p>Levantamos el escenario en desarrollo a√∫n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica/tarea5$ docker-compose up -d<br>Creating bd_mariadb ... done<br>Creating bookmedik-app ... done</code></pre>\n<p>Probamos que funciona:</p>\n<p><img src=\"/img/IAW-P7-T1.5.png\" alt=\"IAW-P7-T1.5.png\"></p>\n<p>Una vez comprobado que se han aplicado los cambios correctamente y que accede, lo pasaremos a producci√≥n para ello haremos un docker push de la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/practica/tarea5$ docker push alemd01/bookmedik:v1_2<br>The push refers to repository [docker.io/alemd01/bookmedik]<br>6462ef003814: Pushed <br>27aea5a6faf2: Pushed <br>610af938ab10: Pushed <br>61d7b4db50a6: Pushed <br>8e396a1aad50: Mounted from library/debian <br>v1_2: digest: sha256:21138d2ff768626704f6ef484d256dbddbec7b08b1ce63c75ebabab381adb75f size: 1366</code></pre>\n<p>Ahora que nuestra imagen est√° lista, pasaremos a producci√≥n y lo que haremos ser√° cambiar en el docker compose la versi√≥n. La l√≠nea queda igual que la anterior.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">    image: alemd01/bookmedik:v1_2</code></pre>\n<p>Levantamos el escenario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd/docker# docker-compose up -d<br>Pulling bookmedik (alemd01/bookmedik:v1_2)...<br>v1_2: Pulling from alemd01/bookmedik<br>1e4aec178e08: Downloading [>                                              1e4aec178e08: Downloading [>                                                  ]  1.081MB/55.05MBfs layer<br>dcb3cfc7cb33: Waiting<br>1e4aec178e08: Downloading [=>                                                 ]  2.163MB/55.05MB<br><br>1e4aec178e08: Downloading [===>                                               ]  3.783MB/55.05MB<br>1e4aec178e08: Downloading [======>                                        1e4aec178e08: Downloading [=============>                                 1e4aec178e08: Downloading [====================>                          1e4aec178e08: Downloading [==========================>                        ]  29.04MB/55.05MB<br>1e4aec178e08: Downloading [=================================>             1e4aec178e08: Downloading [========================================>      1e4aec178e08: Downloading [==============================================>    ]  51.52MB/55.05MB complete<br>1e4aec178e08: Download complete<br>1e4aec178e08: Extracting [>                                               1e4aec178e08: Extracting [==>                                                ]  2.785MB/55.05MBding [===============================================1e4aec178e08: Pull complete<br>b8fab135fbf3: Pull complete<br>2728d62bb111: Pull complete<br>dcb3cfc7cb33: Pull complete<br>71b3df28513f: Pull complete<br>Digest: sha256:21138d2ff768626704f6ef484d256dbddbec7b08b1ce63c75ebabab381adb75f<br>Status: Downloaded newer image for alemd01/bookmedik:v1_2<br>bd_mariadb is up-to-date<br>Recreating bookmedik-app ... done</code></pre>\n<p>Accedemos nuevamente a <a href=\"https://bookmedik.alejandro-montes.es\">https://bookmedik.alejandro-montes.es</a> y veremos los cambios aplicados:</p>\n<p><img src=\"/img/IAW-P7-T1.6.png\" alt=\"IAW-P7-T1.6.png\"></p>\n<p>Muestro que funciona despu√©s del login:</p>\n<p><img src=\"/img/IAW-P7-T1.7.png\" alt=\"IAW-P7-T1.7.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-16T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ldaps/",
      "url": "https://reeseschultz.github.io/post/ldaps/",
      "title": "LDAPs",
      "content_html": "<p>Usaremos los certificados proporcionados a principio de curso mediante la p√°gina de gestiona del centro. para ello los llevaremos al servidor y una vez en el servidor los moveremos a sus rutas correspondientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:/etc/ssl$ sudo mv alemd.crt /etc/ssl/certs<br>usuario@alfa:/etc/ssl$ sudo mv gonzalonazareno.crt /etc/ssl/certs<br>usuario@alfa:/etc/ssl$ sudo mv alemd.key /etc/ssl/private/</code></pre>\n<p>Nos tenemos que asegurar de que el due√±o de los archivos es root y tiene los privilegios correctos. Ahora tendremos que crear unas acls para que el usuario openldap que es el que se conecta con ldap tenga permisos sobre los ficheros anteriores.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/etc/ssl# setfacl -m u:openldap:r-x /etc/ssl/private<br>root@alfa:/etc/ssl# setfacl -m u:openldap:r-x /etc/ssl/certs<br>root@alfa:/etc/ssl# setfacl -m u:openldap:r-x /etc/ssl/private/alemd.key</code></pre>\n<h3 id=\"configuraci%C3%B3n-del-servidor(alfa).\" tabindex=\"-1\">Configuraci√≥n del servidor(Alfa).</h3>\n<p>Ahora tenemos que incorporar los cambios con un registro ldif y aplicamos la configuraci√≥n.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">nano ldaps_config.ldif<br><br>dn: cn=config<br>changetype: modify<br>replace: olcTLSCACertificateFile<br>olcTLSCACertificateFile: /etc/ssl/certs/gonzalonazareno.crt<br>-<br>replace: olcTLSCertificateKeyFile<br>olcTLSCertificateKeyFile: /etc/ssl/private/alemd.key<br>-<br>replace: olcTLSCertificateFile<br>olcTLSCertificateFile: /etc/ssl/certs/alemd.crt</code></pre>\n<p>Para aplicar la configuraci√≥n usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo ldapmodify -Y EXTERNAL -H ldapi:/// -f ldaps_config.ldif <br>SASL/EXTERNAL authentication started<br>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth<br>SASL SSF: 0<br>modifying entry \"cn=config\"</code></pre>\n<p>Editamos el siguiente fichero para habilitar que ldap use el puerto 636. El fichero que tendremos que editar es <code>/etc/default/slapd</code>:</p>\n<p>La siguiente l√≠nea editada queda as√≠:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SLAPD_SERVICES=\"ldap:/// ldapi:/// ldaps:///\"</code></pre>\n<p>Muestro que ya se encuentra escuchando por el puerto 636:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# netstat -tlnp | egrep slap<br>tcp        0      0 0.0.0.0:636             0.0.0.0:*               LISTEN      8551/slapd          <br>tcp        0      0 0.0.0.0:389             0.0.0.0:*               LISTEN      8551/slapd          <br>tcp6       0      0 :::636                  :::*                    LISTEN      8551/slapd          <br>tcp6       0      0 :::389                  :::*                    LISTEN      8551/slapd   </code></pre>\n<p>Copiamos el certificado a la siguiente ruta, que es la ruta donde se ponen los certificados instalados localmente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# cp /etc/ssl/certs/gonzalonazareno.crt /usr/local/share/ca-certificates/</code></pre>\n<p>Ahora actualizamos la lista de los certificados para que ca-certificates realice el enlace simb√≥lico:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# update-ca-certificates<br>Updating certificates in /etc/ssl/certs...<br>rehash: warning: skipping duplicate certificate in gonzalonazareno.crt<br>1 added, 0 removed; done.<br>Running hooks in /etc/ca-certificates/update.d...<br>done.</code></pre>\n<p>Estos 2 pasos anteriores, lo tenemos que repetir en todos los clientes que queramos que use LDAPs.</p>\n<p>Editamos la siguiente l√≠nea en el caso de que no tengamos un certificado v√°lido(no es necesario):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# nano /etc/ldap/ldap.conf</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">TLS_REQCERT     allow</code></pre>\n<p>Ahora podremos ejecutar peticiones al servidor ldap usando SSL/TLS. Realizo una consulta para mostrar que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ ldapsearch -x -b \"dc=alejandro-montes,dc=gonzalonazareno,dc=org\" -H ldaps://localhost:636<br># extended LDIF<br>#<br># LDAPv3<br># base &lt;dc=alejandro-montes,dc=gonzalonazareno,dc=org> with scope subtree<br># filter: (objectclass=*)<br># requesting: ALL<br>#<br><br># alejandro-montes.gonzalonazareno.org<br>dn: dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: dcObject<br>objectClass: organization<br>o: alejandro-montes.gonzalonazareno.org<br>dc: alejandro-montes<br><br># Personas, alejandro-montes.gonzalonazareno.org<br>dn: ou=Personas,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: organizationalUnit<br>ou: Personas<br><br># Grupos, alejandro-montes.gonzalonazareno.org<br>dn: ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: organizationalUnit<br>ou: Grupos<br><br># prueba, Grupos, alejandro-montes.gonzalonazareno.org<br>dn: cn=prueba,ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: posixGroup<br>gidNumber: 2001<br>cn: prueba</code></pre>\n<p>Para que el cliente use por defecto LDAPs para realizar las conexiones, vamos a modificar el fichero de configuraci√≥n del cliente y a√±adir lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# nano /etc/ldap/ldap.conf </code></pre>\n<p>Modificamos esta l√≠nea y queda as√≠:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">URI     ldaps://alfa.alejandro-montes.gonzalonazareno.org</code></pre>\n<p>Hacemos una consulta al servidor LDAPs desde un cliente ubuntu para verificar que funciona:</p>\n<p><img src=\"/img/LDAPS.1.png\" alt=\"LDAPS.1.png\"></p>\n<h3 id=\"configuraci%C3%B3n-de-cliente-ubuntu(delta).\" tabindex=\"-1\">Configuraci√≥n de cliente Ubuntu(Delta).</h3>\n<p>Como hemos visto antes, en el clientes tenemos que pasarnos el certificado de la entidad certificadora y actualizar los certificados locales. Adjunto los comandos usados:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# scp /usr/local/share/ca-certificates/gonzalonazareno.crt ubuntu@192.168.0.3:<br>ubuntu@192.168.0.3's password: <br>gonzalonazareno.crt                                                                                100% 3634     4.2MB/s   00:00  <br>root@delta:/home/ubuntu# chown root: gonzalonazareno.crt <br>root@delta:/home/ubuntu# mv gonzalonazareno.crt /usr/local/share/ca-certificates/<br>root@delta:/home/ubuntu# update-ca-certificates <br>Updating certificates in /etc/ssl/certs...<br>rehash: warning: skipping ca-certificates.crt,it does not contain exactly one certificate or CRL<br>rehash: warning: skipping duplicate certificate in gonzalonazareno.crt<br>1 added, 0 removed; done.<br>Running hooks in /etc/ca-certificates/update.d...<br>done.<br></code></pre>\n<p>En el archivo de configuraci√≥n de LDAP tenemos que indicar en el URI que sea ldaps:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# nano /etc/ldap/ldap.conf <br><br>URI     ldaps://alfa.alejandro-montes.gonzalonazareno.org<br></code></pre>\n<p>Debemos de hacer lo mismo en el archivo <code>/etc/ldap.conf</code>. Una vez hecho esto, ya podemos realizar el login desde Delta:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# login usuario1<br>Password: <br>Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.10.0-21-amd64 x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br>Last login: Tue Feb  7 08:33:57 UTC 2023 on pts/4<br>usuario1@delta:~$ ls<br>prueba\tpruebadelta  rafa1.txt</code></pre>\n<p>Como vemos al hacer el ls siguen las carpetas y los archivos creados anteriormente.</p>\n<h3 id=\"configuraci%C3%B3n-de-cliente-rocky-linux(bravo).\" tabindex=\"-1\">Configuraci√≥n de cliente Rocky Linux(Bravo).</h3>\n<p>Antes que nada, tenemos que acordarnos de mover el certificado y actualizar los certificados locales. Dejo los comandos usados para actualizar los certificados en Rocky Linux:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ scp /usr/local/share/ca-certificates/gonzalonazareno.crt usuario@172.16.0.200:<br>gonzalonazareno.crt                                                                                          100% 3634     1.2MB/s   00:00 <br><br>[root@bravo usuario]# chown root: gonzalonazareno.crt<br>[root@bravo usuario]# mv gonzalonazareno.crt /usr/share/pki/ca-trust-source/anchors/<br>[root@bravo usuario]# update-ca-trust </code></pre>\n<p>Si queremos configurar un cliente de LDAP en rocky linux, lo primero es instalar el paquete del cliente de ldap:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# dnf install openldap-clients<br>Failed to set locale, defaulting to C.UTF-8<br>Last metadata expiration check: 2:18:55 ago on Sat Feb 18 17:57:07 2023.<br>Package openldap-clients-2.6.2-3.el9.x86_64 is already installed.<br>Dependencies resolved.<br>Nothing to do.<br>Complete!</code></pre>\n<p>En mi caso ya est√° instalado. Ahora editaremos el archivo de configuraci√≥n PAM. El archivo se encuentra en la siguiente ruta:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# nano /etc/pam.d/common-auth</code></pre>\n<p>Y contiene la siguiente l√≠nea:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">auth sufficient pam_ldap.so</code></pre>\n<p>Ahora nos vamos al archivo de configuraci√≥n de LDAP:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# nano /etc/openldap/ldap.conf</code></pre>\n<p>y a√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">BASE dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>URI ldaps://alfa.alejandro-montes.gonzalonazareno.org</code></pre>\n<p>Por √∫ltimo, para permitir que el usuario LDAP acceda a su home, debemos de editar el siguiente archivo de configuraci√≥n PAM:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# nano /etc/pam.d/common-session</code></pre>\n<p>Y a√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">session sufficient pam_mkhomedir.so umask=0022 skel=/etc/skel/</code></pre>\n<p>Realizo una consulta al servidor LDAP desde bravo para probar que funciona:</p>\n<p><img src=\"/img/LDAPS.2.png\" alt=\"LDAPS.2.png\"></p>\n<p>Ahora instalaremos los paquetes necesariso para hacer el login con LDAP:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# dnf -y install openldap-clients sssd sssd-ldap oddjob-mkhomedir <br>Failed to set locale, defaulting to C.UTF-8<br>Last metadata expiration check: 1:21:38 ago on Sat Feb 18 21:02:59 2023.<br>Package openldap-clients-2.6.2-3.el9.x86_64 is already installed.<br>Package sssd-2.7.3-4.el9_1.1.x86_64 is already installed.<br>Package sssd-ldap-2.7.3-4.el9_1.1.x86_64 is already installed.<br>Package oddjob-mkhomedir-0.34.7-6.el9.x86_64 is already installed.<br>Dependencies resolved.<br>======================================================================================================================================================<br> Package                                  Architecture                   Version                                 Repository                      Size<br>======================================================================================================================================================<br>Upgrading:<br> libipa_hbac                              x86_64                         2.7.3-4.el9_1.3                         baseos                          36 k<br> libsss_certmap                           x86_64                         2.7.3-4.el9_1.3                         baseos                          78 k<br> libsss_idmap                             x86_64                         2.7.3-4.el9_1.3                         baseos                          42 k<br> libsss_nss_idmap                         x86_64                         2.7.3-4.el9_1.3                         baseos                          45 k<br> libsss_sudo                              x86_64                         2.7.3-4.el9_1.3                         baseos                          35 k<br> sssd                                     x86_64                         2.7.3-4.el9_1.3                         baseos                          27 k<br> sssd-ad                                  x86_64                         2.7.3-4.el9_1.3                         baseos                         211 k<br> sssd-client                              x86_64                         2.7.3-4.el9_1.3                         baseos                         150 k<br> sssd-common                              x86_64                         2.7.3-4.el9_1.3                         baseos                         1.6 M<br> sssd-common-pac                          x86_64                         2.7.3-4.el9_1.3                         baseos                          95 k<br> sssd-ipa                                 x86_64                         2.7.3-4.el9_1.3                         baseos                         274 k<br> sssd-kcm                                 x86_64                         2.7.3-4.el9_1.3                         baseos                         108 k<br> sssd-krb5                                x86_64                         2.7.3-4.el9_1.3                         baseos                          73 k<br> sssd-krb5-common                         x86_64                         2.7.3-4.el9_1.3                         baseos                          89 k<br> sssd-ldap                                x86_64                         2.7.3-4.el9_1.3                         baseos                         156 k<br> sssd-nfs-idmap                           x86_64                         2.7.3-4.el9_1.3                         baseos                          39 k<br> sssd-proxy                               x86_64                         2.7.3-4.el9_1.3                         baseos                          70 k</code></pre>\n<p>Ejecutamos el siguiente comando para que mkhomedir cree el directorio home del usuario en el momento en el que inicia sesi√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# authselect select sssd with-mkhomedir --force<br>Backup stored at /var/lib/authselect/backups/2023-02-18-22-25-09.ddiDdO<br>Profile \"sssd\" was selected.<br>The following nsswitch maps are overwritten by the profile:<br>- passwd<br>- group<br>- netgroup<br>- automount<br>- services<br><br>Make sure that SSSD service is configured and enabled. See SSSD documentation for more information.<br> <br>- with-mkhomedir is selected, make sure pam_oddjob_mkhomedir module<br>  is present and oddjobd service is enabled and active<br>  - systemctl enable --now oddjobd.service</code></pre>\n<p>Editamos el archivo de configuraci√≥n de SSSD:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# nano /etc/sssd/sssd.conf</code></pre>\n<p>Y a√±adimos las siguientes l√≠neas al archivo_</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[domain/default]<br>id_provider = ldap<br>autofs_provider = ldap<br>auth_provider = ldap<br>chpass_provider = ldap<br>ldap_uri = ldaps://alfa.alejandro-montes.gonzalonazareno.org<br>ldap_search_base = dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>ldap_id_use_start_tls = True<br>ldap_tls_cacertdir = /etc/openldap/certs<br>cache_credentials = True<br>ldap_tls_reqcert = allow<br><br>[sssd]<br>services = nss, pam, autofs<br>domains = default<br><br>[nss]<br>homedir_substring = /nfs/users</code></pre>\n<p>Copiamos el certificado en el siguiente directorio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# cp /usr/share/pki/ca-trust-source/anchors/gonzalonazareno.crt /etc/openldap/certs/</code></pre>\n<p>Reiniciamos el servicio y lo habilitamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# chmod 600 /etc/sssd/sssd.conf <br>[root@bravo usuario]# systemctl restart sssd<br>[root@bravo usuario]# systemctl enable sssd</code></pre>\n<p>Ahora creamos una unidad NFS donde se montar√° el home de todos los usuarios LDAP:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# mkdir /nfs<br>[root@bravo usuario]# mkdir /nfs/users<br>[root@bravo usuario]# nano /etc/systemd/system/nfs-users.mount</code></pre>\n<p>El contenido de la unidad es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Unit]<br>Description=Unidad de montaje NFS<br>Requires=NetworkManager.service<br>After=NetworkManager.service<br>[Mount]<br>What=172.16.0.1:/nfs/users<br>Where=/nfs/users<br>Options=_netdev,auto<br>Type=nfs<br>[Install]<br>WantedBy=multi-user.target</code></pre>\n<p>Recargamos el demonio y activamos la unidad:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# systemctl daemon-reload<br>[root@bravo usuario]# systemctl start nfs-users.mount</code></pre>\n<p>Hago un df -h para comprobar que se ha montado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo usuario]# df -h<br>Filesystem                  Size  Used Avail Use% Mounted on<br>devtmpfs                    4.0M     0  4.0M   0% /dev<br>tmpfs                       383M     0  383M   0% /dev/shm<br>tmpfs                       153M   20M  134M  13% /run<br>/dev/vda5                    29G  1.8G   28G   7% /<br>/dev/vda2                   994M  345M  649M  35% /boot<br>/dev/vda1                   100M  7.0M   93M   7% /boot/efi<br>172.16.0.1:/media/Archivos  2.0G     0  1.9G   0% /home/usuario/archivos<br>tmpfs                        77M     0   77M   0% /run/user/1000<br>172.16.0.1:/nfs/users        30G  5.9G   23G  21% /nfs/users<br>[root@bravo usuario]# </code></pre>\n<p>Ahora realizamos un login con el usuario1 y creamos una carpeta:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@bravo ~]# su - usuario1<br>Last failed login: Sat Feb 18 22:42:09 UTC 2023 on pts/0<br>There was 1 failed login attempt since the last successful login.<br>[usuario1@bravo ~]$ ls<br>prueba  pruebadelta  rafa1.txt<br>[usuario1@bravo ~]$ mkdir desde-bravo</code></pre>\n<p>La visualizo desde alfa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ exit<br>logout<br>Connection to 172.16.0.200 closed.<br>usuario@alfa:~$ sudo su<br>root@alfa:/home/usuario# cd<br>root@alfa:~# cd /nfs/users/usuario1/<br>root@alfa:/nfs/users/usuario1# ls<br>desde-bravo  prueba  pruebadelta  rafa1.txt<br>root@alfa:/nfs/users/usuario1# </code></pre>\n<p>Como vemos a creado correctamente la carpeta en el home nfs.</p>\n<p><strong>EXTRA</strong></p>\n<p>Vamos a configurar nuestro servidor LDAP para que podamos loguearnos sin ser root. Esto pasa debido a que el servidor NFS necesita ser root para acceder, para ello le indicaremos un nuevo par√°metro:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:~# nano /etc/exports </code></pre>\n<p>Editamos la l√≠nea de la carpeta NFS que compartimos y a√±adimos el √∫ltimo par√°metro:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">/nfs/users *(rw,fsid=0,subtree_check,no_root_squash)</code></pre>\n<p>Reiniciamos el servidor nfs:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:~# systemctl restart nfs-kernel-server</code></pre>\n<p>Pruebo a iniciar sesi√≥n desde bravo(RockyLinux):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ su - usuario1<br>Password: <br>Last login: Sat Feb 18 23:15:01 UTC 2023 on pts/1<br>[usuario1@bravo ~]$ </code></pre>\n<p>Inicio sesi√≥n desde delta(Ubuntu):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ su - usuario1<br>Password: <br>usuario1@delta:~$ ls<br>desde-bravo  prueba  pruebadelta  rafa1.txt</code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-16T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/poblar-un-directorio-ldap-desde-un-fichero-csv./",
      "url": "https://reeseschultz.github.io/post/poblar-un-directorio-ldap-desde-un-fichero-csv./",
      "title": "Poblar un directorio LDAP desde un fichero CSV.",
      "content_html": "<h3 id=\"creaci%C3%B3n-del-fichero-csv.\" tabindex=\"-1\">Creaci√≥n del fichero CSV.</h3>\n<p>Lo primero que tenemos que hacer es crear un fichero CSV con informaci√≥n de mis compa√±eros. El fichero CSV queda de la siguiente manera:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Alejandro,Montes Delgado,aaleemd11@gmail.com,alemd,ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCvd5Lg3K1k1WeHYHE3T5aPSEx/duCM87J2LFhgFODU3Z0+1mE5bjDUzvrUTVoHdMu1phOd8IS2vPCL2Ei8PjooLdLrsqHtFN9JYvtBRRhTs5tV3JSGaaFrljYtiITbulVTHBTqssrr4VfJ1jxMF9aSVcPjfVxsNMo01AhK8PAnCiSVBru9BUYgoG+7rCVMeB78qTXyuKNLoFqsuIPmQeV8D0JGKGozS2cikflyEOgYC+UwILUliV0dVtlpPltOOMLKngWF1fyjnfsJykiULI+l20Iid5QtDx5SK6nLRTtrr9MYCZbSJqAKVsxxKIYY5I+qSNsikgNrTnWJVq6z4zr5u4AqazjiDqX+266cDBf7rEq9GA9OZuul4/Kzy+PB9+w5rCgneSP7iL38ehQSjWzfpD1ny8mxCFmwuEwFBpGYhYHNywBYg8f1iMayjBeatFIU8WUCrCct0y1Zlf/Hn+Lzd5xb4aJgWd+mMyMmhZPcTAC6UN03tM2b0s6wjP8DzJc= ubuntu@delta<br>Angel,Suarez Perez,angelsuarezperez@gmail.com,angel,ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDFEJGJIWb1KviE3kwQRoUV2C4E0d9L0mq9XjSt1kmznXSXMODJBdHwa7GOb9iwmW3OKkTa6RGokB2nKvs+2IBm9HcPYM0WM78wxEazuUvwpHR4mV58gzif/ETM48/ceQcf1fqADW1456Mfk7zFHwgf8vjyNfFCtR6NGve7wb7ojm79a9CJpqZEJ9X+EVxjbKysdvhS3BsNo5L3aJwPsAHE29+lFhDmOOzuEXWTjvFRkC1aFN1iVyxdolNJuh3onWXZDzPI55Q/DHtkpjKZ4cYqBsmwZFjWlum5aWRltgYMZtvoGOBglIxBQWjY4sl7WCiW89b+6zIcG4vWq48qhoO76ROYEPJL4pdkxxUZbjk4xApHLoO56+fXCtoo+fO/zQiHyTElzXBg/v2MmqxUrFQmQCzhbAuKK88rycZVFdIknuc+Raoi3faiX2x5N9AL4PMpEVJaTi7b/n7NMZVTkuVT9U/X9pwABSi1yngxlr2BpTg2FJD5iId15v51nx1ynXE= angelsuarez@charlie<br>Juan Jesus,Alejo Sillero,juanjesusalejosillero@gmail.com,juanje,ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDzLgcT2qKvflOcKWjUGX0ecoVWN+phHx7dEws3b/rY/xAichGJ6oP8ucD4lVJ8XVrEOaUgqQ1laPK33+u9MmzARx4g17/jKcwepUWdkKVA2++RWG3bsNgxCCkR1Gi7XMAAjwq8/17OjCj+4bvfTPlW5FSjDqaLhfqqeDtKpFJ3wjGG5sjNPC0GU4cRKzggZaR40ld7siaOiMteQ8X6bIggeXw+ULGiUhB4/uoLu0z69AzGgDfoPJuJEx4pPlcnOip/TAuL/pUjTjdUUDTsrZSJegWoLmRwylKvwtX8WojqI2TnTOyLT0IG1oStq4gC4AKOiCqfiBOm25bFfX0lW0uUaR1RjEuGz3jV0vkH3pCiuarNk5KnEQQqUO0x6ZvdCvOlsWYoiDQ6MclGKfUkUzC1uST5khs4xB1zQAZ5795on4SV8STASTwjpxuTuk7v4lTxrm8bTAF4bWiezgOQ0aFr7P0APygX0rbCR1aXoGfSyrrvqOUtkUzpiWwZwOpj0K0= juanjesus@delta.juanjesus.gonzalonazareno.org<br>Ivan,Pina Castillo,ivanpicas88@gmail.com,ivan,ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCfYm123AV12rRYM+tPkrd0Hrzc9Py32Ov8JVZCnH5zVBj3I/IxE08LUhccSSx9aD0DrW+RdfpmLCSBTgGnbdM9eYlq3jxoBqqye4DQeXLSPyXcp/qRPGPsNO+eGypVhRB+Oq9B+ktrHgzAXQSP1yjmjN57H7GVBnMEJhpCEVXk5vWgMhVNxsDSF6lHrbiaYLtunTtt+fNgrprzXuUqhUwEDRt6/ktwad420J7kmqkB4dQuex3hV+16l1GyNH8AJzNzoinTiLr/jW8Ja0udgIknsxFvZ5Df+ACCrXfIFwvdPTm6Nya0jCm9vFx5yc5O1E07qlbAAn3FiIfS5Udjs6rNZjfFH5GmlpodhcGy4nkCYZvylnEayIa/ak4wA7oDft60hlHBMCHMoyY3ZcIkWGmVkwnTB3xfxfykPeD14zQAlIuMol9RNmPUbDYtbfY64npLPmagUIHSpwwbs1byEBbzzqzG8qcCAPUk3mK6oB5+OKUNJDv+4MM+suj+Y/PnWM8= debian@delta</code></pre>\n<p>Una vez tengamos el fichero, a√±adiremos el esquema openssh-lpk. Tendremos que crear el siguiente fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# nano /etc/ldap/schema/openssh-lpk.ldif</code></pre>\n<p>El contenido es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dn: cn=openssh-lpk,cn=schema,cn=config<br>objectClass: olcSchemaConfig<br>cn: openssh-lpk<br>olcAttributeTypes: ( 1.3.6.1.4.1.24552.500.1.1.1.13 NAME 'sshPublicKey'<br>  DESC 'MANDATORY: OpenSSH Public key'<br>  EQUALITY octetStringMatch<br>  SYNTAX 1.3.6.1.4.1.1466.115.121.1.40 )<br>olcObjectClasses: ( 1.3.6.1.4.1.24552.500.1.1.2.0 NAME 'ldapPublicKey' SUP top AUXILIARY<br>  DESC 'MANDATORY: OpenSSH LPK objectclass'<br>  MAY ( sshPublicKey $ uid )<br>  )</code></pre>\n<p>Importamos el esquema con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/ldap/schema/openssh-lpk.ldif<br>SASL/EXTERNAL authentication started<br>SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth<br>SASL SSF: 0<br>adding new entry \"cn=openssh-lpk,cn=schema,cn=config\"</code></pre>\n<h3 id=\"creaci%C3%B3n-de-script-en-python-para-poblar-el-directorio-ldap.\" tabindex=\"-1\">Creaci√≥n de Script en python para poblar el directorio LDAP.</h3>\n<p>Para crear el script, tenemos que instalar python y los entornos virtuales:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo apt install python3-venv<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  python-pip-whl python3.9-venv<br>The following NEW packages will be installed:<br>  python-pip-whl python3-venv python3.9-venv<br>0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 1954 kB of archives.<br>After this operation, 2327 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y<br>Get:1 https://deb.debian.org/debian bullseye/main amd64 python-pip-whl all 20.3.4-4+deb11u1 [1948 kB]<br>Get:2 https://deb.debian.org/debian bullseye/main amd64 python3.9-venv amd64 3.9.2-1 [5396 B]<br>Get:3 https://deb.debian.org/debian bullseye/main amd64 python3-venv amd64</code></pre>\n<p>Creamos un entorno virtual y lo activamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ python3 -m venv ldap<br>usuario@alfa:~$ source ldap/bin/activate<br>(ldap) usuario@alfa:~$ </code></pre>\n<p>Instalamos con pip python3-ldap y ldap.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(ldap) usuario@alfa:~$ pip install python3-ldap<br>Collecting python3-ldap<br>  Downloading python3_ldap-0.9.8.4-py2.py3-none-any.whl (295 kB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 295 kB 1.8 MB/s <br>Collecting pyasn1>=0.1.7<br>  Downloading pyasn1-0.4.8-py2.py3-none-any.whl (77 kB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 77 kB 1.2 MB/s <br>Installing collected packages: pyasn1, python3-ldap<br>Successfully installed pyasn1-0.4.8 python3-ldap-0.9.8.4<br>(ldap) usuario@alfa:~$ pip install ldap3==2.6<br>Collecting ldap3==2.6<br>  Downloading ldap3-2.6-py2.py3-none-any.whl (393 kB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 393 kB 1.6 MB/s <br>Requirement already satisfied: pyasn1>=0.1.8 in ./ldap/lib/python3.9/site-packages (from ldap3==2.6) (0.4.8)<br>Installing collected packages: ldap3<br>Successfully installed ldap3-2.6</code></pre>\n<p>Una vez tengamos instalado el entorno virtual y las dependencias, procederemos a crear el script en python:</p>\n<pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\">#!/usr/bin/env python</span><br><br><span class=\"token keyword\">import</span> ldap3<br><span class=\"token keyword\">from</span> ldap3 <span class=\"token keyword\">import</span> Connection<span class=\"token punctuation\">,</span> ALL<br><span class=\"token keyword\">from</span> getpass <span class=\"token keyword\">import</span> getpass<br><span class=\"token keyword\">from</span> sys <span class=\"token keyword\">import</span> exit<br><br><span class=\"token comment\">### VARIABLES</span><br><br><span class=\"token comment\"># Shell que se le asigna a los usuarios</span><br>shell <span class=\"token operator\">=</span> <span class=\"token string\">'/bin/bash'</span><br><br><span class=\"token comment\"># Ruta absoluta del directorio que contiene los directorios personales de los usuarios. Terminado en \"/\"</span><br>home_dir <span class=\"token operator\">=</span> <span class=\"token string\">'/home/ldap/'</span><br><br><span class=\"token comment\"># El valor inicial para los UID que se asignan al insertar usuarios. </span><br>uid_number <span class=\"token operator\">=</span> <span class=\"token number\">5000</span><br><br><span class=\"token comment\"># El GID que se le asigna a los usuarios. Si no se manda al anadir el usuario da error.</span><br>gid <span class=\"token operator\">=</span> <span class=\"token number\">5000</span><br><br><span class=\"token comment\">### VARIABLES</span><br><br><span class=\"token comment\"># Leemos el fichero .csv de los usuarios y guardamos cada linea en una lista.</span><br><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'usuarios.csv'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> usuarios<span class=\"token punctuation\">:</span><br>  usuarios <span class=\"token operator\">=</span> usuarios<span class=\"token punctuation\">.</span>readlines<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><br><br><br><span class=\"token comment\">### Parametros para la conexion</span><br>ldap_ip <span class=\"token operator\">=</span> <span class=\"token string\">'ldap://alfa.alejandro-montes.gonzalonazareno.org:389'</span><br>dominio_base <span class=\"token operator\">=</span> <span class=\"token string\">'dc=alejandro-montes,dc=gonzalonazareno,dc=org'</span><br>user_admin <span class=\"token operator\">=</span> <span class=\"token string\">'admin'</span> <br>contrasena <span class=\"token operator\">=</span> getpass<span class=\"token punctuation\">(</span><span class=\"token string\">'Contrasena: '</span><span class=\"token punctuation\">)</span><br><br><span class=\"token comment\"># Intenta realizar la conexion.</span><br>conn <span class=\"token operator\">=</span> Connection<span class=\"token punctuation\">(</span>ldap_ip<span class=\"token punctuation\">,</span> <span class=\"token string\">'cn={},{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>user_admin<span class=\"token punctuation\">,</span> dominio_base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>contrasena<span class=\"token punctuation\">)</span><br><br><span class=\"token comment\"># conn.bind() devuelve \"True\" si se ha establecido la conexion y \"False\" en caso contrario.</span><br><br><span class=\"token comment\"># Si no se establece la conexion imprime por pantalla un error de conexion.</span><br><span class=\"token keyword\">if</span> <span class=\"token keyword\">not</span> conn<span class=\"token punctuation\">.</span>bind<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span><br>  <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'No se ha podido conectar con ldap'</span><span class=\"token punctuation\">)</span> <br>  <span class=\"token keyword\">if</span> conn<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">[</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'invalidCredentials'</span><span class=\"token punctuation\">:</span><br>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Credenciales no validas.'</span><span class=\"token punctuation\">)</span><br>  <span class=\"token comment\"># Termina el script.</span><br>  exit<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><br><br><span class=\"token comment\"># Recorre la lista de usuarios</span><br><span class=\"token keyword\">for</span> user <span class=\"token keyword\">in</span> usuarios<span class=\"token punctuation\">:</span><br>  <span class=\"token comment\"># Separa los valores del usuario usando como delimitador \",\", y asigna cada valor a la variable correspondiente.</span><br>  user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><br>  cn <span class=\"token operator\">=</span> user<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><br>  sn <span class=\"token operator\">=</span> user<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><br>  mail <span class=\"token operator\">=</span> user<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><br>  uid <span class=\"token operator\">=</span> user<span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span><br>  ssh <span class=\"token operator\">=</span> user<span class=\"token punctuation\">[</span><span class=\"token number\">4</span><span class=\"token punctuation\">]</span><br><br>  <span class=\"token comment\">#Anade el usuario.</span><br>  conn<span class=\"token punctuation\">.</span>add<span class=\"token punctuation\">(</span><br>    <span class=\"token string\">'uid={},ou=Personas,{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">,</span> dominio_base<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>    object_class <span class=\"token operator\">=</span> <br>      <span class=\"token punctuation\">[</span><br>      <span class=\"token string\">'inetOrgPerson'</span><span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'posixAccount'</span><span class=\"token punctuation\">,</span> <br>      <span class=\"token string\">'ldapPublicKey'</span><br>      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span><br>    attributes <span class=\"token operator\">=</span><br>      <span class=\"token punctuation\">{</span><br>      <span class=\"token string\">'cn'</span><span class=\"token punctuation\">:</span> cn<span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'sn'</span><span class=\"token punctuation\">:</span> sn<span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'mail'</span><span class=\"token punctuation\">:</span> mail<span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'uid'</span><span class=\"token punctuation\">:</span> uid<span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'uidNumber'</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>uid_number<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'gidNumber'</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>gid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'homeDirectory'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'{}{}'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>home_dir<span class=\"token punctuation\">,</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'loginShell'</span><span class=\"token punctuation\">:</span> shell<span class=\"token punctuation\">,</span><br>      <span class=\"token string\">'sshPublicKey'</span><span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>ssh<span class=\"token punctuation\">)</span><br>      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><br><br>  <span class=\"token keyword\">if</span> conn<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">[</span><span class=\"token string\">'description'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'entryAlreadyExists'</span><span class=\"token punctuation\">:</span><br>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'El usuario {} ya existe.'</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">format</span><span class=\"token punctuation\">(</span>uid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><br><br>  <span class=\"token comment\"># Aumenta el contador para asignar un UID diferente a cada usuario (cada vez que ejecutemos el script debemos asegurarnos de ante mano que no existe dicho uid en el directorio ldap, o se solaparian los datos)</span><br>  uid_number <span class=\"token operator\">+=</span> <span class=\"token number\">1</span><br><br><span class=\"token comment\">#Cierra la conexion.</span><br>conn<span class=\"token punctuation\">.</span>unbind<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre>\n<p>Ejecutamos el script:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(ldap) usuario@alfa:~$ nano usuarios.csv<br>(ldap) usuario@alfa:~$ python3 usuarios.py <br>Contrasena:<br>(ldap) usuario@alfa:~$ </code></pre>\n<p>Si hacemos un LDAP search el resultado es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(ldap) usuario@alfa:~$ ldapsearch -x -D \"cn=admin,dc=alejandro-montes,dc=gonzalonazareno,dc=org\" -b \"dc=alejandro-montes,dc=gonzalonazareno,dc=org\" -W<br></code></pre>\n<p><img src=\"/img/LDAP-III.1.png\" alt=\"LDAP-III.1.png\"></p>\n<h3 id=\"configurar-el-sistema-para-que-funcionen-los-usuarios-de-ldap.\" tabindex=\"-1\">Configurar el sistema para que funcionen los usuarios de LDAP.</h3>\n<p>En el <strong>cliente</strong> de LDAP editamos la configuraci√≥n de LDAP y ponemos lo siguiente(Si has seguido los pasos de la pr√°ctica anterior, este paso lo tendremos hecho):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">BASE    dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>URI     ldap://alfa.alejandro-montes.gonzalonazareno.org</code></pre>\n<h3 id=\"configurar-el-servicio-ssh-para-que-permita-acceder-a-los-usuarios-del-ldap-utilizando-las-claves-p%C3%BAblicas-que-hay-all%C3%AD%2C-en-lugar-de-almacenarlas-en-.ssh%2Fauthorized_keys-y-que-se-cree-el-directorio-%E2%80%9Chome%E2%80%9D-al-vuelo.\" tabindex=\"-1\">Configurar el servicio ssh para que permita acceder a los usuarios del LDAP utilizando las claves p√∫blicas que hay all√≠, en lugar de almacenarlas en .ssh/authorized_keys y que se cree el directorio ‚Äúhome‚Äù al vuelo.</h3>\n<p>Para configurar que el servicio ssh cree el home nada m√°s crearse, tenemos que ejecutar el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# echo \"session    required        pam_mkhomedir.so\" >> /etc/pam.d/common-session</code></pre>\n<p>Ahora realizaremos un script que encuentre las claves p√∫blicas de los usuarios. El script debe de estar en una ruta con los permisos correspondientes para que funcione:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# nano /opt/sshsearch.sh<br><br>#!/bin/bash<br><br>ldapsearch -x -u -LLL -o ldif-wrap=no '(&amp;(objectClass=posixAccount)(uid='\"$1\"'))' 'sshPublicKey' | sed -n 's/^[ \\t]*sshPublicKey::[ \\t]*\\(.*\\)/\\1/p' | base64 -d<br>root@alfa:/home/usuario# chmod 755 /opt/sshsearch.sh</code></pre>\n<p>Si ejecutamos el script vemos que funciona correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(ldap) usuario@alfa:~$ source /opt/sshsearch.sh alemd<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCvd5Lg3K1k1WeHYHE3T5aPSEx/duCM87J2LFhgFODU3Z0+1mE5bjDUzvrUTVoHdMu1phOd8IS2vPCL2Ei8PjooLdLrsqHtFN9JYvtBRRhTs5tV3JSGaaFrljYtiITbulVTHBTqssrr4VfJ1jxMF9aSVcPjfVxsNMo01AhK8PAnCiSVBru9BUYgoG+7rCVMeB78qTXyuKNLoFqsuIPmQeV8D0JGKGozS2cikflyEOgYC+UwILUliV0dVtlpPltOOMLKngWF1fyjnfsJykiULI+l20Iid5QtDx5SK6nLRTtrr9MYCZbSJqAKVsxxKIYY5I+qSNsikgNrTnWJVq6z4zr5u4AqazjiDqX+266cDBf7rEq9GA9OZuul4/Kzy+PB9+w5rCgneSP7iL38ehQSjWzfpD1ny8mxCFmwuEwFBpGYhYHNywBYg8f1iMayjBeatFIU8WUCrCct0y1Zlf/Hn+Lzd5xb4aJgWd+mMyMmhZPcTAC6UN03tM2b0s6wjP8DzJc= ubuntu@delta<br>(ldap) usuario@alfa:~$ source /opt/sshsearch.sh ivan<br>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCfYm123AV12rRYM+tPkrd0Hrzc9Py32Ov8JVZCnH5zVBj3I/IxE08LUhccSSx9aD0DrW+RdfpmLCSBTgGnbdM9eYlq3jxoBqqye4DQeXLSPyXcp/qRPGPsNO+eGypVhRB+Oq9B+ktrHgzAXQSP1yjmjN57H7GVBnMEJhpCEVXk5vWgMhVNxsDSF6lHrbiaYLtunTtt+fNgrprzXuUqhUwEDRt6/ktwad420J7kmqkB4dQuex3hV+16l1GyNH8AJzNzoinTiLr/jW8Ja0udgIknsxFvZ5Df+ACCrXfIFwvdPTm6Nya0jCm9vFx5yc5O1E07qlbAAn3FiIfS5Udjs6rNZjfFH5GmlpodhcGy4nkCYZvylnEayIa/ak4wA7oDft60hlHBMCHMoyY3ZcIkWGmVkwnTB3xfxfykPeD14zQAlIuMol9RNmPUbDYtbfY64npLPmagUIHSpwwbs1byEBbzzqzG8qcCAPUk3mK6oB5+OKUNJDv+4MM+suj+Y/PnWM8= debian@delta</code></pre>\n<p>A√±adimos al fichero sshd_config lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# nano /etc/ssh/sshd_config<br></code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">AuthorizedKeysCommand /opt/buscarclave.sh<br>AuthorizedKeysCommandUser nobody</code></pre>\n<p>reiniciamos ssh:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# systemctl restart sshd</code></pre>\n<h3 id=\"comprobaciones.\" tabindex=\"-1\">Comprobaciones.</h3>\n<p>Desde el cliente delta, accedo con el usuario <code>alemd</code> y creo una carpeta y un usuario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ ssh alemd@alfa.alejandro-montes.gonzalonazareno.org<br>The authenticity of host 'alfa.alejandro-montes.gonzalonazareno.org (192.168.0.1)' can't be established.<br>ECDSA key fingerprint is SHA256:Keks1avOP1EmyzMJEwSoAL+mcSzp7ag4TWkE5gjB4m8.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added 'alfa.alejandro-montes.gonzalonazareno.org,192.168.0.1' (ECDSA) to the list of known hosts.<br>Creating directory '/home/ldap/alemd'.<br>Linux alfa 5.10.0-21-amd64 #1 SMP Debian 5.10.162-1 (2023-01-21) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>alemd@alfa:~$ mkdir prueba<br>alemd@alfa:~$ touch prueba2<br>alemd@alfa:~$ ls -l<br>total 4<br>drwxr-xr-x 2 alemd 5000 4096 Feb 14 09:42 prueba<br>-rw-r--r-- 1 alemd 5000    0 Feb 14 09:42 prueba2</code></pre>\n<p>Desde alfa muestro que en la carpeta /home/ldap se ha creado el usuario alemd y se encuentran los archivos que he creado desde delta.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/ldap# ls<br>alemd<br>root@alfa:/home/ldap# cd alemd/<br>root@alfa:/home/ldap/alemd# ls<br>prueba\tprueba2<br>root@alfa:/home/ldap/alemd# ls -l<br>total 4<br>drwxr-xr-x 2 alemd 5000 4096 Feb 14 09:42 prueba<br>-rw-r--r-- 1 alemd 5000    0 Feb 14 09:42 prueba2</code></pre>\n<p>Ahora ivan se conecta a mi servidor y crea un fichero y una carpeta:</p>\n<p><img src=\"/img/LDAP-III.2.png\" alt=\"LDAP-III.2.png\"></p>\n<p>Desde el servidor muestro que se ha creado el Home y los ficheros que el ha creado.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:/home/ldap$ ls<br>alemd  ivan<br>usuario@alfa:/home/ldap$ cd ivan/<br>usuario@alfa:/home/ldap/ivan$ ls -l<br>total 4<br>drwxr-xr-x 2 ivan 5000 4096 Feb 14 09:48 FUNCIONA<br>-rw-r--r-- 1 ivan 5000    0 Feb 14 09:49 soy-Ivan</code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-14T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-k8s-iv./",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-k8s-iv./",
      "title": "Ejercicios de K8s IV.",
      "content_html": "<h3 id=\"despliegue-y-acceso-de-la-aplicaci%C3%B3n-guestbook.\" tabindex=\"-1\">Despliegue y acceso de la aplicaci√≥n GuestBook.</h3>\n<p>Una vez que tenemos creado el despliegue de la aplicaci√≥n GuestBook, que realizamos en el anterioor taller, vamos a crear los Services correspondientes para acceder a ella:</p>\n<p><strong>Service para acceder a la aplicaci√≥n.</strong></p>\n<p>El primer Service que vamos a crear nos va a permitir acceder a la aplicaci√≥n GuestBook desde el exterior, para ello crea un fichero yaml con la definici√≥n del Service a partir de la siguiente plantilla:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br>  <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> guestbook<br>    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> guestbook<br>      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> frontend<br>  <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <br>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <br>      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <br>    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> guestbook<br>      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> frontend</code></pre>\n<p>Tienes que poner el tipo del Service, el puerto del servicio ser√° el 80 y el nombre del puerto de la aplicaci√≥n que hemos asignado en el Deployment es http-server.</p>\n<p>Realiza los siguientes pasos:</p>\n<h4 id=\"1.-elabora-el-fichero-yaml-con-la-definici%C3%B3n-del-service%2C-y-cr%C3%A9alo.\" tabindex=\"-1\">1. Elabora el fichero yaml con la definici√≥n del Service, y cr√©alo.</h4>\n<p>El fichero queda de la siguiente manera:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> guestbook<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> guestbook<br>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> frontend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort<br>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>server<br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> guestbook</code></pre>\n<p>Creamos el sevicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f service-guestbook.yaml <br>service/guestbook created</code></pre>\n<h4 id=\"2.-comprueba-el-puerto-que-le-han-asignado-al-service-para-acceder-desde-el-exterior.\" tabindex=\"-1\">2. Comprueba el puerto que le han asignado al Service para acceder desde el exterior.</h4>\n<p>Con el siguiente comando vemos la ip de minikube:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ minikube ip<br>192.168.39.178</code></pre>\n<p>Ahora vemos informaci√≥n de los servicios para ver el puerto:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get service<br>NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE<br>guestbook    NodePort    10.97.200.110   &lt;none>        80:31272/TCP   4m1s<br>kubernetes   ClusterIP   10.96.0.1       &lt;none>        443/TCP        13d</code></pre>\n<p>Vemos que tiene el puerto 31272.</p>\n<h4 id=\"3.-accede-a-la-ip-del-nodo-master-y-al-puerto-asignado-desde-un-navegador-web-para-ver-la-aplicaci%C3%B3n.\" tabindex=\"-1\">3. Accede a la ip del nodo master y al puerto asignado desde un navegador web para ver la aplicaci√≥n.</h4>\n<p><img src=\"/img/SRI-K8S-T4.1.png\" alt=\"SRI-K8S-T4.1.png\"></p>\n<h4 id=\"4.-responde-la-siguiente-pregunta%3A-%C2%BFpor-qu%C3%A9-aparece-el-mensaje-de-error%3A-waiting-for-database-connection%E2%80%A6%3F\" tabindex=\"-1\">4. Responde la siguiente pregunta: ¬øPor qu√© aparece el mensaje de error: Waiting for database connection‚Ä¶?</h4>\n<p>Porque hemos configurado el front-end, falta configurar la base de datos para que funcione.</p>\n<p><strong>Service para acceder a la base de datos.</strong></p>\n<p>A continuaci√≥n vamos a crear el Service para acceder a la base de datos. Vamos a crear el fichero yaml para su definici√≥n a partir de la siguiente plantilla:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\">  <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br>  <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<br>    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br>  <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> <br>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <br>      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <br>    <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>      <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend</code></pre>\n<p>Tienes que poner el tipo del Service, el puerto del servicio ser√° el 6379 y el nombre del puerto de la base de datos que hemos asignado en el Deployment es redis-server. Nota: No cambies el nombre del Service, ya que la aplicaci√≥n guestbook va a acceder por defecto a la base de datos usando el nombre redis.</p>\n<p>Realiza los siguientes pasos:</p>\n<h4 id=\"1.-elabora-el-fichero-yaml-con-la-definici%C3%B3n-del-service%2C-y-cr%C3%A9alo.-1\" tabindex=\"-1\">1. Elabora el fichero yaml con la definici√≥n del Service, y cr√©alo.</h4>\n<p>El fichero yaml queda de la siguiente manera:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP<br>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>server<br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<br>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f service-guestbook2.yaml <br>service/redis created</code></pre>\n<h4 id=\"2.-lista-los-services-que-has-creado.\" tabindex=\"-1\">2. Lista los Services que has creado.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get services<br>NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE<br>guestbook    NodePort    10.97.200.110   &lt;none>        80:31272/TCP   57m<br>kubernetes   ClusterIP   10.96.0.1       &lt;none>        443/TCP        13d<br>redis        ClusterIP   10.98.117.225   &lt;none>        6379/TCP       97s</code></pre>\n<h4 id=\"3.-accede-a-la-ip-del-nodo-master-y-al-puerto-asignado-desde-un-navegador-web-para-ver-la-aplicaci%C3%B3n.-comprueba-que-funciona-sin-ning%C3%BAn-problema.\" tabindex=\"-1\">3. Accede a la ip del nodo master y al puerto asignado desde un navegador web para ver la aplicaci√≥n. Comprueba que funciona sin ning√∫n problema.</h4>\n<p><img src=\"/img/SRI-K8S-T4.2.png\" alt=\"SRI-K8S-T4.2.png\"></p>\n<p><strong>Acceso a la aplicaci√≥n usando Ingress</strong></p>\n<p>Vamos a crear el fichero yaml de definici√≥n del recurso Ingress para acceder a la aplicaci√≥n a partir de la siguiente plantilla:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> guestbook<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> <br>    <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /<br>        <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix<br>        <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span><br>          <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span><br>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <br>            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span><br>              <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre>\n<p>Indica un host del tipo <a href=\"http://www.tunombre.org\">www.tunombre.org</a>, indica el nombre del Service que creaste para acceder a la aplicaci√≥n guestbook y ten en cuenta que el puerto de dicho servicio era el 80.</p>\n<p>Realiza los siguientes pasos:</p>\n<h4 id=\"1.-activa-el-addon-ingress-en-minikube-para-instalar-el-ingress-controller.\" tabindex=\"-1\">1. Activa el addon ingress en minikube para instalar el Ingress Controller.</h4>\n<p>Para activar el addon ingress usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ minikube addons enable ingress<br>üí°  ingress is an addon maintained by Kubernetes. For any concerns contact minikube on GitHub.<br>You can view the list of minikube maintainers at: https://github.com/kubernetes/minikube/blob/master/OWNERS<br>    ‚ñ™ Using image registry.k8s.io/ingress-nginx/controller:v1.5.1<br>    ‚ñ™ Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20220916-gd32f8c343<br>    ‚ñ™ Using image registry.k8s.io/ingress-nginx/kube-webhook-certgen:v20220916-gd32f8c343<br>üîé  Verifying ingress addon...<br>üåü  The 'ingress' addon is enabled</code></pre>\n<h4 id=\"2.-crea-la-definici%C3%B3n-del-recurso-ingress-con-los-datos-sugeridos%2C-y-crea-el-recurso-ingress.\" tabindex=\"-1\">2. Crea La definici√≥n del recurso Ingress con los datos sugeridos, y crea el recurso Ingress.</h4>\n<p>El fichero yaml queda de la siguiente manera:</p>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> guestbook<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> www.alejandro<span class=\"token punctuation\">-</span>montes.org<br>    <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /<br>        <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix<br>        <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span><br>          <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span><br>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> guestbook<br>            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span><br>              <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></code></pre>\n<p>Y creamos el ingress:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f service-guestbook3.yaml <br>ingress.networking.k8s.io/guestbook created</code></pre>\n<h4 id=\"3.-modifica-el-fichero-%2Fetc%2Fhosts-de-tu-ordenador-para-configurar-la-resoluci%C3%B3n-est%C3%A1tica.\" tabindex=\"-1\">3. Modifica el fichero /etc/hosts de tu ordenador para configurar la resoluci√≥n est√°tica.</h4>\n<p>Configuramos el /etc/hosts de nuestro ordenador con la ip de minikube y <a href=\"http://www.tunombre.org\">www.tunombre.org</a>.</p>\n<h4 id=\"4.-accede-a-la-aplicaci%C3%B3n-usando-el-nombre-que-has-asignado.\" tabindex=\"-1\">4. Accede a la aplicaci√≥n usando el nombre que has asignado.</h4>\n<p><img src=\"/img/SRI-K8S-T4.3.png\" alt=\"SRI-K8S-T4.3.png\"></p>\n<h3 id=\"despliegue-y-acceso-de-la-aplicaci%C3%B3n-lets-chat.\" tabindex=\"-1\">Despliegue y acceso de la Aplicaci√≥n Lets-Chat.</h3>\n<p>Let‚Äôs Chat es una aplicaci√≥n web escrita en Node.js que utilizando una base de datos MongoDB nos posibilita la creaci√≥n de salas de chats.</p>\n<p>Vamos a realiza el despliegue y acceso a esta aplicaci√≥n teniendo en cuenta los siguientes aspectos:</p>\n<ul>\n<li>La imagen docker que vamos a usar para el despliegue de Let‚Äôs Chat es sdelements/lets-chat y para desplegar mongoDB utilizaremos la imagen mongo. Nota: utiliza imagen mongo:4, Let‚Äôs Chat es una aplicaci√≥n antigua y no funciona con las √∫ltimas versiones de mongo.</li>\n<li>Al crear el despliegue de Let‚Äôs Chat podemos poner varias replicas, pero el despliegue de la base de datos, s√≥lo crear√° una replica.</li>\n<li>El puerto en el que responde la aplicaci√≥n es el 8080. La base de datos utiliza el puerto 27017.</li>\n<li>Vamos acceder desde el exterior a la aplicaci√≥n. Sin embargo, no es necesario acceder desde el exterior a la base de datos.</li>\n<li>El nombre del Service para acceder a la base de datos debe ser mongo ya que por defecto la aplicaci√≥n va a conectar a la base de datos usando ese nombre.</li>\n<li>Queremos acceder a la aplicaci√≥n usando un nombre del tipo <a href=\"http://www.chat-tunombre.org\">www.chat-tunombre.org</a>.</li>\n</ul>\n<p>Realiza los siguientes pasos:</p>\n<h4 id=\"1.-utilizando-como-modelos-los-ficheros-yaml-de-la-actividad-anterior%2C-crea-los-ficheros-necesarios-para-crear-los-recursos-en-tu-cluster-de-kubernetes-para-desplegar-esta-aplicaci%C3%B3n.\" tabindex=\"-1\">1. Utilizando como modelos los ficheros yaml de la actividad anterior, crea los ficheros necesarios para crear los recursos en tu cluster de Kubernetes para desplegar esta aplicaci√≥n.</h4>\n<p>Adjunto los deployments:</p>\n<ul>\n<li>Deployment de letschat:</li>\n</ul>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lets<span class=\"token punctuation\">-</span>chat<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> letschat<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span> <br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lets<span class=\"token punctuation\">-</span>chat<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lets<span class=\"token punctuation\">-</span>chat<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lets<span class=\"token punctuation\">-</span>chat<br>        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> sdelements/lets<span class=\"token punctuation\">-</span>chat<br>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>server<br>            <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span><br></code></pre>\n<ul>\n<li>Deployment de mongo:</li>\n</ul>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo<br>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo<br>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span><br>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo<br>        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mongo<span class=\"token punctuation\">:</span><span class=\"token number\">4</span><br>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo<br>            <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span><br></code></pre>\n<p>Adjunto los services:</p>\n<ul>\n<li>Service de letschat:</li>\n</ul>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lets<span class=\"token punctuation\">-</span>chat<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lets<span class=\"token punctuation\">-</span>chat<br>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> frontend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort<br>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">-</span>server <br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> lets<span class=\"token punctuation\">-</span>chat<br></code></pre>\n<ul>\n<li>Service de mongo:</li>\n</ul>\n<pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1<br><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service<br><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo<br>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> mongo<br>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> backend<br><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span><br>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP<br>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span><br>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">27017</span><br>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> mongo <br>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span><br>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mongo</code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-13T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-k8s-iii./",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-k8s-iii./",
      "title": "Ejercicios de K8s III.",
      "content_html": "<h3 id=\"trabajando-con-deployments.\" tabindex=\"-1\">Trabajando con Deployments.</h3>\n<p><strong>En este taller vamos a crear un Deployment de una aplicaci√≥n web. Sigamos los siguientes pasos:</strong></p>\n<h4 id=\"1.-crea-un-fichero-yaml-con-la-descripci%C3%B3n-del-recurso-deployment%2C-teniendo-en-cuenta-los-siguientes-aspectos%3A\" tabindex=\"-1\">1. Crea un fichero yaml con la descripci√≥n del recurso Deployment, teniendo en cuenta los siguientes aspectos:</h4>\n<ul>\n<li><strong>Indica nombres distintos para el Deployment y para el contenedor de los Pods que va a controlar.</strong></li>\n<li><strong>El Deployment va a crear 2 r√©plicas.</strong></li>\n<li><strong>La imagen que debes desplegar es iesgn/test_web:latest.</strong></li>\n<li><strong>Indica de manera adecuada una etiqueta en la especificaci√≥n del Pod que vas a definir que coincida con el selector del Deployment.</strong></li>\n</ul>\n<p>El yaml creado es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: apps/v1<br>kind: Deployment<br>metadata:<br>  name: deployment-t3   <br>  labels:<br>    app: nginx<br>spec:<br>  revisionHistoryLimit: 2<br>  strategy:<br>    type: RollingUpdate<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: nginx<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx<br>    spec:<br>      containers:<br>      - image: iesgn/test_web:latest<br>        name: contendor-t3   <br>        ports:<br>        - name: http<br>          containerPort: 80</code></pre>\n<h4 id=\"2.-crea-el-deployment.\" tabindex=\"-1\">2. Crea el Deployment.</h4>\n<p>Para crear el deployment usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f pod-t3.yaml<br>deployment.apps/deployment-t3 created</code></pre>\n<h4 id=\"3.-comprueba-los-recursos-que-se-han-creado%3A-deployment%2C-replicaset-y-pods.\" tabindex=\"-1\">3. Comprueba los recursos que se han creado: Deployment, ReplicaSet y Pods.</h4>\n<p>Para ver todos los recursos usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get all<br>NAME                                 READY   STATUS    RESTARTS   AGE<br>pod/deployment-t3-6cb4d64f6f-64mzx   1/1     Running   0          61s<br>pod/deployment-t3-6cb4d64f6f-m4448   1/1     Running   0          61s<br><br>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE<br>service/kubernetes   ClusterIP   10.96.0.1    &lt;none>        443/TCP   11d<br><br>NAME                            READY   UP-TO-DATE   AVAILABLE   AGE<br>deployment.apps/deployment-t3   2/2     2            2           61s<br><br>NAME                                       DESIRED   CURRENT   READY   AGE<br>replicaset.apps/deployment-t3-6cb4d64f6f   2         2         2       61s</code></pre>\n<h4 id=\"4.-obt%C3%A9n-informaci%C3%B3n-detallada-del-deployment-creado.\" tabindex=\"-1\">4. Obt√©n informaci√≥n detallada del Deployment creado.</h4>\n<p>Usamos el siguiente comando para ver informaci√≥n detallada del deployment:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl describe deployment deployment-t3<br>Name:                   deployment-t3<br>Namespace:              default<br>CreationTimestamp:      Fri, 10 Feb 2023 18:33:15 +0100<br>Labels:                 app=nginx<br>Annotations:            deployment.kubernetes.io/revision: 1<br>Selector:               app=nginx<br>Replicas:               2 desired | 2 updated | 2 total | 2 available | 0 unavailable<br>StrategyType:           RollingUpdate<br>MinReadySeconds:        0<br>RollingUpdateStrategy:  25% max unavailable, 25% max surge<br>Pod Template:<br>  Labels:  app=nginx<br>  Containers:<br>   contendor-t3:<br>    Image:        iesgn/test_web:latest<br>    Port:         80/TCP<br>    Host Port:    0/TCP<br>    Environment:  &lt;none><br>    Mounts:       &lt;none><br>  Volumes:        &lt;none><br>Conditions:<br>  Type           Status  Reason<br>  ----           ------  ------<br>  Available      True    MinimumReplicasAvailable<br>  Progressing    True    NewReplicaSetAvailable<br>OldReplicaSets:  &lt;none><br>NewReplicaSet:   deployment-t3-6cb4d64f6f (2/2 replicas created)<br>Events:<br>  Type    Reason             Age    From                   Message<br>  ----    ------             ----   ----                   -------<br>  Normal  ScalingReplicaSet  2m30s  deployment-controller  Scaled up replica set deployment-t3-6cb4d64f6f to 2</code></pre>\n<h4 id=\"5.-crea-un-una-redirecci%C3%B3n-utilizando-el-port-forward-para-acceder-a-la-aplicaci%C3%B3n%2C-sabiendo-que-la-aplicaci%C3%B3n-ofrece-el-servicio-en-el-puerto-80%2C-y-accede-a-la-aplicaci%C3%B3n-con-un-navegador-web.\" tabindex=\"-1\">5. Crea un una redirecci√≥n utilizando el port-forward para acceder a la aplicaci√≥n, sabiendo que la aplicaci√≥n ofrece el servicio en el puerto 80, y accede a la aplicaci√≥n con un navegador web.</h4>\n<p>Para realizar el port-forward con un deployment usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl port-forward deployment/deployment-t3 8088:80<br>Forwarding from 127.0.0.1:8088 -> 80<br>Forwarding from [::1]:8088 -> 80</code></pre>\n<p>Accedemos a la p√°gina web por el puerto 8088:</p>\n<p><img src=\"/img/SRI-K8S-T3.1.png\" alt=\"SRI-K8S-T3.1.png\"></p>\n<h4 id=\"6.-accede-a-los-logs-del-despliegue-para-comprobar-el-acceso-que-has-hecho-en-el-punto-anterior.\" tabindex=\"-1\">6. Accede a los logs del despliegue para comprobar el acceso que has hecho en el punto anterior.</h4>\n<p>A continuaci√≥n, muestro los logs del deployment.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl logs deployments/deployment-t3<br>Found 2 pods, using pod/deployment-t3-6cb4d64f6f-m4448<br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.244.0.14. Set the 'ServerName' directive globally to suppress this message<br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.244.0.14. Set the 'ServerName' directive globally to suppress this message<br>[Fri Feb 10 17:33:26.060609 2023] [mpm_event:notice] [pid 1:tid 140502009566336] AH00489: Apache/2.4.46 (Unix) configured -- resuming normal operations<br>[Fri Feb 10 17:33:26.196721 2023] [core:notice] [pid 1:tid 140502009566336] AH00094: Command line: 'httpd -D FOREGROUND'<br>127.0.0.1 - - [10/Feb/2023:17:38:47 +0000] \"GET / HTTP/1.1\" 200 2884<br>127.0.0.1 - - [10/Feb/2023:17:38:47 +0000] \"GET /favicon.ico HTTP/1.1\" 404 196<br></code></pre>\n<h4 id=\"7.-elimina-el-deployment-y-comprueba-que-se-han-borrado-todos-los-recursos-creados.\" tabindex=\"-1\">7. Elimina el Deployment y comprueba que se han borrado todos los recursos creados.</h4>\n<p>Usamos el deplete deplyment:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl delete deployments.apps deployment-t3<br>deployment.apps \"deployment-t3\" deleted</code></pre>\n<h3 id=\"actualizaci%C3%B3n-y-desactualizaci%C3%B3n-de-nuestra-aplicaci%C3%B3n.\" tabindex=\"-1\">Actualizaci√≥n y desactualizaci√≥n de nuestra aplicaci√≥n.</h3>\n<p><strong>El equipo de desarrollo ha creado una primera versi√≥n preliminar de una aplicaci√≥n web y ha creado una imagen de contenedor con el siguiente nombre: iesgn/test_web:version1.</strong></p>\n<p><strong>Vamos a desplegar esta primera versi√≥n de la aplicaci√≥n, para ello:</strong></p>\n<h4 id=\"1.-crea-un-fichero-yaml-(puedes-usar-el-de-la-actividad-anterior)-para-desplegar-la-imagen%3A-iesgn%2Ftest_web%3Aversion1.\" tabindex=\"-1\">1. Crea un fichero yaml (puedes usar el de la actividad anterior) para desplegar la imagen: iesgn/test_web:version1.</h4>\n<p>He usado el mismo fichero que en el anterior ejercicio, no lo vuelvo a poner para no duplicar informaci√≥n, el cambio en el fichero es en container la imagen es <code>iesgn/test_web:version1</code>.</p>\n<h4 id=\"2.-crea-el-deployment%2C-recuerda-realizar-una-anotaci%C3%B3n-para-indicar-las-caracter%C3%ADsticas-del-despliegue.\" tabindex=\"-1\">2. Crea el Deployment, recuerda realizar una anotaci√≥n para indicar las caracter√≠sticas del despliegue.</h4>\n<p>Creamos el deployment y lo anotamos con los siguientes comandos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f deployment-t3.yaml<br>deployment.apps/deployment-t3 created<br>alemd@debian:~/minikube$ kubectl annotate deployment/deployment-t3 iesgn/test_web=\"despliegue version 1\"<br>deployment.apps/deployment-t3 annotated</code></pre>\n<h4 id=\"3.-crea-una-redirecci%C3%B3n-utilizando-el-port-forward-para-acceder-a-la-aplicaci%C3%B3n%2C-sabiendo-que-la-aplicaci%C3%B3n-ofrece-el-servicio-en-el-puerto-80%2C-y-accede-a-la-aplicaci%C3%B3n-con-un-navegador-web.\" tabindex=\"-1\">3. Crea una redirecci√≥n utilizando el port-forward para acceder a la aplicaci√≥n, sabiendo que la aplicaci√≥n ofrece el servicio en el puerto 80, y accede a la aplicaci√≥n con un navegador web.</h4>\n<p>Adjunto el comando para el port-forward:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl port-forward deployment/deployment-t3 8088:80<br>Forwarding from 127.0.0.1:8088 -> 80<br>Forwarding from [::1]:8088 -> 80<br>Handling connection for 8088</code></pre>\n<p><img src=\"/img/SRI-K8S-T3.2.png\" alt=\"SRI-K8S-T3.2.png\"></p>\n<p><strong>Nuestro equipo de desarrollo ha seguido trabajando y ya tiene lista la versi√≥n 2 de nuestra aplicaci√≥n, han creado una imagen que se llama: iesgn/test_web:version2. Vamos a actualizar nuestro despliegue con la nueva versi√≥n, para ello:</strong></p>\n<h4 id=\"4.-realiza-la-actualizaci%C3%B3n-del-despliegue-utilizando-la-nueva-imagen-(no-olvides-anotar-la-causa).\" tabindex=\"-1\">4. Realiza la actualizaci√≥n del despliegue utilizando la nueva imagen (no olvides anotar la causa).</h4>\n<p>Lo primero que haremos ser√° editar nuestro fichero yaml, cambiando <code>iesgn/test_web:version1</code> por <code>iesgn/test_web:version2</code>. Volvemos a hacer un apply:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f deployment-t3.yaml<br>deployment.apps/deployment-t3 configured</code></pre>\n<p>Lo anotamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl annotate deployment/deployment-t3 iesgn/test_web2=\"despliegue version 2\"<br>deployment.apps/deployment-t3 annotated</code></pre>\n<h4 id=\"5.-comprueba-los-recursos-que-se-han-creado%3A-deployment%2C-replicaset-y-pods.\" tabindex=\"-1\">5. Comprueba los recursos que se han creado: Deployment, ReplicaSet y Pods.</h4>\n<p>Usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get all<br>NAME                                 READY   STATUS    RESTARTS   AGE<br>pod/deployment-t3-548d4685f4-6cfxc   1/1     Running   0          4m50s<br>pod/deployment-t3-548d4685f4-z4tqf   1/1     Running   0          4m39s<br><br>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE<br>service/kubernetes   ClusterIP   10.96.0.1    &lt;none>        443/TCP   11d<br><br>NAME                            READY   UP-TO-DATE   AVAILABLE   AGE<br>deployment.apps/deployment-t3   2/2     2            2           12m<br><br>NAME                                       DESIRED   CURRENT   READY   AGE<br>replicaset.apps/deployment-t3-548d4685f4   2         2         2       4m50s<br>replicaset.apps/deployment-t3-55f8ffb8f5   0         0         0       12m<br></code></pre>\n<h4 id=\"6.-visualiza-el-historial-de-actualizaciones.\" tabindex=\"-1\">6. Visualiza el historial de actualizaciones.</h4>\n<p>Para ver el historial de actualizaciones usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl rollout history deployment/deployment-t3<br>deployment.apps/deployment-t3 <br>REVISION  CHANGE-CAUSE<br>1         &lt;none><br>2         &lt;none></code></pre>\n<h4 id=\"7.-crea-una-redirecci%C3%B3n-utilizando-el-port-forward-para-acceder-a-la-aplicaci%C3%B3n%2C-sabiendo-que-la-aplicaci%C3%B3n-ofrece-el-servicio-en-el-puerto-80%2C-y-accede-a-la-aplicaci%C3%B3n-con-un-navegador-web.\" tabindex=\"-1\">7. Crea una redirecci√≥n utilizando el port-forward para acceder a la aplicaci√≥n, sabiendo que la aplicaci√≥n ofrece el servicio en el puerto 80, y accede a la aplicaci√≥n con un navegador web.</h4>\n<p>Creamos la redirecci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl port-forward deployment/deployment-t3 8088:80<br>Forwarding from 127.0.0.1:8088 -> 80<br>Forwarding from [::1]:8088 -> 80</code></pre>\n<p>Accedemos a la p√°gina web.</p>\n<p><img src=\"/img/SRI-K8S-T3.3.png\" alt=\"SRI-K8S-T3.3.png\"></p>\n<p><strong>Finalmente despu√©s de un trabajo muy duro, el equipo de desarrollo ha creado la imagen iesgn/test_web:version3 con la √∫ltima versi√≥n de nuestra aplicaci√≥n y la vamos a poner en producci√≥n, para ello:</strong></p>\n<h4 id=\"8.-realiza-la-actualizaci%C3%B3n-del-despliegue-utilizando-la-nueva-imagen-(no-olvides-anotar-la-causa).\" tabindex=\"-1\">8. Realiza la actualizaci√≥n del despliegue utilizando la nueva imagen (no olvides anotar la causa).</h4>\n<p>Actualizamos a la version 3, adjunto todos los comandos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl set image deployment/deployment-t3 contendor-t3=iesgn/test_web:version3<br>deployment.apps/deployment-t3 image updated<br>alemd@debian:~/minikube$ kubectl annotate deployment/deployment-t3 iesgn/change_cause=\"despliegue version 3\"<br>deployment.apps/deployment-t3 annotated</code></pre>\n<h4 id=\"9.-comprueba-los-recursos-que-se-han-creado%3A-deployment%2C-replicaset-y-pods.\" tabindex=\"-1\">9. Comprueba los recursos que se han creado: Deployment, ReplicaSet y Pods.</h4>\n<p>Vemos todos los recursos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get all<br>NAME                                 READY   STATUS    RESTARTS   AGE<br>pod/deployment-t3-56fc8df8d9-lss46   1/1     Running   0          75s<br>pod/deployment-t3-56fc8df8d9-ts7tv   1/1     Running   0          86s<br><br>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE<br>service/kubernetes   ClusterIP   10.96.0.1    &lt;none>        443/TCP   11d<br><br>NAME                            READY   UP-TO-DATE   AVAILABLE   AGE<br>deployment.apps/deployment-t3   2/2     2            2           26m<br><br>NAME                                       DESIRED   CURRENT   READY   AGE<br>replicaset.apps/deployment-t3-548d4685f4   0         0         0       18m<br>replicaset.apps/deployment-t3-55f8ffb8f5   0         0         0       26m<br>replicaset.apps/deployment-t3-56fc8df8d9   2         2         2       86s</code></pre>\n<h4 id=\"10.-visualiza-el-historial-de-actualizaciones.\" tabindex=\"-1\">10. Visualiza el historial de actualizaciones.</h4>\n<p>Muestro el historial de versiones:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl rollout history deployment/deployment-t3<br>deployment.apps/deployment-t3 <br>REVISION  CHANGE-CAUSE<br>2         &lt;none><br>3         &lt;none><br>4         &lt;none></code></pre>\n<h4 id=\"11.-crea-una-redirecci%C3%B3n-utilizando-el-port-forward-para-acceder-a-la-aplicaci%C3%B3n%2C-sabiendo-que-la-aplicaci%C3%B3n-ofrece-el-servicio-en-el-puerto-80%2C-y-accede-a-la-aplicaci%C3%B3n-con-un-navegador-web.\" tabindex=\"-1\">11. Crea una redirecci√≥n utilizando el port-forward para acceder a la aplicaci√≥n, sabiendo que la aplicaci√≥n ofrece el servicio en el puerto 80, y accede a la aplicaci√≥n con un navegador web.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl port-forward deployment/deployment-t3 8088:80<br>Forwarding from 127.0.0.1:8088 -> 80<br>Forwarding from [::1]:8088 -> 80</code></pre>\n<p>Muestro la p√°gina web:</p>\n<p><img src=\"/img/SRI-K8S-T3.4.png\" alt=\"SRI-K8S-T3.4.png\"></p>\n<p><strong>¬°Vaya!, parece que esta versi√≥n tiene un fallo, y no se ve de forma adecuada la hoja de estilos, tenemos que volver a la versi√≥n anterior:</strong></p>\n<h4 id=\"12.-ejecuta-la-instrucci%C3%B3n-que-nos-permite-hacer-un-rollback-de-nuestro-despliegue.\" tabindex=\"-1\">12. Ejecuta la instrucci√≥n que nos permite hacer un rollback de nuestro despliegue.</h4>\n<p>Hacemos el rollback:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl set image deployment deployment-t3 contendor-t3=iesgn/test_web:version2<br>deployment.apps/deployment-t3 image updated</code></pre>\n<h4 id=\"13.-comprueba-los-recursos-que-se-han-creado%3A-deployment%2C-replicaset-y-pods.\" tabindex=\"-1\">13. Comprueba los recursos que se han creado: Deployment, ReplicaSet y Pods.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get all<br>NAME                                 READY   STATUS    RESTARTS   AGE<br>pod/deployment-t3-548d4685f4-4wbkh   1/1     Running   0          3m4s<br>pod/deployment-t3-548d4685f4-r9492   1/1     Running   0          3m10s<br><br>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE<br>service/kubernetes   ClusterIP   10.96.0.1    &lt;none>        443/TCP   11d<br><br>NAME                            READY   UP-TO-DATE   AVAILABLE   AGE<br>deployment.apps/deployment-t3   2/2     2            2           33m<br><br>NAME                                       DESIRED   CURRENT   READY   AGE<br>replicaset.apps/deployment-t3-548d4685f4   2         2         2       25m<br>replicaset.apps/deployment-t3-55f8ffb8f5   0         0         0       33m<br>replicaset.apps/deployment-t3-56fc8df8d9   0         0         0       8m35s</code></pre>\n<h4 id=\"14.-visualiza-el-historial-de-actualizaciones.\" tabindex=\"-1\">14. Visualiza el historial de actualizaciones.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl rollout history deployment/deployment-t3<br>deployment.apps/deployment-t3 <br>REVISION  CHANGE-CAUSE<br>3         &lt;none><br>4         &lt;none><br>5         &lt;none></code></pre>\n<h4 id=\"15.-crea-una-redirecci%C3%B3n-utilizando-el-port-forward-para-acceder-a-la-aplicaci%C3%B3n%2C-sabiendo-que-la-aplicaci%C3%B3n-ofrece-el-servicio-en-el-puerto-80%2C-y-accede-a-la-aplicaci%C3%B3n-con-un-navegador-web.\" tabindex=\"-1\">15. Crea una redirecci√≥n utilizando el port-forward para acceder a la aplicaci√≥n, sabiendo que la aplicaci√≥n ofrece el servicio en el puerto 80, y accede a la aplicaci√≥n con un navegador web.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl port-forward deployment/deployment-t3 8088:80<br>Forwarding from 127.0.0.1:8088 -> 80<br>Forwarding from [::1]:8088 -> 80<br>Handling connection for 8088</code></pre>\n<p><img src=\"/img/SRI-K8S-T3.5.png\" alt=\"SRI-K8S-T3.5.png\"></p>\n<h3 id=\"despliegue-de-la-aplicaci%C3%B3n-guestbook.\" tabindex=\"-1\">Despliegue de la aplicaci√≥n GuestBook.</h3>\n<p><strong>En esta tarea vamos a desplegar una aplicaci√≥n web que requiere de dos servicios para su ejecuci√≥n. La aplicaci√≥n se llama GuestBook y necesita los siguientes servicios:</strong></p>\n<ul>\n<li><strong>La aplicaci√≥n Guestbook es una aplicaci√≥n web desarrollada en python que es servida en el puerto 5000/tcp. Utilizaremos la imagen iesgn/guestbook.</strong></li>\n<li><strong>Esta aplicaci√≥n guarda la informaci√≥n en una base de datos no relacional redis, que utiliza el puerto 6379/tcp para recibir las conexiones. Usaremos la imagen redis.</strong></li>\n</ul>\n<p><strong>Por lo tanto si tenemos dos servicios distintos, tendremos dos ficheros yaml para crear dos recursos Deployment, uno para cada servicio. Con esta manera de trabajar podemos obtener las siguientes caracter√≠sticas:</strong></p>\n<p><strong>1. Cada conjunto de Pods creado en cada despliegue ejecutar√°n un solo proceso para ofrecer el servicio.</strong>\n<strong>2. Cada conjunto de Pods se puede escalar de manera independiente. Esto es importante, si identificamos que al acceder a alguno de los servicios se crea un cuello de botella, podemos escalarlo para tener m√°s Pods ejecutando el servicio.</strong>\n<strong>3. Las actualizaciones de los distintos servicios no interfieren en el resto.</strong>\n<strong>4. Lo estudiaremos en un m√≥dulo posterior, pero podremos gestionar el almacenamiento de cada servicio de forma independiente.</strong></p>\n<p><strong>Por lo tanto para desplegar la aplicaciones tendremos dos ficheros.yaml:</strong></p>\n<ul>\n<li><strong>guestbook-deployment.yaml</strong></li>\n<li><strong>redis-deployment.yaml</strong></li>\n</ul>\n<p><strong>Para realizar el despliegue realiza los siguientes pasos:</strong></p>\n<h4 id=\"1.-usando-los-ficheros-anteriores-crea-los-dos-deployments.\" tabindex=\"-1\">1. Usando los ficheros anteriores crea los dos Deployments.</h4>\n<p>Ejecutamos los siguientes comandos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f guestbook-deployment.yaml <br>deployment.apps/guestbook created<br>alemd@debian:~/minikube$ kubectl apply -f redis-deployment.yaml <br>deployment.apps/redis created</code></pre>\n<h4 id=\"2.-comprueba-que-los-recursos-que-se-han-creado%3A-deployment%2C-replicaset-y-pods.\" tabindex=\"-1\">2. Comprueba que los recursos que se han creado: Deployment, ReplicaSet y Pods.</h4>\n<p>Muestro todos los recursos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get all<br>NAME                             READY   STATUS    RESTARTS   AGE<br>pod/guestbook-8555449655-46576   1/1     Running   0          2m23s<br>pod/guestbook-8555449655-7sr82   1/1     Running   0          2m23s<br>pod/guestbook-8555449655-hrvld   1/1     Running   0          2m23s<br>pod/redis-6db6c7bfb5-5rn57       1/1     Running   0          2m17s<br><br>NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE<br>service/kubernetes   ClusterIP   10.96.0.1    &lt;none>        443/TCP   11d<br><br>NAME                        READY   UP-TO-DATE   AVAILABLE   AGE<br>deployment.apps/guestbook   3/3     3            3           2m24s<br>deployment.apps/redis       1/1     1            1           2m17s<br><br>NAME                                   DESIRED   CURRENT   READY   AGE<br>replicaset.apps/guestbook-8555449655   3         3         3       2m23s<br>replicaset.apps/redis-6db6c7bfb5       1         1         1       2m17s</code></pre>\n<h4 id=\"3.-crea-una-redirecci%C3%B3n-utilizando-el-port-forward-para-acceder-a-la-aplicaci%C3%B3n%2C-sabiendo-que-la-aplicaci%C3%B3n-ofrece-el-servicio-en-el-puerto-5000%2C-y-accede-a-la-aplicaci%C3%B3n-con-un-navegador-web.\" tabindex=\"-1\">3. Crea una redirecci√≥n utilizando el port-forward para acceder a la aplicaci√≥n, sabiendo que la aplicaci√≥n ofrece el servicio en el puerto 5000, y accede a la aplicaci√≥n con un navegador web.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl port-forward deployment/guestbook 8088:5000<br>Forwarding from 127.0.0.1:8088 -> 5000<br>Forwarding from [::1]:8088 -> 5000<br></code></pre>\n<p>Muestro la web:</p>\n<p><img src=\"/img/SRI-K8S-T3.6.png\" alt=\"SRI-K8S-T3.6.png\"></p>\n<p><strong>¬øQu√© aparece en la p√°gina principal de la aplicaci√≥n?. Aparece el siguiente mensaje: Waiting for database connection‚Ä¶. Por lo tanto podemos indicar varias conclusiones:</strong></p>\n<p><strong>1. Hasta ahora no estamos accediendo de forma ‚Äúnormal‚Äù a las aplicaciones. El uso de la opci√≥n port-forward es un mecanismo que realmente nos posibilita acceder a la aplicaci√≥n, pero utilizando un proxy. Deber√≠amos acceder a las aplicaciones usando una ip y un puerto determinado.</strong>\n<strong>2. Parece que tampoco hay acceso entre los Pods de los distintos despliegues. Parece que los Pods de la aplicaci√≥n guestbook no pueden acceder al Pod donde se est√° ejecutando la base de datos redis.</strong></p>\n<p><strong>En el siguiente m√≥dulo estudiaremos los recursos que nos ofrece la API de Kubernetes para permitirnos el acceso a las aplicaciones desde el exterior, y para que los distintos Pods de los despliegues puedan acceder entre ellos.</strong></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-12T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-k8s-ii./",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-k8s-ii./",
      "title": "Ejercicios de K8s II.",
      "content_html": "<p><strong>Como indicamos en el contenido de este m√≥dulo, no se va a trabajar directamente con los Pods (realmente tampoco vamos a trabajar directamente con los ReplicaSet, en el siguiente m√≥dulo explicaremos los Deployments que ser√°n el recurso con el que trabajaremos). En este ejercicio vamos a crear un ReplicaSet que va a controlar un conjunto de Pods. Para ello, realiza los siguientes pasos:</strong></p>\n<h3 id=\"crea-un-fichero-yaml-con-la-descripci%C3%B3n-del-recurso-replicaset%2C-teniendo-en-cuenta-los-siguientes-aspectos%3A\" tabindex=\"-1\">Crea un fichero yaml con la descripci√≥n del recurso ReplicaSet, teniendo en cuenta los siguientes aspectos:</h3>\n<ul>\n<li>\n<h4 id=\"indica-nombres-distintos-para-el-replicaset-y-para-el-contenedor-de-los-pods-que-va-a-controlar.\" tabindex=\"-1\">Indica nombres distintos para el ReplicaSet y para el contenedor de los Pods que va a controlar.</h4>\n</li>\n<li>\n<h4 id=\"el-replicaset-va-a-crear-3-r%C3%A9plicas.\" tabindex=\"-1\">El ReplicaSet va a crear 3 r√©plicas.</h4>\n</li>\n<li>\n<h4 id=\"la-imagen-que-debes-desplegar-es-iesgn%2Ftest_web%3Alatest.\" tabindex=\"-1\">La imagen que debes desplegar es iesgn/test_web:latest.</h4>\n</li>\n<li>\n<h4 id=\"indica-de-manera-adecuada-una-etiqueta-en-la-especificaci%C3%B3n-del-pod-que-vas-a-definir-que-coincida-con-el-selector-del-replicaset.\" tabindex=\"-1\">Indica de manera adecuada una etiqueta en la especificaci√≥n del Pod que vas a definir que coincida con el selector del ReplicaSet.</h4>\n</li>\n</ul>\n<p>El fichero es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: apps/v1<br>kind: ReplicaSet<br>metadata:<br>  name: replicaset-t2   <br>  labels:<br>    service: web<br>spec:<br>  replicas: 3<br>  selector:<br>    matchLabels:<br>      app: nginx<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx<br>    spec:<br>      containers:<br>        - image: iesgn/test_web:latest<br>          name: contenedor-t2   </code></pre>\n<h3 id=\"crea-el-replicaset.\" tabindex=\"-1\">Crea el ReplicaSet.</h3>\n<p>Usamos el siguiente comando para crear el ReplicaSet:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl apply -f pod-t2.yaml<br>replicaset.apps/replicaset-t2 created</code></pre>\n<h3 id=\"comprueba-que-se-ha-creado-el-replicaset-y-los-3-pods.\" tabindex=\"-1\">Comprueba que se ha creado el ReplicaSet y los 3 Pods.</h3>\n<p>El comando para ver los pods es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get rs<br>NAME            DESIRED   CURRENT   READY   AGE<br>replicaset-t2   3         3         3       4m2s<br>alemd@debian:~/minikube$ kubectl get pods<br>NAME                  READY   STATUS    RESTARTS   AGE<br>replicaset-t2-56w4m   1/1     Running   0          116s<br>replicaset-t2-9jnsp   1/1     Running   0          116s<br>replicaset-t2-mbhkx   1/1     Running   0          116s<br></code></pre>\n<h3 id=\"obt%C3%A9n-informaci%C3%B3n-detallada-del-replicaset-creado.\" tabindex=\"-1\">Obt√©n informaci√≥n detallada del ReplicaSet creado.</h3>\n<p>Usamos el siguiente comando para ver informaci√≥n detallada del ReplicaSet:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl describe rs replicaset-t2<br>Name:         replicaset-t2<br>Namespace:    default<br>Selector:     app=nginx<br>Labels:       service=web<br>Annotations:  &lt;none><br>Replicas:     3 current / 3 desired<br>Pods Status:  3 Running / 0 Waiting / 0 Succeeded / 0 Failed<br>Pod Template:<br>  Labels:  app=nginx<br>  Containers:<br>   contenedor-t2:<br>    Image:        iesgn/test_web:latest<br>    Port:         &lt;none><br>    Host Port:    &lt;none><br>    Environment:  &lt;none><br>    Mounts:       &lt;none><br>  Volumes:        &lt;none><br>Events:<br>  Type    Reason            Age    From                   Message<br>  ----    ------            ----   ----                   -------<br>  Normal  SuccessfulCreate  4m49s  replicaset-controller  Created pod: replicaset-t2-9jnsp<br>  Normal  SuccessfulCreate  4m49s  replicaset-controller  Created pod: replicaset-t2-56w4m<br>  Normal  SuccessfulCreate  4m49s  replicaset-controller  Created pod: replicaset-t2-mbhkx</code></pre>\n<h3 id=\"vamos-a-probar-la-tolerancia-a-fallos%3A-elimina-uno-de-los-3-pods%2C-y-comprueba-que-inmediatamente-se-ha-vuelto-a-crear-un-nuevo-pod.\" tabindex=\"-1\">Vamos a probar la tolerancia a fallos: Elimina uno de los 3 Pods, y comprueba que inmediatamente se ha vuelto a crear un nuevo Pod.</h3>\n<p>Borramos un pod y acto seguido lo mostramos y veremos que se ha creado otro autom√°ticamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl delete pod replicaset-t2-56w4m<br>pod \"replicaset-t2-56w4m\" deleted<br>alemd@debian:~/minikube$ kubectl get pods<br>NAME                  READY   STATUS    RESTARTS   AGE<br>replicaset-t2-9jnsp   1/1     Running   0          5m38s<br>replicaset-t2-mbhkx   1/1     Running   0          5m38s<br>replicaset-t2-zt5dx   1/1     Running   0          10s</code></pre>\n<h3 id=\"vamos-a-comprobar-la-escalabilidad%3A-escala-el-replicaset-para-tener-6-pods-de-la-aplicaci%C3%B3n.\" tabindex=\"-1\">Vamos a comprobar la escalabilidad: escala el ReplicaSet para tener 6 Pods de la aplicaci√≥n.</h3>\n<p>Cambiamos el n√∫mero de r√©plicas y mostramos los pods que tenemos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl scale rs replicaset-t2 --replicas=6<br>replicaset.apps/replicaset-t2 scaled<br>alemd@debian:~/minikube$ kubectl get pods<br>NAME                  READY   STATUS              RESTARTS   AGE<br>replicaset-t2-5fgnq   0/1     ContainerCreating   0          13s<br>replicaset-t2-8fzgx   0/1     ContainerCreating   0          13s<br>replicaset-t2-9jnsp   1/1     Running             0          7m1s<br>replicaset-t2-chxc9   0/1     ContainerCreating   0          13s<br>replicaset-t2-mbhkx   1/1     Running             0          7m1s<br>replicaset-t2-zt5dx   1/1     Running             0          93s</code></pre>\n<h3 id=\"elimina-el-replicaset-y-comprueba-que-se-han-borrado-todos-los-pods.\" tabindex=\"-1\">Elimina el ReplicaSet y comprueba que se han borrado todos los Pods.</h3>\n<p>Los eliminamos y los mostramos, como vemos tarda un poco ya que al hacer el primer get pods el estado de las r√©plicas era Terminating.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl delete rs replicaset-t2<br>replicaset.apps \"replicaset-t2\" deleted<br>alemd@debian:~/minikube$ kubectl get pods<br>NAME                  READY   STATUS        RESTARTS   AGE<br>replicaset-t2-5fgnq   1/1     Terminating   0          63s<br>replicaset-t2-8fzgx   1/1     Terminating   0          63s<br>replicaset-t2-9jnsp   1/1     Terminating   0          7m51s<br>replicaset-t2-chxc9   1/1     Terminating   0          63s<br>replicaset-t2-mbhkx   1/1     Terminating   0          7m51s<br>replicaset-t2-zt5dx   1/1     Terminating   0          2m23s<br>alemd@debian:~/minikube$ kubectl get pods<br>No resources found in default namespace.</code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-11T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/cortafuegos-i:-de-nodo-con-iptables./",
      "url": "https://reeseschultz.github.io/post/cortafuegos-i:-de-nodo-con-iptables./",
      "title": "Cortafuegos I: De nodo con iptables.",
      "content_html": "<h3 id=\"limpieza-de-las-reglas-previas.\" tabindex=\"-1\">Limpieza de las reglas previas.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -F<br>root@maquina:/home/debian# iptables -t nat -F<br>root@maquina:/home/debian# iptables -Z<br>root@maquina:/home/debian# iptables -t nat -Z</code></pre>\n<h3 id=\"vamos-a-permitir-ssh.\" tabindex=\"-1\">Vamos a permitir ssh.</h3>\n<p>C√≥mo estamos conectado a la m√°quina por ssh, vamos a permitir la conexi√≥n ssh desde la red 172.22.0.0/16, antes de cambiar las pol√≠ticas por defecto a DROP, para no perder la conexi√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A INPUT -s 172.22.0.0/16 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A OUTPUT -d 172.22.0.0/16 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<h3 id=\"pol%C3%ADtica-por-defecto.\" tabindex=\"-1\">Pol√≠tica por defecto.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -P INPUT DROP<br>root@maquina:/home/debian# iptables -P OUTPUT DROP</code></pre>\n<p>Comprobamos que el equipo no puede acceder a ning√∫n servicio ni de Internet ni de la red local, ya que la pol√≠tica lo impide.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>64 bytes from 8.8.8.8: icmp_seq=1 ttl=111 time=478 ms<br>64 bytes from 8.8.8.8: icmp_seq=2 ttl=111 time=586 ms<br>64 bytes from 8.8.8.8: icmp_seq=3 ttl=111 time=463 ms<br>^C<br>--- 8.8.8.8 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2003ms<br>rtt min/avg/max/mdev = 463.406/509.111/586.265/54.865 ms<br>root@maquina:/home/debian# iptables -P INPUT DROP<br>root@maquina:/home/debian# iptables -P OUTPUT DROP<br>root@maquina:/home/debian# ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>^C<br>--- 8.8.8.8 ping statistics ---<br>3 packets transmitted, 0 received, 100% packet loss, time 2033ms</code></pre>\n<h3 id=\"permitimos-tr%C3%A1fico-para-la-interfaz-loopback.\" tabindex=\"-1\">Permitimos tr√°fico para la interfaz loopback.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A INPUT -i lo -p icmp -j ACCEPT<br>root@maquina:/home/debian# iptables -A OUTPUT -o lo -p icmp -j ACCEPT</code></pre>\n<h3 id=\"peticiones-y-respuestas-protocolo-icmp.\" tabindex=\"-1\">Peticiones y respuestas protocolo ICMP.</h3>\n<p>Compruebo que no funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>^C<br>--- 8.8.8.8 ping statistics ---<br>11 packets transmitted, 0 received, 100% packet loss, time 10226ms</code></pre>\n<p>A√±ado las reglas:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A INPUT -i ens3 -p icmp --icmp-type echo-reply -j ACCEPT<br>root@maquina:/home/debian# iptables -A OUTPUT -o ens3 -p icmp --icmp-type echo-request -j ACCEPT</code></pre>\n<p>Comprobamos su funcionamiento haciendo ping a una IP p√∫blica:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# ping 8.8.8.8<br>PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.<br>64 bytes from 8.8.8.8: icmp_seq=2 ttl=111 time=312 ms<br>64 bytes from 8.8.8.8: icmp_seq=3 ttl=111 time=486 ms<br>64 bytes from 8.8.8.8: icmp_seq=5 ttl=111 time=302 ms<br>64 bytes from 8.8.8.8: icmp_seq=6 ttl=111 time=594 ms<br>^C<br>--- 8.8.8.8 ping statistics ---<br>6 packets transmitted, 4 received, 33.3333% packet loss, time 5018ms<br>rtt min/avg/max/mdev = 302.468/423.514/594.125/122.526 ms</code></pre>\n<h3 id=\"consultas-y-respuestas-dns.\" tabindex=\"-1\">Consultas y respuestas DNS.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A OUTPUT -o ens3 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A INPUT -i ens3 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Comprobamos su funcionamiento con una consulta DNS:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# dig @8.8.8.8 www.josedomingo.org<br><br>; &lt;&lt;>> DiG 9.16.37-Debian &lt;&lt;>> @8.8.8.8 www.josedomingo.org<br>; (1 server found)<br>;; global options: +cmd<br>;; Got answer:<br>;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 17100<br>;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 1<br><br>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 512<br>;; QUESTION SECTION:<br>;www.josedomingo.org.\t\tIN\tA<br><br>;; ANSWER SECTION:<br>www.josedomingo.org.\t900\tIN\tCNAME\tendor.josedomingo.org.<br>endor.josedomingo.org.\t900\tIN\tA\t37.187.119.60<br><br>;; Query time: 304 msec<br>;; SERVER: 8.8.8.8#53(8.8.8.8)<br>;; WHEN: Tue Feb 14 11:51:49 UTC 2023<br>;; MSG SIZE  rcvd: 84</code></pre>\n<h3 id=\"tr%C3%A1fico-https.\" tabindex=\"-1\">Tr√°fico https.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A OUTPUT -o ens3 -p tcp --dport 443 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A INPUT -i ens3 -p tcp --sport 443 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<h3 id=\"tr%C3%A1fico-http%2Fhttps.\" tabindex=\"-1\">Tr√°fico http/https.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A OUTPUT -o ens3 -p tcp -m multiport --dports 80,443 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A INPUT -i ens3 -p tcp -m multiport --sports 80,443 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<h3 id=\"permitimos-el-acceso-a-nuestro-servidor-web.\" tabindex=\"-1\">Permitimos el acceso a nuestro servidor web.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A INPUT -i ens3 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A OUTPUT -o ens3 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<h3 id=\"ejercicios.\" tabindex=\"-1\">Ejercicios.</h3>\n<h4 id=\"1.-permite-poder-hacer-conexiones-ssh-al-exterior.\" tabindex=\"-1\">1. Permite poder hacer conexiones ssh al exterior.</h4>\n<p>A√±adimos reglas para permitir ssh al exterior:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A INPUT -i ens3 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A OUTPUT -o ens3 -p tcp --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT<br></code></pre>\n<p>Probamos que funciona el ssh</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# ssh alemd@172.22.0.161<br>The authenticity of host '172.22.0.161 (172.22.0.161)' can't be established.<br>ECDSA key fingerprint is SHA256:P4VynMzXNSUoRSzuUrFgWShiT4hYwT/y6DqQ7Sf/ujs.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '172.22.0.161' (ECDSA) to the list of known hosts.<br>alemd@172.22.0.161's password: <br>Linux debian 5.19.0-0.deb11.2-amd64 #1 SMP PREEMPT_DYNAMIC Debian 5.19.11-1~bpo11+1 (2022-10-03) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>You have new mail.<br>alemd@debian:~$ </code></pre>\n<h4 id=\"2.-deniega-el-acceso-a-tu-servidor-web-desde-una-ip-concreta.\" tabindex=\"-1\">2. Deniega el acceso a tu servidor web desde una ip concreta.</h4>\n<p>Instalamos apache y hacemos una web de prueba. Muestro las reglas para denegar el acceso a alfa que es la IP 172.22.200.13</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -I INPUT 4 ! -s 172.22.200.13 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -I OUTPUT 4 ! -d 172.22.200.13 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Desde mi m√°quina, hago un curl.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ curl 172.22.200.42<br>&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"><br>&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"><br>  &lt;body><br>   &lt;h1>PRACTICA FIREWALL&lt;/p><br>  &lt;/body><br>&lt;/html></code></pre>\n<p>Desde alfa hago un curl.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ curl 172.22.200.42<br>curl: (28) Failed to connect to 172.22.200.42 port 80: Connection timed out</code></pre>\n<h4 id=\"3.-permite-hacer-consultas-dns-s%C3%B3lo-al-servidor-192.168.202.2.-comprueba-que-no-puedes-hacer-un-dig-%401.1.1.1.\" tabindex=\"-1\">3. Permite hacer consultas DNS s√≥lo al servidor 192.168.202.2. Comprueba que no puedes hacer un dig @1.1.1.1.</h4>\n<p>Las reglas introducidas son las siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -I INPUT 6 -s 192.168.202.2/32 -p udp --sport 53 -m state --state ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -I OUTPUT 6 -d 192.168.202.2/32 -p udp --dport 53 -m state --state NEW,ESTABLISHED -j ACCEPT</code></pre>\n<p>Hago una consulta al servidor 192.168.202.2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# dig @192.168.202.2 www.josedomingo.org<br><br>; &lt;&lt;>> DiG 9.16.37-Debian &lt;&lt;>> @192.168.202.2 www.josedomingo.org<br>; (1 server found)<br>;; global options: +cmd<br>;; Got answer:<br>;; ->>HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 40487<br>;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 5, ADDITIONAL: 6<br><br>;; OPT PSEUDOSECTION:<br>; EDNS: version: 0, flags:; udp: 4096<br>; COOKIE: 456870443b553f07e841ab7e63ed310c806bb11f806a708b (good)<br>;; QUESTION SECTION:<br>;www.josedomingo.org.\t\tIN\tA<br><br>;; ANSWER SECTION:<br>www.josedomingo.org.\t900\tIN\tCNAME\tendor.josedomingo.org.<br>endor.josedomingo.org.\t900\tIN\tA\t37.187.119.60<br><br>;; AUTHORITY SECTION:<br>josedomingo.org.\t3600\tIN\tNS\tns1.cdmon.net.<br>josedomingo.org.\t3600\tIN\tNS\tns2.cdmon.net.<br>josedomingo.org.\t3600\tIN\tNS\tns5.cdmondns-01.com.<br>josedomingo.org.\t3600\tIN\tNS\tns4.cdmondns-01.org.<br>josedomingo.org.\t3600\tIN\tNS\tns3.cdmon.net.<br><br>;; ADDITIONAL SECTION:<br>ns1.cdmon.net.\t\t67034\tIN\tA\t35.189.106.232<br>ns2.cdmon.net.\t\t67034\tIN\tA\t35.195.57.29<br>ns3.cdmon.net.\t\t67034\tIN\tA\t35.157.47.125<br>ns4.cdmondns-01.org.\t3600\tIN\tA\t52.58.66.183<br>ns5.cdmondns-01.com.\t67034\tIN\tA\t52.59.146.62<br><br>;; Query time: 260 msec<br>;; SERVER: 192.168.202.2#53(192.168.202.2)<br>;; WHEN: Wed Feb 15 19:22:52 UTC 2023<br>;; MSG SIZE  rcvd: 318</code></pre>\n<p>Hago una consulta a trav√©s del servidor 1.1.1.1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# dig @1.1.1.1 www.josedomingo.org<br><br>; &lt;&lt;>> DiG 9.16.37-Debian &lt;&lt;>> @1.1.1.1 www.josedomingo.org<br>; (1 server found)<br>;; global options: +cmd<br>;; connection timed out; no servers could be reached</code></pre>\n<h4 id=\"4.-no-permitir-el-acceso-al-servidor-web-de-www.josedomingo.org-(tienes-que-utilizar-la-ip).-%C2%BFpuedes-acceder-a-fp.josedomingo.org%3F\" tabindex=\"-1\">4. No permitir el acceso al servidor web de <a href=\"http://www.josedomingo.org\">www.josedomingo.org</a> (Tienes que utilizar la ip). ¬øPuedes acceder a <a href=\"http://fp.josedomingo.org\">fp.josedomingo.org</a>?</h4>\n<p>Las reglas usadas son las siguientes.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -I OUTPUT 8 ! -d 37.187.119.60/32 -p tcp --dport 80 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -I INPUT 8 ! -s 37.187.119.60/32 -p tcp --sport 80 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>Realizo un curl a <a href=\"http://www.josedomingo.org\">www.josedomingo.org</a></p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# curl www.josedomingo.org<br>curl: (28) Failed to connect to www.josedomingo.org port 80: Connection timed out</code></pre>\n<p>Realizo un curl a <a href=\"http://fp.josedomingo.org\">fp.josedomingo.org</a>.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# curl fp.josedomingo.org<br>curl: (28) Failed to connect to fp.josedomingo.org port 80: Connection timed out</code></pre>\n<p>Como vemos a <a href=\"http://fp.josedomingo.org\">fp.josedomingo.org</a> no se puede acceder ya que tiene la misma ip que <a href=\"http://www.josedomingo.org\">www.josedomingo.org</a>.</p>\n<p>Si hago un curl a otra ip si funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# curl alejandro-montes.es<br>&lt;!DOCTYPE html><br>&lt;html><br>&lt;head><br>&lt;title>Welcome to nginx!&lt;/title><br>&lt;style><br>    body {<br>        width: 35em;<br>        margin: 0 auto;<br>        font-family: Tahoma, Verdana, Arial, sans-serif;<br>    }<br>&lt;/style><br>&lt;/head><br>&lt;body><br>&lt;h1>Welcome to nginx!&lt;/h1><br>&lt;p>If you see this page, the nginx web server is successfully installed and<br>working. Further configuration is required.&lt;/p><br><br>&lt;p>For online documentation and support please refer to<br>&lt;a href=\"http://nginx.org/\">nginx.org&lt;/a>.&lt;br/><br>Commercial support is available at<br>&lt;a href=\"http://nginx.com/\">nginx.com&lt;/a>.&lt;/p><br><br>&lt;p>&lt;em>Thank you for using nginx.&lt;/em>&lt;/p><br>&lt;/body><br>&lt;/html></code></pre>\n<h4 id=\"5.-permite-mandar-un-correo-usando-nuestro-servidor-de-correo%3A-babuino-smtp.-para-probarlo-ejecuta-un-telnet-bubuino-smtp.gonzalonazareno.org-25.\" tabindex=\"-1\">5. Permite mandar un correo usando nuestro servidor de correo: babuino-smtp. Para probarlo ejecuta un telnet <a href=\"http://bubuino-smtp.gonzalonazareno.org\">bubuino-smtp.gonzalonazareno.org</a> 25.</h4>\n<p>Las reglas utilizadas son las siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A OUTPUT -d 192.168.203.3/32 -p tcp --dport 25 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A INPUT -s 192.168.203.3/32 -p tcp --sport 25 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>La ip 192.168.203.3 no se encuentra disponible:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@maquina:~$ ping babuino-smtp.gonzalonazareno.org<br>PING babuino-smtp.gonzalonazareno.org (192.168.203.3) 56(84) bytes of data.<br>^C<br>--- babuino-smtp.gonzalonazareno.org ping statistics ---<br>5 packets transmitted, 0 received, 100% packet loss, time 4104ms<br></code></pre>\n<h4 id=\"6.-instala-un-servidor-mariadb%2C-y-permite-los-accesos-desde-la-ip-de-tu-cliente.-comprueba-que-desde-otro-cliente-no-se-puede-acceder.\" tabindex=\"-1\">6. Instala un servidor mariadb, y permite los accesos desde la ip de tu cliente. Comprueba que desde otro cliente no se puede acceder.</h4>\n<p>Las reglas usadas son las siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@maquina:/home/debian# iptables -A INPUT -s 172.22.6.172/16 -p tcp --dport 3306 -m state --state NEW,ESTABLISHED -j ACCEPT<br>root@maquina:/home/debian# iptables -A OUTPUT -d 172.22.6.172/16 -p tcp --sport 3306 -m state --state ESTABLISHED -j ACCEPT</code></pre>\n<p>He creado un servidor mariadb habilitando el acceso remoto. Desde un cliente me conecto al usuario FIREWALL.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ mysql -h 172.22.200.42 -u FIREWALL testing -p<br>Enter password: <br>Welcome to the MariaDB monitor.  Commands end with ; or \\g.<br>Your MariaDB connection id is 34<br>Server version: 10.5.18-MariaDB-0+deb11u1 Debian 11<br><br>Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.<br><br>Type 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.<br><br>MariaDB [testing]> </code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-11T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-k8s./",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-k8s./",
      "title": "Ejercicios de K8s.",
      "content_html": "<p><strong>Vamos a crear nuestro primer Pod, y para ellos vamos a desplegar una imagen que nos ofrece un servidor web con una p√°gina est√°tica. Para ello realiza los siguientes pasos:</strong></p>\n<h3 id=\"crea-un-fichero-yaml-con-la-descripci%C3%B3n-del-recurso-pod%2C-teniendo-en-cuenta-los-siguientes-aspectos%3A\" tabindex=\"-1\">Crea un fichero yaml con la descripci√≥n del recurso Pod, teniendo en cuenta los siguientes aspectos:</h3>\n<ul>\n<li>\n<h4 id=\"indica-nombres-distintos-para-el-pod-y-para-el-contenedor.\" tabindex=\"-1\">Indica nombres distintos para el Pod y para el contenedor.</h4>\n</li>\n<li>\n<h4 id=\"la-imagen-que-debes-desplegar-es-iesgn%2Ftest_web%3Alatest.\" tabindex=\"-1\">La imagen que debes desplegar es iesgn/test_web:latest.</h4>\n</li>\n<li>\n<h4 id=\"indica-una-etiqueta-en-la-descripci%C3%B3n-del-pod.\" tabindex=\"-1\">Indica una etiqueta en la descripci√≥n del Pod.</h4>\n</li>\n</ul>\n<p>El contenido del fichero es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">apiVersion: v1<br>kind: Pod<br>metadata:<br> name: pod-t1<br> labels:<br>   app: nginx<br>   service: web<br>spec:<br> containers:<br>   - image: iesgn/test_web:latest<br>     name: contenedor-t1<br>     imagePullPolicy: Always<br></code></pre>\n<h3 id=\"crea-el-pod.\" tabindex=\"-1\">Crea el Pod.</h3>\n<p>Para crear el pod usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl create -f pod-t1.yaml<br>pod/pod-t1 created</code></pre>\n<h3 id=\"comprueba-que-el-pod-se-ha-creado-y-est%C3%A1-corriendo.\" tabindex=\"-1\">Comprueba que el Pod se ha creado y est√° corriendo.</h3>\n<p>Para comprobar que el pod est√° creado usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get pods<br>NAME     READY   STATUS             RESTARTS   AGE<br>pod-t1   0/1     ImagePullBackOff   0          2m11s</code></pre>\n<h3 id=\"obt%C3%A9n-informaci%C3%B3n-detallada-del-pod-creado.\" tabindex=\"-1\">Obt√©n informaci√≥n detallada del Pod creado.</h3>\n<p>Con el siguiente comando vemos informaci√≥n detallada del pod:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl describe pod pod-t1<br>Name:             pod-t1<br>Namespace:        default<br>Priority:         0<br>Service Account:  default<br>Node:             minikube/192.168.39.178<br>Start Time:       Fri, 10 Feb 2023 08:47:38 +0100<br>Labels:           app=nginx<br>                  service=web<br>Annotations:      &lt;none><br>Status:           Running<br>IP:               10.244.0.4<br>IPs:<br>  IP:  10.244.0.4<br>Containers:<br>  contenedor-t1:<br>    Container ID:   docker://0dca5570cfa08f80d86a65045f964124dc1c994a7be10885e75a5015dee87904<br>    Image:          iesgn/test_web:latest</code></pre>\n<h3 id=\"accede-de-forma-interactiva-al-pod-y-comprueba-los-ficheros-que-est%C3%A1n-en-el-documentroot-(usr%2Flocal%2Fapache2%2Fhtdocs%2F).\" tabindex=\"-1\">Accede de forma interactiva al Pod y comprueba los ficheros que est√°n en el DocumentRoot (usr/local/apache2/htdocs/).</h3>\n<p>Los comandos ejecutados son los siguientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl exec -it pod-t1 -- /bin/bash<br>root@pod-t1:/usr/local/apache2# ls<br>bin  build  cgi-bin  conf  error  htdocs  icons  include  logs\tmodules<br>root@pod-t1:/usr/local/apache2# cd htdocs/<br>root@pod-t1:/usr/local/apache2/htdocs# ls<br>index.html<br></code></pre>\n<h3 id=\"crea-una-redirecci%C3%B3n-con-kubectl-port-forward-utilizando-el-puerto-de-localhost-8888-y-sabiendo-que-el-pod-ofrece-el-servicio-en-el-puerto-80.-accede-a-la-aplicaci%C3%B3n-desde-un-navegador.\" tabindex=\"-1\">Crea una redirecci√≥n con kubectl port-forward utilizando el puerto de localhost 8888 y sabiendo que el Pod ofrece el servicio en el puerto 80. Accede a la aplicaci√≥n desde un navegador.</h3>\n<p>Muestro el comando usado para redireccionar el puerto:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl port-forward pod-t1 8888:80<br>Forwarding from 127.0.0.1:8888 -> 80<br>Forwarding from [::1]:8888 -> 80<br>Handling connection for 8888</code></pre>\n<p>Muestro una captura accediendo por el puerto 8888.</p>\n<p><img src=\"/img/SRI-T8-T1.1.png\" alt=\"SRI-T8-T1.1.png\"></p>\n<h3 id=\"muestra-los-logs-del-pod-y-comprueba-que-se-visualizan-los-logs-de-los-accesos-que-hemos-realizado-en-el-punto-anterior.\" tabindex=\"-1\">Muestra los logs del Pod y comprueba que se visualizan los logs de los accesos que hemos realizado en el punto anterior.</h3>\n<p>El comando para mostrar los logs el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl logs pod-t1 <br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.244.0.4. Set the 'ServerName' directive globally to suppress this message<br>AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.244.0.4. Set the 'ServerName' directive globally to suppress this message<br>[Fri Feb 10 07:50:08.134095 2023] [mpm_event:notice] [pid 1:tid 140490452923520] AH00489: Apache/2.4.46 (Unix) configured -- resuming normal operations<br>[Fri Feb 10 07:50:08.135109 2023] [core:notice] [pid 1:tid 140490452923520] AH00094: Command line: 'httpd -D FOREGROUND'<br>127.0.0.1 - - [10/Feb/2023:07:55:18 +0000] \"GET / HTTP/1.1\" 200 2884<br>127.0.0.1 - - [10/Feb/2023:07:55:19 +0000] \"GET /favicon.ico HTTP/1.1\" 404 196<br>127.0.0.1 - - [10/Feb/2023:07:57:24 +0000] \"GET / HTTP/1.1\" 200 2884<br>127.0.0.1 - - [10/Feb/2023:07:57:24 +0000] \"GET /favicon.ico HTTP/1.1\" 404 196</code></pre>\n<h3 id=\"elimina-el-pod%2C-y-comprueba-que-ha-sido-eliminado.\" tabindex=\"-1\">Elimina el Pod, y comprueba que ha sido eliminado.</h3>\n<p>La instrucci√≥n usada para eliminar el pod es:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl delete pod pod-t1<br>pod \"pod-t1\" deleted</code></pre>\n<p>Muestro los pods para verificar que se ha borrado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/minikube$ kubectl get pod<br>No resources found in default namespace.<br></code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-10T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-con-docker-iii./",
      "url": "https://reeseschultz.github.io/post/ejercicios-con-docker-iii./",
      "title": "Ejercicios con Docker III.",
      "content_html": "<h1 id=\"taller-3%3A-creaci%C3%B3n-de-im%C3%A1genes-docker.\" tabindex=\"-1\">Taller 3: Creaci√≥n de im√°genes Docker.</h1>\n<h2 id=\"creaci%C3%B3n-de-una-imagen-a-partir-de-un-dockerfile.\" tabindex=\"-1\">Creaci√≥n de una imagen a partir de un Dockerfile.</h2>\n<p>Lo primero que haremos ser√° una cuenta en Docker Hub.</p>\n<h3 id=\"crea-una-p%C3%A1gina-web-est%C3%A1tica-(por-ejemplo-busca-una-plantilla-html5).-o-simplemente-crea-un-index.html.\" tabindex=\"-1\">Crea una p√°gina web est√°tica (por ejemplo busca una plantilla HTML5). O simplemente crea un index.html.</h3>\n<p>Yo usar√© una p√°gina web est√°tica que cre√© el curso anterior. Para ello mediante scp pasar√© la p√°gina est√°tica a la m√°quina donde uso docker.</p>\n<h3 id=\"crea-un-fichero-dockerfile-que-permita-crear-una-imagen-con-un-servidor-web-sirviendo-la-p%C3%A1gina.-puedes-usar-una-imagen-base-debian-o-ubuntu%2C-o-una-imagen-que-tenga-ya-un-servicio-web.\" tabindex=\"-1\">Crea un fichero Dockerfile que permita crear una imagen con un servidor web sirviendo la p√°gina. Puedes usar una imagen base debian o ubuntu, o una imagen que tenga ya un servicio web.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ nano Dockerfile</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">FROM debian:latest<br>MAINTAINER alemd01 \"aaleemd11@gmail.com\"<br>RUN apt update &amp;&amp; apt install -y apache2 &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<br>ADD miresa /var/www/html/<br>EXPOSE 80<br>CMD [\"/usr/sbin/apache2ctl\", \"-D\", \"FOREGROUND\"]</code></pre>\n<h3 id=\"ejecuta-el-comando-docker-que-crea-la-nueva-imagen.-la-imagen-se-debe-llamar-%2Fmi_servidor_web%3Av1.\" tabindex=\"-1\">Ejecuta el comando docker que crea la nueva imagen. La imagen se debe llamar /mi_servidor_web:v1.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker build -t alemd01/mi_servidor_web:v1 .<br>Sending build context to Docker daemon  3.989MB<br>Step 1/6 : FROM debian:latest<br>latest: Pulling from library/debian<br>699c8a97647f: Pull complete <br>Digest: sha256:92277f7108c432febe41beffd367dbb6dac60b9fbfe517c77208e6457eafe22b<br>Status: Downloaded newer image for debian:latest<br> ---> 20473158e8b3<br>Step 2/6 : MAINTAINER alemd01 \"aaleemd11@gmail.com\"<br> ---> Running in 1bfd4864f4ba<br>Removing intermediate container 1bfd4864f4ba<br> ---> ea9811fb5ce2<br>Step 3/6 : RUN apt update &amp;&amp; apt install -y apache2 &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<br> ---> Running in 1f3515239860<br></code></pre>\n<p>Ejecuto el contenedor para probarlo.</p>\n<p><img src=\"/img/IAW-T6-T3.1.png\" alt=\"IAW-T6-T3.1.png\"></p>\n<h3 id=\"con%C3%A9ctate-a-docker-hub-y-sube-la-imagen-que-acabas-de-crear.\" tabindex=\"-1\">Con√©ctate a Docker Hub y sube la imagen que acabas de crear.</h3>\n<p>Para conectarnos a Docker Hub, ejecutamos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker login -u alemd01<br>Password: <br>WARNING! Your password will be stored unencrypted in /home/usuario/.docker/config.json.<br>Configure a credential helper to remove this warning. See<br>https://docs.docker.com/engine/reference/commandline/login/#credentials-store<br><br>Login Succeeded</code></pre>\n<p>Como contrase√±a podemos usar un <code>access token</code>, lo podemos obtener yendo a los ajustes de nuestro perfil de docker hub y en el apartado de <code>Security</code> nos aparecer√° para crear un nuevo token de acceso.</p>\n<p>Ahora subiremos nuestra imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker push alemd01/mi_servidor_web:v1<br>The push refers to repository [docker.io/alemd01/mi_servidor_web]<br>fb9bbbdf2bba: Pushed <br>de157d4f9d2d: Pushed <br>8fcfc59d80ac: Mounted from library/debian <br>v1: digest: sha256:1f518a3a8db31e1cf556ddeeec920e35545cf5d117dbb58f0462bfb1834a5850 size: 952<br></code></pre>\n<p>Como podemos ver se ha subido correctamente:</p>\n<p><img src=\"/img/IAW-T6-T3.2.png\" alt=\"IAW-T6-T3.2.png\"></p>\n<h3 id=\"descarga-la-imagen-en-otro-ordenador-donde-tengas-docker-instalado%2C-y-crea-un-contenedor-a-partir-de-ella.-(si-no-tienes-otro-ordenador-con-docker-instalado%2C-borra-la-imagen-en-tu-ordenador-y-b%C3%A1jala-de-docker-hub).\" tabindex=\"-1\">Descarga la imagen en otro ordenador donde tengas docker instalado, y crea un contenedor a partir de ella. (Si no tienes otro ordenador con docker instalado, borra la imagen en tu ordenador y b√°jala de Docker Hub).</h3>\n<p>Como no tengo otra m√°quina con docker, borrar√© la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker rm -f mi_servidor_web <br>mi_servidor_web<br>usuario@debian:~/docker/taller3$ docker rmi alemd01/mi_servidor_web:v1<br>Untagged: alemd01/mi_servidor_web:v1<br>Untagged: alemd01/mi_servidor_web@sha256:1f518a3a8db31e1cf556ddeeec920e35545cf5d117dbb58f0462bfb1834a5850<br>Deleted: sha256:b1421e4328a124a2d5d79cbcdaee041a6a5cc540281f3dee34a4a4a2bb9b8c5b<br>Deleted: sha256:f41cc79ea6eb3e88d31d8e6ea80c3a66847423f757f828801f91fc828105496f<br>Deleted: sha256:14fedc712e4013f7b8fbac9a90497f599f92ad737dd9c9dc348c3206b46c8356<br>Deleted: sha256:7a41ce465264e588eb8efe17edccd0f1589b95c8f609f604da9da717f3ee5923<br>Deleted: sha256:fc066f3915bee0e6cdece071401e09403d26848e875cf5beef9d1f6f8faf9a91<br>Deleted: sha256:a1cbbce8a51991a52ea414bf88a33fa04adf85d34b64cfcd9a93d6b08727a291<br>Deleted: sha256:ea9811fb5ce2d965671ba62b2eeebfdc3268a4f71f01a16ff5eb7ced271d02f2<br></code></pre>\n<p>Ahora vuelvo a descargar la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker pull alemd01/mi_servidor_web:v1<br>v1: Pulling from alemd01/mi_servidor_web<br>699c8a97647f: Already exists <br>b70b6b1f6935: Pull complete <br>6cb65f0b958b: Pull complete <br>Digest: sha256:1f518a3a8db31e1cf556ddeeec920e35545cf5d117dbb58f0462bfb1834a5850<br>Status: Downloaded newer image for alemd01/mi_servidor_web:v1<br>docker.io/alemd01/mi_servidor_web:v1<br></code></pre>\n<p>Y creamos el contenedor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker run -d -p 8080:80 --name mi_servidor_web alemd01/mi_servidor_web:v1<br>c372915cce45d36f14c433e5ef4f877bc1efc59b87e3bdc788aee2e79b5a71c9<br></code></pre>\n<h3 id=\"vamos-a-hacer-una-modificaci%C3%B3n-de-la-p%C3%A1gina-web%3A-haz-una-modificaci%C3%B3n-al-fichero-index.html.\" tabindex=\"-1\">Vamos a hacer una modificaci√≥n de la p√°gina web: haz una modificaci√≥n al fichero index.html.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ nano miresa/index.html </code></pre>\n<p>Esta es la l√≠nea que he editado:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>heading<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Utrera en el siglo XX. Docker Taller 3.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span></code></pre>\n<h3 id=\"vuelve-a-crear-una-nueva-imagen%2C-en-esta-caso-pon-ta-etiqueta-v2.-s%C3%BAbela-a-docker-hub.\" tabindex=\"-1\">Vuelve a crear una nueva imagen, en esta caso pon ta etiqueta v2. S√∫bela a Docker Hub.</h3>\n<p>Construyo la nueva imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker build -t alemd01/mi_servidor_web:v2 .<br>Sending build context to Docker daemon   3.99MB<br>Step 1/6 : FROM debian:latest<br> ---> 20473158e8b3<br>Step 2/6 : MAINTAINER alemd01 \"aaleemd11@gmail.com\"<br> ---> Running in 9c6ce0fe2cd4<br>Removing intermediate container 9c6ce0fe2cd4<br> ---> c5a25059498d<br>Step 3/6 : RUN apt update &amp;&amp; apt install -y apache2 &amp;&amp; apt clean &amp;&amp; rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*<br> ---> Running in 5cc2d230d04e</code></pre>\n<p>La subo a Docker Hub:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker push alemd01/mi_servidor_web:v2<br>The push refers to repository [docker.io/alemd01/mi_servidor_web]<br>c93977927766: Pushed <br>2e2c716f2c7f: Pushed <br>8fcfc59d80ac: Layer already exists <br>v2: digest: sha256:04c70a813837a0fbbc176a499732a7d3fa99dd36f6ed3d60bf56b5b9afbf0b1d size: 952<br></code></pre>\n<h3 id=\"por-%C3%BAltimo%2C-baja-la-nueva-imagen-en-el-ordenador-donde-est%C3%A1-corriendo-el-contenedor.-para-hacer-la-implantaci%C3%B3n-de-la-nueva-versi%C3%B3n-debes-borrar-el-contenedor-y-crear-uno-nuevo-desde-la-nueva-versi%C3%B3n-de-la-imagen.\" tabindex=\"-1\">Por √∫ltimo, baja la nueva imagen en el ordenador donde est√° corriendo el contenedor. Para hacer la implantaci√≥n de la nueva versi√≥n debes borrar el contenedor y crear uno nuevo desde la nueva versi√≥n de la imagen.</h3>\n<p>Elimino el contenedor y la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker rm -f mi_servidor_web <br>mi_servidor_web<br>usuario@debian:~/docker/taller3$ docker rmi alemd01/mi_servidor_web:v2<br>Untagged: alemd01/mi_servidor_web:v2<br>Untagged: alemd01/mi_servidor_web@sha256:04c70a813837a0fbbc176a499732a7d3fa99dd36f6ed3d60bf56b5b9afbf0b1d<br>Deleted: sha256:4c59dc832620ef19a0c7c8cfc2c8c5aab5b252ee5a95682d1dbb021c7644f8b1<br>Deleted: sha256:9009b939999f9230485edd5be57919a22a076493fb95eb53eea4dde3896f56db<br>Deleted: sha256:1b5da554f6e3376a9dd6cc76706945a46cc49ba8b1217c19b2f9a44938af005f<br>Deleted: sha256:d8e4f0fdb9ec151d0b3e8740cf63c34444e411956a3315aadd9e0075bb2b0c0f<br>Deleted: sha256:291028a34b7b79422480095d3ccef56d931a7d723e7c4c36af9cb0092ecaae4e<br>Deleted: sha256:329429045bff31241bf29767b5f37a38ec89d9430a12c8f874adc346b46534f9<br>Deleted: sha256:c5a25059498db80665ae7743cefdd116beee2b9e433aefdd12f1ecf167aedc01</code></pre>\n<p>Hacemos un pull de la imagen en Docker Hub:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker pull alemd01/mi_servidor_web:v2<br>v2: Pulling from alemd01/mi_servidor_web<br>699c8a97647f: Already exists <br>e45857a00bba: Pull complete <br>5ec4abd0fb7e: Pull complete <br>Digest: sha256:04c70a813837a0fbbc176a499732a7d3fa99dd36f6ed3d60bf56b5b9afbf0b1d<br>Status: Downloaded newer image for alemd01/mi_servidor_web:v2<br>docker.io/alemd01/mi_servidor_web:v2<br></code></pre>\n<p>Creamos el contenedor a partir de la imagen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller3$ docker run -d -p 8080:80 --name mi_servidor_web alemd01/mi_servidor_web:v2<br>41549244e7a29291ae4eb1f9ef090ec385fbf4bcb52ee9e29ecbebbd02588f09<br></code></pre>\n<p>Accedo mediante mi navegador para comprobar que funciona correctamente:</p>\n<p><img src=\"/img/IAW-T6-T3.3.png\" alt=\"IAW-T6-T3.3.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-07T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/informatica-forense./",
      "url": "https://reeseschultz.github.io/post/informatica-forense./",
      "title": "Inform√°tica forense.",
      "content_html": "<p>La inform√°tica forense es el conjunto de t√©cnicas que nos permite obtener la m√°xima informaci√≥n posible tras un incidente o delito inform√°tico.</p>\n<p>En esta pr√°ctica, realizar√°s la fase de toma de evidencias y an√°lisis de las mismas sobre una m√°quina Linux y otra Windows. Supondremos que pillamos al delincuente in fraganti y las m√°quinas se encontraban encendidas. Opcionalmente, pod√©is realizar el an√°lisis de un dispositivo Android.</p>\n<p>Sobre cada una de las m√°quinas debes realizar un volcado de memoria y otro de disco duro, tomando las medidas necesarias para certificar posteriormente la cadena de custodia.</p>\n<p>Debes tratar de obtener las siguientes informaciones:</p>\n<h3 id=\"m%C3%A1quina-windows.\" tabindex=\"-1\">M√°quina Windows.</h3>\n<p>Lo primero que haremos ser√° un volcado de memoria y un volcado de disco sobre los que trabajaremos. Para hacer un volcado de memoria en Windows 7, usar√© una herramienta llamada DumpIt y la ejecutaremos:</p>\n<p><img src=\"/img/SAD-P7.12.png\" alt=\"SAD-P7.12.png\"></p>\n<p>Pasado unos minutos nos genera la siguiente imagen:</p>\n<p><img src=\"/img/SAD-P7.13.png\" alt=\"SAD-P7.13.png\"></p>\n<p>Para analizar esta imagen, usaremos la herramienta Volatility, la instalaremos en nuestro equipo debian, para ello tendremos que instalar python and pip si no lo tenemos instalado y con pip instalaremos distorm3.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ sudo pip install distorm3<br>Collecting distorm3<br>  Downloading distorm3-3.5.2.tar.gz (138 kB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 138 kB 3.3 MB/s <br>Building wheels for collected packages: distorm3<br>  Building wheel for distorm3 (setup.py) ... done<br>  Created wheel for distorm3: filename=distorm3-3.5.2-cp39-cp39-linux_x86_64.whl size=126327 sha256=9f9b53cd375a137982810e36b7c0caf1b1f6b4f1f96e2627b211e08a4c43917e<br>  Stored in directory: /root/.cache/pip/wheels/eb/3a/b1/929df023c1328f8c1f94de335b110b1f2347aafa1a55edbf99<br>Successfully built distorm3<br>Installing collected packages: distorm3<br>Successfully installed distorm3-3.5.2<br></code></pre>\n<p>Tambi√©n necesitaremos git para copiar el repositorio de volatility.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR/SAD/volatility$ git clone https://github.com/volatilityfoundation/volatility3.git<br>Clonando en 'volatility3'...<br>remote: Enumerating objects: 30094, done.<br>remote: Counting objects: 100% (938/938), done.<br>remote: Compressing objects: 100% (463/463), done.<br>remote: Total 30094 (delta 561), reused 805 (delta 469), pack-reused 29156<br>Recibiendo objetos: 100% (30094/30094), 6.07 MiB | 6.70 MiB/s, listo.<br>Resolviendo deltas: 100% (22742/22742), listo.<br></code></pre>\n<p>Ahora me copiar√© el dump a mi m√°quina para trabajar sobre √©l.</p>\n<p><strong>Por comandos:</strong></p>\n<h4 id=\"1.-procesos-en-ejecuci%C3%B3n.\" tabindex=\"-1\">1. Procesos en ejecuci√≥n.</h4>\n<p>Usando volatility con un dumpeo de un Windows 7, listo los procesos activos a la hora de hacer el dump:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">python3 vol.py -f USUARIO-PC-20230207-201216.raw windows.pslist.PsList</code></pre>\n<p><img src=\"/img/SAD-P7.14.png\" alt=\"SAD-P7.14.png\"></p>\n<p>Ahora realizo un escaneo de los procesos:</p>\n<p><img src=\"/img/SAD-P7.15.png\" alt=\"SAD-P7.15.png\"></p>\n<p>La diferencia entre psscan y pslist es que pslist muestra todos los procesos que hay en ERPROCESS y psscan busca en memoria procesos ocultos, por eso psscan tarda bastante m√°s.</p>\n<h4 id=\"2.-servicios-en-ejecuci%C3%B3n.\" tabindex=\"-1\">2. Servicios en ejecuci√≥n.</h4>\n<p>Usando volatility y un dump de Windows 7, la sintaxis del comando es la siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">python3 vol.py -f USUARIO-PC-20230207-201216.raw windows.getservicesids.GetServiceSIDs</code></pre>\n<p><img src=\"/img/SAD-P7.16.png\" alt=\"SAD-P7.16.png\"></p>\n<h4 id=\"3.-puertos-abiertos.\" tabindex=\"-1\">3. Puertos abiertos.</h4>\n<p>El comando para ver los puertos abiertos es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">python3 vol.py -f USUARIO-PC-20230207-201216.raw windows.netscan.NetScan</code></pre>\n<p><img src=\"/img/SAD-P7.20.png\" alt=\"SAD-P7.20.png\"></p>\n<h4 id=\"4.-conexiones-establecidas-por-la-m%C3%A1quina.\" tabindex=\"-1\">4. Conexiones establecidas por la m√°quina.</h4>\n<p>Con este comando vemos las conexiones establecidas por la m√°quina:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">python3 vol.py -f USUARIO-PC-20230207-201216.raw windows.netscan.NetScan</code></pre>\n<p><img src=\"/img/SAD-P7.19.png\" alt=\"SAD-P7.19.png\"></p>\n<h4 id=\"5.-sesiones-de-usuario-establecidas-remotamente.\" tabindex=\"-1\">5. Sesiones de usuario establecidas remotamente.</h4>\n<p>El comando es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">python3 vol.py -f USUARIO-PC-20230207-201216.raw windows.sessions.Sessions</code></pre>\n<p><img src=\"/img/SAD-P7.18.png\" alt=\"SAD-P7.18.png\"></p>\n<h4 id=\"6.-ficheros-transferidos-recientemente-por-netbios.\" tabindex=\"-1\">6. Ficheros transferidos recientemente por NetBios.</h4>\n<h4 id=\"7.-contenido-de-la-cach%C3%A9-dns.\" tabindex=\"-1\">7. Contenido de la cach√© DNS.</h4>\n<h4 id=\"8.-variables-de-entorno.\" tabindex=\"-1\">8. Variables de entorno.</h4>\n<p>Para ver las variables de entorno he usado volatility y el dump de Windows 7:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"> python3 vol.py -f USUARIO-PC-20230207-201216.raw windows.envars.Envars</code></pre>\n<p><img src=\"/img/SAD-P7.17.png\" alt=\"SAD-P7.17.png\"></p>\n<p><strong>Analizando el Registro de Windows:</strong></p>\n<h4 id=\"9.-dispositivos-usb-conectados\" tabindex=\"-1\">9. Dispositivos USB conectados</h4>\n<h4 id=\"10.-redes-wifi-utilizadas-recientemente.\" tabindex=\"-1\">10. Redes wifi utilizadas recientemente.</h4>\n<h4 id=\"11.-configuraci%C3%B3n-del-firewall-de-nodo.\" tabindex=\"-1\">11. Configuraci√≥n del firewall de nodo.</h4>\n<h4 id=\"12.-programas-que-se-ejecutan-en-el-inicio.\" tabindex=\"-1\">12. Programas que se ejecutan en el Inicio.</h4>\n<h4 id=\"13.-asociaci%C3%B3n-de-extensiones-de-ficheros-y-aplicaciones.\" tabindex=\"-1\">13. Asociaci√≥n de extensiones de ficheros y aplicaciones.</h4>\n<p>En el apartado file views, desplegamos file types y by extension y nos aparecen todos los archivos ordenados por carpetas y extensi√≥n:</p>\n<p><img src=\"/img/SAD-P7.20.png\" alt=\"SAD-P7.20.png\"></p>\n<h4 id=\"14.-aplicaciones-usadas-recientemente.\" tabindex=\"-1\">14. Aplicaciones usadas recientemente.</h4>\n<p>Nos vamos al apartado de Data Artifacts y Run Programs. Como vemos en la captura el √∫ltimo programa ejecutado es el FTK imager que es para hacer la imagen del disco:</p>\n<p><img src=\"/img/SAD-P7.22.png\" alt=\"SAD-P7.22.png\"></p>\n<h4 id=\"15.-ficheros-abiertos-recientemente.\" tabindex=\"-1\">15. Ficheros abiertos recientemente.</h4>\n<p>Nuevamente en el apartado Data Artifacts, y en Recent Documents:</p>\n<p><img src=\"/img/SAD-P7.23.png\" alt=\"SAD-P7.23.png\"></p>\n<h4 id=\"16.-software-instalado.\" tabindex=\"-1\">16. Software Instalado.</h4>\n<p>Seguimos en el apartado Data Artifacts y en Installed Programs:</p>\n<p><img src=\"/img/SAD-P7.24.png\" alt=\"SAD-P7.24.png\"></p>\n<h4 id=\"17.-contrase%C3%B1as-guardadas.\" tabindex=\"-1\">17. Contrase√±as guardadas.</h4>\n<h4 id=\"18.-cuentas-de-usuario\" tabindex=\"-1\">18. Cuentas de Usuario</h4>\n<p>En este apartado, aparecen todas las cuentas de usuario del sistema y sus contrase√±as. El apartado es OS account.</p>\n<p><img src=\"/img/SAD-P7.24.png\" alt=\"SAD-P7.24.png\"></p>\n<p><strong>Con Aplicaciones de terceros:</strong></p>\n<h4 id=\"19.-historial-de-navegaci%C3%B3n-y-descargas.-cookies.\" tabindex=\"-1\">19. Historial de navegaci√≥n y descargas. Cookies.</h4>\n<ul>\n<li>‚Äì&gt; Data Artifacts --&gt; web search. Veremos las b√∫squedas realizadas en el navegador.</li>\n</ul>\n<p><img src=\"/img/SAD-P7.26.png\" alt=\"SAD-P7.26.png\"></p>\n<ul>\n<li>‚Äì&gt; Data Artifacts --&gt; web History. Aparece el historial.</li>\n</ul>\n<p><img src=\"/img/SAD-P7.27.png\" alt=\"SAD-P7.27.png\"></p>\n<ul>\n<li>‚Äì&gt; Data Artifacts --&gt; web Download. Aparecen las descargas realizadas.</li>\n</ul>\n<p><img src=\"/img/SAD-P7.28.png\" alt=\"SAD-P7.28.png\"></p>\n<ul>\n<li>‚Äì&gt; Data Artifacts --&gt; web Cookies. Aparecen las cookies guardadas en el navegador.</li>\n</ul>\n<p><img src=\"/img/SAD-P7.29.png\" alt=\"SAD-P7.29.png\"></p>\n<ul>\n<li>‚Äì&gt; Data Artifacts --&gt; web Bookmarks. Aparecen los marcadores del navegador.</li>\n</ul>\n<p><img src=\"/img/SAD-P7.30.png\" alt=\"SAD-P7.30.png\"></p>\n<h4 id=\"20.-vol%C3%BAmenes-cifrados\" tabindex=\"-1\">20. Vol√∫menes cifrados</h4>\n<p><strong>Sobre la imagen del disco:</strong></p>\n<h4 id=\"21.-archivos-con-extensi%C3%B3n-cambiada.\" tabindex=\"-1\">21. Archivos con extensi√≥n cambiada.</h4>\n<p>Para verlo vamos a la siguiente ruta --&gt; Analysis Results --&gt; Extension Mismatch Detected.</p>\n<p><img src=\"/img/SAD-P7.31.png\" alt=\"SAD-P7.31.png\"></p>\n<h4 id=\"22.-archivos-eliminados.\" tabindex=\"-1\">22. Archivos eliminados.</h4>\n<p>‚Äì&gt; Deleted Files --&gt; File System</p>\n<p><img src=\"/img/SAD-P7.32.png\" alt=\"SAD-P7.32.png\"></p>\n<h4 id=\"23.-archivos-ocultos.\" tabindex=\"-1\">23. Archivos Ocultos.</h4>\n<h4 id=\"24.-archivos-que-contienen-una-cadena-determinada.\" tabindex=\"-1\">24. Archivos que contienen una cadena determinada.</h4>\n<p>Arriba a la derecha, tenemos la opci√≥n de Keyword Search.</p>\n<p><img src=\"/img/SAD-P7.33.png\" alt=\"SAD-P7.33.png\"></p>\n<h4 id=\"25.-b%C3%BAsqueda-de-im%C3%A1genes-por-ubicaci%C3%B3n.\" tabindex=\"-1\">25. B√∫squeda de im√°genes por ubicaci√≥n.</h4>\n<p>En la barra de herramientas, usamos la opci√≥n Geolocation.</p>\n<p><img src=\"/img/SAD-P7.34.png\" alt=\"SAD-P7.34.png\"></p>\n<h4 id=\"26.-b%C3%BAsqueda-de-archivos-por-autor.\" tabindex=\"-1\">26. B√∫squeda de archivos por autor.</h4>\n<p>‚Äì&gt; Data Artifacts --&gt; Metadata.</p>\n<p><img src=\"/img/SAD-P7.35.png\" alt=\"SAD-P7.35.png\"></p>\n<h3 id=\"m%C3%A1quina-linux.\" tabindex=\"-1\">M√°quina Linux.</h3>\n<p><strong>Intenta realizar las mismas operaciones en una m√°quina Linux para aquellos apartados que tengan sentido y no se realicen de manera id√©ntica a Windows.</strong></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-07T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-con-docker-ii./",
      "url": "https://reeseschultz.github.io/post/ejercicios-con-docker-ii./",
      "title": "Ejercicios con Docker II.",
      "content_html": "<h1 id=\"taller-2%3A-escenarios-multicontenedor-en-docker\" tabindex=\"-1\">Taller 2: Escenarios multicontenedor en Docker</h1>\n<h2 id=\"despliegue-de-nextcloud.\" tabindex=\"-1\">Despliegue de Nextcloud.</h2>\n<p><strong>Vamos a desplegar la aplicaci√≥n nextcloud con una base de datos (puedes elegir mariadb o PostgreSQL) utilizando la aplicaci√≥n docker-compose. Puedes coger c√≥mo modelo el fichero docker-compose.yml el que hemos estudiado para desplegar WordPress.</strong></p>\n<h3 id=\"instala-docker-compose-en-tu-ordenador.\" tabindex=\"-1\">Instala docker-compose en tu ordenador.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller1$ sudo apt install docker-compose<br>Leyendo lista de paquetes... Hecho<br>Creando √°rbol de dependencias... Hecho<br>Leyendo la informaci√≥n de estado... Hecho<br>Se instalar√°n los siguientes paquetes adicionales:<br>  python3-cached-property python3-docker python3-dockerpty<br>  python3-docopt python3-texttable python3-websocket<br>Se instalar√°n los siguientes paquetes NUEVOS:<br>  docker-compose python3-cached-property python3-docker<br>  python3-dockerpty python3-docopt python3-texttable python3-websocket<br>0 actualizados, 7 nuevos se instalar√°n, 0 para eliminar y 31 no actualizados.<br>Se necesita descargar 301 kB de archivos.<br>Se utilizar√°n 1.647 kB de espacio de disco adicional despu√©s de esta operaci√≥n.<br>¬øDesea continuar? [S/n] s</code></pre>\n<h3 id=\"dentro-de-un-directorio-crea-un-fichero-docker-compose.yml-para-realizar-el-despliegue-de-nextcloud-con-una-base-de-datos.-recuerda-las-variables-de-entorno-y-la-persistencia-de-informaci%C3%B3n.\" tabindex=\"-1\">Dentro de un directorio crea un fichero docker-compose.yml para realizar el despliegue de nextcloud con una base de datos. Recuerda las variables de entorno y la persistencia de informaci√≥n.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker$ mkdir nextcloud<br>usuario@debian:~/docker$ cd nextcloud/<br>usuario@debian:~/docker/nextcloud$ nano docker-compose.yml</code></pre>\n<p>El contenido del fichero es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">version: '3.7'<br>services:<br>  nextcloud:<br>    image: nextcloud:latest<br>    container_name: nextcloud<br>    restart: always<br>    ports:<br>      - 8080:80<br>    volumes:<br>      - nextcloud:/var/www/html<br>    environment:<br>      - MYSQL_HOST=mariadb<br>      - MYSQL_DATABASE=nextcloud<br>      - MYSQL_USER=nextcloud<br>      - MYSQL_PASSWORD=nextcloud<br>      - MYSQL_ROOT_PASSWORD=nextcloud<br>    networks:<br>      - red-taller2<br>    depends_on:<br>      - mariadb<br>  mariadb:<br>    image: mariadb:latest<br>    container_name: mariadb<br>    restart: always<br>    volumes:<br>      - mariadb:/var/lib/mysql<br>    environment:<br>      - MYSQL_DATABASE=nextcloud<br>      - MYSQL_USER=nextcloud<br>      - MYSQL_PASSWORD=nextcloud<br>      - MYSQL_ROOT_PASSWORD=nextcloud<br>    networks:<br>      - red-taller2<br>volumes:<br>  nextcloud:<br>  mariadb:<br>networks:<br>  red-taller2:<br>    driver: bridge<br>    driver_opts:<br>      com.docker.network.driver.mtu: 1420</code></pre>\n<h3 id=\"levanta-el-escenario-con-docker-compose.\" tabindex=\"-1\">Levanta el escenario con docker-compose.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/nextcloud$ docker-compose up -d<br>Creating mariadb ... done<br>Creating nextcloud ... done</code></pre>\n<h3 id=\"muestra-los-contenedores-con-docker-compose.\" tabindex=\"-1\">Muestra los contenedores con docker-compose.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/nextcloud$ docker-compose ps<br>  Name                 Command               State          Ports        <br>-------------------------------------------------------------------------<br>mariadb     docker-entrypoint.sh mariadbd    Up      3306/tcp            <br>nextcloud   /entrypoint.sh apache2-for ...   Up      0.0.0.0:8080->80/tcp<br></code></pre>\n<h3 id=\"accede-a-la-aplicaci%C3%B3n-y-comprueba-que-funciona.\" tabindex=\"-1\">Accede a la aplicaci√≥n y comprueba que funciona.</h3>\n<p><img src=\"/img/IAW-T6-T2.1.png\" alt=\"IAW-T6-T2.1.png\"></p>\n<h3 id=\"comprueba-el-almacenamiento-que-has-definido-y-que-se-ha-creado-una-nueva-red-de-tipo-bridge.\" tabindex=\"-1\">Comprueba el almacenamiento que has definido y que se ha creado una nueva red de tipo bridge.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/nextcloud$ docker volume ls<br>DRIVER    VOLUME NAME<br>local     miweb<br>local     nextcloud_mariadb<br>local     nextcloud_nextcloud<br>usuario@debian:~/docker/nextcloud$ docker network ls<br>NETWORK ID     NAME                    DRIVER    SCOPE<br>0a056584eb52   bridge                  bridge    local<br>5a9854477fa0   host                    host      local<br>50145eea35b5   nextcloud_red-taller2   bridge    local<br>6819e5224e2d   none                    null      local<br>8812477bf491   red-taller1             bridge    local</code></pre>\n<h3 id=\"borra-el-escenario-con-docker-compose.\" tabindex=\"-1\">Borra el escenario con docker-compose.</h3>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/nextcloud$ docker-compose down --volumes<br>Stopping nextcloud ... done<br>Stopping mariadb   ... done<br>Removing nextcloud ... done<br>Removing mariadb   ... done<br>Removing network nextcloud_red-taller2<br>Removing volume nextcloud_nextcloud<br>Removing volume nextcloud_mariadb<br>usuario@debian:~/docker/nextcloud$ docker network ls<br>NETWORK ID     NAME          DRIVER    SCOPE<br>0a056584eb52   bridge        bridge    local<br>5a9854477fa0   host          host      local<br>6819e5224e2d   none          null      local<br>8812477bf491   red-taller1   bridge    local<br>usuario@debian:~/docker/nextcloud$ docker volume ls<br>DRIVER    VOLUME NAME<br>local     miweb<br>usuario@debian:~/docker/nextcloud$ docker ps -a<br>CONTAINER ID   IMAGE       COMMAND                CREATED       STATUS                    PORTS                  NAMES<br>51e59b04534c   httpd:2.4   \"httpd-foreground\"     11 days ago   Exited (255) 4 days ago   0.0.0.0:8080->80/tcp   my-apache-app<br>5ea92851b3d2   ubuntu      \"bash\"                 11 days ago   Exited (0) 11 days ago                           contenedor1<br>76cb08ee11c3   ubuntu      \"echo 'Hello world'\"   11 days ago   Exited (0) 11 days ago                           priceless_hamilton</code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-06T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-con-docker./",
      "url": "https://reeseschultz.github.io/post/ejercicios-con-docker./",
      "title": "Ejercicios con Docker.",
      "content_html": "<h3 id=\"almacenamiento.\" tabindex=\"-1\">Almacenamiento.</h3>\n<p><strong>Vamos a trabajar con vol√∫menes docker:</strong></p>\n<h4 id=\"1.-crea-un-volumen-docker-que-se-llame-miweb.\" tabindex=\"-1\">1. Crea un volumen docker que se llame miweb.</h4>\n<p>Creo el volumen y lo muestro.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker volume create miweb<br>miweb<br>usuario@debian:~$ docker volume ls<br>DRIVER    VOLUME NAME<br>local     miweb</code></pre>\n<h4 id=\"2.-crea-un-contenedor-desde-la-imagen-php%3A7.4-apache-donde-montes-en-el-directorio-%2Fvar%2Fwww%2Fhtml-(que-sabemos-que-es-el-documentroot-del-servidor-que-nos-ofrece-esa-imagen)-el-volumen-docker-que-has-creado.\" tabindex=\"-1\">2. Crea un contenedor desde la imagen php:7.4-apache donde montes en el directorio /var/www/html (que sabemos que es el DocumentRoot del servidor que nos ofrece esa imagen) el volumen docker que has creado.</h4>\n<p>Creamos el contenedor y listo los contenedores.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker run -d --name miweb -v miweb:/var/www/html -p 8080:80 php:7.4-apache<br>Unable to find image 'php:7.4-apache' locally<br>7.4-apache: Pulling from library/php<br>a603fa5e3b41: Pull complete <br>c428f1a49423: Pull complete <br>156740b07ef8: Pull complete <br>fb5a4c8af82f: Pull complete <br>25f85b498fd5: Pull complete <br>9b233e420ac7: Pull complete <br>fe42347c4ecf: Pull complete <br>d14eb2ed1e17: Pull complete <br>66d98f73acb6: Pull complete <br>d2c43c5efbc8: Pull complete <br>ab590b48ea47: Pull complete <br>80692ae2d067: Pull complete <br>05e465aaa99a: Pull complete <br>Digest: sha256:c9d7e608f73832673479770d66aacc8100011ec751d1905ff63fae3fe2e0ca6d<br>Status: Downloaded newer image for php:7.4-apache<br>645843f9d771e6d8ea8322ef4329af791f798d74806b863bd2884515fc58314a<br>usuario@debian:~$ docker ps<br>CONTAINER ID   IMAGE            COMMAND                  CREATED          STATUS          PORTS                  NAMES<br>645843f9d771   php:7.4-apache   \"docker-php-entrypoi‚Ä¶\"   20 seconds ago   Up 17 seconds   0.0.0.0:8080->80/tcp   miweb</code></pre>\n<h4 id=\"3.-utiliza-el-comando-docker-cp-para-copiar-un-fichero-index.html-(donde-aparece-tu-nombre)-en-el-directorio-%2Fvar%2Fwww%2Fhtml.\" tabindex=\"-1\">3. Utiliza el comando docker cp para copiar un fichero index.html (donde aparece tu nombre) en el directorio /var/www/html.</h4>\n<p>Lo primero que haremos ser√° crear un index de prueba:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span><br><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span><br>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span><br>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span>Prueba<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span><br>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span><br>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span><br>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>Alejandro Montes Delgado<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span><br>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Ejercicio3 de Almacenamiento<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span><br>  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span><br><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Ahora usamos el comando docker cp para enviar el index al contenedor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker cp index.html miweb:/var/www/html</code></pre>\n<h4 id=\"4.-accede-al-contenedor-desde-el-navegador-para-ver-la-informaci%C3%B3n-ofrecida-por-el-fichero-index.html.\" tabindex=\"-1\">4. Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero index.html.</h4>\n<p><img src=\"/img/IAW-T6-T1.1.png\" alt=\"IAW-T6-T1.1.png\"></p>\n<h4 id=\"5.-borra-el-contenedor\" tabindex=\"-1\">5. Borra el contenedor</h4>\n<p>Borro el contenedor y muestro que se ha borrado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker rm -f miweb<br>miweb<br>usuario@debian:~$ docker ps -a<br>CONTAINER ID   IMAGE       COMMAND                CREATED       STATUS                    PORTS                  NAMES<br>51e59b04534c   httpd:2.4   \"httpd-foreground\"     11 days ago   Exited (255) 4 days ago   0.0.0.0:8080->80/tcp   my-apache-app<br>5ea92851b3d2   ubuntu      \"bash\"                 11 days ago   Exited (0) 11 days ago                           contenedor1<br>76cb08ee11c3   ubuntu      \"echo 'Hello world'\"   11 days ago   Exited (0) 11 days ago                           priceless_hamilton<br></code></pre>\n<h4 id=\"6.-crea-un-nuevo-contenedor-y-monta-el-mismo-volumen-como-en-el-ejercicio-anterior.\" tabindex=\"-1\">6. Crea un nuevo contenedor y monta el mismo volumen como en el ejercicio anterior.</h4>\n<p>Creo de nuevo el contenedor con el mismo volumen y veremos que no se ha borrado la p√°gina web ya que al eliminar el contenedor no se elimina el volumen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker run -d --name miweb2 -v miweb:/var/www/html -p 8080:80 php:7.4-apache<br>98fd921d25f3a4525b2e9e0bcd26e36330d1d469daf007f33f3dfc0ff181c19c</code></pre>\n<h4 id=\"accede-al-contenedor-desde-el-navegador-para-ver-la-informaci%C3%B3n-ofrecida-por-el-fichero-index.html.-%C2%BFsegu%C3%ADa-existiendo-ese-fichero%3F\" tabindex=\"-1\">Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero index.html. ¬øSegu√≠a existiendo ese fichero?</h4>\n<p><img src=\"/img/IAW-T6-T1.2.png\" alt=\"IAW-T6-T1.2.png\"></p>\n<p><strong>Vamos a trabajar con bind mount:</strong></p>\n<h4 id=\"7.-crea-un-directorio-en-tu-host-y-dentro-crea-un-fichero-index.html-(donde-aparece-tu-nombre).\" tabindex=\"-1\">7. Crea un directorio en tu host y dentro crea un fichero index.html (donde aparece tu nombre).</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ mkdir web<br>usuario@debian:~$ cd web<br>usuario@debian:~/web$ nano index.html </code></pre>\n<p>El contenido del index es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">&lt;!DOCTYPE html><br>&lt;html><br>  &lt;head><br>    &lt;title>Prueba&lt;/title><br>  &lt;/head><br>  &lt;body><br>    &lt;h1>Alejandro Montes Delgado&lt;/h1><br>    &lt;p>Bind Mount&lt;/p><br>  &lt;/body><br>&lt;/html></code></pre>\n<h4 id=\"8.-crea-un-contenedor-desde-la-imagen-php%3A7.4-apache-donde-montes-en-el-directorio-%2Fvar%2Fwww%2Fhtml-el-directorio-que-has-creado-por-medio-de-bind-mount.\" tabindex=\"-1\">8. Crea un contenedor desde la imagen php:7.4-apache donde montes en el directorio /var/www/html el directorio que has creado por medio de bind mount.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/web$ docker run -d --name miweb -v /home/usuario/web:/var/www/html -p 8080:80 php:7.4-apache<br>405f87ad2a41df0e6fde514d622c741d08da1d498e35420ef106036d5d1d86e6<br></code></pre>\n<h4 id=\"9.-accede-al-contenedor-desde-el-navegador-para-ver-la-informaci%C3%B3n-ofrecida-por-el-fichero-index.html.\" tabindex=\"-1\">9. Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero index.html.</h4>\n<p><img src=\"/img/IAW-T6-T1.3.png\" alt=\"IAW-T6-T1.3.png\"></p>\n<h4 id=\"10.-modifica-el-contenido-del-fichero-index.html-en-tu-host-y-comprueba-que-al-refrescar-la-p%C3%A1gina-ofrecida-por-el-contenedor%2C-el-contenido-ha-cambiado.\" tabindex=\"-1\">10. Modifica el contenido del fichero index.html en tu host y comprueba que al refrescar la p√°gina ofrecida por el contenedor, el contenido ha cambiado.</h4>\n<p>Edito el index  y queda de la siguiente manera:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">&lt;!DOCTYPE html><br>&lt;html><br>  &lt;head><br>    &lt;title>Prueba&lt;/title><br>  &lt;/head><br>  &lt;body><br>    &lt;h1>Alejandro Montes Delgado&lt;/h1><br>    &lt;p>Bind Mount, esto es una modificacion.&lt;/p><br>  &lt;/body><br>&lt;/html></code></pre>\n<p>Refresco la p√°gina y muestro el cambio:</p>\n<p><img src=\"/img/IAW-T6-T1.4.png\" alt=\"IAW-T6-T1.4.png\"></p>\n<h4 id=\"11.-borra-el-contenedor\" tabindex=\"-1\">11. Borra el contenedor</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~$ docker rm -f miweb<br>miweb</code></pre>\n<h4 id=\"12.-crea-un-nuevo-contenedor-y-monta-el-mismo-directorio-como-en-el-ejercicio-anterior.\" tabindex=\"-1\">12. Crea un nuevo contenedor y monta el mismo directorio como en el ejercicio anterior.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/web$ docker run -d --name miweb-nueva -v /home/usuario/web:/var/www/html -p 8080:80 php:7.4-apache<br>2074045b34c2643ac2186e117e51b9d7c6fdbec5e341d8ca3599f2fcf7f18f43</code></pre>\n<h4 id=\"13.-accede-al-contenedor-desde-el-navegador-para-ver-la-informaci%C3%B3n-ofrecida-por-el-fichero-index.html.-%C2%BFse-sigue-viendo-el-mismo-contenido%3F\" tabindex=\"-1\">13. Accede al contenedor desde el navegador para ver la informaci√≥n ofrecida por el fichero index.html. ¬øSe sigue viendo el mismo contenido?</h4>\n<p>S√≠, se sigue viendo el mismo contenido.</p>\n<h3 id=\"redes\" tabindex=\"-1\">Redes</h3>\n<p><strong>Despliegue de Nextcloud + mariadb/postgreSQL</strong></p>\n<p>Vamos a desplegar la aplicaci√≥n nextcloud con una base de datos (puedes elegir mariadb o PostgreSQL) (NOTA: Para que no te de errores utiliza la imagen mariadb:10.5). Te puede servir el ejercicio que hemos realizado para desplegar Wordpress. Para ello sigue los siguientes pasos:</p>\n<h4 id=\"1.-crea-una-red-de-tipo-bridge.\" tabindex=\"-1\">1. Crea una red de tipo bridge.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/web$ docker network create red-taller1<br>8812477bf491b70d5402f72b3336483c364aa56b9f746c59b6d931a03cf6ac57<br>usuario@debian:~/web$ docker network ls<br>NETWORK ID     NAME          DRIVER    SCOPE<br>0a056584eb52   bridge        bridge    local<br>5a9854477fa0   host          host      local<br>6819e5224e2d   none          null      local<br>8812477bf491   red-taller1   bridge    local<br></code></pre>\n<h4 id=\"2.-crea-el-contenedor-de-la-base-de-datos-conectado-a-la-red-que-has-creado.-la-base-de-datos-se-debe-configurar-para-crear-una-base-de-dato-y-un-usuario.-adem%C3%A1s-el-contenedor-debe-utilizar-almacenamiento-(vol%C3%BAmenes-o-bind-mount)-para-guardar-la-informaci%C3%B3n.-puedes-seguir-la-documentaci%C3%B3n-de-mariadb-o-la-de-postgresql.\" tabindex=\"-1\">2. Crea el contenedor de la base de datos conectado a la red que has creado. La base de datos se debe configurar para crear una base de dato y un usuario. Adem√°s el contenedor debe utilizar almacenamiento (vol√∫menes o bind mount) para guardar la informaci√≥n. Puedes seguir la documentaci√≥n de mariadb o la de PostgreSQL.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller1$ docker run -d --name nextcloud-db -v /home/usuario/docker/taller1/mariadb/:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=nextcloud -e MYSQL_DATABASE=nextcloud -e MYSQL_USER=nextcloud -e MYSQL_PASSWORD=nextcloud --network red-taller1 mariadb:10.5<br>Unable to find image 'mariadb:10.5' locally<br>10.5: Pulling from library/mariadb<br>7608715873ec: Pull complete <br>578dfcf52320: Pull complete <br>06e052319319: Pull complete <br>64a5db893c1d: Pull complete <br>a474552678e0: Pull complete <br>08cf6eb2006a: Pull complete <br>e8af41dcfbcd: Pull complete <br>d1ea3aee3f93: Pull complete <br>Digest: sha256:fd7c3b8e1f0306819aa90df0fae9573dabb09ef9ee88e4890aa97f9e6ad1b1d1<br>Status: Downloaded newer image for mariadb:10.5<br>33ac7a28b4871412b60ccc7306d52e456eb0b81c243d82b076d8e0a9ec6ce08b</code></pre>\n<h4 id=\"3.-a-continuaci%C3%B3n%2C-siguiendo-la-documentaci%C3%B3n-de-la-imagen-nextcloud%2C-crea-un-contenedor-conectado-a-la-misma-red%2C-e-indica-las-variables-adecuadas-para-que-se-configure-de-forma-adecuada-y-realice-la-conexi%C3%B3n-a-la-base-de-datos.-el-contenedor-tambi%C3%A9n-debe-ser-persistente-usando-almacenamiento.\" tabindex=\"-1\">3. A continuaci√≥n, siguiendo la documentaci√≥n de la imagen nextcloud, crea un contenedor conectado a la misma red, e indica las variables adecuadas para que se configure de forma adecuada y realice la conexi√≥n a la base de datos. El contenedor tambi√©n debe ser persistente usando almacenamiento.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@debian:~/docker/taller1$ mkdir nextcloud<br>usuario@debian:~/docker/taller1$ docker run -d --name nextcloud -v /home/dusuario/docker/taller1/nextcloud:/var/www/html -e MYSQL_HOST=nextcloud-bd -e MYSQL_DATABASE=nextcloud -e MYSQL_USER=nextcloud -e MYSQL_PASSWORD=nextcloud -e MYSQL_ROOT_PASSWORD=nextcloud -p 8080:80 --network red-taller1 nextcloud<br>Unable to find image 'nextcloud:latest' locally<br>latest: Pulling from library/nextcloud<br>01b5b2efb836: Pull complete <br>45244a9928d1: Pull complete <br>139d4815e950: Pull complete <br>9a420fd884ad: Pull complete <br>1de46a46cfcd: Pull complete <br>9cc46e699e97: Pull complete <br>9a8d67ebc9db: Pull complete <br>f9464a3489e8: Pull complete <br>5fececf0d356: Pull complete <br>6dd28e697cc8: Pull complete <br>b38a56ab5f21: Pull complete <br>ca91e5a7ae8b: Pull complete <br>185f934955ec: Pull complete <br>979a87e257ad: Pull complete <br>63796aca9c04: Pull complete <br>afba53389a1b: Pull complete <br>6a79123df1c3: Pull complete <br>790f82f8928c: Pull complete <br>2bdee9c1e37b: Pull complete <br>39b72fdca150: Pull complete <br>Digest: sha256:c64895f402b6d8a2d6704bcd17fd26b5c0b69fcaccdd2185dc35e5fbe4f6488c<br>Status: Downloaded newer image for nextcloud:latest<br>13e2680e97784f790d300de21017c6381cc39ff75614be0ffa8e534863f5159d</code></pre>\n<h4 id=\"4.-accede-a-la-aplicaci%C3%B3n-usando-un-navegador-web.\" tabindex=\"-1\">4. Accede a la aplicaci√≥n usando un navegador web.</h4>\n<p><img src=\"/img/IAW-T6-T1.5.png\" alt=\"IAW-T6-T1.5.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-02-05T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/instalacion-y-configuracion-inicial-de-openldap./",
      "url": "https://reeseschultz.github.io/post/instalacion-y-configuracion-inicial-de-openldap./",
      "title": "Instalaci√≥n y configuraci√≥n inicial de OpenLDAP.",
      "content_html": "<h3 id=\"instalaci%C3%B3n-y-configuraci%C3%B3n-del-servidor-ldap.\" tabindex=\"-1\">Instalaci√≥n y configuraci√≥n del servidor LDAP.</h3>\n<p>Lo primero que debemos de hacer es asegurarnos de que tenemos el FQND configurado correctamente. En nuestro caso, en el escenario de OpenStack est√° configurado correctamente ya que tenemos instalado un servidor DNS. Muestro el hostname de Alfa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ hostname -f<br>alfa.alejandro-montes.gonzalonazareno.org</code></pre>\n<p>Una vez comprobado de que el FQDN est√° configurado correctamente, comenzaremos con la instalaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo apt install slapd<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  ldap-utils libltdl7 libodbc1<br>Suggested packages:<br>  libsasl2-modules-gssapi-mit | libsasl2-modules-gssapi-heimdal<br>  libmyodbc odbc-postgresql tdsodbc unixodbc-bin<br>The following NEW packages will be installed:<br>  ldap-utils libltdl7 libodbc1 slapd<br>0 upgraded, 4 newly installed, 0 to remove and 1 not upgraded.<br>Need to get 2270 kB of archives.<br>After this operation, 6400 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y<br></code></pre>\n<p>Nos pedir√° una contrase√±a para el usuario administrador de LDAP. Ahora instalaremos el siguiente paquete:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo apt install ldap-utils<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>ldap-utils is already the newest version (2.4.57+dfsg-3+deb11u1).<br>ldap-utils set to manually installed.<br>0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.</code></pre>\n<p>No se me ha instalado ldap-utils debido a que se me ha instalado como dependencia. Para verificar que est√° instalado, haremos una b√∫squeda con las credenciales de la instalaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ ldapsearch -x -D \"cn=admin,dc=alejandro-montes,dc=gonzalonazareno,dc=org\" -b \"dc=alejandro-montes,dc=gonzalonazareno,dc=org\" -W<br>Enter LDAP Password:<br># extended LDIF<br>#<br># LDAPv3<br># base &lt;dc=alejandro-montes,dc=gonzalonazareno,dc=org> with scope subtree<br># filter: (objectclass=*)<br># requesting: ALL<br>#<br><br># alejandro-montes.gonzalonazareno.org<br>dn: dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: dcObject<br>objectClass: organization<br>o: alejandro-montes.gonzalonazareno.org<br>dc: alejandro-montes<br><br># search result<br>search: 2<br>result: 0 Success<br><br># numResponses: 2<br># numEntries: 1</code></pre>\n<p>Ahora, vamos a crear dos objetos, para ello crearemos el siguiente fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ nano unidades.ldif</code></pre>\n<p>Y ponemos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dn: ou=Personas,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: organizationalUnit<br>ou: Personas<br><br>dn: ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: organizationalUnit<br>ou: Grupos</code></pre>\n<p>Ejecutamos el siguiente comando para incluirlo en nuestro √°rbol de directorios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ ldapadd -x -D \"cn=admin,dc=alejandro-montes,dc=gonzalonazareno,dc=org\" -f unidades.ldif -W<br>Enter LDAP Password:<br>adding new entry \"ou=Personas,dc=alejandro-montes,dc=gonzalonazareno,dc=org\"<br><br>adding new entry \"ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org\"</code></pre>\n<p>Ahora crearemos un fichero para crear un grupo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dn: cn=prueba,ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: posixGroup<br>gidNumber: 2001<br>cn: prueba</code></pre>\n<p>lo a√±adimos con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ ldapadd -x -D 'cn=admin,dc=alejandro-montes,dc=gonzalonazareno,dc=org' -W -f grupos.ldif</code></pre>\n<p>Con el siguiente comando generaremos una contrase√±a cifrada para el usuario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# slappasswd<br>New password: <br>Re-enter new password: <br>{SSHA}L53zECZUj4SOYLkP8kELnX8wM7oN04FM<br></code></pre>\n<p>Ahora crearemos el siguiente fichero para crear un usuario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ nano usuarios.ldif</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dn: uid=usuario1, ou=Grupos, dc=alejandro-montes, dc=gonzalonazareno, dc=org<br>objectClass: top<br>objectClass: posixAccount<br>objectClass: inetOrgPerson<br>objectClass: person<br>cn: usuario1<br>uid: usuario1<br>uidNumber: 2001<br>gidNumber: 2001<br>homeDirectory: /nfs/users/usuario1<br>loginShell: /bin/bash<br>userPassword: {SSHA}L53zECZUj4SOYLkP8kELnX8wM7oN04FM<br>sn: usuario1<br>mail: pruebausuario@prueba.com<br>givenName: usuario1<br></code></pre>\n<p>Ejecutamos el siguiente comando para a√±adir el usuario a LDAP:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ ldapadd -x -D \"cn=admin,dc=alejandro-montes,dc=gonzalonazareno,dc=org\" -W -f usuario.ldif<br>Enter LDAP Password: <br>adding new entry \"uid=usuario, ou=Grupos, dc=alejandro-montes, dc=gonzalonazareno, dc=org\"<br></code></pre>\n<p>Si hacemos un ldapsearch, podemos ver que el usuario creado est√° en el grupo <code>Grupos</code>.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"># usuario1, Grupos, alejandro-montes.gonzalonazareno.org<br>dn: uid=usuario1,ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: posixAccount<br>objectClass: inetOrgPerson<br>objectClass: person<br>cn: usuario1<br>uid: usuario1<br>uidNumber: 2000<br>gidNumber: 2000<br>homeDirectory: /nfs/users/pruebausuario<br>loginShell: /bin/bash<br>userPassword:: dXN1YXJpbw==<br>sn: apellido<br>mail: pruebausuario@prueba.com<br>givenName: usuario1<br><br></code></pre>\n<h3 id=\"configuraci%C3%B3n-nfs-en-el-servidor(alfa).\" tabindex=\"-1\">Configuraci√≥n NFS en el servidor(Alfa).</h3>\n<p>Lo primero que har√© ser√° crear el directorio donde se guardar√°n el home de todos los usuarios.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# mkdir /nfs<br>root@alfa:/home/usuario# mkdir /nfs/users<br></code></pre>\n<p>Creamos el directorio para el home del usuario de prueba y le cambiamos de due√±o al directorio.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# mkdir /nfs/users/prueba<br>root@alfa:/home/usuario# chown 2000:2000 /nfs/users/prueba/<br></code></pre>\n<p>Instalamos los paquetes necesarios para nfs, en mi caso ya est√°n instalados:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# apt install nfs-kernel-server nfs-common<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>nfs-common is already the newest version (1:1.3.4-6).<br>nfs-kernel-server is already the newest version (1:1.3.4-6).<br>0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.<br></code></pre>\n<p>A√±adimos la siguiente l√≠nea al fichero exports para indicar a nfs el directorio que vamos a compartir.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">/nfs/users *(rw,fsid=0,subtree_check)</code></pre>\n<h3 id=\"instalaci%C3%B3n-de-nss%2C-pam-y-nscd.\" tabindex=\"-1\">Instalaci√≥n de NSS, PAM y NSCD.</h3>\n<p>Ahora instalaremos los siguientes paquetes para que el servidor LDAP sea capaz de identificarse, resolver nombres de usuarios y grupos, y cachear la resoluci√≥n de nombres. Para ellos instalaremos los siguientes paquetes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# apt install libpam-ldapd nscd libnss-ldap<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  nslcd nslcd-utils<br>Suggested packages:<br>  kstart<br>The following NEW packages will be installed:<br>  libnss-ldap libpam-ldapd nscd nslcd nslcd-utils<br>0 upgraded, 5 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 710 kB of archives.<br>After this operation, 1361 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>\n<p>Ahora tendremos que poner la direcci√≥n del servidor LDAP, en nuestro caso es el localhost.</p>\n<p><img src=\"/img/ASO-LDAP-1.png\" alt=\"ASO-LDAP-1.png\"></p>\n<p>En este apartado, tenemos que indicar el dominio separado en vez de por un punto, ponemos al principio <code>dc=</code> y una coma, as√≠ tendremos que tener el dominio completo.</p>\n<p><img src=\"/img/ASO-LDAP-2.png\" alt=\"ASO-LDAP-2.png\"></p>\n<p>Ahora nos aparece la configuraci√≥n de nss, le damos siguiente ya que nos pide la direcci√≥n del servidor ldap.</p>\n<p><img src=\"/img/ASO-LDAP-3.png\" alt=\"ASO-LDAP-3.png\"></p>\n<p>Volvemos a indicar el dominio pero esta vez ser√° para la configuraci√≥n de NSS:</p>\n<p><img src=\"/img/ASO-LDAP-4.png\" alt=\"ASO-LDAP-4.png\"></p>\n<p>Indicamos la versi√≥n 3:</p>\n<p><img src=\"/img/ASO-LDAP-5.png\" alt=\"ASO-LDAP-5.png\"></p>\n<p>Ahora tenemos que indicar la cuenta administrador, en mi caso es admin.</p>\n<p><img src=\"/img/ASO-LDAP-6.png\" alt=\"ASO-LDAP-6.png\"></p>\n<p>Indicamos la contrase√±a del usuario y pulsamos siguiente, en la siguiente ventana pulsaremos <code>&lt;Ok&gt;</code> y se terminar√° de instalar. Para finalizar la configuraci√≥n, editaremos el siguiente fichero para que el sistema use LDAP para la resoluci√≥n de nombres.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# nano /etc/nsswitch.conf <br></code></pre>\n<p>Editamos las 4 primeras l√≠neas no comentadas y ponemos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">passwd:         files ldap<br>group:          files ldap<br>shadow:         files ldap<br>gshadow:        files ldap</code></pre>\n<p>Como prueba, muestro el uuid del usuario y nos loguearemos desde el propio servidor con el usuario creado.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/home/usuario# id usuario1<br>uid=2001(usuario1) gid=2001(prueba) groups=2001(prueba)<br>root@alfa:/home/usuario# login<br>alfa login: usuario1<br>Password: <br>Linux alfa 5.10.0-20-amd64 #1 SMP Debian 5.10.158-2 (2022-12-13) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Thu Feb  2 16:45:31 UTC 2023 on pts/2<br>usuario1@alfa:~$ <br></code></pre>\n<h3 id=\"configuraci%C3%B3n-y-prueba-de-cliente-ldap-en-ubuntu(delta).\" tabindex=\"-1\">Configuraci√≥n y prueba de cliente LDAP en Ubuntu(Delta).</h3>\n<p>En el cliente(Delta), despu√©s de actualizarlo, lo primero que haremos ser√° instalar los paquetes necesarios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ sudo apt install ldap-utils<br>[sudo] password for ubuntu: <br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>Suggested packages:<br>  libsasl2-modules-gssapi-mit | libsasl2-modules-gssapi-heimdal<br>The following NEW packages will be installed:<br>  ldap-utils<br>0 upgraded, 1 newly installed, 0 to remove and 11 not upgraded.<br>Need to get 121 kB of archives.<br>After this operation, 745 kB of additional disk space will be used.<br>Get:1 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 ldap-utils amd64 2.4.49+dfsg-2ubuntu1.9 [121 kB]<br></code></pre>\n<p>Una vez se hayan instalados las dependencias, editaremos el fichero de configuraci√≥n para el cliente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ sudo nano /etc/ldap/ldap.conf<br></code></pre>\n<p>Y a√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">BASE    dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>URI     ldap://alfa.alejandro-montes.gonzalonazareno.org<br></code></pre>\n<p>Una vez hayamos terminado, podremos comprobar que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ ldapsearch -x -b \"dc=alejandro-montes,dc=gonzalonazareno,dc=org\"<br># extended LDIF<br>#<br># LDAPv3<br># base &lt;dc=alejandro-montes,dc=gonzalonazareno,dc=org> with scope subtree<br># filter: (objectclass=*)<br># requesting: ALL<br>#<br><br># alejandro-montes.gonzalonazareno.org<br>dn: dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: dcObject<br>objectClass: organization<br>o: alejandro-montes.gonzalonazareno.org<br>dc: alejandro-montes<br><br># Personas, alejandro-montes.gonzalonazareno.org<br>dn: ou=Personas,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: organizationalUnit<br>ou: Personas<br><br># Grupos, alejandro-montes.gonzalonazareno.org<br>dn: ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: organizationalUnit<br>ou: Grupos<br><br># prueba, Grupos, alejandro-montes.gonzalonazareno.org<br>dn: cn=prueba,ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: posixGroup<br>gidNumber: 2001<br>cn: prueba<br><br># usuario1, Grupos, alejandro-montes.gonzalonazareno.org<br>dn: uid=usuario1,ou=Grupos,dc=alejandro-montes,dc=gonzalonazareno,dc=org<br>objectClass: top<br>objectClass: posixAccount<br>objectClass: inetOrgPerson<br>objectClass: person<br>cn: usuario1<br>uid: usuario1<br>uidNumber: 2001<br>gidNumber: 2001<br>homeDirectory: /nfs/users/usuario1<br>loginShell: /bin/bash<br>sn: usuario1<br>mail: pruebausuario@prueba.com<br>givenName: usuario1<br><br># search result<br>search: 2<br>result: 0 Success<br><br># numResponses: 6<br># numEntries: 5</code></pre>\n<p>Ahora instalaremos los paquetes necesarios para poder conectarnos al servidor. Como son exactamente los mismos paquetes que en el servidor, no pondr√© la configuraci√≥n ya que es igual solo que poniendo los datos del servidor en vez de local.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ sudo apt install -y libnss-ldap libpam-ldapd nscd<br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>The following additional packages will be installed:<br>  ldap-auth-client ldap-auth-config nslcd nslcd-utils<br>Suggested packages:<br>  kstart<br>The following NEW packages will be installed:<br>  ldap-auth-client ldap-auth-config libnss-ldap libpam-ldapd nscd nslcd<br>  nslcd-utils<br>0 upgraded, 7 newly installed, 0 to remove and 11 not upgraded.<br>Need to get 330 kB of archives.<br>After this operation, 1,285 kB of additional disk space will be used.<br>Get:1 http://archive.ubuntu.com/ubuntu focal/universe amd64 nslcd amd64 0.9.11-1 [156 kB]<br>Get:2 http://archive.ubuntu.com/ubuntu focal-updates/universe a</code></pre>\n<p>Editamos el fichero nsswitch.conf</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ sudo nano /etc/nsswitch.conf</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">passwd:         files systemd ldap<br>group:          files systemd ldap<br>shadow:         files ldap<br>gshadow:        files ldap</code></pre>\n<p>Reiniciamos el servicio para que se apliquen los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ sudo systemctl restart nscd<br></code></pre>\n<p>A√∫n as√≠, todav√≠a no podemos acceder al home del usuario1 ya que no est√° montado, para ello tenemos que instalar y configurar el cliente NFS.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ sudo apt install -y nfs-common<br>[sudo] password for ubuntu: <br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>The following additional packages will be installed:<br>  keyutils libevent-2.1-7 libnfsidmap2 libtirpc-common libtirpc3 rpcbind<br>Suggested packages:<br>  open-iscsi watchdog<br>The following NEW packages will be installed:<br>  keyutils libevent-2.1-7 libnfsidmap2 libtirpc-common libtirpc3<br>  nfs-common rpcbind<br>0 upgraded, 7 newly installed, 0 to remove and 11 not upgraded.<br>Need to get 543 kB of archives.<br>After this operation, 1,924 kB of additional disk space will be used.<br>Get:1 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libtirpc-common all 1.2.5-1ubuntu0.1 [7,712 B]<br>Get:2 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 libtirpc3 amd64 1.2.5-1ubuntu0.1 [77.9 kB]<br>Get:3 http://archive.ubuntu.com/ubuntu focal/main amd64 rpcbind amd64 1.2.5-8 [42.8 kB]<br>Get:4 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 keyutils amd64 1.6-6ubuntu1.1 [44.8 kB]<br>Get:5 http://archive.ubuntu.com/ubuntu focal/main amd64 libevent-2.1-7 amd64 2.1.11-stable-1 [138 kB]<br></code></pre>\n<p>Activamos nfs:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ sudo systemctl start nfs-client.target<br>ubuntu@delta:~$ sudo systemctl enable nfs-client.target<br></code></pre>\n<p>Creamos el directorio donde montaremos el servicio nfs:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# mkdir /nfs/users<br>root@delta:/home/ubuntu# mkdir /nfs/users/usuario1</code></pre>\n<p>Cambiamos el due√±o al usuario1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# chown 2001:2001 /nfs/users/usuario1</code></pre>\n<p>Ejecutamos lo siguiente para que se cargue autom√°ticamente el m√≥dulo nfs:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# echo NFS | tee -a /etc/modules<br>NFS</code></pre>\n<p>Creamos una nueva unidad de systemd:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# nano /etc/systemd/system/nfs-users.mount</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Unit]<br>Description=Home centralizado<br>Requires=network-online.target<br>After=network-online.target<br>[Mount]<br>What=192.168.0.1:/nfs/users<br>Where=/nfs/users<br>Options=_netdev,auto<br>Type=nfs<br>[Install]<br>WantedBy=multi-user.target</code></pre>\n<p>Recargamos el demonio de systemd para que se agregue la nueva unidad y la encendemos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/home/ubuntu# systemctl daemon-reload<br>root@delta:/home/ubuntu# systemctl start nfs-users.mount<br>root@delta:/home/ubuntu# systemctl enable nfs-users.mount<br>Created symlink /etc/systemd/system/multi-user.target.wants/nfs-users.mount ‚Üí /etc/systemd/system/nfs-users.mount.<br></code></pre>\n<h3 id=\"comprobaciones\" tabindex=\"-1\">Comprobaciones</h3>\n<p>Desde el servidor conectado al usuario1, crearemos una carpeta de prueba:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/nfs/users# login usuario1<br>Password: <br>Linux alfa 5.10.0-20-amd64 #1 SMP Debian 5.10.158-2 (2022-12-13) x86_64<br><br>The programs included with the Debian GNU/Linux system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent<br>permitted by applicable law.<br>Last login: Thu Feb  2 19:15:26 UTC 2023 on pts/3<br>usuario1@alfa:~$ mkdir prueba<br>usuario1@alfa:~$ ls<br>prueba</code></pre>\n<p>Desde el cliente ubuntu nos conectaremos al usuario1 y haremos un ls y crearemos otra carpeta:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@delta:/nfs/users# login usuario1<br>Password: <br>Welcome to Ubuntu 20.04.5 LTS (GNU/Linux 5.10.0-20-amd64 x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms for each program are described in the<br>individual files in /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>Last login: Thu Feb  2 19:14:55 UTC 2023 on pts/4<br>usuario1@delta:~$ ls<br>prueba<br>usuario1@delta:~$ mkdir pruebadelta<br>usuario1@delta:~$ ls<br>prueba\tpruebadelta</code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-01-19T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/servidores-web-base-de-datos-y-dns-en-nuestros-escenario-de-openstack/",
      "url": "https://reeseschultz.github.io/post/servidores-web-base-de-datos-y-dns-en-nuestros-escenario-de-openstack/",
      "title": "Servidores Web, Base de Datos y DNS en nuestros escenario de OpenStack",
      "content_html": "<h3 id=\"entrega-la-configuraci%C3%B3n-dns-de-cada-m%C3%A1quina.\" tabindex=\"-1\">Entrega la configuraci√≥n DNS de cada m√°quina.</h3>\n<p>Para que la configuraci√≥n sea persistente en todas las m√°quinas tendremos que hacer lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo nano /usr/lib/systemd/resolv.conf </code></pre>\n<p>En este fichero, a√±adiremos la configuraci√≥n dns para que al reiniciar se mantenga.</p>\n<ul>\n<li>\n<h4 id=\"alfa.\" tabindex=\"-1\">Alfa.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ cat /etc/resolv.conf<br><br>nameserver 192.168.0.2<br>search alejandro-montes.gonzalonazareno.org<br>nameserver 172.16.202.2<br>search openstacklocal</code></pre>\n<ul>\n<li>\n<h4 id=\"bravo.\" tabindex=\"-1\">Bravo.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ cat /etc/resolv.conf <br><br>nameserver 192.168.0.2<br>search alejandro-montes.gonzalonazareno.org<br>nameserver 172.16.202.2</code></pre>\n<ul>\n<li>\n<h4 id=\"charlie.\" tabindex=\"-1\">Charlie.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@charlie:~$ cat /etc/resolv.conf <br><br>nameserver 192.168.0.2<br>search alejandro-montes.gonzalonazareno.org<br>nameserver 127.0.0.53<br>options edns0 trust-ad<br></code></pre>\n<ul>\n<li>\n<h4 id=\"delta.\" tabindex=\"-1\">Delta.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@delta:~$ cat /etc/resolv.conf <br><br>nameserver 192.168.0.2<br>search alejandro-montes.gonzalonazareno.org<br>nameserver 127.0.0.53<br>options edns0 trust-ad<br></code></pre>\n<h3 id=\"entrega-la-definici%C3%B3n-de-las-vistas-y-de-las-zonas.\" tabindex=\"-1\">Entrega la definici√≥n de las vistas y de las zonas.</h3>\n<ul>\n<li>\n<h4 id=\"configuraci%C3%B3n-de-las-vistas.\" tabindex=\"-1\">Configuraci√≥n de las vistas.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">view externa {<br>                match-clients { 172.22.0.0/16; 172.29.0.0/16; 192.168.202.2/32; };<br>                allow-recursion { any; };<br>                zone \"alejandro-montes.gonzalonazareno.org\"<br>                {<br>                        type master;<br>                        file \"db.externa.alejandro-montesgonzalonazareno.org\";<br>                };<br>                include \"/etc/bind/zones.rfc1918\";<br>                include \"/etc/bind/named.conf.default-zones\";<br>};<br>view dmz {<br>                match-clients { 172.16.0.0/16; };<br>                allow-recursion { any; };<br>                zone \"alejandro-montes.gonzalonazareno.org\"<br>                {<br>                        type master;<br>                        file \"db.dmz.alejandro-montes.gonzalonazareno.org\";<br>                };<br>                zone \"16.172.in-addr.arpa\"<br>                {<br>                        type master;<br>                        file \"db.16.172\";<br>                };<br>                zone \"0.168.192.in-addr.arpa\"<br>                {<br>                        type master;<br>                        file \"db.0.168.192\";<br>                };<br>                include \"/etc/bind/zones.rfc1918\";<br>                include \"/etc/bind/named.conf.default-zones\";<br>};<br>view interna {<br>                match-clients { 192.168.0.0/24; 127.0.0.1; };<br>                allow-recursion { any; };<br>                zone \"alejandro-montes.gonzalonazareno.org\"<br>                {<br>                        type master;<br>                        file \"db.interna.alejandro-montes.gonzalonazareno.org\";<br>                };<br>                zone \"0.168.192.in-addr.arpa\"<br>                {<br>                        type master;<br>                        file \"db.0.168.192\";<br>                };<br>                zone \"16.172.in-addr.arpa\"<br>                {<br>                        type master;<br>                        file \"db.16.172\";<br>                };<br>                include \"/etc/bind/zones.rfc1918\";<br>                include \"/etc/bind/named.conf.default-zones\";<br>};</code></pre>\n<ul>\n<li>\n<h4 id=\"configuraci%C3%B3n-de-la-zona-externa.\" tabindex=\"-1\">Configuraci√≥n de la zona externa.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">$TTL    86400<br>@       IN      SOA     alfa.alejandro-montes.gonzalonazareno.org. root.alejandro-montes.gonzalonazareno.org. (<br>                              1         ; Serial<br>                         604800         ; Refresh<br>                          86400         ; Retry<br>                        2419200         ; Expire<br>                          86400 )       ; Negative Cache TTL<br>;<br>@       IN      NS      alfa.alejandro-montes.gonzalonazareno.org.<br><br>$ORIGIN alejandro-montes.gonzalonazareno.org.<br><br>alfa                    IN      A       172.22.200.13<br>dns                     IN      CNAME   alfa<br>www                     IN      CNAME   alfa<br></code></pre>\n<ul>\n<li>\n<h4 id=\"configuraci%C3%B3n-de-la-zona-dmz.\" tabindex=\"-1\">Configuraci√≥n de la zona dmz.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">$TTL    86400<br>@       IN      SOA     charlie.alejandro-montes.gonzalonazareno.org. root.charlie.alejandro-montes.gonzalonazareno.org. (<br>                              1         ; Serial<br>                         604800         ; Refresh<br>                          86400         ; Retry<br>                        2419200         ; Expire<br>                          86400 )       ; Negative Cache TTL<br>;<br>@       IN      NS      charlie.alejandro-montes.gonzalonazareno.org.<br><br>$ORIGIN alejandro-montes.gonzalonazareno.org.<br><br>alfa                    IN      A       172.16.0.1<br>bravo                   IN      A       172.16.0.200<br>charlie                 IN      A       192.168.0.2<br>delta                   IN      A       192.168.0.3<br>www                     IN      CNAME   bravo<br>bd                      IN      CNAME   delta<br>dns                     IN      CNAME   charlie</code></pre>\n<ul>\n<li>\n<h4 id=\"configuraci%C3%B3n-de-la-zona-interna.\" tabindex=\"-1\">Configuraci√≥n de la zona Interna.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">$TTL    86400<br>@       IN      SOA     charlie.alejandro-montes.gonzalonazareno.org. root.charlie.alejandro-montes.gonzalonazareno.org. (<br>                              1         ; Serial<br>                         604800         ; Refresh<br>                          86400         ; Retry<br>                        2419200         ; Expire<br>                          86400 )       ; Negative Cache TTL<br>;<br>@       IN      NS      charlie.alejandro-montes.gonzalonazareno.org.<br><br>$ORIGIN alejandro-montes.gonzalonazareno.org.<br><br>alfa                    IN      A       192.168.0.1<br>bravo                   IN      A       172.16.0.200<br>charlie                 IN      A       192.168.0.2<br>delta                   IN      A       192.168.0.3<br>www                     IN      CNAME   bravo<br>bd                      IN      CNAME   delta<br>dns                     IN      CNAME   charlie<br></code></pre>\n<ul>\n<li>\n<h4 id=\"configuraci%C3%B3n-de-la-zona-dmz-inversa.\" tabindex=\"-1\">Configuraci√≥n de la zona DMZ inversa.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">$TTL    86400<br>@       IN      SOA     charlie.alejandro-montes.gonzalonazareno.org. root.alejandro-montes.gonzalonazareno.org. (<br>                              1         ; Serial<br>                         604800         ; Refresh<br>                          86400         ; Retry<br>                        2419200         ; Expire<br>                          86400 )       ; Negative Cache TTL<br>;<br>@       IN      NS              charlie.alejandro-montes.gonzalonazareno.org.<br><br>$ORIGIN 16.172.in-addr.arpa.<br><br>200.0                   IN      PTR             bravo.alejandro-montes.gonzalonazareno.org.</code></pre>\n<ul>\n<li>\n<h4 id=\"configuraci%C3%B3n-de-la-zona-interna-inversa.\" tabindex=\"-1\">Configuraci√≥n de la zona interna inversa.</h4>\n</li>\n</ul>\n<pre class=\"language-txt\"><code class=\"language-txt\">$TTL    86400<br>@       IN      SOA     charlie.alejandro-montes.gonzalonazareno.org. root.alejandro-montes.gonzalonazareno.org. (<br>                              1         ; Serial<br>                         604800         ; Refresh<br>                          86400         ; Retry<br>                        2419200         ; Expire<br>                          86400 )       ; Negative Cache TTL<br>;<br>@       IN      NS              charlie.alejandro-montes.gonzalonazareno.org.<br><br>$ORIGIN 0.168.192.in-addr.arpa.<br><br>1                       IN      PTR             alfa.alejandro-montes.gonzalonazareno.org.<br>2                       IN      PTR             charlie.alejandro-montes.gonzalonazareno.org.<br>3                       IN      PTR             delta.alejandro-montes.gonzalonazareno.org.</code></pre>\n<h3 id=\"entrega-el-resultado-de-las-siguientes-consultas-desde-una-m%C3%A1quina-interna-a-nuestra-red-y-otro-externo%3A\" tabindex=\"-1\">Entrega el resultado de las siguientes consultas desde una m√°quina interna a nuestra red y otro externo:</h3>\n<ul>\n<li>\n<h4 id=\"el-servidor-dns-con-autoridad-sobre-la-zona-del-dominio-tu_nombre.gonzalonazareno.org.\" tabindex=\"-1\">El servidor DNS con autoridad sobre la zona del dominio tu_nombre.gonzalonazareno.org.</h4>\n</li>\n</ul>\n<p>El comando es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dig ns alejandro-montes.gonzalonazareno.org</code></pre>\n<p>Desde alfa(Red Interna):</p>\n<p><img src=\"/img/SRI-P7.4.png\" alt=\"SRI-P7.4.png\"></p>\n<p>Desde bravo(Red DMZ):</p>\n<p><img src=\"/img/SRI-P7.2.png\" alt=\"SRI-P7.2.png\"></p>\n<p>Desde mi port√°til:</p>\n<p><img src=\"/img/SRI-P7.3.png\" alt=\"SRI-P7.3.png\"></p>\n<ul>\n<li>\n<h4 id=\"la-direcci%C3%B3n-ip-de-alfa.\" tabindex=\"-1\">La direcci√≥n IP de alfa.</h4>\n</li>\n</ul>\n<p>El comando es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dig alfa.alejandro-montes.gonzalonazareno.org</code></pre>\n<p>Desde alfa(Red Interna):</p>\n<p><img src=\"/img/SRI-P7.5.png\" alt=\"SRI-P7.5.png\"></p>\n<p>Desde bravo(Red DMZ):</p>\n<p><img src=\"/img/SRI-P7.6.png\" alt=\"SRI-P7.6.png\"></p>\n<p>Desde mi port√°til:</p>\n<p><img src=\"/img/SRI-P7.7.png\" alt=\"SRI-P7.7.png\"></p>\n<ul>\n<li>\n<h4 id=\"una-resoluci%C3%B3n-de-www.\" tabindex=\"-1\">Una resoluci√≥n de www.</h4>\n</li>\n</ul>\n<p>El comando es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dig www.alejandro-montes.gonzalonazareno.org</code></pre>\n<p>Desde alfa(Red Interna):</p>\n<p><img src=\"/img/SRI-P7.8.png\" alt=\"SRI-P7.8.png\"></p>\n<p>Desde bravo(Red DMZ):</p>\n<p><img src=\"/img/SRI-P7.9.png\" alt=\"SRI-P7.9.png\"></p>\n<p>Desde mi port√°til:</p>\n<p><img src=\"/img/SRI-P7.10.png\" alt=\"SRI-P7.10.png\"></p>\n<ul>\n<li>\n<h4 id=\"una-resoluci%C3%B3n-de-bd.\" tabindex=\"-1\">Una resoluci√≥n de bd.</h4>\n</li>\n</ul>\n<p>El comando es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dig bd.alejandro-montes.gonzalonazareno.org</code></pre>\n<p>Desde alfa(Red Interna):</p>\n<p><img src=\"/img/SRI-P7.11.png\" alt=\"SRI-P7.11.png\"></p>\n<p>Desde bravo(Red DMZ):</p>\n<p><img src=\"/img/SRI-P7.12.png\" alt=\"SRI-P7.12.png\"></p>\n<p>Desde mi port√°til:</p>\n<p><img src=\"/img/SRI-P7.13.png\" alt=\"SRI-P7.13.png\"></p>\n<ul>\n<li>\n<h4 id=\"un-resoluci%C3%B3n-inversa-de-ip-fija-en-cada-una-de-las-redes.-(esta-consulta-s%C3%B3lo-funcionar%C3%A1-desde-una-m%C3%A1quina-interna).\" tabindex=\"-1\">Un resoluci√≥n inversa de IP fija en cada una de las redes. (Esta consulta s√≥lo funcionar√° desde una m√°quina interna).</h4>\n</li>\n</ul>\n<p>El comando es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dig -x 0.0.0.0</code></pre>\n<p>Desde alfa(Red Interna) a la red interna:</p>\n<p><img src=\"/img/SRI-P7.14.png\" alt=\"SRI-P7.14.png\"></p>\n<p>Desde alfa(Red Interna) a la red dmz:</p>\n<p><img src=\"/img/SRI-P7.15.png\" alt=\"SRI-P7.15.png\"></p>\n<p>Desde bravo(Red DMZ) a la red interna:</p>\n<p><img src=\"/img/SRI-P7.16.png\" alt=\"SRI-P7.16.png\"></p>\n<p>Desde bravo(Red DMZ) a la red dmz:</p>\n<p><img src=\"/img/SRI-P7.17.png\" alt=\"SRI-P7.17.png\"></p>\n<h3 id=\"entrega-una-captura-de-pantalla-accediendo-a-www.tunombre.gonzalonazareno.org%2Finfo.php-donde-se-vea-la-salida-del-fichero-info.php.\" tabindex=\"-1\">Entrega una captura de pantalla accediendo a <a href=\"http://www.tunombre.gonzalonazareno.org/info.php\">www.tunombre.gonzalonazareno.org/info.php</a> donde se vea la salida del fichero info.php.</h3>\n<p><img src=\"/img/SRI-P7.18.png\" alt=\"SRI-P7.18.png\"></p>\n<h3 id=\"entrega-una-prueba-de-funcionamiento-donde-se-vea-como-se-realiza-una-conexi%C3%B3n-a-la-base-de-datos-desde-bravo.\" tabindex=\"-1\">Entrega una prueba de funcionamiento donde se vea como se realiza una conexi√≥n a la base de datos desde bravo.</h3>\n<p>Desde Bravo, conecto al servidor de bases de datos usando el CNAME <code>bd</code> de delta:</p>\n<p><img src=\"/img/SRI-P7.1.png\" alt=\"SRI-P7.1.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-01-14T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/configurar-servidor-vpn-en-openvpn-y-wireguard./",
      "url": "https://reeseschultz.github.io/post/configurar-servidor-vpn-en-openvpn-y-wireguard./",
      "title": "Configurar servidor VPN en OpenVPN y WireGuard.",
      "content_html": "<h3 id=\"openvpn\" tabindex=\"-1\">OpenVPN</h3>\n<h4 id=\"1.1.-vpn-de-acceso-remoto-con-openvpn-y-certificados-x509.-(5-puntos)\" tabindex=\"-1\">1.1. VPN de acceso remoto con OpenVPN y certificados x509. (5 puntos)</h4>\n<p><strong>Configura una conexi√≥n VPN de acceso remoto entre dos equipos del cloud:</strong></p>\n<ul>\n<li><strong>Uno de los dos equipos (el que actuar√° como servidor) estar√° conectado a dos redes</strong></li>\n<li><strong>Para la autenticaci√≥n de los extremos se usar√°n obligatoriamente certificados digitales, que se generar√°n utilizando openssl y se almacenar√°n en el directorio /etc/openvpn, junto con  los par√°metros Diffie-Helman y el certificado de la propia Autoridad de Certificaci√≥n.</strong></li>\n<li><strong>Se utilizar√°n direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La direcci√≥n 10.99.99.1 se asignar√° al servidor VPN.</strong></li>\n<li><strong>Los ficheros de configuraci√≥n del servidor y del cliente se crear√°n en el directorio /etc/openvpn de cada m√°quina, y se llamar√°n servidor.conf y cliente.conf respectivamente.</strong></li>\n<li><strong>Tras el establecimiento de la VPN, la m√°quina cliente debe ser capaz de acceder a una m√°quina que est√© en la otra red a la que est√° conectado el servidor.</strong>\n<strong>Documenta el proceso detalladamente.</strong></li>\n</ul>\n<p>Antes que nada, tendremos que tener un escenario donde realizaremos la pr√°ctica. Crear√© dos instancias en OpenStack, y el equipo servidor estar√° conectado a 2 redes distintas.</p>\n<p><img src=\"/img/SAD-P6.1.png\" alt=\"SAD-P6.1.png\"></p>\n<p>Una vez creado el escenario, empezaremos con la pr√°ctica.</p>\n<h5 id=\"configuraci%C3%B3n-del-servidor.\" tabindex=\"-1\">Configuraci√≥n del servidor.</h5>\n<p>Lo primero que haremos ser√° instalar openvpn.</p>\n<p><img src=\"/img/SAD-P6.2.png\" alt=\"SAD-P6.2.png\"></p>\n<p>Ahora, activaremos el bit de forwarding en el servidor.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:~$  nano /etc/sysctl.conf</code></pre>\n<p>editamos la siguiente l√≠nea:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"># Uncomment the next line to enable packet forwarding for IPv4<br>net.ipv4.ip_forward=1</code></pre>\n<p>Por precauci√≥n, copiaremos la configuraci√≥n que se encuentra en <code>/usr/share/easy-rsa</code> a <code>/etc/openvpn</code> para evitar que en una pr√≥xima actualizaci√≥n del paquete sobreescriba los cambios que hagamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:~$  cp -r /usr/share/easy-rsa /etc/openvpn</code></pre>\n<p>Ahora dentro del directorio <code>/etc/openvpn/easy-rsa/</code>, ejecutaremos el siguiente script para inicializar el directorio PKI:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa init-pki<br><br>init-pki complete; you may now create a CA or requests.<br>Your newly created PKI dir is: /etc/openvpn/easy-rsa/pki<br><br><br></code></pre>\n<p>A continuaci√≥n, vamos a generar el certificado de la CA y la clave con la que firmaremos los certificados. Tendremos que introducir una contrase√±a para el certificado y un nombre para la autoridad certificadora.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa build-ca<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br><br>Enter New CA Key Passphrase: <br>Re-Enter New CA Key Passphrase: <br>Generating RSA private key, 2048 bit long modulus (2 primes)<br>..............+++++<br>................................+++++<br>e is 65537 (0x010001)<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter '.', the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [Easy-RSA CA]:alejandro-montes<br><br>CA creation complete and you may now import and sign cert requests.<br>Your new CA certificate file for publishing is at:<br>/etc/openvpn/easy-rsa/pki/ca.crt</code></pre>\n<p>Como indica la salida del comando, el certificado se ha generado en la ruta <code>/etc/openvpn/easy-rsa/pki/ca.crt</code> mientras que la clave privada se encuentra en <code>/etc/openvpn/easy-rsa/pki/private/ca.key</code>. Ahora tendremos que generar los par√°metros Diffie-Hellman, los cu√°les se usan para el intercambio de claves entre el servidor de openvpn y los clientes.</p>\n<p><img src=\"/img/SAD-P6.3.png\" alt=\"SAD-P6.3.png\"></p>\n<p>El archivo ha sido generado en el directorio <code>/etc/openvpn/easy-rsa/pki/dh.pem</code>.</p>\n<p>Ahora generaremos el certificado y la clave privada del servidor openvpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa build-server-full server nopass<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br>Generating a RSA private key<br>.........................+++++<br>.......................+++++<br>writing new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-22061.NS9Bww/tmp.gmhUC5'<br>-----<br>Using configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-22061.NS9Bww/tmp.xcbWer<br>Enter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject's Distinguished Name is as follows<br>commonName            :ASN.1 12:'server'<br>Certificate is to be certified until Apr 17 11:03:08 2025 GMT (825 days)<br><br>Write out database with 1 new entries<br>Data Base Updated</code></pre>\n<p>El certificado ha sido guardado en la ruta <code>/etc/openvpn/easy-rsa/pki/issued/server.crt</code> y la clave privada se ha generado en <code>/etc/openvpn/easy-rsa/pki/private/server.key</code>. La opci√≥n nopass es para deshabilitar la frase de paso.</p>\n<p>Una vez hecho esto, generaremos el certificado y la clave privada del cliente de la vpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa build-client-full cliente-vpn nopass<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br>Generating a RSA private key<br>.................................+++++<br>..........+++++<br>writing new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-22138.MZyJbQ/tmp.MWGIDo'<br>-----<br>Using configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-22138.MZyJbQ/tmp.1G19BJ<br>Enter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject's Distinguished Name is as follows<br>commonName            :ASN.1 12:'cliente-vpn'<br>Certificate is to be certified until Apr 17 11:06:42 2025 GMT (825 days)<br><br>Write out database with 1 new entries<br>Data Base Updated<br><br></code></pre>\n<p>El certificado esta generado en <code>etc/openvpn/easy-rsa/pki/issued/Clientevpn1.crt</code> y la clave privada en <code>/etc/openvpn/easy-rsa/pki/private/Clientevpn1.key</code>.</p>\n<p>Ahora pasaremos al cliente los ficheros necesarios. Para ello, primero en el servidor crearemos una carpeta con los ficheros del cliente vpn y posteriormente lo pasaremos al cliente por scp mediante mi m√°quina local:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/openvpn/easy-rsa# mkdir /home/debian/cliente-vpn<br>root@servidor-vpn:/etc/openvpn/easy-rsa# cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/cliente-vpn.crt,private/cliente-vpn.key} /home/debian/cliente-vpn/<br>root@servidor-vpn:/etc/openvpn/easy-rsa# chown debian: /home/debian/cliente-vpn/<br>alemd@172.22.0.161's password: <br>cliente-vpn.key                           100% 1704   201.0KB/s   00:00    <br>ca.crt                                    100% 1224   138.4KB/s   00:00    <br>cliente-vpn.crt                           100% 4525   325.1KB/s   00:00   <br><br><br>alemd@debian:~$ scp -r cliente-vpn/ debian@172.22.201.177:<br>cliente-vpn.key                           100% 1704   125.8KB/s   00:00    <br>ca.crt                                    100% 1224     5.1KB/s   00:00    <br>cliente-vpn.crt                           100% 4525   329.6KB/s   00:00  </code></pre>\n<p>Una vez hecho esto, desde el lado del servidor a√∫n, crearemos el archivo de configuraci√≥n del tunel que crearemos a partir del fichero de ejemplo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/debian# cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/servidor.conf</code></pre>\n<p>Lo editamos y el resultado es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/debian# nano /etc/openvpn/server/servidor.conf</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\"><br>port 1194<br>proto udp<br>dev tun<br><br>ca /etc/openvpn/easy-rsa/pki/ca.crt<br>cert /etc/openvpn/easy-rsa/pki/issued/server.crt<br>key /etc/openvpn/easy-rsa/pki/private/server.key  # This file should be kept<br> secret<br>dh  /etc/openvpn/easy-rsa/pki/dh.pem<br><br>topology subnet<br><br>server 10.100.200.0 255.255.255.0<br>ifconfig-pool-persist /var/log/openvpn/ipp.txt<br><br>push \"route 192.168.100.0 255.255.255.0\"<br><br>keepalive 10 120<br>cipher AES-256-CBC<br>persist-key<br>persist-tun<br>status /var/log/openvpn/openvpn-status.log<br>verb 3<br><br>explicit-exit-notify 1</code></pre>\n<p>Ahora que hemos terminado de crear el fichero de configuraci√≥n, habilitaremos el servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/debian# systemctl enable --now openvpn-server@servidor<br>Created symlink /etc/systemd/system/multi-user.target.wants/openvpn-server@servidor.service ‚Üí /lib/systemd/system/openvpn-server@.service.</code></pre>\n<p>Muestro el estado del servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/debian# systemctl status openvpn-server@servidor<br><br>‚óè openvpn-server@servidor.service - OpenVPN service for servidor<br>     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; vendor preset: enabled)<br>     Active: active (running) since Fri 2023-01-13 11:37:51 UTC; 1min 8s ago<br>       Docs: man:openvpn(8)<br>             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage<br>             https://community.openvpn.net/openvpn/wiki/HOWTO<br>   Main PID: 22260 (openvpn)<br>     Status: \"Initialization Sequence Completed\"<br>      Tasks: 1 (limit: 527)<br>     Memory: 988.0K<br>        CPU: 14ms<br>     CGroup: /system.slice/system-openvpn\\x2dserver.slice/openvpn-server@servidor.service<br>             ‚îî‚îÄ22260 /usr/sbin/openvpn --status /run/openvpn-server/status-servidor.log --status-version 2 --suppress-timestamps --config servidor.conf<br><br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: net_iface_up: set tun0 up<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: net_addr_v4_add: 10.100.200.1/24 dev tun0<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: Could not determine IPv4/IPv6 protocol. Using AF_INET<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: Socket Buffers: R=[212992->212992] S=[212992->212992]<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: UDPv4 link local (bound): [AF_INET][undef]:1194<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: UDPv4 link remote: [AF_UNSPEC]<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: MULTI: multi_init called, r=256 v=256<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: IFCONFIG POOL IPv4: base=10.100.200.2 size=252<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: IFCONFIG POOL LIST<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: Initialization Sequence Completed<br></code></pre>\n<h5 id=\"configuraci%C3%B3n-del-cliente-vpn.\" tabindex=\"-1\">Configuraci√≥n del cliente VPN.</h5>\n<p>Ahora tomaremos el control del cliente e instalaremos openvpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">debian@cliente-vpn:~$ sudo apt install openvpn<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 pcscd<br>Suggested packages:<br>  pcmciautils openvpn-systemd-resolved<br>The following NEW packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 openvpn pcscd<br>0 upgraded, 10 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 2551 kB of archives.<br>After this operation, 7667 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>\n<p>Movemos el contenido del directorio que nos hemos pasado anteriormente por scp:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@cliente-vpn:/home/debian# mv cliente-vpn/* /etc/openvpn/client/</code></pre>\n<p>Le cambiamos el propietario a root a los archivos que hemos movido:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@cliente-vpn:/home/debian# chown root: /etc/openvpn/client/*</code></pre>\n<p>Creamos el siguiente archivo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@cliente-vpn:/home/debian# nano /etc/openvpn/client/cliente.conf</code></pre>\n<p>Le a√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">client<br>dev tun<br>proto udp<br><br>remote 10.0.0.15 1194<br>resolv-retry infinite<br>nobind<br>persist-key<br>persist-tun<br><br>ca /etc/openvpn/client/ca.crt<br>cert /etc/openvpn/client/cliente-vpn.crt<br>key /etc/openvpn/client/cliente-vpn.key<br><br>remote-cert-tls server<br>cipher AES-256-CBC<br>verb 3<br></code></pre>\n<p>Ahora miramos si el servicio est√° funcionando correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@cliente-vpn:/etc/openvpn/client# systemctl status openvpn-client@cliente<br>‚óè openvpn-client@cliente.service - OpenVPN tunnel for cliente<br>     Loaded: loaded (/lib/systemd/system/openvpn-client@.service; enabled; vendor preset: enabled)<br>     Active: active (running) since Fri 2023-01-13 19:44:09 UTC; 15s ago<br>       Docs: man:openvpn(8)<br>             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage<br>             https://community.openvpn.net/openvpn/wiki/HOWTO<br>   Main PID: 22514 (openvpn)<br>     Status: \"Initialization Sequence Completed\"<br>      Tasks: 1 (limit: 527)<br>     Memory: 1004.0K<br>        CPU: 22ms<br>     CGroup: /system.slice/system-openvpn\\x2dclient.slice/openvpn-client@cliente.service<br>             ‚îî‚îÄ22514 /usr/sbin/openvpn --suppress-timestamps --nobind --config cliente.conf<br><br>Jan 13 19:44:09 cliente-vpn openvpn[22514]: net_route_v4_best_gw query: dst 0.0.0.0<br>Jan 13 19:44:09 cliente-vpn openvpn[22514]: net_route_v4_best_gw result: via 10.0.0.1 dev ens3<br>Jan 13 19:44:09 cliente-vpn openvpn[22514]: ROUTE_GATEWAY 10.0.0.1/255.255.255.0 IFACE=ens3 HWADDR=fa:16:3e:7a:78:88<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: TUN/TAP device tun0 opened<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_iface_mtu_set: mtu 1500 for tun0<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_iface_up: set tun0 up<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_addr_v4_add: 10.100.200.2/24 dev tun0<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_route_v4_add: 192.168.100.0/24 via 10.100.200.1 dev [NULL] table 0 metric -1<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent ><br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: Initialization Sequence Completed</code></pre>\n<p>Como podemos ver, el servicio est√° activo y el servidor le ha asignado una ip correctamente. Ahora mostrar√© las interfaces de red del cliente y veremos que se ha creado un tun0 con la direcci√≥n ip de la vpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@cliente-vpn:/etc/openvpn/client# ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether fa:16:3e:7a:78:88 brd ff:ff:ff:ff:ff:ff<br>    altname enp0s3<br>    inet 10.0.0.186/24 brd 10.0.0.255 scope global dynamic ens3<br>       valid_lft 68878sec preferred_lft 68878sec<br>    inet6 fe80::f816:3eff:fe7a:7888/64 scope link <br>       valid_lft forever preferred_lft forever<br>3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500<br>    link/none <br>    inet 10.100.200.2/24 scope global tun0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::e7f5:181c:a293:e455/64 scope link stable-privacy <br>       valid_lft forever preferred_lft forever</code></pre>\n<p>Ahora muestro las interfaces de red del servidor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/debian# ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether fa:16:3e:b6:d0:79 brd ff:ff:ff:ff:ff:ff<br>    altname enp0s3<br>    inet 192.168.100.66/24 brd 192.168.100.255 scope global dynamic ens3<br>       valid_lft 78208sec preferred_lft 78208sec<br>    inet6 fe80::f816:3eff:feb6:d079/64 scope link <br>       valid_lft forever preferred_lft forever<br>3: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether fa:16:3e:23:26:50 brd ff:ff:ff:ff:ff:ff<br>    altname enp0s4<br>    inet 10.0.0.15/24 brd 10.0.0.255 scope global dynamic ens4<br>       valid_lft 83174sec preferred_lft 83174sec<br>    inet6 fe80::f816:3eff:fe23:2650/64 scope link <br>       valid_lft forever preferred_lft forever<br>4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500<br>    link/none <br>    inet 10.100.200.1/24 scope global tun0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::c656:fa09:7f9c:ffb4/64 scope link stable-privacy <br>       valid_lft forever preferred_lft forever</code></pre>\n<p>Ahora a√±adiremos un cliente conectado a la red de la vpn. A√±adiremos una ruta est√°tica por defecto para que use el servidor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ip route del default<br>ip route add default via 192.168.11.10</code></pre>\n<p><strong>Atenci√≥n he vuelto a hacer el escenario en Vagrant ya que en OpenStack da problemas al cambiar las rutas est√°ticas de la m√°quina.</strong></p>\n<p>Hay que remarcar que en el servidor tenemos que a√±adir una regla de encaminamiento desde la red de la vpn a la red con la que queremos que se vea. La regla es la siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/vagrant# sudo iptables -A POSTROUTING -t nat -s 172.111.222.0/24 -o eth2 -j MASQUERADE</code></pre>\n<p>Muestro como desde el cliente externo a la red vpn realiza ping al cliente de la vpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@clientevpn:~$ ping 172.111.222.2<br>PING 172.111.222.2 (172.111.222.2) 56(84) bytes of data.<br>64 bytes from 172.111.222.2: icmp_seq=1 ttl=63 time=1.70 ms<br>64 bytes from 172.111.222.2: icmp_seq=2 ttl=63 time=3.05 ms<br>64 bytes from 172.111.222.2: icmp_seq=3 ttl=63 time=2.35 ms<br>64 bytes from 172.111.222.2: icmp_seq=4 ttl=63 time=2.78 ms<br>64 bytes from 172.111.222.2: icmp_seq=5 ttl=63 time=2.72 ms</code></pre>\n<p>Ahora muestro un traceroute:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@clientevpn:~$ traceroute 172.111.222.2<br>traceroute to 172.111.222.2 (172.111.222.2), 30 hops max, 60 byte packets<br> 1  10.100.200.1 (10.100.200.1)  0.349 ms  0.267 ms  0.306 ms<br> 2  172.111.222.2 (172.111.222.2)  2.544 ms  2.526 ms  2.547 ms</code></pre>\n<p>Ahora desde el cliente de la vpn hago ping y un traceroute al cliente externo a la vpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@clientevpn:~$ ping 10.100.200.10<br>PING 10.100.200.10 (10.100.200.10) 56(84) bytes of data.<br>64 bytes from 10.100.200.10: icmp_seq=1 ttl=63 time=3.63 ms<br>64 bytes from 10.100.200.10: icmp_seq=2 ttl=63 time=2.50 ms<br>64 bytes from 10.100.200.10: icmp_seq=3 ttl=63 time=3.00 ms<br>64 bytes from 10.100.200.10: icmp_seq=4 ttl=63 time=3.08 ms<br>^C<br>--- 10.100.200.10 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3005ms<br>rtt min/avg/max/mdev = 2.497/3.053/3.633/0.402 ms<br>vagrant@clientevpn:~$ traceroute 10.100.200.10<br>traceroute to 10.100.200.10 (10.100.200.10), 30 hops max, 60 byte packets<br> 1  172.111.222.1 (172.111.222.1)  1.059 ms  0.955 ms  0.904 ms<br> 2  10.100.200.10 (10.100.200.10)  1.773 ms  1.640 ms  2.039 ms<br></code></pre>\n<h4 id=\"1.2.-vpn-sitio-a-sitio-con-openvpn-y-certificados-x509.-(10-puntos)\" tabindex=\"-1\">1.2. VPN sitio a sitio con OpenVPN y certificados x509. (10 puntos)</h4>\n<p><strong>Configura una conexi√≥n VPN sitio a sitio entre dos equipos del cloud:</strong></p>\n<ul>\n<li><strong>Cada equipo estar√° conectado a dos redes, una de ellas en com√∫n.</strong></li>\n<li><strong>Para la autenticaci√≥n de los extremos se usar√°n obligatoriamente certificados digitales, que se generar√°n utilizando openssl y se almacenar√°n en el directorio /etc/openvpn, junto con con los par√°metros Diffie-Helman y el certificado de la propia Autoridad de Certificaci√≥n.</strong></li>\n<li><strong>Se utilizar√°n direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN.</strong></li>\n<li><strong>Tras el establecimiento de la VPN, una m√°quina de cada red detr√°s de cada servidor VPN debe ser capaz de acceder a una m√°quina del otro extremo.</strong>\n<strong>Documenta el proceso detalladamente.</strong></li>\n</ul>\n<p>En este apartado, necesitaremos dos clientes y dos servidores y tendremos que conectar los servidores a trav√©s de una vpn. Adjunto un esquema l√≥gico para que se vea m√°s claro:</p>\n<p><img src=\"/img/site2site.png\" alt=\"site2site.png\"></p>\n<p>El escenario ser√° realizado en Vagrant. Adjunto el Vagrantfile con el escenario completo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Vagrant.configure(\"2\") do |config|<br><br>    config.vm.define :nodo1 do |nodo1|<br>      nodo1.vm.box = \"debian/bullseye64\"<br>      nodo1.vm.hostname = \"servidor-vpn\"<br>      nodo1.vm.synced_folder \".\", \"/vagrant\", disabled: true<br>      nodo1.vm.network :private_network,<br>      :libvirt__network_name => \"net1\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"10.0.0.10\",<br>      :libvirt__forward_mode => \"veryisolated\"<br>    end<br>  config.vm.define :nodo2 do |nodo2|<br>    nodo2.vm.box = \"debian/bullseye64\"<br>    nodo2.vm.hostname = \"clientevpn\"<br>    nodo2.vm.synced_folder \".\", \"/vagrant\", disabled: true<br>    nodo2.vm.network :private_network,<br>      :libvirt__network_name => \"net1\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"10.0.0.11\",<br>      :libvirt__forward_mode => \"veryisolated\"<br>    end<br>   config.vm.define :nodo3 do |nodo3|<br>     nodo3.vm.box = \"debian/bullseye64\"<br>     nodo3.vm.hostname = \"servidor2-vpn\"<br>     nodo3.vm.synced_folder \".\", \"/vagrant\", disabled: true      <br>     nodo3.vm.network :private_network,<br>      :libvirt__network_name => \"net2\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"10.1.2.1\",<br>      :libvirt__forward_mode => \"veryisolated\"<br>    end<br>  config.vm.define :nodo4 do |nodo4|<br>    nodo4.vm.box = \"debian/bullseye64\"<br>    nodo4.vm.hostname = \"cliente2vpn\"<br>    nodo4.vm.synced_folder \".\", \"/vagrant\", disabled: true<br>    nodo4.vm.network :private_network,<br>      :libvirt__network_name => \"net2\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"10.1.2.2\",<br>      :libvirt__forward_mode => \"veryisolated\"<br>    end<br>  end</code></pre>\n<p>Como podemos ver, son dos servidores totalmente aislados con un cliente cada uno y lo que haremos ser√° configurar una vpn para que ambas redes sean visibles entre s√≠.</p>\n<h5 id=\"configuraci%C3%B3n-del-servidor1.\" tabindex=\"-1\">Configuraci√≥n del servidor1.</h5>\n<p>Lo primero que haremos, ser√° instalar openvpn y configurar un fichero llamado vars, cogeremos de ejemplo un fichero que se encontrar√° en el mismo directorio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@servidor-vpn:~$ sudo apt install openvpn<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 pcscd<br>Suggested packages:<br>  pcmciautils resolvconf openvpn-systemd-resolved<br>The following NEW packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 openvpn pcscd<br>0 upgraded, 10 newly installed, 0 to remove and 31 not upgraded.<br>Need to get 2551 kB of archives.<br>After this operation, 7667 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y<br>vagrant@servidor-vpn:~$ cd /usr/share/easy-rsa/<br>vagrant@servidor-vpn:/usr/share/easy-rsa$ sudo su<br>root@servidor-vpn:/usr/share/easy-rsa# cp vars.example vars<br>root@servidor-vpn:/usr/share/easy-rsa# nano vars</code></pre>\n<p>El archivo vars contiene lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">set_var EASYRSA_REQ_COUNTRY     \"ES\"<br>set_var EASYRSA_REQ_PROVINCE    \"Sevilla\"<br>set_var EASYRSA_REQ_CITY        \"Utrera\"<br>set_var EASYRSA_REQ_ORG         \"amontes\"<br>set_var EASYRSA_REQ_EMAIL       \"aaleemd11@gmail.com\"<br>set_var EASYRSA_REQ_OU          \"Practica VPN\"</code></pre>\n<p>Ahora crearemos el directorio donde se almacenaran los documentos de la CA:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# ./easyrsa init-pki<br><br>Note: using Easy-RSA configuration from: /usr/share/easy-rsa/vars<br><br>init-pki complete; you may now create a CA or requests.<br>Your newly created PKI dir is: /usr/share/easy-rsa/pki<br><br></code></pre>\n<p>Ahora crearemos una clave Diffie-Hellman:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# ./easyrsa gen-dh<br><br>Note: using Easy-RSA configuration from: /usr/share/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br>Generating DH parameters, 2048 bit long safe prime, generator 2<br>This is going to take a long time<br>........................+............................................................+....+..............................+.............................................................................................+..............................................+...........................................................................................................................................................................................................................+...................................<br><br>DH parameters of size 2048 created at /usr/share/easy-rsa/pki/dh.pem<br></code></pre>\n<p>Una vez hecho esto, crearemos la CA:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# ./easyrsa build-ca<br><br>Note: using Easy-RSA configuration from: /usr/share/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br><br>Enter New CA Key Passphrase: <br>Re-Enter New CA Key Passphrase: <br>Generating RSA private key, 2048 bit long modulus (2 primes)<br>.....................+++++<br>......................................+++++<br>e is 65537 (0x010001)<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter '.', the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [Easy-RSA CA]:Alejandro Montes<br><br>CA creation complete and you may now import and sign cert requests.<br>Your new CA certificate file for publishing is at:<br>/usr/share/easy-rsa/pki/ca.crt</code></pre>\n<p>Cuando tengamos lista nuestra CA, lo primero que haremos ser√° crear y firmar el certificado que usar√° nuestra m√°quina servidor.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# ./easyrsa gen-req server<br><br>Note: using Easy-RSA configuration from: /usr/share/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br>Generating a RSA private key<br>..........................+++++<br>.................................................................................................+++++<br>writing new private key to '/usr/share/easy-rsa/pki/easy-rsa-613.56pi8H/tmp.zJd9ro'<br>Enter PEM pass phrase:<br>Verifying - Enter PEM pass phrase:<br>-----<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter '.', the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [server]:Alejandro Montes<br><br>Keypair and certificate request completed. Your files are:<br>req: /usr/share/easy-rsa/pki/reqs/server.req<br>key: /usr/share/easy-rsa/pki/private/server.key</code></pre>\n<p>Ahora firmamos el certificado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# ./easyrsa sign-req server server<br><br>Note: using Easy-RSA configuration from: /usr/share/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br><br><br>You are about to sign the following certificate.<br>Please check over the details shown below for accuracy. Note that this request<br>has not been cryptographically verified. Please be sure it came from a trusted<br>source or that you have verified the request checksum with the sender.<br><br>Request subject, to be signed as a server certificate for 825 days:<br><br>subject=<br>    commonName                = Alejandro Montes<br><br><br>Type the word 'yes' to continue, or any other input to abort.<br>  Confirm request details: yes<br>Using configuration from /usr/share/easy-rsa/pki/easy-rsa-635.4wZS7o/tmp.l26dgD<br>Enter pass phrase for /usr/share/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject's Distinguished Name is as follows<br>commonName            :ASN.1 12:'Alejandro Montes'<br>Certificate is to be certified until Apr 29 09:05:56 2025 GMT (825 days)<br><br>Write out database with 1 new entries<br>Data Base Updated<br><br>Certificate created at: /usr/share/easy-rsa/pki/issued/server.crt</code></pre>\n<p>Tras crear y firmar el certificado, crearemos y firmaremos el certificado que usar√° el servidor2.:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# ./easyrsa gen-req vpn_server2<br><br>Note: using Easy-RSA configuration from: /usr/share/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br>Generating a RSA private key<br>.....+++++<br>.............................................+++++<br>writing new private key to '/usr/share/easy-rsa/pki/easy-rsa-698.V9av96/tmp.uT7ClE'<br>Enter PEM pass phrase:<br>Verifying - Enter PEM pass phrase:<br>-----<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter '.', the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [vpn_server2]:Servidor 2<br><br>Keypair and certificate request completed. Your files are:<br>req: /usr/share/easy-rsa/pki/reqs/vpn_server2.req<br>key: /usr/share/easy-rsa/pki/private/vpn_server2.key<br></code></pre>\n<p>Y lo firmamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# ./easyrsa sign-req client vpn_server2<br><br>Note: using Easy-RSA configuration from: /usr/share/easy-rsa/vars<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br><br><br>You are about to sign the following certificate.<br>Please check over the details shown below for accuracy. Note that this request<br>has not been cryptographically verified. Please be sure it came from a trusted<br>source or that you have verified the request checksum with the sender.<br><br>Request subject, to be signed as a client certificate for 825 days:<br><br>subject=<br>    commonName                = Servidor 2<br><br><br>Type the word 'yes' to continue, or any other input to abort.<br>  Confirm request details: yes<br>Using configuration from /usr/share/easy-rsa/pki/easy-rsa-747.Dd9qde/tmp.YOHohQ<br>Enter pass phrase for /usr/share/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject's Distinguished Name is as follows<br>commonName            :ASN.1 12:'Servidor 2'<br>Certificate is to be certified until Apr 29 09:10:37 2025 GMT (825 days)<br><br>Write out database with 1 new entries<br>Data Base Updated<br><br>Certificate created at: /usr/share/easy-rsa/pki/issued/vpn_server2.crt</code></pre>\n<p>Ahora copiaremos los ficheros a la ruta <code>/etc/openvpn</code> para que funcione el servidor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa/pki# cp ca.crt /etc/openvpn/server/<br>root@servidor-vpn:/usr/share/easy-rsa/pki# cp dh.pem /etc/openvpn/server/<br>root@servidor-vpn:/usr/share/easy-rsa/pki# cp issued/server.crt /etc/openvpn/server/<br>root@servidor-vpn:/usr/share/easy-rsa/pki# cp private/server.key /etc/openvpn/server/</code></pre>\n<p>Ahora pasamos al otro servidor los archivos necesarios para que se conecte al servidor vpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/usr/share/easy-rsa# scp pki/ca.crt vagrant@192.168.121.252:<br>ca.crt                                  100% 1224   672.0KB/s   00:00    <br>root@servidor-vpn:/usr/share/easy-rsa# scp pki/issued/vpn_server2.crt vagrant@192.168.121.252:<br>vpn_server2.crt                         100% 4527   134.1KB/s   00:00    <br>root@servidor-vpn:/usr/share/easy-rsa# scp pki/private/vpn_server2.key vagrant@192.168.121.252:<br>vpn_server2.key    </code></pre>\n<p>Una vez hayamos pasados los archivos al otro servidor y hayamos copiado los ficheros a su ruta correspondiente, crearemos el fichero de configuraci√≥n del servidor vpn.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">dev tun<br>ifconfig 100.0.123.1 100.0.123.2<br>route 10.1.2.0 255.255.255.0<br>tls-server<br>ca ca.crt<br>cert server.crt<br>key server.key<br>dh dh.pem<br>comp-lzo<br>keepalive 10 120<br>log /var/log/openvpn/server.log<br>verb 3<br>askpass passwd.txt</code></pre>\n<p>Creamos en /etc/openvpn/server un fichero llamado passwd.txt con la contrase√±a de frase de paso que hemos introducido anteriormente.</p>\n<p>Iniciamos el servidor vpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/openvpn/server# systemctl start openvpn-server@servidor</code></pre>\n<p>Ahora hacemos un status para ver que se ha iniciado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">‚óè openvpn-server@servidor.service - OpenVPN service for servidor<br>     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; disable><br>     Active: active (running) since Wed 2023-01-25 12:21:45 UTC; 39s ago<br>       Docs: man:openvpn(8)<br>             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage<br>             https://community.openvpn.net/openvpn/wiki/HOWTO<br>   Main PID: 11960 (openvpn)<br>     Status: \"Pre-connection initialization successful\"<br>      Tasks: 1 (limit: 527)<br>     Memory: 936.0K<br>        CPU: 27ms<br>     CGroup: /system.slice/system-openvpn\\x2dserver.slice/openvpn-server@><br>             ‚îî‚îÄ11960 /usr/sbin/openvpn --status /run/openvpn-server/statu><br><br>Jan 25 12:21:44 servidor-vpn systemd[1]: Starting OpenVPN service for ser><br>Jan 25 12:21:45 servidor-vpn openvpn[11960]: WARNING: Compression for rec><br>Jan 25 12:21:45 servidor-vpn systemd[1]: Started OpenVPN service for serv></code></pre>\n<p>Si no lo hemos hecho antes, activamos el bit de forwarding a 1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/openvpn/server# echo 1 > /proc/sys/net/ipv4/ip_forward</code></pre>\n<h5 id=\"configuraci%C3%B3n-del-cliente1.\" tabindex=\"-1\">Configuraci√≥n del cliente1.</h5>\n<p>Cambiaremos la ruta por defecto del cliente1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@clientevpn:~$ sudo ip r del default<br>vagrant@clientevpn:~$ sudo ip r add default via 10.0.0.10</code></pre>\n<h5 id=\"configuraci%C3%B3n-del-servidor2.\" tabindex=\"-1\">Configuraci√≥n del servidor2.</h5>\n<p>Ahora configuraremos el servidor 2 que es el otro extremo del t√∫nel vpn. Lo primero que haremos ser√° instalar openvpn y mover los ficheros que pasamos anteriormente por scp a las rutas adecuadas:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@servidor2-vpn:~$ sudo apt install openvpn<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 pcscd<br>Suggested packages:<br>  pcmciautils resolvconf openvpn-systemd-resolved<br>The following NEW packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 openvpn pcscd<br>0 upgraded, 10 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 2551 kB of archives.<br>After this operation, 7667 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y<br>vagrant@servidor2-vpn:~$ sudo su<br>root@servidor2-vpn:/home/vagrant# mv ca.crt /etc/openvpn/client/<br>root@servidor2-vpn:/home/vagrant# mv vpn_server2.crt /etc/openvpn/client/<br>root@servidor2-vpn:/home/vagrant# mv vpn_server2.key /etc/openvpn/client/</code></pre>\n<p>Creamos un archivo de configuraci√≥n para este servidor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor2-vpn:/home/vagrant# nano /etc/openvpn/client/client.conf</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">dev tun<br>remote 192.168.121.6<br>ifconfig 100.0.123.2 100.0.123.1<br>route 10.0.0.0 255.255.255.0<br>tls-client<br>ca ca.crt<br>cert vpn_server2.crt<br>key vpn_server2.key<br>comp-lzo<br>keepalive 10 60<br>verb 3<br>askpass passwd2.txt</code></pre>\n<p>Ahora arrancamos el servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor2-vpn:/etc/openvpn/client# systemctl start openvpn-client@client</code></pre>\n<p>Muestro el estado del servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">openvpn-client@client.service - OpenVPN tunnel for client<br>     Loaded: loaded (/lib/systemd/system/openvpn-client@.service; disable><br>     Active: active (running) since Wed 2023-01-25 14:25:56 UTC; 2min 14s><br>       Docs: man:openvpn(8)<br>             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage<br>             https://community.openvpn.net/openvpn/wiki/HOWTO<br>   Main PID: 12472 (openvpn)<br>     Status: \"Pre-connection initialization successful\"<br>      Tasks: 1 (limit: 527)<br>     Memory: 1.1M<br>        CPU: 50ms<br>     CGroup: /system.slice/system-openvpn\\x2dclient.slice/openvpn-client@><br>             ‚îî‚îÄ12472 /usr/sbin/openvpn --suppress-timestamps --nobind --c><br><br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: ROUTE_GATEWAY 192.168.121.1><br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: TUN/TAP device tun0 opened<br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: net_iface_mtu_set: mtu 1500><br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: net_iface_up: set tun0 up<br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: net_addr_ptp_v4_add: 100.0.><br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: net_route_v4_add: 10.0.0.0/><br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: TCP/UDP: Preserving recentl><br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: Socket Buffers: R=[212992->><br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: UDP link local: (not bound)<br>Jan 25 14:28:06 servidor2-vpn openvpn[12472]: UDP link remote: [AF_INET]1></code></pre>\n<p>No debemos olvidarnos de activar el bit de forwarding en este servidor tambi√©n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">echo 1 > /proc/sys/net/ipv4/ip_forward</code></pre>\n<h5 id=\"configuraci%C3%B3n-cliente-2.\" tabindex=\"-1\">Configuraci√≥n cliente 2.</h5>\n<p>Cambiamos la ruta por defecto del cliente2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@cliente2vpn:~$ sudo ip r del default<br>vagrant@cliente2vpn:~$ sudo ip r add default via 10.1.2.1</code></pre>\n<h5 id=\"comprobaciones.\" tabindex=\"-1\">Comprobaciones.</h5>\n<p>IPs:</p>\n<p>Servidor1-vpn:10.0.0.10,192.168.121.6</p>\n<p>Cliente1-vpn:10.0.0.11</p>\n<p>Servidor2-vpn:10.1.2.1.1,192.168.121.252</p>\n<p>Cliente2-vpn:10.1.2.1.2</p>\n<p>Ping y traceroute desde el cliente del servidor 1 al cliente del servidor 2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@clientevpn:~$ ping 10.1.2.2<br>PING 10.1.2.2 (10.1.2.2) 56(84) bytes of data.<br>64 bytes from 10.1.2.2: icmp_seq=1 ttl=62 time=3.13 ms<br>64 bytes from 10.1.2.2: icmp_seq=2 ttl=62 time=3.48 ms<br>64 bytes from 10.1.2.2: icmp_seq=3 ttl=62 time=3.55 ms<br>64 bytes from 10.1.2.2: icmp_seq=4 ttl=62 time=3.14 ms<br>^C<br>--- 10.1.2.2 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3005ms<br>rtt min/avg/max/mdev = 3.130/3.325/3.549/0.191 ms<br>vagrant@clientevpn:~$ traceroute 10.1.2.2<br>traceroute to 10.1.2.2 (10.1.2.2), 30 hops max, 60 byte packets<br> 1  10.0.0.10 (10.0.0.10)  0.470 ms  0.414 ms  0.469 ms<br> 2  pool-100-0-123-2.bstnma.fios.verizon.net (100.0.123.2)  1.674 ms  3.207 ms  3.144 ms<br> 3  10.1.2.2 (10.1.2.2)  3.090 ms  3.072 ms  2.993 ms</code></pre>\n<p>Ping y traceroute desde el cliente del servidor 2 al cliente del servidor 1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@cliente2vpn:~$ ping 10.0.0.11<br>PING 10.0.0.11 (10.0.0.11) 56(84) bytes of data.<br>64 bytes from 10.0.0.11: icmp_seq=1 ttl=62 time=3.55 ms<br>64 bytes from 10.0.0.11: icmp_seq=2 ttl=62 time=3.91 ms<br>64 bytes from 10.0.0.11: icmp_seq=3 ttl=62 time=3.89 ms<br>^C<br>--- 10.0.0.11 ping statistics ---<br>3 packets transmitted, 3 received, 0% packet loss, time 2003ms<br>rtt min/avg/max/mdev = 3.551/3.782/3.910/0.163 ms<br>vagrant@cliente2vpn:~$ traceroute 10.0.0.11<br>traceroute to 10.0.0.11 (10.0.0.11), 30 hops max, 60 byte packets<br> 1  10.1.2.1 (10.1.2.1)  0.577 ms  0.532 ms  0.476 ms<br> 2  lo0-100.BSTNMA-VFTTP-306.verizon-gni.net (100.0.123.1)  2.497 ms  2.832 ms  3.371 ms<br> 3  10.0.0.11 (10.0.0.11)  3.341 ms  3.210 ms  3.121 ms</code></pre>\n<h3 id=\"wireguard\" tabindex=\"-1\">WireGuard</h3>\n<h4 id=\"2.1.-vpn-de-acceso-remoto-con-wireguard.-(5-puntos)\" tabindex=\"-1\">2.1. VPN de acceso remoto con WireGuard. (5 puntos)</h4>\n<p><strong>Monta una VPN de acceso remoto usando Wireguard. Intenta probarla con clientes Windows, Linux y Android. Documenta el proceso adecuadamente y comp√°ralo con el del apartado A.</strong></p>\n<p>Para crear el escenario he usado este Vagrantfile:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Vagrant.configure(\"2\") do |config|<br><br>    config.vm.define :nodo1 do |nodo1|<br>      nodo1.vm.box = \"debian/bullseye64\"<br>      nodo1.vm.hostname = \"wireguard-server\"<br>      nodo1.vm.synced_folder \".\", \"/vagrant\", disabled: true<br>      nodo1.vm.network :private_network,<br>      :libvirt__network_name => \"net1\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"192.168.100.1\",<br>      :libvirt__forward_mode => \"veryisolated\"<br>      nodo1.vm.network :private_network,<br>      :libvirt__network_name => \"net-privada\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"192.168.50.1\",<br>      :libvirt__forward_mode => \"veryisolated\"<br><br>    end<br>    config.vm.define :nodo2 do |nodo2|<br>      nodo2.vm.box = \"debian/bullseye64\"<br>      nodo2.vm.hostname = \"wireguard-client\"<br>      nodo2.vm.synced_folder \".\", \"/vagrant\", disabled: true<br>      nodo2.vm.network :private_network,<br>      :libvirt__network_name => \"net1\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"192.168.100.2\",<br>      :libvirt__forward_mode => \"veryisolated\"<br>    end<br>    config.vm.define :nodo3 do |nodo3|<br>      nodo3.vm.box = \"debian/bullseye64\"<br>      nodo3.vm.hostname = \"private-client\"<br>      nodo3.vm.synced_folder \".\", \"/vagrant\", disabled: true<br>      nodo3.vm.network :private_network,<br>      :libvirt__network_name => \"net-privada\",<br>      :libvirt__dhcp_enabled => false,<br>      :ip => \"192.168.50.10\",<br>      :libvirt__forward_mode => \"veryisolated\"<br>    end<br>  end</code></pre>\n<h5 id=\"configuraci%C3%B3n-del-servidor.-1\" tabindex=\"-1\">Configuraci√≥n del servidor.</h5>\n<p>Una vez creado el escenario, entraremos al servidor y lo configuraremos, para ello lo primero que haremos ser√° instalar wireguard:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@wireguard-server:~$ sudo apt install wireguard<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  wireguard-tools<br>Suggested packages:<br>  openresolv | resolvconf<br>The following NEW packages will be installed:<br>  wireguard wireguard-tools<br>0 upgraded, 2 newly installed, 0 to remove and 31 not upgraded.<br>Need to get 94.3 kB of archives.<br>After this operation, 344 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>\n<p>Como he tenido problemas en el apartado anterior, lo primero que haremos ser√° activar el bit de forwarding:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@wireguard-server:~$ sudo nano /etc/sysctl.conf</code></pre>\n<p>Y descomentamos la l√≠nea:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">net.ipv4.ip_forward=1</code></pre>\n<p>Creamos un par de claves usando el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@wireguard-server:~$ sudo su<br>root@wireguard-server:/home/vagrant# cd /etc/wireguard/<br>root@wireguard-server:/etc/wireguard# wg genkey | tee serverprivatekey | wg pubkey > serverpublickey</code></pre>\n<p>Creamos el archivo de configuraci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-server:/etc/wireguard# nano wg0.conf</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Interface]<br>Address = 10.0.100.1 #IP de la nueva interfaz<br>PrivateKey = yMILnmrL3ACptes5tfVdGQE7aeMRjX04t1KgOF811W8= #Clave privada generada anteriormente.<br>ListenPort = 51820 #Puerto de escucha.</code></pre>\n<p>Levantamos la interfaz creada con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-server:/etc/wireguard# wg-quick up wg0<br>[#] ip link add wg0 type wireguard<br>[#] wg setconf wg0 /dev/fd/63<br>[#] ip -4 address add 10.0.100.1 dev wg0<br>[#] ip link set mtu 1420 up dev wg0</code></pre>\n<p>Como vemos con el siguiente comanfo, la interfaz est√° activa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-server:/etc/wireguard# wg<br>interface: wg0<br>  public key: bEnc2dZ0wBF6R3GBNmeGWidnyng+w4I2QZNFqFA2emA=<br>  private key: (hidden)<br>  listening port: 51820</code></pre>\n<p>Ahora que el servidor ya est√° configurado, procederemos a configurar los clientes:</p>\n<h5 id=\"configuraci%C3%B3n-cliente-debian.\" tabindex=\"-1\">Configuraci√≥n cliente debian.</h5>\n<p>Instalamos wireguard y creamos el par de claves:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@wireguard-client:~$ sudo apt install wireguard<br>vagrant@wireguard-client:~$ sudo su<br>cdroot@wireguard-client:/home/vagrant# cd /etc/wireguard/<br>root@wireguard-client:/etc/wireguard# wg genkey | tee clientprivatekey | wg pubkey > clientpublickey</code></pre>\n<p>Creamos el fichero de configuraci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-client:/etc/wireguard# nano wg0.conf<br><br>[Interface]<br>Address = 10.0.100.2<br>PrivateKey = kDCxFoW5x4U41A826+d1l8k6J1frGKHYk5PsK2A7Y2k=<br>ListenPort = 51820<br><br>[Peer]<br>PublicKey = bEnc2dZ0wBF6R3GBNmeGWidnyng+w4I2QZNFqFA2emA=<br>AllowedIPs = 0.0.0.0/0<br>Endpoint = 192.168.100.1:51820</code></pre>\n<p>Ahora del lado del servidor editamos la configuraci√≥n y a√±adimos un bloque peer:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-server:/etc/wireguard# nano wg0.conf <br><br><br>[Interface]<br>Address = 10.0.100.1<br>PrivateKey = 6OC4j5vEf+qxlROFk+6V8GSKc+wBJkHpDtLtCFLUG3s=<br>ListenPort = 51820<br><br>[Peer]<br>Publickey = 3VMhNkz7uu2NdG4kv59RPyZZmmF/00MZvvbnt5tyx38=<br>AllowedIPs = 10.0.100.2/32<br>PersistentKeepAlive = 25</code></pre>\n<p>Desactivamos y activamos la interfaz de wireguard tanto en el cliente como en el servidor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-server:/etc/wireguard# wg-quick down wg0<br>[#] ip link delete dev wg0<br>root@wireguard-server:/etc/wireguard# wg-quick up wg0<br>[#] ip link add wg0 type wireguard<br>[#] wg setconf wg0 /dev/fd/63<br>[#] ip -4 address add 10.0.100.1 dev wg0<br>[#] ip link set mtu 1420 up dev wg0<br>[#] ip -4 route add 10.0.100.2/32 dev wg0</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-server:/etc/wireguard# wg<br>interface: wg0<br>  public key: B3YLtNXGjfm5H+4DIz/rs55TtJ1T65IB1q7rpS1IqBA=<br>  private key: (hidden)<br>  listening port: 51820<br><br>peer: 3VMhNkz7uu2NdG4kv59RPyZZmmF/00MZvvbnt5tyx38=<br>  endpoint: 192.168.100.2:51820<br>  allowed ips: 10.0.100.2/32<br>  latest handshake: 15 seconds ago<br>  transfer: 180 B received, 124 B sent<br>  persistent keepalive: every 25 seconds</code></pre>\n<p>Ahora el cliente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-client:/etc/wireguard# wg-quick down wg0<br>[#] ip -4 rule delete table 51820<br>[#] ip -4 rule delete table main suppress_prefixlength 0<br>[#] ip link delete dev wg0<br>[#] nft -f /dev/fd/63<br>root@wireguard-client:/etc/wireguard# wg-quick up wg0<br>[#] ip link add wg0 type wireguard<br>[#] wg setconf wg0 /dev/fd/63<br>[#] ip -4 address add 10.0.100.2 dev wg0<br>[#] ip link set mtu 1420 up dev wg0<br>[#] wg set wg0 fwmark 51820<br>[#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820<br>[#] ip -4 rule add not fwmark 51820 table 51820<br>[#] ip -4 rule add table main suppress_prefixlength 0<br>[#] sysctl -q net.ipv4.conf.all.src_valid_mark=1<br>[#] nft -f /dev/fd/63</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-client:/etc/wireguard# wg<br>interface: wg0<br>  public key: 3VMhNkz7uu2NdG4kv59RPyZZmmF/00MZvvbnt5tyx38=<br>  private key: (hidden)<br>  listening port: 51820<br>  fwmark: 0xca6c<br><br>peer: B3YLtNXGjfm5H+4DIz/rs55TtJ1T65IB1q7rpS1IqBA=<br>  endpoint: 192.168.100.1:51820<br>  allowed ips: 0.0.0.0/0<br>  latest handshake: 33 seconds ago<br>  transfer: 156 B received, 612 B sent</code></pre>\n<h5 id=\"cliente-debian.\" tabindex=\"-1\">Cliente Debian.</h5>\n<p>Para que el cliente interno Debian se vea con la vpn tendremos que cambiarle la ruta por defecto:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@private-client:~$ sudo ip r del default<br>vagrant@private-client:~$ sudo ip r add default via 192.168.50.1</code></pre>\n<h5 id=\"comprobaciones.-1\" tabindex=\"-1\">Comprobaciones.</h5>\n<p>Ping y traceroute desde el cliente interno (Debian) al cliente vpn:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@private-client:~$ ping 10.0.100.2<br>PING 10.0.100.2 (10.0.100.2) 56(84) bytes of data.<br>64 bytes from 10.0.100.2: icmp_seq=1 ttl=63 time=1.06 ms<br>64 bytes from 10.0.100.2: icmp_seq=2 ttl=63 time=2.16 ms<br>64 bytes from 10.0.100.2: icmp_seq=3 ttl=63 time=2.49 ms<br>64 bytes from 10.0.100.2: icmp_seq=4 ttl=63 time=2.06 ms<br>^C<br>--- 10.0.100.2 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3006ms<br>rtt min/avg/max/mdev = 1.056/1.939/2.486/0.534 ms<br>vagrant@private-client:~$ traceroute 10.0.100.2<br>traceroute to 10.0.100.2 (10.0.100.2), 30 hops max, 60 byte packets<br> 1  192.168.50.1 (192.168.50.1)  0.641 ms  0.622 ms  0.700 ms<br> 2  10.0.100.2 (10.0.100.2)  1.899 ms  1.976 ms  2.234 ms</code></pre>\n<p>Ping y traceroute desde el cliente vpn al cliente interno(Debian):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">oot@wireguard-client:/etc/wireguard# ping 192.168.50.10<br>PING 192.168.50.10 (192.168.50.10) 56(84) bytes of data.<br>64 bytes from 192.168.50.10: icmp_seq=1 ttl=63 time=2.11 ms<br>64 bytes from 192.168.50.10: icmp_seq=2 ttl=63 time=2.81 ms<br>64 bytes from 192.168.50.10: icmp_seq=3 ttl=63 time=2.31 ms<br>64 bytes from 192.168.50.10: icmp_seq=4 ttl=63 time=1.03 ms<br>^C<br>--- 192.168.50.10 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3006ms<br>rtt min/avg/max/mdev = 1.027/2.062/2.806/0.649 ms<br>root@wireguard-client:/etc/wireguard# traceroute 192.168.50.10<br>traceroute to 192.168.50.10 (192.168.50.10), 30 hops max, 60 byte packets<br> 1  10.0.100.1 (10.0.100.1)  0.905 ms  0.672 ms  0.462 ms<br> 2  192.168.50.10 (192.168.50.10)  1.202 ms  1.026 ms  0.953 ms</code></pre>\n<h5 id=\"cliente-windows.\" tabindex=\"-1\">Cliente Windows.</h5>\n<p>Para windows, nos descargaremos el programa desde su p√°gina oficial, es un ejecutable y se instala de manera muy sencilla, no veo necesario poner los pasos a seguir para la instalaci√≥n.</p>\n<p>Una vez hecho esto, le damos a crear nuevo t√∫nel y nos aparecer√° lo siguiente:</p>\n<p><img src=\"/img/SAD-P6.4.png\" alt=\"SAD-P6.4.png\"></p>\n<p>Crearemos el archivo de configuraci√≥n del cliente vpn.</p>\n<p><img src=\"/img/SAD-P6.5.png\" alt=\"SAD-P6.5.png\"></p>\n<p>A√±adimos al servidor otro peer con los datos del cliente windows. La configuraci√≥n quedar√≠a as√≠:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Interface]<br>Address = 10.0.100.1<br>PrivateKey = 6OC4j5vEf+qxlROFk+6V8GSKc+wBJkHpDtLtCFLUG3s=<br>ListenPort = 51820<br><br>[Peer]<br>Publickey = 3VMhNkz7uu2NdG4kv59RPyZZmmF/00MZvvbnt5tyx38=<br>AllowedIPs = 10.0.100.2/32<br>PersistentKeepAlive = 25<br><br>[Peer]<br>Publickey = ARu1pvsyDprc147XdaBNliCeuBl8mtnY65xIYR2UPio=<br>AllowedIPs = 10.0.100.3/32<br>PersistentKeepAlive = 25<br></code></pre>\n<p>Si  en el cliente pulsamos activate, habilitamos la vpn:</p>\n<p><img src=\"/img/SAD-P6.6.png\" alt=\"SAD-P6.6.png\"></p>\n<h5 id=\"comprobaciones-cliente-vpn-windows.\" tabindex=\"-1\">Comprobaciones Cliente VPN Windows.</h5>\n<p>Lo primero que haremos ser√° hacer ping y traceroute desde el cliente windows al cliente interno:</p>\n<p><img src=\"/img/SAD-P6.7.png\" alt=\"SAD-P6.7.png\"></p>\n<p>Ahora desde el cliente interno ping y traceroute al cliente vpn windows:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@private-client:~$ ping 10.0.100.3<br>PING 10.0.100.3 (10.0.100.3) 56(84) bytes of data.<br>64 bytes from 10.0.100.3: icmp_seq=1 ttl=127 time=2.29 ms<br>64 bytes from 10.0.100.3: icmp_seq=2 ttl=127 time=11.8 ms<br>64 bytes from 10.0.100.3: icmp_seq=3 ttl=127 time=4.78 ms<br>64 bytes from 10.0.100.3: icmp_seq=4 ttl=127 time=1.83 ms<br>^C<br>--- 10.0.100.3 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3005ms<br>rtt min/avg/max/mdev = 1.834/5.178/11.816/3.992 ms<br>vagrant@private-client:~$ traceroute 10.0.100.3<br>traceroute to 10.0.100.3 (10.0.100.3), 30 hops max, 60 byte packets<br> 1  192.168.50.1 (192.168.50.1)  0.514 ms  0.621 ms  0.571 ms<br> 2  10.0.100.3 (10.0.100.3)  12.915 ms * *<br>vagrant@private-client:~$ </code></pre>\n<p>Por √∫ltimo desde el otro cliente de la vpn tambi√©n probaremos que tiene conexi√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@wireguard-client:/home/vagrant# ping 10.0.100.3<br>PING 10.0.100.3 (10.0.100.3) 56(84) bytes of data.<br>64 bytes from 10.0.100.3: icmp_seq=1 ttl=127 time=2.98 ms<br>64 bytes from 10.0.100.3: icmp_seq=2 ttl=127 time=11.6 ms<br>64 bytes from 10.0.100.3: icmp_seq=3 ttl=127 time=3.14 ms<br>64 bytes from 10.0.100.3: icmp_seq=4 ttl=127 time=1.96 ms<br>^C<br>--- 10.0.100.3 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3005ms<br>rtt min/avg/max/mdev = 1.964/4.924/11.618/3.890 ms<br>root@wireguard-client:/home/vagrant# traceroute 10.0.100.3<br>traceroute to 10.0.100.3 (10.0.100.3), 30 hops max, 60 byte packets<br> 1  10.0.100.1 (10.0.100.1)  1.913 ms  1.565 ms  1.451 ms<br> 2  10.0.100.3 (10.0.100.3)  4.352 ms * *<br></code></pre>\n<h4 id=\"2.2.-vpn-sitio-a-sitio-con-wireguard.-(10-puntos)\" tabindex=\"-1\">2.2. VPN sitio a sitio con WireGuard. (10 puntos)</h4>\n<p><strong>Configura una VPN sitio a sitio usando WireGuard. Documenta el proceso adecuadamente y comp√°ralo con el del apartado B.</strong></p>\n<p>Lo primero que har√© ser√° copiar el escenario del apartado B que es openvpn site to site, ser√° exactamente el mismo cambiando openvpn por wireguard. No adjunto el vagrant ya que est√° m√°s arriba.</p>\n<p>Para no olvidarnos lo primero que haremos ser√° cambiar la puerta de enlace de los dos clientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@clientevpn:~$ sudo ip r del default<br>vagrant@clientevpn:~$ sudo ip r add default via 10.0.0.10<br></code></pre>\n<p>Cliente2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@cliente2vpn:~$ sudo ip r del default<br>vagrant@cliente2vpn:~$ sudo ip r add default via 10.1.2.1<br></code></pre>\n<h5 id=\"configuraci%C3%B3n-servidor1.\" tabindex=\"-1\">Configuraci√≥n Servidor1.</h5>\n<p>En el servidor1, instalaremos wireguard y activaremos el bit de forwarding:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@servidor-vpn:~$ sudo apt install wireguard<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  wireguard-tools<br>Suggested packages:<br>  openresolv | resolvconf<br>The following NEW packages will be installed:<br>  wireguard wireguard-tools<br>0 upgraded, 2 newly installed, 0 to remove and 31 not upgraded.<br>Need to get 94.3 kB of archives.<br>After this operation, 344 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>\n<p>Activamos el bit de forwarding:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/vagrant# nano /etc/sysctl.conf <br><br><br>#Uncoment<br>net.ipv4.ip_forward=1</code></pre>\n<p>Nos movemos al directorio de wireguard y generamos el par de claves:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/home/vagrant# cd /etc/wireguard/<br>root@servidor-vpn:/etc/wireguard# wg genkey | tee serverprivatekey | wg pubkey > serverpublickey<br>root@servidor-vpn:/etc/wireguard# cat serverpublickey <br>mTfMLCkgFZboI9Pi+35malydyOVVFIiAPZvMG0QNhnA=<br>root@servidor-vpn:/etc/wireguard# cat serverprivatekey <br>mC4yoTaz9iVpXW2i4ykl+3u68SqIVbDOS71wQrZ6WG0=<br></code></pre>\n<p>Creamos el fichero de configuraci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/wireguard# nano wg0.conf<br><br>[Interface]<br>Address = 10.0.100.1<br>PrivateKey = mC4yoTaz9iVpXW2i4ykl+3u68SqIVbDOS71wQrZ6WG0=<br>ListenPort = 51820</code></pre>\n<p>Iniciamos la vpn para probar que funciona:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/wireguard# wg-quick up wg0<br>[#] ip link add wg0 type wireguard<br>[#] wg setconf wg0 /dev/fd/63<br>[#] ip -4 address add 10.0.100.1 dev wg0<br>[#] ip link set mtu 1420 up dev wg0<br>root@servidor-vpn:/etc/wireguard# wg<br>interface: wg0<br>  public key: mTfMLCkgFZboI9Pi+35malydyOVVFIiAPZvMG0QNhnA=<br>  private key: (hidden)<br>  listening port: 51820<br></code></pre>\n<h5 id=\"configuraci%C3%B3n-servidor2.\" tabindex=\"-1\">Configuraci√≥n servidor2.</h5>\n<p>Ahora replicaremos los pasos que hemos hecho en el servidor1, instalaremos wireguard y activaremos el bit de forwarding.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@servidor2-vpn:~$ sudo apt install wireguard<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  wireguard-tools<br>Suggested packages:<br>  openresolv | resolvconf<br>The following NEW packages will be installed:<br>  wireguard wireguard-tools<br>0 upgraded, 2 newly installed, 0 to remove and 31 not upgraded.<br>Need to get 94.3 kB of archives.<br>After this operation, 344 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>\n<p>Activamos el bit de forwarding:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@servidor2-vpn:~$ sudo nano /etc/sysctl.conf <br><br># Uncomment the next line to enable packet forwarding for IPv4<br>net.ipv4.ip_forward=1<br></code></pre>\n<p>Nos conectamos como super usuario, nos movemos al directorio de wireguard y generamos el par de claves:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor2-vpn:/home/vagrant# cd /etc/wireguard/<br>root@servidor2-vpn:/etc/wireguard# wg genkey | tee clientprivatekey | wg pubkey > clientpublickey<br>root@servidor2-vpn:/etc/wireguard# cat clientpublickey <br>E4obRhgP0i+SvbDf8uKfGnZFNjKmqH/E+ms7WiL9Qjw=<br>root@servidor2-vpn:/etc/wireguard# cat clientprivatekey <br>WBGshn38JwiYiFhJnVocCKyGpGjL0wgvMviRIPLmEXE=</code></pre>\n<p>Creamos el fichero de configuraci√≥n del Servidor2.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor2-vpn:/etc/wireguard# sudo nano wg0.conf</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Interface]<br>Address = 10.0.100.2<br>PrivateKey = WBGshn38JwiYiFhJnVocCKyGpGjL0wgvMviRIPLmEXE=<br>ListenPort = 51820<br><br>[Peer]<br>PublicKey = mTfMLCkgFZboI9Pi+35malydyOVVFIiAPZvMG0QNhnA=<br>AllowedIPs = 0.0.0.0/0<br>Endpoint = 192.168.121.225:51820<br></code></pre>\n<p>Ahora modificaremos el servidor1 para a√±adir un peer con los datos del servidor2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/wireguard# nano wg0.conf</code></pre>\n<p>El fichero quedar√° as√≠:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Interface]<br>Address = 10.0.100.1<br>PrivateKey = mC4yoTaz9iVpXW2i4ykl+3u68SqIVbDOS71wQrZ6WG0=<br>ListenPort = 51820<br><br>[Peer]<br>Publickey = E4obRhgP0i+SvbDf8uKfGnZFNjKmqH/E+ms7WiL9Qjw=<br>AllowedIPs = 0.0.0.0/0<br>PersistentKeepAlive = 25<br></code></pre>\n<p>Reiniciamos la interfaz de la vpn del servidor1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/wireguard# wg-quick down wg0<br>[#] ip link delete dev wg0<br>root@servidor-vpn:/etc/wireguard# wg-quick up wg0<br>[#] ip link add wg0 type wireguard<br>[#] wg setconf wg0 /dev/fd/63<br>[#] ip -4 address add 10.0.100.1 dev wg0<br>[#] ip link set mtu 1420 up dev wg0<br>[#] wg set wg0 fwmark 51820<br>[#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820<br>[#] ip -4 rule add not fwmark 51820 table 51820<br>[#] ip -4 rule add table main suppress_prefixlength 0<br>[#] sysctl -q net.ipv4.conf.all.src_valid_mark=1<br>[#] nft -f /dev/fd/63<br></code></pre>\n<p>Iniciamos la interfaz del servidor2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor2-vpn:/etc/wireguard# wg-quick down wg0<br>wg-quick: `wg0' is not a WireGuard interface<br>root@servidor2-vpn:/etc/wireguard# wg-quick up wg0<br>[#] ip link add wg0 type wireguard<br>[#] wg setconf wg0 /dev/fd/63<br>[#] ip -4 address add 10.0.100.2 dev wg0<br>[#] ip link set mtu 1420 up dev wg0<br>[#] wg set wg0 fwmark 51820<br>[#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820<br>[#] ip -4 rule add not fwmark 51820 table 51820<br>[#] ip -4 rule add table main suppress_prefixlength 0<br>[#] sysctl -q net.ipv4.conf.all.src_valid_mark=1<br>[#] nft -f /dev/fd/63</code></pre>\n<p>Muestro el estado de conexi√≥n de ambos servidores:</p>\n<p>Servidor1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor-vpn:/etc/wireguard# wg<br>interface: wg0<br>  public key: mTfMLCkgFZboI9Pi+35malydyOVVFIiAPZvMG0QNhnA=<br>  private key: (hidden)<br>  listening port: 51820<br>  fwmark: 0xca6c<br><br>peer: E4obRhgP0i+SvbDf8uKfGnZFNjKmqH/E+ms7WiL9Qjw=<br>  endpoint: 192.168.121.31:51820<br>  allowed ips: 0.0.0.0/0<br>  latest handshake: 8 seconds ago<br>  transfer: 276 B received, 124 B sent<br>  persistent keepalive: every 25 seconds</code></pre>\n<p>Servidor2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidor2-vpn:/etc/wireguard# wg-quick up wg0<br>[#] ip link add wg0 type wireguard<br>[#] wg setconf wg0 /dev/fd/63<br>[#] ip -4 address add 10.0.100.2 dev wg0<br>[#] ip link set mtu 1420 up dev wg0<br>[#] wg set wg0 fwmark 51820<br>[#] ip -4 route add 0.0.0.0/0 dev wg0 table 51820<br>[#] ip -4 rule add not fwmark 51820 table 51820<br>[#] ip -4 rule add table main suppress_prefixlength 0<br>[#] sysctl -q net.ipv4.conf.all.src_valid_mark=1<br>[#] nft -f /dev/fd/63</code></pre>\n<h5 id=\"comprobaciones.-2\" tabindex=\"-1\">Comprobaciones.</h5>\n<p>Las IP de los equipos son:</p>\n<p>Servidor1: 10.0.0.10,192.168.121.225</p>\n<p>Cliente1: 10.0.0.11</p>\n<p>Servidor2: 10.1.2.1, 192.168.121.31</p>\n<p>Cliente2: 10.1.2.2</p>\n<p>Desde el cliente del servidor1 (cliente1) hago ping y traceroute al cliente del servidor2 (cliente2):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@clientevpn:~$ ping 10.1.2.2<br>PING 10.1.2.2 (10.1.2.2) 56(84) bytes of data.<br>64 bytes from 10.1.2.2: icmp_seq=1 ttl=62 time=3.47 ms<br>64 bytes from 10.1.2.2: icmp_seq=2 ttl=62 time=3.42 ms<br>64 bytes from 10.1.2.2: icmp_seq=3 ttl=62 time=3.87 ms<br>64 bytes from 10.1.2.2: icmp_seq=4 ttl=62 time=3.93 ms<br>^C<br>--- 10.1.2.2 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3005ms<br>rtt min/avg/max/mdev = 3.424/3.673/3.933/0.228 ms<br>vagrant@clientevpn:~$ traceroute 10.1.2.2<br>traceroute to 10.1.2.2 (10.1.2.2), 30 hops max, 60 byte packets<br> 1  10.0.0.10 (10.0.0.10)  0.626 ms  0.557 ms  0.526 ms<br> 2  10.0.100.2 (10.0.100.2)  1.445 ms  1.356 ms  2.004 ms<br> 3  10.1.2.2 (10.1.2.2)  2.759 ms  2.620 ms  2.521 ms<br></code></pre>\n<p>Ahora, desde el cliente del servidor2 (cliente2) hago ping y traceroute al cliente del servidor1 (cliente1):</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">agrant@cliente2vpn:~$ ping 10.0.0.11<br>PING 10.0.0.11 (10.0.0.11) 56(84) bytes of data.<br>64 bytes from 10.0.0.11: icmp_seq=1 ttl=62 time=3.44 ms<br>64 bytes from 10.0.0.11: icmp_seq=2 ttl=62 time=3.69 ms<br>64 bytes from 10.0.0.11: icmp_seq=3 ttl=62 time=3.83 ms<br>64 bytes from 10.0.0.11: icmp_seq=4 ttl=62 time=3.81 ms<br>^C<br>--- 10.0.0.11 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3004ms<br>rtt min/avg/max/mdev = 3.438/3.690/3.830/0.155 ms<br>vagrant@cliente2vpn:~$ traceroute 10.0.0.11<br>traceroute to 10.0.0.11 (10.0.0.11), 30 hops max, 60 byte packets<br> 1  10.1.2.1 (10.1.2.1)  0.451 ms  0.470 ms  0.454 ms<br> 2  10.0.100.1 (10.0.100.1)  1.640 ms  2.705 ms  2.682 ms<br> 3  10.0.0.11 (10.0.0.11)  4.315 ms  4.267 ms  4.207 ms<br></code></pre>\n<h3 id=\"comparaciones\" tabindex=\"-1\">Comparaciones</h3>\n<h4 id=\"3.1.-comparaci%C3%B3n-entre-openvpn-y-wireguard-acceso-remoto.\" tabindex=\"-1\">3.1. Comparaci√≥n entre OpenVPN y Wireguard acceso remoto.</h4>\n<p>Wireguard es m√°s r√°pido que OpenVPN y un 15% mas eficiente a la hora de consumir datos, pero en cambio yo personalmente veo a OpenVPN m√°s estable y seguro. En mi experiencia montando ambos servidores, la configuraci√≥n de OpenVPN parece m√°s complicada pero no se el motivo me ha dado m√°s dolores de cabeza Wireguard que OpenVPN, ya que OpenVPN pr√°cticamente la mont√© al 2¬∫ intento y Wireguard concretamente la de Acceso remoto me ha tardado bastante en funcionar. Tambi√©n est√°n las diferencias de configuraci√≥n que no creo que sea necesario nombrar ya que las acabamos de ver.</p>\n<h4 id=\"3.2.-comparaci%C3%B3n-entre-openvpn-y-wireguard-site-to-site.\" tabindex=\"-1\">3.2. Comparaci√≥n entre OpenVPN y Wireguard site to site.</h4>\n<p>En la VPN site to site tambi√©n sigue la misma din√°mica que el anterior, Wireguard bastante m√°s r√°pido y eficiente y OpenVPN m√°s estable y seguro. Al montar los servidores Site to Site, s√≠ me ha gustado m√°s Wireguard la configuraci√≥n ha sido igual de sencilla que el anterior pero sin saber el motivo ha funcionado a la primera y sin ning√∫n tipo de fallo en la vpn, OpenVPN tambi√©n ha funcionado correctamente y ha sido m√°s dif√≠cil de configurar que Wireguard pero tampoco ha sido algo imposible.</p>\n<h3 id=\"conclusi%C3%B3n\" tabindex=\"-1\">Conclusi√≥n</h3>\n<p>Como conclusi√≥n si tengo que montar una VPN, seg√∫n el entorno en que me encuentre elegir√≠a uno u otro, es decir, si tengo que montar una VPN en una empresa elegir√≠a OpenVPN ya que aunque pierde un poco de rendimiento prima la privacidad y la seguridad, y si la VPN es para uso personal, probablemente me decantar√≠a por Wireguard ya que es m√°s f√°cil de configurar y es m√°s eficiente.</p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-01-10T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/criptografia-iii.-certificados-digitales.-https./",
      "url": "https://reeseschultz.github.io/post/criptografia-iii.-certificados-digitales.-https./",
      "title": "Criptograf√≠a III. Certificados Digitales. HTTPS.",
      "content_html": "<h2 id=\"certificado-digital-de-persona-f%C3%ADsica.\" tabindex=\"-1\">Certificado digital de persona f√≠sica.</h2>\n<h3 id=\"tarea-1%3A-instalaci%C3%B3n-del-certificado.\" tabindex=\"-1\">Tarea 1: Instalaci√≥n del certificado.</h3>\n<h4 id=\"una-vez-que-hayas-obtenido-tu-certificado%2C-explica-brevemente-como-se-instala-en-tu-navegador-favorito.\" tabindex=\"-1\">Una vez que hayas obtenido tu certificado, explica brevemente como se instala en tu navegador favorito.</h4>\n<p>Para importarlo en Firefox hacemos los siguientes pasos:</p>\n<ul>\n<li>\n<p>Abrimos los ajustes de Firefox.</p>\n</li>\n<li>\n<p>Vamos a la pesta√±a Privacidad &amp; Seguridad.</p>\n</li>\n<li>\n<p>En seguridad, hay un apartado de certificados y le damos a la opci√≥n de ver certificados. Se nos abrir√° la siguiente pesta√±a:</p>\n</li>\n</ul>\n<p><img src=\"/img/SAD-cripto3.t1.1.png\" alt=\"SAD-cripto3.t1.1.png\"></p>\n<ul>\n<li>Como vemos mi certificado ya est√° importado, pero tenemos que elegir la opci√≥n de importar y elegimos nuestro certificado. Le damos a aceptar para que se guarden los cambios y lo habremos instalado correctamente.</li>\n</ul>\n<h4 id=\"muestra-una-captura-de-pantalla-donde-se-vea-las-preferencias-del-navegador-donde-se-ve-instalado-tu-certificado.\" tabindex=\"-1\">Muestra una captura de pantalla donde se vea las preferencias del navegador donde se ve instalado tu certificado.</h4>\n<p>Para no repetir la captura, en el anterior apartado muestro mi certificado instalado.</p>\n<h4 id=\"%C2%BFc%C3%B3mo-puedes-hacer-una-copia-de-tu-certificado%3F%2C-%C2%BFcomo-vas-a-realizar-la-copia-de-seguridad-de-tu-certificado%3F.-razona-la-respuesta.\" tabindex=\"-1\">¬øC√≥mo puedes hacer una copia de tu certificado?, ¬øComo vas a realizar la copia de seguridad de tu certificado?. Razona la respuesta.</h4>\n<p>Estando en el mismo apartado de ajuste que en el primer apartado, si seleccionamos nuestro certificado, nos da una opci√≥n que es  <code>Hacer copia...</code> .</p>\n<p><img src=\"/img/SAD-cripto3.t1.2.png\" alt=\"SAD-cripto3.t1.2.png\"></p>\n<p>Elegimos un nombre para la copia y lo guardamos. Tendremos que elegir una contrase√±a de respaldo de la copia del certificado, para cuando vayamos a restaurarla la introduzcamos.</p>\n<p><img src=\"/img/SAD-cripto3.t1.3.png\" alt=\"SAD-cripto3.t1.3.png\"></p>\n<h4 id=\"investiga-como-exportar-la-clave-p%C3%BAblica-de-tu-certificado.\" tabindex=\"-1\">Investiga como exportar la clave p√∫blica de tu certificado.</h4>\n<p>Lo primero que hacemos es generar el par de claves del certificado con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR$ openssl pkcs12 -in MONTES_DELGADO_ALEJANDRO___49125015M.p12 -nocerts -nodes -out MONTES_DELGADO_ALEJANDRO___49125015M.key<br>Enter Import Password:<br>alemd@debian:~/2ASIR$</code></pre>\n<p>Ahora usamos el siguiente comando para extraer la clave p√∫blica:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR$ openssl rsa -in MONTES_DELGADO_ALEJANDRO___49125015M.key -pubout -out MONTES_DELGADO_ALEJANDRO___49125015M.pub<br>writing RSA key</code></pre>\n<p>muestro un ls del directorio para comprobar que se han generado los ficheros correspondientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR$ ls | grep ^MONTES*<br>MONTES_DELGADO_ALEJANDRO___49125015M.key<br>MONTES_DELGADO_ALEJANDRO___49125015M.p12<br>MONTES_DELGADO_ALEJANDRO___49125015M.pub</code></pre>\n<h3 id=\"tarea-2%3A-validaci%C3%B3n-del-certificado.\" tabindex=\"-1\">Tarea 2: Validaci√≥n del certificado.</h3>\n<h4 id=\"instala-en-tu-ordenador-el-software-autofirma-y-desde-la-p%C3%A1gina-de-valide-valida-tu-certificado.-muestra-capturas-de-pantalla-donde-se-comprueba-la-validaci%C3%B3n.\" tabindex=\"-1\">Instala en tu ordenador el software autofirma y desde la p√°gina de VALIDe valida tu certificado. Muestra capturas de pantalla donde se comprueba la validaci√≥n.</h4>\n<p>Lo primero que haremos ser√° instalar las dependencias correspondiente para que funcione autofirma:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">sudo apt install default-jdk libnss3-tools</code></pre>\n<p>Desde la p√°gina de <a href=\"https://autofirma.net/como-instalar-autofirma-en-linux/\">autofirma</a> descargaremos el zip y lo descomprimiremos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR$ unzip AutoFirma_Linux.zip</code></pre>\n<p>Como podemos comprobar autofirma funciona correctamente.</p>\n<p><img src=\"/img/SAD-cripto3.t2.1.png\" alt=\"SAD-cripto3.t2.1.png\"></p>\n<p>Ahora en la p√°gina web de VALIDe, validaremos el certificado en la secci√≥n de validar el certificado, subiremos nuestro certificado y validaremos el captcha.</p>\n<p><img src=\"/img/SAD-cripto3.t2.png\" alt=\"SAD-cripto3.t2.png\"></p>\n<h3 id=\"tarea-3%3A-firma-electr%C3%B3nica.\" tabindex=\"-1\">Tarea 3: Firma electr√≥nica.</h3>\n<h4 id=\"utilizando-la-p%C3%A1gina-valide-y-el-programa-autofirma%2C-firma-un-documento-con-tu-certificado-y-env%C3%ADalo-por-correo-a-un-compa%C3%B1ero.\" tabindex=\"-1\">Utilizando la p√°gina VALIDe y el programa autofirma, firma un documento con tu certificado y env√≠alo por correo a un compa√±ero.</h4>\n<p>Si usamos VALIDe, en la secci√≥n de realizar firma, pulsamos sobre el bot√≥n firmar y subimos un archivo nuestro. Guardaremos el documento y se lo enviaremos a nuestro compa√±ero.</p>\n<p><img src=\"/img/SAD-cripto3.t3.1.png\" alt=\"SAD-cripto3.t3.1.png\"></p>\n<p>Ahora muestro como he firmado otro documento con Autofirma. Pulsamos sobre seleccionar ficheros a firmar y buscamos el fichero que queremos firmar. Como podemos ver en los detalles est√° firmado por m√≠.</p>\n<p><img src=\"/img/SAD-cripto3.t3.2.png\" alt=\"SAD-cripto3.t3.2.png\"></p>\n<p>Ahora env√≠o los ficheros a mi compa√±ero Juanje por correo.</p>\n<h4 id=\"tu-debes-recibir-otro-documento-firmado-por-un-compa%C3%B1ero-y-utilizando-las-herramientas-anteriores-debes-visualizar-la-firma-(visualizar-firma)-y-(verificar-firma).-%C2%BFpuedes-verificar-la-firma-aunque-no-tengas-la-clave-p%C3%BAblica-de-tu-compa%C3%B1ero%3F%2C-%C2%BFes-necesario-estar-conectado-a-internet-para-hacer-la-validaci%C3%B3n-de-la-firma%3F.-razona-tus-respuestas.\" tabindex=\"-1\">Tu debes recibir otro documento firmado por un compa√±ero y utilizando las herramientas anteriores debes visualizar la firma (Visualizar Firma) y (Verificar Firma). ¬øPuedes verificar la firma aunque no tengas la clave p√∫blica de tu compa√±ero?, ¬øEs necesario estar conectado a internet para hacer la validaci√≥n de la firma?. Razona tus respuestas.</h4>\n<p>Visualizo la firma en VALIDe:</p>\n<p><img src=\"/img/SAD-cripto3.t3.6.png\" alt=\"SAD-cripto3.t3.6.png\"></p>\n<p>Visualizo la firma en Autofirma:</p>\n<p><img src=\"/img/SAD-cripto3.t3.5.png\" alt=\"SAD-cripto3.t3.5.png\"></p>\n<p>Juanje me ha enviado 2 ficheros. El primero lo valido con VALIDe:</p>\n<p><img src=\"/img/SAD-cripto3.t3.4.png\" alt=\"SAD-cripto3.t3.4.png\"></p>\n<p>Ahora valido el otro fichero con Autofirma:</p>\n<p><img src=\"/img/SAD-cripto3.t3.3.png\" alt=\"SAD-cripto3.t3.3.png\"></p>\n<h4 id=\"entre-dos-compa%C3%B1eros%2C-firmar-los-dos-un-documento%2C-verificar-la-firma-para-comprobar-que-est%C3%A1-firmado-por-los-dos.\" tabindex=\"-1\">Entre dos compa√±eros, firmar los dos un documento, verificar la firma para comprobar que est√° firmado por los dos.</h4>\n<p>Ahora con Autofirma, firmo un documento que me ha enviado Juanje:</p>\n<p><img src=\"/img/SAD-cripto3.t3.7.png\" alt=\"SAD-cripto3.t3.7.png\"></p>\n<p>Como podemos ver, el fichero es firmado por Juanje y por m√≠. Tambi√©n lo he firmado con VALIDe:</p>\n<p><img src=\"/img/SAD-cripto3.t3.8.png\" alt=\"SAD-cripto3.t3.8.png\"></p>\n<h3 id=\"tarea-4%3A-autentificaci%C3%B3n.\" tabindex=\"-1\">Tarea 4: Autentificaci√≥n.</h3>\n<h4 id=\"utilizando-tu-certificado-accede-a-alguna-p%C3%A1gina-de-la-administraci%C3%B3n-p%C3%BAblica-)cita-m%C3%A9dica%2C-becas%2C-puntos-del-carnet%2C%E2%80%A6).-entrega-capturas-de-pantalla-donde-se-demuestre-el-acceso-a-ellas.\" tabindex=\"-1\">Utilizando tu certificado accede a alguna p√°gina de la administraci√≥n p√∫blica )cita m√©dica, becas, puntos del carnet,‚Ä¶). Entrega capturas de pantalla donde se demuestre el acceso a ellas.</h4>\n<p>Entrar√© en la <a href=\"https://sede.dgt.gob.es/es/\">Sede de la DGT</a> con mi certificado digital. Puelsaremos en el bot√≥n de arriba a la derecha <code>Acceso a mi dgt</code> :</p>\n<p><img src=\"/img/SAD-cripto3.t3.9.png\" alt=\"SAD-cripto3.t3.9.png\"></p>\n<p>Nos llevar√° a la pasarela de clave para iniciar sesi√≥n con el certificado electr√≥nico y elegiremos nuestro certificado.</p>\n<p><img src=\"/img/SAD-cripto3.t3.10.png\" alt=\"SAD-cripto3.t3.10.png\"></p>\n<p>Como podemos ver, hemos iniciado sesi√≥n con mi certificado digital.</p>\n<hr>\n<h2 id=\"https-%2F-ssl.\" tabindex=\"-1\">HTTPS / SSL.</h2>\n<h3 id=\"tarea-1%3A-certificado-autofirmado.-ca\" tabindex=\"-1\">Tarea 1: Certificado autofirmado. CA</h3>\n<h4 id=\"crear-su-autoridad-certificadora-(generar-el-certificado-digital-de-la-ca).-mostrar-el-fichero-de-configuraci%C3%B3n-de-la-ac.\" tabindex=\"-1\">Crear su autoridad certificadora (generar el certificado digital de la CA). Mostrar el fichero de configuraci√≥n de la AC.</h4>\n<p>Lo primero que har√©, ser√° crear carpetas para mantener una organizaci√≥n con los archivos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR/SAD/cripto3/CA$ mkdir certs csr crl newcerts private<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ chmod 700 private<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ touch index.txt<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ touch index.txt.attr<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ echo 1000 > serial</code></pre>\n<p>A√±ado las siguientes variables de entorno:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR/SAD/cripto3/CA$ countryName_default=\"ES\"<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ stateOrProvinceName_default=\"Sevilla\"<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ localityName_default=\"Utrera\"<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ organizationName_default=\"Alejandro\"<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ organizationalUnitName_default=\"ASIR2\"<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ emailAddress_default=\"aaleemd11@gmail.com\"<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ DIR_CA=\"./\"</code></pre>\n<p>A continuaci√≥n, creo el archivo openssl.cnf</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"> cat &lt;&lt;EOF>$DIR_CA/openssl.conf<br>[ ca ]<br># man ca<br>default_ca = CA_default<br><br>[ CA_default ]<br># Directory and file locations.<br>dir               = ${DIR_CA}<br>certs             = ${DIR_CA}certs<br>crl_dir           = ${DIR_CA}crl<br>new_certs_dir     = ${DIR_CA}newcerts<br>database          = ${DIR_CA}index.txt<br>serial            = ${DIR_CA}serial<br>RANDFILE          = ${DIR_CA}private/.rand<br><br># The root key and root certificate.<br>private_key       = ${DIR_CA}private/private.key<br>certificate       = ${DIR_CA}certs/cacert.crt<br><br># For certificate revocation lists.<br>crlnumber         = ${DIR_CA}crlnumber<br>crl               = ${DIR_CA}crl/ca.crl.pem<br>crl_extensions    = crl_ext<br>default_crl_days  = 30<br><br># SHA-1 is deprecated, so use SHA-2 instead.<br>default_md        = sha256<br><br>name_opt          = ca_default<br>cert_opt          = ca_default<br>default_days      = 375<br>preserve          = no<br>policy            = policy_strict<br><br>[ policy_strict ]<br># The root CA should only sign intermediate certificates that match.<br>EOFendedKeyUsage = critical, OCSPSignings (man ocsp).tg).yEnciphermentes.</code></pre>\n<p>Generamos la clave privada y le cambiamos los permisos a la misma:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR/SAD/cripto3/CA$ openssl genrsa -aes256 -out private/private.key 4096<br>Generating RSA private key, 4096 bit long modulus (2 primes)<br>...........................................................++++<br>.......................................................................................................................................................................................................................................................++++<br>e is 65537 (0x010001)<br>Enter pass phrase for private/private.key:<br>Verifying - Enter pass phrase for private/private.key:<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ chmod 400 private/private.key</code></pre>\n<p>Con el siguiente comando, editamos el fichero openssl.cnf:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR/SAD/cripto3/CA$ sed -i 's|xxxsubjectAltNamexxx =|subjectAltName = ${ENV::SAN}|g' openssl.conf</code></pre>\n<p>Y ahora, creamos el certificado autofirmado para la CA:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR/SAD/cripto3/CA$ URL=juanjesus.iesgn.org<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ export SAN=DNS:$URL<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ openssl req -config openssl.conf -key private/private.key -new -x509 -days 3650 -sha256 -extensions v3_ca -out certs/cacert.crt<br>Enter pass phrase for private/private.key:<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter '.', the field will be left blank.<br>-----<br>Country Name (2 letter code) [ES]:<br>State or Province Name [Sevilla]:<br>Locality Name [Utrera]:<br>Organization Name [Alejandro]:<br>Organizational Unit Name [ASIR2]:<br>Common Name []:alejandro.montes<br>Email Address [aaleemd11@gmail.com]:<br>alemd@debian:~/2ASIR/SAD/cripto3/CA$ chmod 444 certs/cacert.crt</code></pre>\n<h4 id=\"debe-recibir-el-fichero-csr-(solicitud-de-firmar-un-certificado)-de-su-compa%C3%B1ero%2C-debe-firmarlo-y-enviar-el-certificado-generado-a-su-compa%C3%B1ero.\" tabindex=\"-1\">Debe recibir el fichero CSR (Solicitud de Firmar un Certificado) de su compa√±ero, debe firmarlo y enviar el certificado generado a su compa√±ero.</h4>\n<p>Una vez que mi compa√±ero Juanje me ha enviado el fichero, lo firmo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/2ASIR/SAD/cripto3/CA$ openssl ca -config openssl.conf -extensions v3_req -days 3650 -notext -md sha256 -in csr/juanjesus-aleca.csr -out certs/juanjesus-aleca.crt<br>Using configuration from openssl.conf<br>Enter pass phrase for ./private/private.key:<br>Check that the request matches the signature<br>Signature ok<br>Certificate Details:<br>        Serial Number: 4096 (0x1000)<br>        Validity<br>            Not Before: Jan  8 12:21:19 2023 GMT<br>            Not After : Jan  5 12:21:19 2033 GMT<br>        Subject:<br>            countryName               = ES<br>            stateOrProvinceName       = Sevilla<br>            organizationName          = Alejandro<br>            organizationalUnitName    = ASIR2<br>            commonName                = juanjesus.debian<br>            emailAddress              = githubemail1asir@gmail.com<br>        X509v3 extensions:<br>            X509v3 Basic Constraints: <br>                CA:FALSE<br>            X509v3 Key Usage: <br>                Digital Signature, Non Repudiation, Key Encipherment<br>            X509v3 Subject Alternative Name: <br>                DNS:juanjesus.iesgn.org<br>Certificate is to be certified until Jan  5 12:21:19 2033 GMT (3650 days)<br>Sign the certificate? [y/n]:y<br><br><br>1 out of 1 certificate requests certified, commit? [y/n]y<br>Write out database with 1 new entries<br>Data Base Updated</code></pre>\n<p>Ahora le env√≠o a Juanje los ficheros <code>juanjesus-aleca.crt</code> y el fichero <code>cacert.crt</code></p>\n<h4 id=\"%C2%BFqu%C3%A9-otra-informaci%C3%B3n-debes-aportar-a-tu-compa%C3%B1ero-para-que-%C3%A9ste-configure-de-forma-adecuada-su-servidor-web-con-el-certificado-generado%3F\" tabindex=\"-1\">¬øQu√© otra informaci√≥n debes aportar a tu compa√±ero para que √©ste configure de forma adecuada su servidor web con el certificado generado?</h4>\n<p>Mi compa√±ero necesitara el fichero <code>cacert.crt</code> que es el certificado autofirmado de la CA para que se pueda verificar la firma del certificado que le he enviado.</p>\n<h3 id=\"tarea-1%3A-certificado-autofirmado.-administrador-web\" tabindex=\"-1\">Tarea 1: Certificado autofirmado. Administrador Web</h3>\n<p>Antes que nada, dejo un resumen de los comandos usados para crear el servidor web con el virtualhost <code>alejandro.iesgn.org</code>.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo apt update<br>usuario@alejandro:~$ sudo apt install apache2<br>usuario@alejandro:~$ sudo a2dissite 000-default.conf<br>usuario@alejandro:~$ sudo nano -cl /etc/apache2/sites-available/alejandro.iesgn.org.conf</code></pre>\n<p>A√±adimos lo siguiente a la configuraci√≥n del virtualhost:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">&lt;VirtualHost *:80><br>    ServerName alejandro.iesgn.org<br>    DocumentRoot /var/www/html/alejandro.iesgn.org<br>    ErrorLog ${APACHE_LOG_DIR}/error-alejandro.log<br>    CustomLog ${APACHE_LOG_DIR}/access-alejandro.log combined<br>&lt;/VirtualHost></code></pre>\n<p>He puesto un fichero de prueba para visualizar la p√°gina web. Activamos el virtual host:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo a2ensite alejandro.iesgn.org.conf<br>Enabling site alejandro.iesgn.org.<br>To activate the new configuration, you need to run:<br>  systemctl reload apache2<br>usuario@alejandro:~$ sudo systemctl reload apache2</code></pre>\n<p>Y por √∫ltimo en mi m√°quina cliente a√±adimos al /etc/hosts lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">172.22.9.231 alejandro.iesgn.org</code></pre>\n<h4 id=\"crea-una-clave-privada-rsa-de-4096-bits-para-identificar-el-servidor.\" tabindex=\"-1\">Crea una clave privada RSA de 4096 bits para identificar el servidor.</h4>\n<p>Usamos el siguiente comando para crear la clave y le cambiamos los permisos al fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo openssl genrsa -aes256 -out /etc/ssl/private/alejandro-priv.key 4096<br>Generating RSA private key, 4096 bit long modulus (2 primes)<br>........................++++<br>...............................................................................................................................................................++++<br>e is 65537 (0x010001)<br>Enter pass phrase for /etc/ssl/private/alejandro-priv.key:<br>Verifying - Enter pass phrase for /etc/ssl/private/alejandro-priv.key:<br>usuario@alejandro:~$ sudo chmod 400 /etc/ssl/private/alejandro-priv.key</code></pre>\n<h4 id=\"utiliza-la-clave-anterior-para-generar-un-csr%2C-considerando-que-deseas-acceder-al-servidor-con-el-fqdn-(tunombre.iesgn.org).\" tabindex=\"-1\">Utiliza la clave anterior para generar un CSR, considerando que deseas acceder al servidor con el FQDN (<a href=\"http://tunombre.iesgn.org\">tunombre.iesgn.org</a>).</h4>\n<p>El comando es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo openssl req -new -sha256 -key /etc/ssl/private/alejandro-priv.key -out alejandro.csr<br>Enter pass phrase for /etc/ssl/private/alejandro-priv.key:<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter '.', the field will be left blank.<br>-----<br>Country Name (2 letter code) [AU]:ES<br>State or Province Name (full name) [Some-State]:Sevilla<br>Locality Name (eg, city) []:Dos Hermanas<br>Organization Name (eg, company) [Internet Widgits Pty Ltd]:Juanje<br>Organizational Unit Name (eg, section) []:ASIR2<br>Common Name (e.g. server FQDN or YOUR name) []:alejandro.montes<br>Email Address []:aaleemd11@gmail.com<br><br>Please enter the following 'extra' attributes<br>to be sent with your certificate request<br>A challenge password []:       <br>An optional company name []:</code></pre>\n<h4 id=\"env%C3%ADa-la-solicitud-de-firma-a-la-entidad-certificadora-(su-compa%C3%B1ero).\" tabindex=\"-1\">Env√≠a la solicitud de firma a la entidad certificadora (su compa√±ero).</h4>\n<p>El fichero CSR ha sido enviado a mi compa√±ero Juanje.</p>\n<h4 id=\"recibe-como-respuesta-un-certificado-x.509-para-el-servidor-firmado-y-el-certificado-de-la-autoridad-certificadora.\" tabindex=\"-1\">Recibe como respuesta un certificado X.509 para el servidor firmado y el certificado de la autoridad certificadora.</h4>\n<p>Juanje me env√≠a los ficheros <code>alejandro.crt</code> y <code>cacert.crt</code>.</p>\n<h4 id=\"configura-tu-servidor-web-con-https-en-el-puerto-443%2C-haciendo-que-las-peticiones-http-se-redireccionen-a-https-(forzar-https).\" tabindex=\"-1\">Configura tu servidor web con https en el puerto 443, haciendo que las peticiones http se redireccionen a https (forzar https).</h4>\n<p>Creo el virtualhost para https:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo nano -cl /etc/apache2/sites-available/ssl-alejandro.iesgn.org.conf</code></pre>\n<p>A√±ado lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"> &lt;IfModule mod_ssl.c><br>     &lt;VirtualHost *:443><br>         ServerName alejandro.iesgn.org<br>         DocumentRoot /var/www/html/alejandro.iesgn.org<br>         ErrorLog ${APACHE_LOG_DIR}/error-alejandro.log<br>         CustomLog ${APACHE_LOG_DIR}/access-alejandro.log combined<br><br>         SSLEngine on<br>         SSLCertificateFile /etc/ssl/certs/alejandro.crt<br>         SSLCertificateKeyFile /etc/ssl/private/alejandro-priv.key<br>         SSLCertificateChainFile /etc/ssl/certs/cacert.crt<br><br>         &lt;Directory /var/www/html/alejandro.iesgn.org><br>             Options Indexes FollowSymLinks<br>             AllowOverride None<br>             Require all granted<br>         &lt;/Directory><br>     &lt;/VirtualHost><br> &lt;/IfModule></code></pre>\n<p>A continuaci√≥n, muevo los ficheros a sus directorios correspondientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo mv alejandro.crt /etc/ssl/certs/<br>usuario@alejandro:~$ sudo mv cacert.crt /etc/ssl/certs/<br>usuario@alejandro:~$ sudo chown root:root /etc/ssl/certs/alejandro.crt<br>usuario@alejandro:~$ sudo chown root:root /etc/ssl/certs/cacert.crt<br>usuario@alejandro:~$ sudo chmod 644 /etc/ssl/certs/alejandro.crt<br>usuario@alejandro:~$ sudo chmod 644 /etc/ssl/certs/cacert.crt</code></pre>\n<p>por √∫ltimo, activamos el m√≥dulo SSL de apache, el virtualhost y recargamos el servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo a2enmod ssl<br>Considering dependency setenvif for ssl:<br>Module setenvif already enabled<br>Considering dependency mime for ssl:<br>Module mime already enabled<br>Considering dependency socache_shmcb for ssl:<br>Enabling module socache_shmcb.<br>Enabling module ssl.<br>See /usr/share/doc/apache2/README.Debian.gz on how to configure SSL and create self-signed certificates.<br>To activate the new configuration, you need to run:<br>  systemctl restart apache2<br>usuario@alejandro:~$ sudo a2ensite ssl-alejandro.iesgn.org.conf<br>Enabling site ssl-alejandro.iesgn.org.<br>To activate the new configuration, you need to run:<br>  systemctl reload apache2<br>usuario@alejandro:~$ sudo systemctl reload apache2<br>üîê Enter passphrase for SSL/TLS keys for alejandro.iesgn.org:443 (RSA): (p*********             </code></pre>\n<p>Para que nos redirija a HTTPS, tenemos que hacer lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ sudo nano -cl /etc/apache2/sites-available/ssl-alejandro.iesgn.org.conf</code></pre>\n<p>Tenemos que dejar el fichero de la siguiente manera:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">&lt;VirtualHost *:80><br>     ServerName alejandro.iesgn.org<br>     DocumentRoot /var/www/html/alejandro.iesgn.org<br>     ErrorLog ${APACHE_LOG_DIR}/error-alejandro.log<br>     CustomLog ${APACHE_LOG_DIR}/access-alejandro.log combined<br>     Redirect 301 / https://alejandro.iesgn.org/<br>&lt;/VirtualHost></code></pre>\n<p>Volvemos a recargar apache para que se apliquen los cambios.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo systemctl reload apache2</code></pre>\n<p>Para que al entrar no nos aparezca el mensaje de que el certificado no es reconocido por mi navegador tendremos que importar en el navegador el certificado autofirmado de la CA  de Juanje que es el archivo <code>cacert.crt</code>.</p>\n<p><img src=\"/img/SAD-cripto3.t6.2.png\" alt=\"SAD-cripto3.t6.2.png\"></p>\n<h4 id=\"instala-ahora-un-servidor-nginx%2C-y-realiza-la-misma-configuraci%C3%B3n-que-anteriormente-para-que-se-sirva-la-p%C3%A1gina-con-https.\" tabindex=\"-1\">Instala ahora un servidor nginx, y realiza la misma configuraci√≥n que anteriormente para que se sirva la p√°gina con HTTPS.</h4>\n<p>Lo primero que haremos ser√° deshabilitar apache2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo systemctl disable --now apache2<br>Synchronizing state of apache2.service with SysV service script with /lib/systemd/systemd-sysv-install.<br>Executing: /lib/systemd/systemd-sysv-install disable apache2<br>Removed /etc/systemd/system/multi-user.target.wants/apache2.service.</code></pre>\n<p>Instalamos nginx:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo apt install nginx<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  fontconfig-config fonts-dejavu-core geoip-database libdeflate0<br>  libfontconfig1 libgd3 libgeoip1 libjbig0 libjpeg62-turbo<br>  libnginx-mod-http-geoip libnginx-mod-http-image-filter<br>  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream<br>  libnginx-mod-stream-geoip libtiff5 libwebp6 libx11-6 libx11-data<br>  libxau6 libxcb1 libxdmcp6 libxpm4 libxslt1.1 nginx-common nginx-core<br>Suggested packages:<br>  libgd-tools geoip-bin fcgiwrap nginx-doc<br>The following NEW packages will be installed:<br>  fontconfig-config fonts-dejavu-core geoip-database libdeflate0<br>  libfontconfig1 libgd3 libgeoip1 libjbig0 libjpeg62-turbo<br>  libnginx-mod-http-geoip libnginx-mod-http-image-filter<br>  libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream<br>  libnginx-mod-stream-geoip libtiff5 libwebp6 libx11-6 libx11-data<br>  libxau6 libxcb1 libxdmcp6 libxpm4 libxslt1.1 nginx nginx-common<br>  nginx-core<br>0 upgraded, 27 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 8715 kB of archives.<br>After this operation, 24.2 MB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>\n<p>Creamos el fichero de configuraci√≥n del virtualhost de la web:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo nano -cl /etc/nginx/sites-available/alejandro.iesgn.org.conf</code></pre>\n<p>agregamos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">server {<br>    listen 80;<br>    listen [::]:80;<br>    server_name alejandro.iesgn.org;<br>    return 301 https://$server_name$request_uri;<br>}<br><br>server {<br>    listen 443 ssl http2;<br>    listen [::]:443 ssl http2;<br>    server_name alejandro.iesgn.org;<br><br>    ssl_certificate /etc/ssl/certs/alejandro.crt;<br>    ssl_certificate_key /etc/ssl/private/alejandro-priv.key;<br>    ssl_trusted_certificate /etc/ssl/certs/cacert.crt;<br><br>    root /var/www/html/alejandro.iesgn.org;<br>    index index.html;<br><br>    location / {<br>        try_files $uri $uri/ =404;<br>    }<br>}</code></pre>\n<p>Ahora creamos el enlace simb√≥lico del virtualhost:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"> sudo ln -s /etc/nginx/sites-available/alejandro.iesgn.org.conf /etc/nginx/sites-enabled/</code></pre>\n<p>Modifico la p√°gina y reinicio el servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alejandro:~$ sudo systemctl restart nginx<br>usuario@alejandro:~$ sudo nano -cl /var/www/html/alejandro.iesgn.org/index.html</code></pre>\n<p>Accedo a la web:</p>\n<p><img src=\"/img/SAD-cripto3.t6.1.png\" alt=\"SAD-cripto3.t6.1.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-01-05T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/recoleccion-centralizada-de-logs-de-sistema-mediante-journald./",
      "url": "https://reeseschultz.github.io/post/recoleccion-centralizada-de-logs-de-sistema-mediante-journald./",
      "title": "Recolecci√≥n centralizada de logs de sistema, mediante journald.",
      "content_html": "<p>Lo primero que tendremos que hacer es instalar el paquete <code>systemd-journal-remote</code> en todas las m√°quinas del escenario. Para ello ejecutaremos el siguiente comando</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo apt install systemd-journal-remote<br>[usuario@bravo ~]$ sudo dnf install systemd-journal-remote<br>ubuntu@charlie:~$ sudo apt install systemd-journal-remote<br>ubuntu@delta:~$ sudo apt install systemd-journal-remote</code></pre>\n<p><img src=\"/img/ASO-P7.1.png\" alt=\"ASO-P7.1.png\"></p>\n<h3 id=\"configuraci%C3%B3n-del-servidor-alfa.\" tabindex=\"-1\">Configuraci√≥n del Servidor Alfa.</h3>\n<p>Una vez hayamos instalado el paquete en todo el escenario, lo siguiente que realizaremos ser√° configurar el servidor que recoger√° los logs.</p>\n<p>Ya que no utilizaremos https, desactivaremos esa opci√≥n en el fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo grep --color -E -- '--listen-http' /lib/systemd/system/systemd-journal-remote.service <br>ExecStart=/lib/systemd/systemd-journal-remote --listen-https=-3 --output=/var/log/journal/remote/                                                    <br>usuario@alfa:~$ sudo sed -i 's/--listen-https=-3/--listen-http=-3/g' /lib/systemd/system/systemd-journal-remote.service                               <br>usuario@alfa:~$ sudo grep --color -E -- '--listen-http' /lib/systemd/system/systemd-journal-remote.service systemd-journal-remote-250-12.el9_1.86_64                              <br>ExecStart=/lib/systemd/systemd-journal-remote --listen-http=-3 --output=/var/log/journal/remote/         </code></pre>\n<p>Ahora habilitamos el servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo systemctl enable --now systemd-journal-remote.socket<br>Created symlink /etc/systemd/system/sockets.target.wants/systemd-journal-remote.socket ‚Üí /lib/systemd/system/systemd-journal-remote.socket.<br>usuario@alfa:~$ sudo systemctl enable --now systemd-journal-remote.service<br>usuario@alfa:~$<br>---<br><br>Si no existe el siguiente directorio, lo creamos:<br><br>```txt<br>usuario@alfa:~$ sudo mkdir -p /var/log/journal/remote/<br>usuario@alfa:~$ sudo chown systemd-journal-remote:systemd-journal-remote /var/log/journal/remote</code></pre>\n<h3 id=\"configuraci%C3%B3n-de-los-clientes-bravo%2C-charlie-y-delta.\" tabindex=\"-1\">Configuraci√≥n de los clientes Bravo, Charlie y Delta.</h3>\n<p>Lo primero que haremos ser√° crear un usuario llamado <code>systemd-journal-upload</code> con el home <code>/run/systemd</code> y en el grupo <code>systemd-journal-upload</code>:</p>\n<p>Bravo</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ sudo adduser --system --home-dir /run/systemd --no-create-home --user-group systemd-journal-upload</code></pre>\n<p>Charlie y Delta(son iguales)</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@charlie:~$ sudo adduser --system --home /run/systemd --no-create-home --disabled-login --group systemd-journal-upload                                  <br>[sudo] password for ubuntu:<br>Adding system user `systemd-journal-upload' (UID 109) ...<br>Adding new group `systemd-journal-upload' (GID 114) ...<br>Adding new user `systemd-journal-upload' (UID 109) with group `systemd-journal-upload' ...                                                                    <br>Not creating home directory `/run/systemd'.<br><br><br>ubuntu@delta:~$ sudo adduser --system --home /run/systemd --no-create-home --disabled-login --group systemd-journal-upload                          <br>[sudo] password for ubuntu:                                               <br>Adding system user `systemd-journal-upload' (UID 108) ...                 <br>Adding new group `systemd-journal-upload' (GID 113) ...                   <br>Adding new user `systemd-journal-upload' (UID 108) with group `systemd-journal-upload' ...                                                          <br>Not creating home directory `/run/systemd'.                               </code></pre>\n<p>Una vez creado los usuarios, tenemos que modificar la configuraci√≥n del journal-upload para indicar que los clientes env√≠en los logs a alfa.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ sudo sed -i 's/# URL=/URL=http:\\/\\/alfa.alejandro-montes.gonzalonazareno.org:19532/g' /etc/systemd/journal-upload.conf<br>[usuario@bravo ~]$ sudo grep 'URL=' /etc/systemd/journal-upload.conf<br>URL=http://alfa.alejandro-montes.gonzalonazareno.org:19532</code></pre>\n<p>Repetiremos los mismos comandos en charlie y delta.</p>\n<p>Una vez realizado esto, reiniciaremos el servicio en todos los clientes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ sudo systemctl restart systemd-journal-upload.service</code></pre>\n<h3 id=\"comprobaciones.\" tabindex=\"-1\">Comprobaciones.</h3>\n<p>Si en el servidor le hacemos un ls a la ruta donde se guardan los logs de los clientes, se habr√°n creado 3 archivos distintos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ ls /var/log/journal/remote/<br>remote-172.16.0.200.journal  remote-192.168.0.3.journal<br>remote-192.168.0.2.journal<br>usuario@alfa:~$ </code></pre>\n<p>Si queremos comprobarlo con el comando journalctl ejecutamos lo siguiente indicando el archivo con la ip del cliente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo journalctl --file /var/log/journal/remote/remote-172.16.0.200.journal</code></pre>\n<p>Y nos aparecer√° esto:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">-- Journal begins at Mon 2022-11-28 21:25:01 UTC, ends at Sun 2023-01-08 23:04:44 UTC. --<br>Nov 28 21:25:01 localhost kernel: Linux version 5.14.0-162.6.1.el9_1.x86_64 (mockbuild@dal1-prod-builder001.bld.equ.rockylinux.org) (gcc (GCC) 11.3.1><br>Nov 28 21:25:01 localhost kernel: The list of certified hardware and cloud instances for Red Hat Enterprise Linux 9 can be viewed at the Red Hat Ecos><br>Nov 28 21:25:01 localhost kernel: Command line: BOOT_IMAGE=(hd0,gpt2)/vmlinuz-5.14.0-162.6.1.el9_1.x86_64 root=UUID=4814451b-2177-4679-bda1-e10797d12><br>Nov 28 21:25:01 localhost kernel: x86/fpu: Supporting XSAVE feature 0x001: 'x87 floating point registers'<br>Nov 28 21:25:01 localhost kernel: x86/fpu: Supporting XSAVE feature 0x002: 'SSE registers'<br>Nov 28 21:25:01 localhost kernel: x86/fpu: Supporting XSAVE feature 0x004: 'AVX registers'<br>Nov 28 21:25:01 localhost kernel: x86/fpu: Supporting XSAVE feature 0x020: 'AVX-512 opmask'<br>Nov 28 21:25:01 localhost kernel: x86/fpu: Supporting XSAVE feature 0x040: 'AVX-512 Hi256'<br>Nov 28 21:25:01 localhost kernel: x86/fpu: Supporting XSAVE feature 0x080: 'AVX-512 ZMM_Hi256'<br>Nov 28 21:25:01 localhost kernel: x86/fpu: Supporting XSAVE feature 0x200: 'Protection Keys User registers'<br>Nov 28 21:25:01 localhost kernel: x86/fpu: xstate_offset[2]:  576, xstate_sizes[2]:  256<br>Nov 28 21:25:01 localhost kernel: x86/fpu: xstate_offset[5]:  832, xstate_sizes[5]:   64<br>Nov 28 21:25:01 localhost kernel: x86/fpu: xstate_offset[6]:  896, xstate_sizes[6]:  512<br>Nov 28 21:25:01 localhost kernel: x86/fpu: xstate_offset[7]: 1408, xstate_sizes[7]: 1024<br>Nov 28 21:25:01 localhost kernel: x86/fpu: xstate_offset[9]: 2432, xstate_sizes[9]:    8<br>Nov 28 21:25:01 localhost kernel: x86/fpu: Enabled xstate features 0x2e7, context size is 2440 bytes, using 'compacted' format.<br>Nov 28 21:25:01 localhost kernel: signal: max sigframe size: 3632<br>Nov 28 21:25:01 localhost kernel: BIOS-provided physical RAM map:<br>Nov 28 21:25:01 localhost kernel: BIOS-e820: [mem 0x0000000000000000-0x000000000009fbff] usable<br>Nov 28 21:25:01 localhost kernel: BIOS-e820: [mem 0x000000000009fc00-0x000000000009ffff] reserved<br>Nov 28 21:25:01 localhost kernel: BIOS-e820: [mem 0x00000000000f0000-0x00000000000fffff] reserved<br>Nov 28 21:25:01 localhost kernel: BIOS-e820: [mem 0x0000000000100000-0x000000003ffdcfff] usable<br>Nov 28 21:25:01 localhost kernel: BIOS-e820: [mem 0x000000003ffdd000-0x000000003fffffff] reserved<br>Nov 28 21:25:01 localhost kernel: BIOS-e820: [mem 0x00000000feffc000-0x00000000feffffff] reserved<br>Nov 28 21:25:01 localhost kernel: BIOS-e820: [mem 0x00000000fffc0000-0x00000000ffffffff] reserved<br>Nov 28 21:25:01 localhost kernel: NX (Execute Disable) protection: active<br>Nov 28 21:25:01 localhost kernel: SMBIOS 2.8 present.<br>Nov 28 21:25:01 localhost kernel: DMI: OpenStack Foundation OpenStack Nova, BIOS 1.15.0-1 04/01/2014<br>Nov 28 21:25:01 localhost kernel: Hypervisor detected: KVM<br>Nov 28 21:25:01 localhost kernel: kvm-clock: Using msrs 4b564d01 and 4b564d00<br>Nov 28 21:25:01 localhost kernel: kvm-clock: using sched offset of 13231497159309 cycles<br>Nov 28 21:25:01 localhost kernel: clocksource: kvm-clock: mask: 0xffffffffffffffff max_cycles: 0x1cd42e4dffb, max_idle_ns: 881590591483 ns<br>Nov 28 21:25:01 localhost kernel: tsc: Detected 2095.082 MHz processor<br>Nov 28 21:25:01 localhost kernel: e820: update [mem 0x00000000-0x00000fff] usable ==> reserved<br>Nov 28 21:25:01 localhost kernel: e820: remove [mem 0x000a0000-0x000fffff] usable<br></code></pre>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-01-04T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/despliegue-de-aplicaciones-python./",
      "url": "https://reeseschultz.github.io/post/despliegue-de-aplicaciones-python./",
      "title": "Despliegue de aplicaciones python.",
      "content_html": "<h3 id=\"tarea-1%3A-entorno-de-desarrollo.\" tabindex=\"-1\">Tarea 1: Entorno de desarrollo.</h3>\n<p>Lo primero que haremos ser√° forkear el repositorio y clonarlo a bravo.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ git clone https://github.com/alemd01/django_tutorial.git<br>Cloning into 'django_tutorial'...<br>remote: Enumerating objects: 158, done.<br>remote: Counting objects: 100% (5/5), done.<br>remote: Compressing objects: 100% (5/5), done.<br>remote: Total 158 (delta 0), reused 2 (delta 0), pack-reused 153<br>Receiving objects: 100% (158/158), 4.25 MiB | 6.63 MiB/s, done.<br>Resolving deltas: 100% (50/50), done.</code></pre>\n<p>Una vez clonado el repositorio, lo que haremos ser√° crear un entorno virtual. para ello, Crearemos una carpeta donde guardaremos todos los entornos virtuales y dentro crearemos el entorno virtual.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ mkdir venv<br>[usuario@bravo ~]$ cd venv<br>[usuario@bravo venv]$ python3 -m venv venv</code></pre>\n<p>Una vez creado el entorno virtual, lo activamos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo venv]$ source bin/activate<br>(venv) [usuario@bravo venv]$</code></pre>\n<p>Instalamos los requisitos usando el requirements.txt</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(venv) [usuario@bravo django_tutorial]$ pip install -r requirements.txt <br>Collecting Django<br>  Downloading Django-4.1.5-py3-none-any.whl (8.1 MB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 8.1 MB 1.7 MB/s <br>Collecting asgiref&lt;4,>=3.5.2<br>  Downloading asgiref-3.6.0-py3-none-any.whl (23 kB)<br>Collecting sqlparse>=0.2.2<br>  Downloading sqlparse-0.4.3-py3-none-any.whl (42 kB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 42 kB 946 kB/s <br>Installing collected packages: sqlparse, asgiref, Django<br>Successfully installed Django-4.1.5 asgiref-3.6.0 sqlparse-0.4.3</code></pre>\n<p>Como podemos observar en el fichero <a href=\"http://settings.py\">settings.py</a>, usaremos sqlite y el nombre de la base de datos ser√° db.sqlite3</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">DATABASES = {<br>    'default': {<br>        'ENGINE': 'django.db.backends.sqlite3',<br>        'NAME': BASE_DIR / 'db.sqlite3',<br>    }<br>}</code></pre>\n<p>Para generar la base de datos, tenemos que realizar una migraci√≥n del fichero <a href=\"http://manage.py\">manage.py</a> y as√≠ se crear√° un archivo sqlite3.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(venv) [usuario@bravo django_tutorial]$ python3 manage.py migrate<br>Operations to perform:<br>  Apply all migrations: admin, auth, contenttypes, polls, sessions<br>Running migrations:<br>  Applying contenttypes.0001_initial... OK<br>  Applying auth.0001_initial... OK<br>  Applying admin.0001_initial... OK<br>  Applying admin.0002_logentry_remove_auto_add... OK<br>  Applying admin.0003_logentry_add_action_flag_choices... OK<br>  Applying contenttypes.0002_remove_content_type_name... OK<br>  Applying auth.0002_alter_permission_name_max_length... OK<br>  Applying auth.0003_alter_user_email_max_length... OK<br>  Applying auth.0004_alter_user_username_opts... OK<br>  Applying auth.0005_alter_user_last_login_null... OK<br>  Applying auth.0006_require_contenttypes_0002... OK<br>  Applying auth.0007_alter_validators_add_error_messages... OK<br>  Applying auth.0008_alter_user_username_max_length... OK<br>  Applying auth.0009_alter_user_last_name_max_length... OK<br>  Applying auth.0010_alter_group_name_max_length... OK<br>  Applying auth.0011_update_proxy_permissions... OK<br>  Applying auth.0012_alter_user_first_name_max_length... OK<br>  Applying polls.0001_initial... OK<br>  Applying sessions.0001_initial... OK<br>(venv) [usuario@bravo django_tutorial]$ ls<br>README.md   django_tutorial  polls<br>db.sqlite3  manage.py        requirements.txt<br></code></pre>\n<p>Con el siguiente comando crearemos un usuario para la base de datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(venv) [usuario@bravo django_tutorial]$ python3 manage.py createsuperuser<br>Username (leave blank to use 'usuario'): alejandro<br>Email address: aaleemd11@gmail.com<br>Password: <br>Password (again): <br>This password is too short. It must contain at least 8 characters.<br>Bypass password validation and create user anyway? [y/N]: y<br>Superuser created successfully.</code></pre>\n<p>probaremos el servidor en desarrollo, para ello utilizaremos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(venv) [usuario@bravo django_tutorial]$ python3 manage.py runserver 0.0.0.0:8000<br>Watching for file changes with StatReloader<br>Performing system checks...<br><br>System check identified no issues (0 silenced).<br>January 19, 2023 - 10:05:34<br>Django version 4.1.5, using settings 'django_tutorial.settings'<br>Starting development server at http://0.0.0.0:8000/<br>Quit the server with CONTROL-C.</code></pre>\n<p>Ahora en alfa, a√±adiremos una regla DNAT para que el tr√°fico del puerto 8000 vaya a bravo.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:~$ sudo iptables -t nat -A PREROUTING -p tcp --dport 8000 -i ens3 -j DNAT --to 172.16.0.200<br>usuario@alfa:~$ sudo iptables -L -t nat<br>Chain PREROUTING (policy ACCEPT)<br>target     prot opt source               destination         <br>DNAT       tcp  --  anywhere             anywhere             tcp dpt:http to:172.16.0.200:80<br>DNAT       udp  --  anywhere             anywhere             udp dpt:domain to:192.168.0.2:53<br>DNAT       tcp  --  anywhere             anywhere             tcp dpt:smtp to:192.168.0.3<br>DNAT       tcp  --  anywhere             anywhere             tcp dpt:8000 to:172.16.0.200</code></pre>\n<p>Una vez hecho esto, podremos acceder desde nuestro navegador web a django en fase de desarrollo:</p>\n<p><img src=\"/img/IAW-T4.P1.1.png\" alt=\"IAW-T4.P1.1.png\"></p>\n<p>Nos logeamos con el usuario y contrase√±a que creamos anteriormente y nos aparecer√° el siguiente men√∫:</p>\n<p><img src=\"/img/IAW-T4.P1.2.png\" alt=\"IAW-T4.P1.2.png\"></p>\n<p>En el apartado <code>Questions</code> pulsamos <code>Add</code> para a√±adir preguntas.</p>\n<p><img src=\"/img/IAW-T4.P1.3.png\" alt=\"IAW-T4.P1.3.png\"></p>\n<p>Rellenamos 2 preguntas con sus respuestas y pulsamos sobre <code>Questions</code> el resultado ser√° el siguiente:</p>\n<p><img src=\"/img/IAW-T4.P1.4.png\" alt=\"IAW-T4.P1.4.png\"></p>\n<p>Ahora si nos metemos en /polls veremos las preguntas creadas:</p>\n<p><img src=\"/img/IAW-T4.P1.5.png\" alt=\"IAW-T4.P1.5.png\"></p>\n<p>Una vez hecho esto, pondremos en producci√≥n django en bravo. Lo primero que haremos ser√° mover django que est√° en el home a <code>/var/www</code></p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(venv) [usuario@bravo ~]$ sudo mv django_tutorial/ /var/www<br>(venv) [usuario@bravo ~]$ sudo chown -R apache:apache /var/www/django_tutorial/</code></pre>\n<p>Ahora editamos la configuraci√≥n de django para indicar la nueva ruta est√°tica:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(venv) [usuario@bravo www]$ sudo nano django_tutorial/settings.py </code></pre>\n<p>Al final del archivo a√±adimos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">STATIC_ROOT = '/var/www/django_tutorial/static'</code></pre>\n<p>Ahora ejecutamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) [usuario@bravo django_tutorial]$ python3 manage.py collectstatic<br><br>133 static files copied to '/var/www/django_tutorial/static'.<br></code></pre>\n<p>Nos salimos del entorno virtual e instalaremos mod_wsgi:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) [usuario@bravo django_tutorial]$ deactivate<br>[usuario@bravo django_tutorial]$ sudo dnf install python3-mod_wsgi -y<br>Failed to set locale, defaulting to C.UTF-8<br>Last metadata expiration check: 2:14:47 ago on Sun Jan 22 12:59:59 2023.<br>Dependencies resolved.<br>==========================================================================<br> Package               Arch        Version           Repository      Size<br>==========================================================================<br>Installing:<br> python3-mod_wsgi      x86_64      4.7.1-11.el9      appstream      931 k<br><br>Transaction Summary<br>==========================================================================<br>Install  1 Package<br><br>Total download size: 931 k<br>Installed size: 5.6 M<br>Downloading Packages:<br>python3-mod_wsgi-4.7.1-11.el9.x86_64.rpm  1.7 MB/s | 931 kB     00:00    <br>--------------------------------------------------------------------------<br>Total                                     857 kB/s | 931 kB     00:01     <br></code></pre>\n<p>Ahora tendr√≠amos que crear el fichero <a href=\"http://wsgi.py\">wsgi.py</a> en django pero ya viene creado. Lo que haremos ser√° crear el virtual host:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo django_tutorial]$ sudo nano /etc/httpd/sites-available/django.conf</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">&lt;VirtualHost *:80><br>        ServerName python.alejandro-montes.gonzalonazareno.org<br>        DocumentRoot /var/www/django_tutorial<br>        Alias /static/ /var/www/django_tutorial/static/<br>        WSGIDaemonProcess django_tutorial python-path=/var/www/django_tutorial:/var/www/django/lib/python3.9/site-packages/<br>        WSGIProcessGroup django_tutorial<br>        WSGIScriptAlias / /var/www/django_tutorial/django_tutorial/wsgi.py<br>        ErrorLog /var/log/httpd/django_tutorial_error.log<br>        CustomLog /var/log/httpd/django_tutorial_access.log combined<br>&lt;/VirtualHost></code></pre>\n<p>Activamos el virtual host:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo django_tutorial]$ sudo ln -s /etc/httpd/sites-available/django.conf /etc/httpd/sites-enabled/django.conf</code></pre>\n<p>Reiniciamos apache para que se apliquen los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo django_tutorial]$ sudo systemctl restart httpd</code></pre>\n<p>Ahora en charlie a√±adimos un CNAME para todas las zonas llamado python.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@charlie:~$ sudo nano /var/cache/bind/db.dmz.alejandro-montes.gonzalonazareno.org<br>ubuntu@charlie:~$ sudo nano /var/cache/bind/db.interna.alejandro-montes.gonzalonazareno.org</code></pre>\n<p>a√±adimos al final lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">python                  IN      CNAME   bravo</code></pre>\n<p>ahora reiniciamos el servidor dns y borramos la cache:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">ubuntu@charlie:~$ sudo rndc flush<br>ubuntu@charlie:~$ sudo systemctl restart bind9</code></pre>\n<p>Una vez hecho esto, estar√≠a funcionando el servidor dns y el virtualhost. Ahora probaremos a acceder a <a href=\"http://python.alejandro-montes.gonzalonazareno.org\">python.alejandro-montes.gonzalonazareno.org</a> a trav√©s de internet:</p>\n<p><img src=\"/img/IAW-T4.P1.6.png\" alt=\"IAW-T4.P1.6.png\"></p>\n<p>Por √∫ltimos subimos los cambios a git para realizar la migraci√≥n al vps.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo django_tutorial]$ git add .<br>[usuario@bravo django_tutorial]$ git commit -m \"corregido\"<br>[usuario@bravo django_tutorial]$ git push</code></pre>\n<h3 id=\"tarea-2%3A-entorno-de-producci%C3%B3n.\" tabindex=\"-1\">Tarea 2: Entorno de producci√≥n.</h3>\n<p>Lo primero que haremos ser√° conectarnos al vps a traves de ssh e instalaremos git:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:~$ sudo apt install git<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  git-man libcurl3-gnutls liberror-perl patch<br>Suggested packages:<br>  git-daemon-run | git-daemon-sysvinit git-doc git-el git-email git-gui<br>  gitk gitweb git-cvs git-mediawiki git-svn ed diffutils-doc<br>The following NEW packages will be installed:<br>  git git-man libcurl3-gnutls liberror-perl patch<br>0 upgraded, 5 newly installed, 0 to remove and 3 not upgraded.<br>Need to get 7855 kB of archives.<br>After this operation, 38.9 MB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>\n<p>Clonaremos el repositorio con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:~$ git clone git@github.com:alemd01/django_tutorial.git</code></pre>\n<p>Ahora instalamos si es necesario el m√≥dulo de python para crear entornos virtuales:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:~$ sudo apt install python3-venv</code></pre>\n<p>Y creamos uno:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:~$ mkdir django<br>alemd@nabil:~$ python3 -m venv django</code></pre>\n<p>Activamos el entorno virtual:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:~$ source django/bin/activate<br>(django) alemd@nabil:~$ </code></pre>\n<p>Instalaremos las dependencias de nuestra aplicaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:~/django_tutorial$ pip install -r requirements.txt <br>Collecting Django<br>  Downloading Django-4.1.5-py3-none-any.whl (8.1 MB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 8.1 MB 4.9 MB/s <br>Collecting asgiref&lt;4,>=3.5.2<br>  Downloading asgiref-3.6.0-py3-none-any.whl (23 kB)<br>Collecting sqlparse>=0.2.2<br>  Downloading sqlparse-0.4.3-py3-none-any.whl (42 kB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 42 kB 1.5 MB/s <br>Installing collected packages: sqlparse, asgiref, Django<br>Successfully installed Django-4.1.5 asgiref-3.6.0 sqlparse-0.4.3</code></pre>\n<p>Tambi√©n instalaremos mysqlclient ya que la aplicaci√≥n trabajar√° con una base de datos de mariadb:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:~/django_tutorial$ sudo apt install python3-dev default-libmysqlclient-dev build-essential -y<br>(django) alemd@nabil:~/django_tutorial$ pip install mysqlclient</code></pre>\n<p>Ahora crearemos una base de datos en mysql, con un usuario y sus respectivos privilegios para la base de datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd/django_tutorial# mysql -u root<br><br>MariaDB [(none)]> CREATE DATABASE DJANGO;<br>Query OK, 1 row affected (0.009 sec)<br><br>MariaDB [(none)]> CREATE USER 'alejandro'@'%' IDENTIFIED BY 'usuario';<br>Query OK, 0 rows affected (0.021 sec)<br><br>MariaDB [(none)]> GRANT ALL PRIVILEGES ON DJANGO.* TO 'alejandro'@'%';<br>Query OK, 0 rows affected (0.007 sec)<br></code></pre>\n<p>Ahora editaremos la aplicaci√≥n para que utilice MySQL en vez de sqlite3:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:~/django_tutorial$ nano django_tutorial/settings.py</code></pre>\n<p>editamos la zona de databases y tiene que quedar as√≠:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">DATABASES = {<br>    'default': {<br>        'ENGINE': 'django.db.backends.mysql',<br>        'NAME': 'DJANGO',<br>        'USER': 'alejandro',<br>        'PASSWORD': 'usuario',<br>        'HOST': 'localhost',<br>        'PORT': '',<br>    }</code></pre>\n<p>Ahora creamos una copia de seguridad de la base de datos del entorno de desarrollo(bravo) y la subimos a github y actualizamos el repositorio en el vps:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) [usuario@bravo django_tutorial]$ python3 manage.py dumpdata > db.json<br>(django) [usuario@bravo django_tutorial]$ git add .<br>(django) [usuario@bravo django_tutorial]$ git commit -m \"copia de seguridad\"<br>(django) [usuario@bravo django_tutorial]$ git push</code></pre>\n<p>Ahora hacemos un pull al vps para que sincronice con el repositorio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:~/django_tutorial$ git pull<br>(django) alemd@nabil:~/django_tutorial$ ls<br>README.md  django_tutorial  polls             static<br>db.json    manage.py        requirements.txt</code></pre>\n<p>Una vez tengamos la copia de seguridad en el vps, realizaremos la migraci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:~/django_tutorial$ python3 manage.py migrate<br>Operations to perform:<br>  Apply all migrations: admin, auth, contenttypes, polls, sessions<br>Running migrations:<br>  Applying contenttypes.0001_initial... OK<br>  Applying auth.0001_initial... OK<br>  Applying admin.0001_initial... OK<br>  Applying admin.0002_logentry_remove_auto_add... OK<br>  Applying admin.0003_logentry_add_action_flag_choices... OK<br>  Applying contenttypes.0002_remove_content_type_name... OK<br>  Applying auth.0002_alter_permission_name_max_length... OK<br>  Applying auth.0003_alter_user_email_max_length... OK<br>  Applying auth.0004_alter_user_username_opts... OK<br>  Applying auth.0005_alter_user_last_login_null... OK<br>  Applying auth.0006_require_contenttypes_0002... OK<br>  Applying auth.0007_alter_validators_add_error_messages... OK<br>  Applying auth.0008_alter_user_username_max_length... OK<br>  Applying auth.0009_alter_user_last_name_max_length... OK<br>  Applying auth.0010_alter_group_name_max_length... OK<br>  Applying auth.0011_update_proxy_permissions... OK<br>  Applying auth.0012_alter_user_first_name_max_length... OK<br>  Applying polls.0001_initial... OK<br>  Applying sessions.0001_initial... OK</code></pre>\n<p>Ahora cargamos los datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:~/django_tutorial$ python3 manage.py loaddata db.json <br>Installed 53 object(s) from 1 fixture(s)</code></pre>\n<p>Ahora instalaremos con pip un servidor de aplicaciones como uwsgi:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:~$ source django/bin/activate<br>(django) alemd@nabil:~$ pip install uwsgi<br>Collecting uwsgi<br>  Downloading uwsgi-2.0.21.tar.gz (808 kB)<br>     |‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 808 kB 5.1 MB/s <br>Using legacy 'setup.py install' for uwsgi, since package 'wheel' is not installed.<br>Installing collected packages: uwsgi<br>    Running setup.py install for uwsgi ... done<br>Successfully installed uwsgi-2.0.21</code></pre>\n<p>Y crearemos una unidad de systemd:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:/var/www$ nano django/uwsgi.ini <br><br>[uwsgi]<br>http = :8080<br>chdir = /var/www/django_tutorial<br>wsgi-file = /var/www/django_tutorial/django_tutorial/wsgi.py<br>processes = 4<br>threads = 2<br></code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:/var/www$ sudo nano /etc/systemd/system/uwsgi-django.service <br><br>[Unit]<br>Description=uWSGI instance to serve django_tutorial<br>After=network.target<br><br>[Install]<br>WantedBy=multi-user.target<br><br>[Service]<br>User=www-data<br>Group=www-data<br>Restart=always<br><br>ExecStart=/var/www/django/bin/uwsgi --ini /var/www/django/uwsgi.ini<br>ExecReload=/bin/kill -s HUP $MAINPID<br>ExecStop=/bin/kill -s TERM $MAINPID<br><br>WorkingDirectory=/var/www/django_tutorial<br>Environment=PYTHONPATH='/var/www/django_tutorial/django_tutorial:/var/www><br><br>PrivateTmp=true<br></code></pre>\n<p>Una vez hecho esto recargaremos el demonio de systemctl para que se apliquen los cambios y habilitaremos la unidad:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:/var/www/django$ sudo systemctl daemon-reload<br>(django) alemd@nabil:/var/www/django$ sudo systemctl enable --now uwsgi-django.service<br>Created symlink /etc/systemd/system/multi-user.target.wants/uwsgi-django.service ‚Üí /etc/systemd/system/uwsgi-django.service.</code></pre>\n<p>Ahora configuraremos el virtual host en el servidor nginx del vps:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:/var/www/django$ sudo nano /etc/nginx/sites-available/django.conf<br><br>server {<br>        listen 80;<br>        listen [::]:80;<br><br>        root /var/www/django_tutorial;<br><br>        index index.html index.php index.htm index.nginx-debian.html;<br><br>        server_name python.alejandro-montes.es;<br><br>        location / {<br>                proxy_pass http://localhost:8080;<br>                include proxy_params;<br>        }<br><br>        location /static {<br>                alias /var/www/django_tutorial/static;<br>        }<br>}<br></code></pre>\n<p>Crearemos el enlace simb√≥lico para activar el virtual host:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:/var/www/django$ sudo ln -s  /etc/nginx/sites-available/django.conf /etc/nginx/sites-enabled/</code></pre>\n<p>Ahora crearemos una entrada en la configuraci√≥n de nuestro dns para poder acceder a trav√©s de internet.</p>\n<p><img src=\"/img/IAW-T4.P1.7.png\" alt=\"IAW-T4.P1.7.png\"></p>\n<p>Como podemos ver en la casilla marcada, hemos indicado a nuestro proveedor de dns un cname a nabil que es la m√°quina del vps. Ahora muestro una captura de pantalla de django funcionando en el vps:</p>\n<p><img src=\"/img/IAW-T4.P1.8.png\" alt=\"IAW-T4.P1.8.png\"></p>\n<h3 id=\"tarea-3%3A-modificaci%C3%B3n-de-nuestra-aplicaci%C3%B3n.\" tabindex=\"-1\">Tarea 3: Modificaci√≥n de nuestra aplicaci√≥n.</h3>\n<p>Lo primero que realizaremos ser√° entrar en el entorno de desarrollo (bravo) y modificaremos el apartado polls para que aparezca nuestro nombre:</p>\n<pre><code>[usuario@bravo django_tutorial]$ nano polls/templates/polls/index.html\n</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<p><img src=\"/img/IAW-T4.P1.13.png\" alt=\"IAW-T4.P1.13.png\"></p>\n<p>Ahora cambiaremos el fondo de la aplicaci√≥n para ello bajaremos una imagen y la pasaremos al servidor por scp. Una vez la imagen est√© en el servidor, la moveremos a la siguiente ruta:</p>\n<pre><code>[usuario@bravo ~]$ sudo mv background2.jpg /var/www/django_tutorial/static/polls/images/ \n</code></pre>\n<p>Y ahora editamos el css para aplicar los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ sudo nano /var/www/django_tutorial/static/polls/style.css </code></pre>\n<p>El contenido del fichero ya editado es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">li a {<br>    color: green;<br>    background-color: blanchedalmond;<br>}<br><br>body {<br>    background: white url(\"images/background2.jpg\");<br>}</code></pre>\n<p>Muestro una captura de bravo con la pantalla editada:</p>\n<p><img src=\"/img/IAW-T4.P1.9.png\" alt=\"IAW-T4.P1.9.png\"></p>\n<p>Una vez hecho esto, a√±adiremos una nueva tabla en la base de datos, para ello editaremos el archivo <a href=\"http://models.py\">models.py</a> situado en el directorio polls dentro de nuestra aplicaci√≥n django:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo django_tutorial]$ nano polls/models.py </code></pre>\n<p>A√±adimos lo siguiente al final del fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">class Categoria(models.Model):<br>    Abr = models.CharField(max_length=4)<br>    Nombre = models.CharField(max_length=50)<br><br>    def __str__(self):<br>        return self.Abr+\" - \"+self.Nombre</code></pre>\n<p>Crearemos una nueva migraci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) [usuario@bravo django_tutorial]$ python3 manage.py makemigrations<br>Migrations for 'polls':<br>  polls/migrations/0002_categoria.py<br>    - Create model Categoria<br>(django) [usuario@bravo django_tutorial]$ python3 manage.py migrate   <br>Operations to perform:<br>  Apply all migrations: admin, auth, contenttypes, polls, sessions<br>Running migrations:<br>  Applying polls.0002_categoria... OK</code></pre>\n<p>Ahora a√±adimos el nuevo modelo al panel de administraci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) [usuario@bravo django_tutorial]$ nano polls/admin.py </code></pre>\n<p>La segunda l√≠nea del fichero la cambiamos por la siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">from .models import Choice, Question, Categoria</code></pre>\n<p>Y al final agregamos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">admin.site.register(Categoria)</code></pre>\n<p>Reiniciamos el servicio y muestro el panel de administraci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) [usuario@bravo django_tutorial]$ sudo systemctl restart httpd</code></pre>\n<p><img src=\"/img/IAW-T4.P1.10.png\" alt=\"IAW-T4.P1.10.png\"></p>\n<p>Como vemos, en los polls ahora aparece <code>Categorias</code>. Ahora pasaremos los cambios a bravo, para ello actualizaremos nuestro repositorio de github con todos los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) [usuario@bravo django_tutorial]$ git add .<br>(django) [usuario@bravo django_tutorial]$ git commit -m \"modificacion\"<br>[master 5122a1d] modificacion<br> 7 files changed, 35 insertions(+), 4 deletions(-)<br> rewrite db.json (100%)<br> create mode 100644 polls/migrations/0002_categoria.py<br> create mode 100644 static/polls/images/background2.jpg<br>(django) [usuario@bravo django_tutorial]$ git push<br>Enumerating objects: 27, done.<br>Counting objects: 100% (27/27), done.<br>Compressing objects: 100% (15/15), done.<br>Writing objects: 100% (15/15), 43.47 KiB | 8.69 MiB/s, done.<br>Total 15 (delta 6), reused 0 (delta 0), pack-reused 0<br>remote: Resolving deltas: 100% (6/6), completed with 6 local objects.<br>To github.com:alemd01/django_tutorial.git<br>   48e377c..5122a1d  master -> master</code></pre>\n<p>Ahora en producci√≥n actualizamos los cambios:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:/var/www/django_tutorial$ git pull</code></pre>\n<p>Ahora haremos un collectstatic para que cambie la parte est√°tica de la aplicaci√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">(django) alemd@nabil:/var/www/django_tutorial$ python3 manage.py collectstatic<br><br>You have requested to collect static files at the destination<br>location as specified in your settings:<br><br>    /var/www/django_tutorial/static<br><br>This will overwrite existing files!<br>Are you sure you want to do this?<br><br>Type 'yes' to continue, or 'no' to cancel: yes</code></pre>\n<p>Por √∫ltimo muestro los cambios en producci√≥n:</p>\n<p>Primero muestro que polls tiene el background cambiado y muestra mi nombre:</p>\n<p><img src=\"/img/IAW-T4.P1.11.png\" alt=\"IAW-T4.P1.11.png\"></p>\n<p>Ahora muestro que en la zona de administraci√≥n se ha creado el nuevo polls:</p>\n<p><img src=\"/img/IAW-T4.P1.12.png\" alt=\"IAW-T4.P1.12.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2023-01-04T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/posts/comprobaciones/",
      "url": "https://reeseschultz.github.io/posts/comprobaciones/",
      "title": "",
      "content_html": "<h2 id=\"funcionamiento-de-los-ejercicios\" tabindex=\"-1\">Funcionamiento de los ejercicios</h2>\n<h3 id=\"3.-a%C3%B1ade-dos-columnas-llamadas-distancia-y-duraci%C3%B3n-(en-formato-hh%3Ami)-a-la-tabla-vuelos-y-rell%C3%A9nalas-adecuadamente.-realiza-un-trigger-que-garantice-que-un-avi%C3%B3n-asignado-a-un-viaje-tenga-una-autonom%C3%ADa-superior-al-menos-en-un-25%25-a-la-distancia-a-recorrer.\" tabindex=\"-1\">3. A√±ade dos columnas llamadas Distancia y Duraci√≥n (en formato hh:mi) a la tabla Vuelos y rell√©nalas adecuadamente. Realiza un trigger que garantice que un avi√≥n asignado a un viaje tenga una autonom√≠a superior al menos en un 25% a la distancia a recorrer.</h3>\n<p><strong>Pruebas con el update:</strong></p>\n<ul>\n<li>Update que la autonom√≠a del avi√≥n es superior en un 25% superior a la distancia:</li>\n</ul>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">UPDATE</span> VUELOS <span class=\"token keyword\">SET</span> DISTANCIA<span class=\"token operator\">=</span><span class=\"token number\">800</span> <span class=\"token keyword\">WHERE</span> CODVUELO<span class=\"token operator\">=</span><span class=\"token string\">'IB-5940'</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-AMD.1.png\" alt=\"BD-AMD.1.png\"></p>\n<ul>\n<li>Update que la autonom√≠a del avi√≥n es menor del 25% de la distancia a recorrer.</li>\n</ul>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">UPDATE</span> VUELOS <span class=\"token keyword\">SET</span> DISTANCIA<span class=\"token operator\">=</span><span class=\"token number\">5000</span> <span class=\"token keyword\">WHERE</span> CODVUELO<span class=\"token operator\">=</span><span class=\"token string\">'IB-5940'</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-AMD.2.png\" alt=\"BD-AMD.2.png\"></p>\n<p><strong>Pruebas con el insert:</strong></p>\n<ul>\n<li>Insert que la autonom√≠a del avi√≥n es superior en un 25% superior a la distancia:</li>\n</ul>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> VUELOS <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><br>    <span class=\"token string\">'UX-6013'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'PMI'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'MAD'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Air Europa'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Jueves'</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'10:15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'EJK000333'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'HYJ000568'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token number\">782</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'01:30'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-AMD.4.png\" alt=\"BD-AMD.4.png\"></p>\n<ul>\n<li>Insert que la autonom√≠a del avi√≥n es menor del 25% de la distancia a recorrer.</li>\n</ul>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> VUELOS <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><br>    <span class=\"token string\">'UX-6013'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'PMI'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'MAD'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Air Europa'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Jueves'</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'10:15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'EJK000333'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'HYJ000568'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token number\">7820</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'01:30'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-AMD.3.png\" alt=\"BD-AMD.3.png\"></p>\n<h3 id=\"7.-realiza-los-m%C3%B3dulos-de-programaci%C3%B3n-necesarios-para-garantizar-que-una-misma-compa%C3%B1%C3%ADa-no-tiene-m%C3%A1s-de-dos-vuelos-con-el-mismo-origen-y-destino-en-un-mismo-d%C3%ADa-de-la-semana.\" tabindex=\"-1\">7. Realiza los m√≥dulos de programaci√≥n necesarios para garantizar que una misma compa√±√≠a no tiene m√°s de dos vuelos con el mismo origen y destino en un mismo d√≠a de la semana.</h3>\n<p>Inserto un vuelo con el mismo origen y destino y en el mismo d√≠a de la semana.</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> VUELOS <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><br>    <span class=\"token string\">'CD-6015'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'PMI'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'MAD'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Air Europa'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Jueves'</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'14:15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'CVF000126'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'FHY000456'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token number\">782</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'01:30'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-AMD.5.png\" alt=\"BD-AMD.5.png\"></p>\n<p>Si insertamos otro vuelo con el mismo origen y destino y en el mismo d√≠a de la semana, se dispara el trigger.</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> VUELOS <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><br>    <span class=\"token string\">'CD-6017'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'PMI'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'MAD'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Air Europa'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'Jueves'</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'14:15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'CVF000126'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token string\">'FHY000456'</span><span class=\"token punctuation\">,</span><br>    <span class=\"token number\">782</span><span class=\"token punctuation\">,</span><br>    TO_DATE<span class=\"token punctuation\">(</span><span class=\"token string\">'01:30'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><br><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-AMD.6.png\" alt=\"BD-AMD.6.png\"></p>\n<p>El trigger no funciona bien, ya que al eliminar un vuelo no lo detecta y si se vuelve a insertar salta el trigger cuando no deber√≠a de hacerlo.</p>\n<h3 id=\"8.-realiza-los-m%C3%B3dulos-de-programaci%C3%B3n-necesarios-para-garantizar-que-el-n%C3%BAmero-de-auxiliares-de-vuelo-en-un-viaje-es-de-al-menos-uno-por-cada-5-pasajeros-que-realizan-ese-viaje.\" tabindex=\"-1\">8. Realiza los m√≥dulos de programaci√≥n necesarios para garantizar que el n√∫mero de auxiliares de vuelo en un viaje es de al menos uno por cada 5 pasajeros que realizan ese viaje.</h3>\n<p>Vamos a ingresar pasajeros hasta que salte la excepci√≥n. No dejo los inserts aqu√≠ ya que el c√≥digo ser√≠a muy largo, todos los inserts se encuentran en el archivo del ejercicio 8. Dejo aqu√≠ el resultado de hacer todos los inserts.</p>\n<p><img src=\"img/BD-AMD.7.png\" alt=\"BD-AMD.7.png\"></p>\n<p>He tenido problemas con la tabla temporal, para que se rellene tenemos que actualizar la tabla auxiliares de viaje para que se rellene</p>\n<h3 id=\"3.-(pl%2Fpgsql)-a%C3%B1ade-dos-columnas-llamadas-distancia-y-duraci%C3%B3n-(en-formato-hh%3Ami)-a-la-tabla-vuelos-y-rell%C3%A9nalas-adecuadamente.-realiza-un-trigger-que-garantice-que-un-avi%C3%B3n-asignado-a-un-viaje-tenga-una-autonom%C3%ADa-superior-al-menos-en-un-25%25-a-la-distancia-a-recorrer.\" tabindex=\"-1\">3. (pl/pgsql) A√±ade dos columnas llamadas Distancia y Duraci√≥n (en formato hh:mi) a la tabla Vuelos y rell√©nalas adecuadamente. Realiza un trigger que garantice que un avi√≥n asignado a un viaje tenga una autonom√≠a superior al menos en un 25% a la distancia a recorrer.</h3>\n<p>El primer insert funciona correctamente, en el segundo salta el error.</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"> <span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> VUELOS <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><br>     <span class=\"token string\">'UX-6013'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'PMI'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'MAD'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'Air Europa'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'Jueves'</span><span class=\"token punctuation\">,</span><br>     TO_TIMESTAMP<span class=\"token punctuation\">(</span><span class=\"token string\">'10:15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'EJK000333'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'HYJ000568'</span><span class=\"token punctuation\">,</span><br>     TO_TIMESTAMP<span class=\"token punctuation\">(</span><span class=\"token string\">'01:30'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>      <span class=\"token number\">782</span><br> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br></code></pre>\n<p>Este es el insert el cual hace que se dispare el trigger.</p>\n<pre class=\"language-sql\"><code class=\"language-sql\"> <span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> VUELOS <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><br>     <span class=\"token string\">'UX-6013'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'PMI'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'MAD'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'Air Europa'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'Jueves'</span><span class=\"token punctuation\">,</span><br>     TO_TIMESTAMP<span class=\"token punctuation\">(</span><span class=\"token string\">'10:15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'EJK000333'</span><span class=\"token punctuation\">,</span><br>     <span class=\"token string\">'HYJ000568'</span><span class=\"token punctuation\">,</span><br>     TO_TIMESTAMP<span class=\"token punctuation\">(</span><span class=\"token string\">'01:30'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'HH24:MI'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><br>      <span class=\"token number\">7820</span><br> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"img/BD-AMD.8.png\" alt=\"BD-AMD.8.png\"></p>\n",
      "date_published": "2022-12-30T18:59:38Z"
    },{
      "id": "https://reeseschultz.github.io/post/montaje-servidor-y-cliente-nfs-mediante-systemd./",
      "url": "https://reeseschultz.github.io/post/montaje-servidor-y-cliente-nfs-mediante-systemd./",
      "title": "Montaje Servidor y cliente NFS mediante Systemd.",
      "content_html": "<h3 id=\"creaci%C3%B3n-del-volumen-y-particionado.\" tabindex=\"-1\">Creaci√≥n del volumen y particionado.</h3>\n<p>Lo primero que he hecho ha sido a√±adir un volumen de 2Gb a la m√°quina <code>Alfa</code> de mi escenario en OpenStack. Una vex a√±adido el volumen, crearemos una partici√≥n y le daremos formato ext4.</p>\n<p>Para crear la partici√≥n he usado el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# fdisk /dev/vdb<br><br>Welcome to fdisk (util-linux 2.36.1).<br>Changes will remain in memory only, until you decide to write them.<br>Be careful before using the write command.<br><br>Device does not contain a recognized partition table.<br>Created a new DOS disklabel with disk identifier 0x04ba1fd8.<br><br>Command (m for help): n<br>Partition type<br>   p   primary (0 primary, 0 extended, 4 free)<br>   e   extended (container for logical partitions)<br>Select (default p): p<br>Partition number (1-4, default 1): <br>First sector (2048-4194303, default 2048): <br>Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-4194303, default 4194303): <br><br>Created a new partition 1 of type 'Linux' and of size 2 GiB.<br><br>Command (m for help): w<br>The partition table has been altered.<br>Calling ioctl() to re-read partition table.<br>Syncing disks.</code></pre>\n<p>Una vez creada la partici√≥n con el siguiente comando, le asignaremos el formato ext4.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# mkfs.ext4 /dev/vdb1<br>mke2fs 1.46.2 (28-Feb-2021)<br>Discarding device blocks: done                            <br>Creating filesystem with 524032 4k blocks and 131072 inodes<br>Filesystem UUID: faa25fa0-cffb-4494-b586-bdbe74f845aa<br>Superblock backups stored on blocks: <br>\t32768, 98304, 163840, 229376, 294912<br><br>Allocating group tables: done                            <br>Writing inode tables: done                            <br>Creating journal (8192 blocks): done<br>Writing superblocks and filesystem accounting information: done </code></pre>\n<h3 id=\"creaci%C3%B3n-de-la-unidad-en-systemd.\" tabindex=\"-1\">Creaci√≥n de la unidad en systemd.</h3>\n<p>Primero de todo crearemos el directorio donde se montar√° el volumen en mi caso es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# mkdir /media/Archivos</code></pre>\n<p>Ahora crearemos la unidad de systemd para montar el volumen en el servidor Alfa.</p>\n<p>Creamos el siguiente fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# nano /etc/systemd/system/media-Archivos.mount</code></pre>\n<p>El fichero tiene dicho ya que debe de llamarse igual que la ruta donde se monta el volumen cambiando las barras <code>/</code> por guiones <code>-</code> y es <code>.mount</code> porque es una unidad de montaje. A√±adiremos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Unit]<br>Description=Disco montado para practica ASO<br>[Mount]<br>What=/dev/vdb1<br>Where=/media/Archivos<br>Type=ext4<br>Options=defaults<br>[Install]<br>WantedBy=multi-user.target</code></pre>\n<ul>\n<li>Description como su nombre indica es una descripci√≥n del volumen montado.</li>\n<li>En What debemos indicar la ruta del volumen que queremos montar.</li>\n<li>En Where es donde lo hemos montado, es decir, la ruta donde se monta el volumen.</li>\n<li>La opci√≥n Type es el formato que tendra el volumen.</li>\n<li>En Options indicamos las opciones por defecto.</li>\n</ul>\n<p>Una vez hecho esto, la unidad estar√≠a creada. Ahora procederemos a activarlo.</p>\n<h3 id=\"activaci%C3%B3n-de-la-unidad-de-montaje.\" tabindex=\"-1\">Activaci√≥n de la unidad de montaje.</h3>\n<p>Para activar la unidad de montaje, tenemos que recargar el daemon de systemd antes para que detecto los nuevos cambios y la nueva unidad. Para ello usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# systemctl daemon-reload</code></pre>\n<p>Ahora ejecutamos el siguiente comando para iniciar la unidad creada:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# systemctl start media-Archivos.mount</code></pre>\n<p>Para habilitar que la unidad se inicie autom√°ticamente al inicio del sistema usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# systemctl enable media-Archivos.mount<br>Created symlink /etc/systemd/system/multi-user.target.wants/media-Archivos.mount ‚Üí /etc/systemd/system/media-Archivos.mount.</code></pre>\n<h3 id=\"configuraci%C3%B3n-servidor-nfs.\" tabindex=\"-1\">Configuraci√≥n servidor NFS.</h3>\n<p>Lo primero que tenemos que hacer es instalar los paquetes necesarios. Son los siguientes paquetes:</p>\n<ul>\n<li>nfs-kernel-server</li>\n<li>nfs-common</li>\n</ul>\n<p>Una vez instalados los paquetes, editaremos el fichero exports.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# nano /etc/exports</code></pre>\n<p>A√±adiremos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">/media/Archivos *(rw,no_root_squash)</code></pre>\n<p>Activamos el servicio:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# service nfs-kernel-server start</code></pre>\n<p>Ahora comprobamos los directorios exportados:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@alfa:/media/Archivos# showmount --exports localhost<br>Export list for localhost:<br>/media/Archivos *</code></pre>\n<h3 id=\"configuraci%C3%B3n-cliente-nfs.\" tabindex=\"-1\">Configuraci√≥n cliente NFS.</h3>\n<p>El cliente que configurar√© ser√° bravo. Lo primero que haremos ser√° instalar el cliente nfs-utils:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo system]$ sudo dnf install nfs-utils<br>Failed to set locale, defaulting to C.UTF-8<br>Last metadata expiration check: 1:58:56 ago on Tue Dec 27 15:52:39 2022.<br>Package nfs-utils-1:2.5.4-15.el9.x86_64 is already installed.<br>Dependencies resolved.<br>Nothing to do.<br>Complete!</code></pre>\n<p>Ahora crearemos una unidad de montaje del volumen nfs:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo system]$ sudo nano /etc/systemd/system/home-usuario-archivos.mount</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[Unit]<br>Description= cliente NFS<br>[Mount]<br>What=172.16.0.1:/media/Archivos<br>Where=/home/usuario/archivos<br>Type=nfs<br>Options=defaults<br>[Install]<br>WantedBy=multi-user.target</code></pre>\n<p>Reiniciamos el demonio de systemctl:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo system]$ sudo systemctl daemon-reload</code></pre>\n<p>Arrancamos la unidad que hemos creado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo system]$ sudo systemctl start home-usuario-archivos.mount </code></pre>\n<p>Como podemos ver se ha montado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo system]$ df -h<br>Filesystem                  Size  Used Avail Use% Mounted on<br>devtmpfs                    4.0M     0  4.0M   0% /dev<br>tmpfs                       383M     0  383M   0% /dev/shm<br>tmpfs                       153M   14M  140M   9% /run<br>/dev/vda5                    29G  1.3G   28G   5% /<br>/dev/vda2                   994M  267M  728M  27% /boot<br>/dev/vda1                   100M  7.0M   93M   7% /boot/efi<br>tmpfs                        77M     0   77M   0% /run/user/1000<br>172.16.0.1:/media/Archivos  2.0G     0  1.9G   0% /home/usuario/archivos</code></pre>\n<p>Ahora hacemos una prueba para ver que est√° montado correctamente. Desde el servidor crearemos una carpeta en el volumen:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:/media/Archivos$ sudo mkdir prueba</code></pre>\n<p>Ahora en el cliente listaremos los archivos para ver que se ha creado el directorio.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo ~]$ cd archivos/<br>[usuario@bravo archivos]$ ls<br>lost+found  prueba</code></pre>\n<p>Hacemos la prueba del rev√©s para ver que se pueden crear carpetas y ficheros desde el cliente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[usuario@bravo archivos]$ sudo mkdir prueba2<br>[usuario@bravo archivos]$ ls<br>lost+found  prueba  prueba2</code></pre>\n<p>Ahora listamos desde el servidor para ver que se ha creado correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@alfa:/media/Archivos$ ls<br>lost+found  prueba  prueba2</code></pre>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-12-15T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/criptografia-ii:-integridad-firmas-y-autenticacion/",
      "url": "https://reeseschultz.github.io/post/criptografia-ii:-integridad-firmas-y-autenticacion/",
      "title": "Criptograf√≠a II: Integridad, firmas y autenticaci√≥n",
      "content_html": "<h3 id=\"tarea-1%3A-firmas-electr%C3%B3nicas\" tabindex=\"-1\">Tarea 1: Firmas electr√≥nicas</h3>\n<h4 id=\"1.-manda-un-documento-y-la-firma-electr%C3%B3nica-del-mismo-a-un-compa%C3%B1ero.-verifica-la-firma-que-tu-has-recibido.\" tabindex=\"-1\">1. Manda un documento y la firma electr√≥nica del mismo a un compa√±ero. Verifica la firma que tu has recibido.</h4>\n<p>Para generar la firma de un documento, usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --detach-sign prueba.txt</code></pre>\n<p>Le enviamos al compa√±ero el documento con la firma y saldr√° el error del siguiente apratado.</p>\n<h4 id=\"2.-%C2%BFqu%C3%A9-significa-el-mensaje-que-aparece-en-el-momento-de-verificar-la-firma%3F\" tabindex=\"-1\">2. ¬øQu√© significa el mensaje que aparece en el momento de verificar la firma?</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\"> gpg: Firma correcta de \"Pepe D &lt;josedom24@gmail.com>\" [desconocido]<br> gpg: ATENCI√ìN: ¬°Esta clave no est√° certificada por una firma de confianza!<br> gpg:          No hay indicios de que la firma pertenezca al propietario.<br> Huellas dactilares de la clave primaria: E8DD 5DA9 3B88 F08A DA1D  26BF 5141 3DDB 0C99 55FC</code></pre>\n<p>Este mensaje sale porque no tenemos un anillo de confianza. El error, nos hace referencia a que nuestra clave no est√° en ningun anillo de confianza.</p>\n<h4 id=\"3.-vamos-a-crear-un-anillo-de-confianza-entre-los-miembros-de-nuestra-clase%2C-para-ello.\" tabindex=\"-1\">3. Vamos a crear un anillo de confianza entre los miembros de nuestra clase, para ello.</h4>\n<p><strong>Tu clave p√∫blica debe estar en un servidor de claves.</strong></p>\n<p>Tengo la clave subida al servidor de ubuntu.</p>\n<p><strong>Escribe tu fingerprint en un papel y d√°rselo a tu compa√±ero, para que puede descargarse tu clave p√∫blica.</strong></p>\n<p>Mi fingerprint es:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">A24B1921B28D5F7BA7320497E29C0E02DE5CF68C</code></pre>\n<p><strong>Te debes bajar al menos tres claves p√∫blicas de compa√±eros. Firma estas claves.</strong></p>\n<p>Clave de Alfonso.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --keyserver keyserver.ubuntu.com --recv-keys DA5E8263079216E8<br>gpg --sign-key DA5E8263079216E8</code></pre>\n<p>Clave de Paco.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --keyserver gpg.mit.edu --recv-keys D5DF96E1BBD7DB81<br>gpg --sign-key 7C499EE49A10C836480FCC9CD5DF96E1BBD7DB81</code></pre>\n<p>Clave de √ìscar.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --keyserver keyserver.ubuntu.com --recv-keys A8544395EB1796857BC8C1309E4B2C4247B5AA59<br>gpg --sign-key A8544395EB1796857BC8C1309E4B2C4247B5AA59</code></pre>\n<p><strong>Tu te debes asegurar que tu clave p√∫blica es firmada por al menos tres compa√±eros de la clase.</strong></p>\n<p>Mi clave p√∫blica ha sido firmada por Alfonso, Paco y √ìscar.</p>\n<p><strong>Una vez que firmes una clave se la tendr√°s que devolver a su due√±o, para que otra persona se la firme.</strong></p>\n<p>Exporto la clave de Alfonso y se la env√≠o.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --export -a DA5E8263079216E8 > clave_alfonso.asc</code></pre>\n<p>Exporto la clave de Paco y se la env√≠o</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --export -a 7C499EE49A10C836480FCC9CD5DF96E1BBD7DB81 > paco.key</code></pre>\n<p>Exporto la clave de √ìscar y se la env√≠o</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --export -a A8544395EB1796857BC8C1309E4B2C4247B5AA59 > oscar.key</code></pre>\n<p><strong>Cuando tengas las tres firmas sube la clave al servidor de claves y rellena tus datos en la tabla Claves p√∫blicas PGP 2020-2021</strong></p>\n<p>Subido.</p>\n<p><strong>Asegurate que te vuelves a bajar las claves p√∫blicas de tus compa√±eros que tengan las tres firmas.</strong></p>\n<p>Me he tenido que bajar manualmente las claves, ya que desde la terminal no se actualizaba.</p>\n<h4 id=\"4.-muestra-las-firmas-que-tiene-tu-clave-p%C3%BAblica.\" tabindex=\"-1\">4. Muestra las firmas que tiene tu clave p√∫blica.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --list-sig</code></pre>\n<p><img src=\"/img/SAD-P4.1.png\" alt=\"SAD-P4.1.png\"></p>\n<h4 id=\"5.-comprueba-que-ya-puedes-verificar-sin-%E2%80%9Cproblemas%E2%80%9D-una-firma-recibida-por-una-persona-en-la-que-conf%C3%ADas.\" tabindex=\"-1\">5. Comprueba que ya puedes verificar sin ‚Äúproblemas‚Äù una firma recibida por una persona en la que conf√≠as.</h4>\n<p>Alfonso me ha enviado un documento con su firma. Muestro que se ha verificado correctamente.</p>\n<p><img src=\"/img/SAD-P4.2.png\" alt=\"SAD-P4.2.png\"></p>\n<h4 id=\"6.-comprueba-que-puedes-verificar-con-confianza-una-firma-de-una-persona-en-las-que-no-conf%C3%ADas%2C-pero-sin-embargo-si-conf%C3%ADa-otra-persona-en-la-que-tu-tienes-confianza-total.\" tabindex=\"-1\">6. Comprueba que puedes verificar con confianza una firma de una persona en las que no conf√≠as, pero sin embargo si conf√≠a otra persona en la que tu tienes confianza total.</h4>\n<hr>\n<h3 id=\"tarea-2%3A-correo-seguro-con-evolution%2Fthunderbird\" tabindex=\"-1\">Tarea 2: Correo seguro con evolution/thunderbird</h3>\n<h4 id=\"1.-configura-el-cliente-de-correo-evolution-con-tu-cuenta-de-correo-habitual\" tabindex=\"-1\">1. Configura el cliente de correo evolution con tu cuenta de correo habitual</h4>\n<p>He iniciado sesi√≥n con la cuenta que uso normalmente.</p>\n<p><img src=\"/img/SAD-P4.3.png\" alt=\"SAD-P4.3.png\"></p>\n<h4 id=\"2.-a%C3%B1ade-a-la-cuenta-las-opciones-de-seguridad-para-poder-enviar-correos-firmados-con-tu-clave-privada-o-cifrar-los-mensajes-para-otros-destinatarios\" tabindex=\"-1\">2. A√±ade a la cuenta las opciones de seguridad para poder enviar correos firmados con tu clave privada o cifrar los mensajes para otros destinatarios</h4>\n<p>Tenemos que irnos a ajustes y configuraci√≥n de la cuenta, y le damos a cifrado extremo a extremo. All√≠ importaremos nuestra clave privada y activaremos el cifrado para nuevos mensajes.</p>\n<p><img src=\"/img/SAD-P4.5.png\" alt=\"SAD-P4.5.png\"></p>\n<h4 id=\"3.-env%C3%ADa-y-recibe-varios-mensajes-con-tus-compa%C3%B1eros-y-comprueba-el-funcionamiento-adecuado-de-gpg.\" tabindex=\"-1\">3. Env√≠a y recibe varios mensajes con tus compa√±eros y comprueba el funcionamiento adecuado de GPG.</h4>\n<p>Aqu√≠ muestro como Alfonso me ha enviado un correo cifrado por mi clave p√∫blica y lo puedo visualizar correctamente.</p>\n<p><img src=\"/img/SAD-P4.4.png\" alt=\"SAD-P4.4.png\"></p>\n<p>Como podemos ver en la siguiente captura le he enviado correctamente un correo cifrado a Paco.</p>\n<p><img src=\"/img/SAD-P4.7.jpg\" alt=\"SAD-P4.7.png\"></p>\n<h4 id=\"4.-correo-firmado-para-ra%C3%BAl.\" tabindex=\"-1\">4. Correo firmado para Ra√∫l.</h4>\n<p>Enviado el correo a Ra√∫l, mi correo es <a href=\"mailto:alemd01@outlook.com\">alemd01@outlook.com</a> para que lo puedas verificar.</p>\n<hr>\n<h3 id=\"tarea-3%3A-integridad-de-ficheros\" tabindex=\"-1\">Tarea 3: Integridad de ficheros</h3>\n<h4 id=\"1.-para-validar-el-contenido-de-la-imagen-cd%2C-solo-aseg%C3%BArese-de-usar-la-herramienta-apropiada-para-sumas-de-verificaci%C3%B3n.-para-cada-versi%C3%B3n-publicada-existen-archivos-de-suma-de-comprobaci%C3%B3n-con-algoritmos-fuertes-(sha256-y-sha512)%3B-deber%C3%ADa-usar-las-herramientas-sha256sum-o-sha512sum-para-trabajar-con-ellos.\" tabindex=\"-1\">1. Para validar el contenido de la imagen CD, solo aseg√∫rese de usar la herramienta apropiada para sumas de verificaci√≥n. Para cada versi√≥n publicada existen archivos de suma de comprobaci√≥n con algoritmos fuertes (SHA256 y SHA512); deber√≠a usar las herramientas sha256sum o sha512sum para trabajar con ellos.</h4>\n<p>Una vez descargada la ISO de debian, abriremos el fichero <a href=\"https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/\">SHA256SUMS</a> que se encuentra en el mismo enlace y nos centraremos en el checksum para la imagen <code>debian-11.5.0-amd64-netinst.iso</code> ya que esa es la que hemos descargado.</p>\n<p>Ejecutaremos el siguiente comando para ver checksum de la ISO:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/Descargas$ sha256sum debian-11.5.0-amd64-netinst.iso<br>e307d0e583b4a8f7e5b436f8413d4707dd4242b70aea61eb08591dc0378522f3  debian-11.5.0-amd64-netinst.iso</code></pre>\n<p>Y realizaremos un cat del archivo SHA512SUMS para ver si es el mismo checksum:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/Descargas$ cat SHA256SUMS | grep debian-11.5.0-amd64-netinst.iso<br>e307d0e583b4a8f7e5b436f8413d4707dd4242b70aea61eb08591dc0378522f3  debian-11.5.0-amd64-netinst.iso</code></pre>\n<p>Como podemos comprobar, el checksum es el mismo.</p>\n<h4 id=\"2.-verifica-que-el-contenido-del-hash-que-has-utilizado-no-ha-sido-manipulado%2C-usando-la-firma-digital-que-encontrar%C3%A1s-en-el-repositorio.-puedes-encontrar-una-gu%C3%ADa-para-realizarlo-en-este-art%C3%ADculo%3A-how-to-verify-an-authenticity-of-downloaded-debian-iso-images\" tabindex=\"-1\">2. Verifica que el contenido del hash que has utilizado no ha sido manipulado, usando la firma digital que encontrar√°s en el repositorio. Puedes encontrar una gu√≠a para realizarlo en este art√≠culo: How to verify an authenticity of downloaded Debian ISO images</h4>\n<p>Primero descargaremos el fichero <a href=\"https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/SHA256SUMS.sign\">SHA256SUMS.sign</a>.</p>\n<p>Importaremos la clave p√∫blica de debian para poder verificar la firma.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/Descargas$ gpg --keyserver keyring.debian.org --recv DF9B9C49EAA9298432589D76DA87E80D6294BE9B<br>gpg: clave DA87E80D6294BE9B: clave p√∫blica \"Debian CD signing key &lt;debian-cd@lists.debian.org>\" importada<br>gpg: Cantidad total procesada: 1<br>gpg:               importadas: 1</code></pre>\n<p>Una vez importada la clave p√∫blica de debian, procederemos a verificar la firma:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/Descargas$ gpg --verify SHA256SUMS.sign SHA256SUMS<br>gpg: Firmado el dom 11 sep 2022 01:00:07 CEST<br>gpg:                usando RSA clave DF9B9C49EAA9298432589D76DA87E80D6294BE9B<br>gpg: Firma correcta de \"Debian CD signing key &lt;debian-cd@lists.debian.org>\" [desconocido]<br>gpg: ATENCI√ìN: ¬°Esta clave no est√° certificada por una firma de confianza!<br>gpg:          No hay indicios de que la firma pertenezca al propietario.<br>Huellas dactilares de la clave primaria: DF9B 9C49 EAA9 2984 3258  9D76 DA87 E80D 6294 BE9B</code></pre>\n<p>Indica que se ha verificado correctamente y nos advierte de que la clave no est√° certificada por una firma de confianza.</p>\n<hr>\n<h3 id=\"tarea-4%3A-integridad-y-autenticidad-(apt-secure)\" tabindex=\"-1\">Tarea 4: Integridad y autenticidad (apt secure)</h3>\n<h4 id=\"1.-%C2%BFqu%C3%A9-software-utiliza-apt-secure-para-realizar-la-criptograf%C3%ADa-asim%C3%A9trica%3F\" tabindex=\"-1\">1. ¬øQu√© software utiliza apt secure para realizar la criptograf√≠a asim√©trica?</h4>\n<p>El software que  usa la herramienta apt secure es GPG.</p>\n<h4 id=\"2.-%C2%BFpara-que-sirve-el-comando-apt-key%3F-%C2%BFqu%C3%A9-muestra-el-comando-apt-key-list%3F\" tabindex=\"-1\">2. ¬øPara que sirve el comando apt-key? ¬øQu√© muestra el comando apt-key list?</h4>\n<p>Este comando, es una herramienta que permite gestionar la lista de claves que utiliza APT para autenticar paquetes. Algunas de las opciones mas usadas son las siguientes: add, del, export, exportall, list y finger.</p>\n<p>El comando apt-key list muestra todas las claves de confianza para APT:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~/Descargas$ apt-key list<br>Warning: apt-key is deprecated. Manage keyring files in trusted.gpg.d instead (see apt-key(8)).<br>/etc/apt/trusted.gpg<br>--------------------<br>pub   rsa4096 2021-10-27 [SC] [caduca: 2023-01-20]<br>      F9A2 1197 6ED6 62F0 0E59  361E 5E3C 45D7 B312 C643<br>uid        [desconocida] Spotify Public Repository Signing Key &lt;tux@spotify.com><br><br>/etc/apt/trusted.gpg.d/debian-archive-bullseye-automatic.gpg<br>------------------------------------------------------------<br>pub   rsa4096 2021-01-17 [SC] [caduca: 2029-01-15]<br>      1F89 983E 0081 FDE0 18F3  CC96 73A4 F27B 8DD4 7936<br>uid        [desconocida] Debian Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org><br>sub   rsa4096 2021-01-17 [S] [caduca: 2029-01-15]<br><br>/etc/apt/trusted.gpg.d/debian-archive-bullseye-security-automatic.gpg<br>---------------------------------------------------------------------<br>pub   rsa4096 2021-01-17 [SC] [caduca: 2029-01-15]<br>      AC53 0D52 0F2F 3269 F5E9  8313 A484 4904 4AAD 5C5D<br>uid        [desconocida] Debian Security Archive Automatic Signing Key (11/bullseye) &lt;ftpmaster@debian.org><br>sub   rsa4096 2021-01-17 [S] [caduca: 2029-01-15]<br><br>/etc/apt/trusted.gpg.d/debian-archive-bullseye-stable.gpg<br>---------------------------------------------------------<br>pub   rsa4096 2021-02-13 [SC] [caduca: 2029-02-11]<br>      A428 5295 FC7B 1A81 6000  62A9 605C 66F0 0D6C 9793<br>uid        [desconocida] Debian Stable Release Key (11/bullseye) &lt;debian-release@lists.debian.org><br><br>/etc/apt/trusted.gpg.d/debian-archive-buster-automatic.gpg<br>----------------------------------------------------------<br>pub   rsa4096 2019-04-14 [SC] [caduca: 2027-04-12]<br>      80D1 5823 B7FD 1561 F9F7  BCDD DC30 D7C2 3CBB ABEE<br>uid        [desconocida] Debian Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org><br>sub   rsa4096 2019-04-14 [S] [caduca: 2027-04-12]<br><br>/etc/apt/trusted.gpg.d/debian-archive-buster-security-automatic.gpg<br>-------------------------------------------------------------------<br>pub   rsa4096 2019-04-14 [SC] [caduca: 2027-04-12]<br>      5E61 B217 265D A980 7A23  C5FF 4DFA B270 CAA9 6DFA<br>uid        [desconocida] Debian Security Archive Automatic Signing Key (10/buster) &lt;ftpmaster@debian.org><br>sub   rsa4096 2019-04-14 [S] [caduca: 2027-04-12]<br><br>/etc/apt/trusted.gpg.d/debian-archive-buster-stable.gpg<br>-------------------------------------------------------<br>pub   rsa4096 2019-02-05 [SC] [caduca: 2027-02-03]<br>      6D33 866E DD8F FA41 C014  3AED DCC9 EFBF 77E1 1517<br>uid        [desconocida] Debian Stable Release Key (10/buster) &lt;debian-release@lists.debian.org><br><br>/etc/apt/trusted.gpg.d/debian-archive-stretch-automatic.gpg<br>-----------------------------------------------------------<br>pub   rsa4096 2017-05-22 [SC] [caduca: 2025-05-20]<br>      E1CF 20DD FFE4 B89E 8026  58F1 E0B1 1894 F66A EC98<br>uid        [desconocida] Debian Archive Automatic Signing Key (9/stretch) &lt;ftpmaster@debian.org><br>sub   rsa4096 2017-05-22 [S] [caduca: 2025-05-20]<br><br>/etc/apt/trusted.gpg.d/debian-archive-stretch-security-automatic.gpg<br>--------------------------------------------------------------------<br>pub   rsa4096 2017-05-22 [SC] [caduca: 2025-05-20]<br>      6ED6 F5CB 5FA6 FB2F 460A  E88E EDA0 D238 8AE2 2BA9<br>uid        [desconocida] Debian Security Archive Automatic Signing Key (9/stretch) &lt;ftpmaster@debian.org><br>sub   rsa4096 2017-05-22 [S] [caduca: 2025-05-20]<br><br>/etc/apt/trusted.gpg.d/debian-archive-stretch-stable.gpg<br>--------------------------------------------------------<br>pub   rsa4096 2017-05-20 [SC] [caduca: 2025-05-18]<br>      067E 3C45 6BAE 240A CEE8  8F6F EF0F 382A 1A7B 6500<br>uid        [desconocida] Debian Stable Release Key (9/stretch) &lt;debian-release@lists.debian.org><br><br>/etc/apt/trusted.gpg.d/microsoft.gpg<br>------------------------------------<br>pub   rsa2048 2015-10-28 [SC]<br>      BC52 8686 B50D 79E3 39D3  721C EB3E 94AD BE12 29CF<br>uid        [desconocida] Microsoft (Release signing) &lt;gpgsecurity@microsoft.com><br><br>/etc/apt/trusted.gpg.d/spotify-2021-10-27-5E3C45D7B312C643.gpg<br>--------------------------------------------------------------<br>pub   rsa4096 2021-10-27 [SC] [caduca: 2023-01-20]<br>      F9A2 1197 6ED6 62F0 0E59  361E 5E3C 45D7 B312 C643<br>uid        [desconocida] Spotify Public Repository Signing Key &lt;tux@spotify.com><br><br>/etc/apt/trusted.gpg.d/spotify-2022-11-14-7A3A762FAFD4A51F.gpg<br>--------------------------------------------------------------<br>pub   rsa4096 2022-11-14 [SC] [caduca: 2024-02-07]<br>      E274 09F5 1D1B 6633 7F2D  2F41 7A3A 762F AFD4 A51F<br>uid        [desconocida] Spotify Public Repository Signing Key &lt;tux@spotify.com><br></code></pre>\n<h4 id=\"3.-en-que-fichero-se-guarda-el-anillo-de-claves-que-guarda-la-herramienta-apt-key%3F\" tabindex=\"-1\">3. En que fichero se guarda el anillo de claves que guarda la herramienta apt-key?</h4>\n<p>Se encuentra en <code>/etc/apt/trusted.gpg</code>.</p>\n<h4 id=\"4.-%C2%BFqu%C3%A9-contiene-el-archivo-release-de-un-repositorio-de-paquetes%3F.-%C2%BFy-el-archivo-release.gpg%3F.-puedes-ver-estos-archivos-en-el-repositorio-http%3A%2F%2Fftp.debian.org%2Fdebian%2Fdists%2Fdebian10.1%2F.-estos-archivos-se-descargan-cuando-hacemos-un-apt-update.\" tabindex=\"-1\">4. ¬øQu√© contiene el archivo Release de un repositorio de paquetes?. ¬øY el archivo Release.gpg?. Puedes ver estos archivos en el repositorio <a href=\"http://ftp.debian.org/debian/dists/Debian10.1/\">http://ftp.debian.org/debian/dists/Debian10.1/</a>. Estos archivos se descargan cuando hacemos un apt update.</h4>\n<p>El archivo release contiene una lista de los archivos <code>Package</code>, junto con sus hash MD5, SHA1 y SHA256. Con esto, podemos verificar que los ficheros <code>Packages</code> no han sido manipulados, comparando el hash que se nos ha facilitado con el hash que nosotros calculamos osbre el fichero que hemos descargado.</p>\n<p>El archivo release.gpg Contiene la firma con la que se verifica que no se ha manipulado el paquete.</p>\n<h4 id=\"5.-explica-el-proceso-por-el-cual-el-sistema-nos-asegura-que-los-ficheros-que-estamos-descargando-son-leg%C3%ADtimos.\" tabindex=\"-1\">5. Explica el proceso por el cual el sistema nos asegura que los ficheros que estamos descargando son leg√≠timos.</h4>\n<p>Primero se descargan los ficheros Release, Release.gpg y el fichero Packages correspondientes. Se comprueba que usando la firma Release.gpg m√°s la clave p√∫blica correspondiente el fichero es leg√≠timo, entonces apt ya conf√≠a en todos sus checksum. Apt compara el checksum del Package con el que checksum del fichero Release, si ambos coinciden, el fichero se habr√≠a descargado.</p>\n<h4 id=\"6.-a%C3%B1ade-de-forma-correcta-el-repositorio-de-virtualbox-a%C3%B1adiendo-la-clave-p%C3%BAblica-de-virtualbox-como-se-indica-en-la-documentaci%C3%B3n.\" tabindex=\"-1\">6. A√±ade de forma correcta el repositorio de virtualbox a√±adiendo la clave p√∫blica de virtualbox como se indica en la documentaci√≥n.</h4>\n<p>Primero descargamos las claves gpg:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">sudo wget -O- https://www.virtualbox.org/download/oracle_vbox_2016.asc | gpg --dearmor | sudo tee /usr/share/keyrings/virtualbox.gpg</code></pre>\n<p>A√±adimos el repositorio al sources.list:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">echo deb [arch=amd64 signed-by=/usr/share/keyrings/virtualbox.gpg] http://download.virtualbox.org/virtualbox/debian bullseye contrib | sudo tee /etc/apt/sources.list.d/virtualbox.list</code></pre>\n<hr>\n<h3 id=\"tarea-5%3A-autentificaci%C3%B3n%3A-ejemplo-ssh\" tabindex=\"-1\">Tarea 5: Autentificaci√≥n: ejemplo SSH</h3>\n<h4 id=\"1.-explica-los-pasos-que-se-producen-entre-el-cliente-y-el-servidor-para-que-el-protocolo-cifre-la-informaci%C3%B3n-que-se-transmite%3F-%C2%BFpara-qu%C3%A9-se-utiliza-la-criptograf%C3%ADa-sim%C3%A9trica%3F-%C2%BFy-la-asim%C3%A9trica%3F\" tabindex=\"-1\">1. Explica los pasos que se producen entre el cliente y el servidor para que el protocolo cifre la informaci√≥n que se transmite? ¬øPara qu√© se utiliza la criptograf√≠a sim√©trica? ¬øY la asim√©trica?</h4>\n<p>Son 2 pasos los que se realizan antes de que se cifre una comunicaci√≥n ssh:</p>\n<ul>\n<li>Conexi√≥n:</li>\n</ul>\n<p>El cliente establece una conexi√≥n TCP con l servidor, y este responde con las versiones del protocolo que soporta. El cliente tiene que usar unas de las versiones que soporta el servidor para continuar. El servidor comparte su clave p√∫blica con el cliente para que compruebe si es la m√°quina ala que quer√≠a conectarse. Ahora, ambas partes est√°n preparadas para la negociaci√≥n de una clave de sesi√≥n usando Diffie-Hellman.</p>\n<ul>\n<li>Negociaci√≥n:</li>\n</ul>\n<p>El cliente y el servidor, se ponen de acuerdo en un n√∫mero primo alto, que servir√° como seed value, tambi√©n se ponen de acuerdo en un tipo de cifrado, generan un n√∫mero primo por separado, que mantienen en secreto de la otra parte que lo usan como una clave privada de la negociaci√≥n, intercambian sus claves p√∫blicas generadas(no son las mismas que usan para la autenticaci√≥n). Cada parte usa su clave privada m√°s la clave p√∫blica de la otra parte m√°s el n√∫mero primo compartido original para calcular una clave compartida llamada shared secret. Este shared secret se usa para encriptar toda la comunicaci√≥n a partir de ahora.</p>\n<p>La criptograf√≠a sim√©trica se usa para encriptar conexiones mediante una clave secreta.</p>\n<p>La criptograf√≠a asim√©trica se usa durante el intercambio de claves, se usa en la autenticaci√≥n del cliente con el servidor.</p>\n<h4 id=\"2.-explica-los-dos-m%C3%A9todos-principales-de-autentificaci%C3%B3n%3A-por-contrase%C3%B1a-y-utilizando-un-par-de-claves-p%C3%BAblicas-y-privadas.\" tabindex=\"-1\">2. Explica los dos m√©todos principales de autentificaci√≥n: por contrase√±a y utilizando un par de claves p√∫blicas y privadas.</h4>\n<ul>\n<li>Por Contrase√±as:</li>\n</ul>\n<p>Es el m√©todo m√°s simple, el servidor pide al cliente que introduzca la contrase√±a del usuario al que intenta conectar y esta contrase√±a se env√≠a usando la encriptaci√≥n que previamente se ha negociado para que se mantenga en secreto.</p>\n<ul>\n<li>Por par de claves:</li>\n</ul>\n<p>Utiliza dos claves separadas para el cifrado y el descifrado. Estas dos claves se conocen como clave p√∫blica y privada, juntas forman el par de claves. La clave p√∫blica como su nombre indica se distribuye abiertamente y se comparte con el otro cliente. La clave privada debe de permanecer oculta, para que la conexi√≥n sea segura, ning√∫n tercero puede conocerla.</p>\n<p>El cliente env√≠a el ID del par de claves con el que se quiere autenticar ante el servidor. El servidor comprueba en el fichero <code>authorized_keys</code> del usuario al que quiere conectar el cliente si ese ID coincide con algunas de las claves p√∫blicas que tiene en el fichero. Si se encuentra una clave p√∫blica que coincide, el servidor genera un n√∫mero aleatorio y usa esa clave p√∫blica para desencriptarlo. El servidor env√≠a este n√∫mero encriptado al cliente. Si el cliente tiene la clave privada del par de claves, podr√° desencriptar este mensaje y revelar el n√∫mero original. El cliente combina el n√∫mero desencriptado con la clave compartida de sesi√≥n que se est√ßa usando para encriptar la comunicaci√≥n y calcula el hash MD5 de este valor. El cliente env√≠a al servidor este hash como respuesta. El servidor compara el hash que √©l mismo gener√≥ con el que el cliente le ha enviado. Si los valores son iguales, se prueba que el cliente tiene la clave privada correcta y el cliente se autentica correctamente.</p>\n<h4 id=\"3.-en-el-cliente-para-que-sirve-el-contenido-que-se-guarda-en-el-fichero-~%2F.ssh%2Fknow_hosts%3F\" tabindex=\"-1\">3. En el cliente para que sirve el contenido que se guarda en el fichero ~/.ssh/know_hosts?</h4>\n<p>En este fichero, se guardan todas las claves p√∫blicas a las que el cliente se conecta. Se usa para autenticar los servidores a los que se conecta.</p>\n<h4 id=\"4.-%C2%BFqu%C3%A9-significa-este-mensaje-que-aparece-la-primera-vez-que-nos-conectamos-a-un-servidor%3F\" tabindex=\"-1\">4. ¬øQu√© significa este mensaje que aparece la primera vez que nos conectamos a un servidor?</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\"> $ ssh debian@172.22.200.74<br> The authenticity of host '172.22.200.74 (172.22.200.74)' can't be established.<br> ECDSA key fingerprint is SHA256:7ZoNZPCbQTnDso1meVSNoKszn38ZwUI4i6saebbfL4M.<br> Are you sure you want to continue connecting (yes/no)? </code></pre>\n<p>Este mensaje es mostrado al ser la primera vez que nos conectamos a ese servidor por ssh y sucede porque en el fichero <code>know_hosts</code> no tenemos almacenada la clave p√∫blica y no se ha podido verificar la autenticidad del mismo. Si estamos seguro de su autenticidad, le diremos que s√≠ y se guardar√° su clave p√∫blica en el fichero <code>know_hosts</code>.</p>\n<h4 id=\"5.-en-ocasiones-cuando-estamos-trabajando-en-el-cloud%2C-y-reutilizamos-una-ip-flotante-nos-aparece-este-mensaje%3A\" tabindex=\"-1\">5. En ocasiones cuando estamos trabajando en el cloud, y reutilizamos una ip flotante nos aparece este mensaje:</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\"> $ ssh debian@172.22.200.74<br> @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br> @    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @<br> @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@<br> IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!<br> Someone could be eavesdropping on you right now (man-in-the-middle attack)!<br> It is also possible that a host key has just been changed.<br> The fingerprint for the ECDSA key sent by the remote host is<br> SHA256:W05RrybmcnJxD3fbwJOgSNNWATkVftsQl7EzfeKJgNc.<br> Please contact your system administrator.<br> Add correct host key in /home/jose/.ssh/known_hosts to get rid of this message.<br> Offending ECDSA key in /home/jose/.ssh/known_hosts:103<br>   remove with:<br>   ssh-keygen -f \"/home/jose/.ssh/known_hosts\" -R \"172.22.200.74\"<br> ECDSA host key for 172.22.200.74 has changed and you have requested strict checking.</code></pre>\n<p>El mensaje nos indica que la clave p√∫blica del servidor al cual nos queremos conectar ha cambiado con respecto a la que ten√≠amos guardadada para esa direcci√≥n IP en nuestro fichero <code>know_hosts</code>.</p>\n<p>Esta alerta sale porque as√≠ se realizan los ataques Man-In-The-Middle, pero si estamos seguros de que somos nosotros o una m√°quina que conocemos, borramos la l√≠nea correspondiente en nuestro <code>know_hosts</code> de la antigua conexi√≥n y volvemos a conectar o podemos ejecutar el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">   ssh-keygen -f \"/home/jose/.ssh/known_hosts\" -R \"&lt;&lt;DIRECCION.IP.DEL.SERVIDOR>>\"</code></pre>\n<h4 id=\"6.-%C2%BFqu%C3%A9-guardamos-y-para-qu%C3%A9-sirve-el-fichero-en-el-servidor-~%2F.ssh%2Fauthorized_keys%3F\" tabindex=\"-1\">6. ¬øQu√© guardamos y para qu√© sirve el fichero en el servidor ~/.ssh/authorized_keys?</h4>\n<p>Es un fichero que existe para cada usuario del sistema y guarda las claves p√∫blicas de los clientes que entran a ese usuario mediante ssh.</p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-12-08T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/boletin-individual-plsql/",
      "url": "https://reeseschultz.github.io/post/boletin-individual-plsql/",
      "title": "Bolet√≠n individual PL/SQL",
      "content_html": "<h3 id=\"hacer-un-procedimiento-que-muestre-el-nombre-y-el-salario-del-empleado-cuyo-c%C3%B3digo-es-7082\" tabindex=\"-1\">Hacer un procedimiento que muestre el nombre y el salario del empleado cuyo c√≥digo es 7082</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MUESTRANOMBREYSALARIO<br><span class=\"token keyword\">IS</span><br>    V_ENAME EMP<span class=\"token punctuation\">.</span>ENAME<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">;</span><br>    V_SAL EMP<span class=\"token punctuation\">.</span>SAL<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token keyword\">SELECT</span> ENAME<span class=\"token punctuation\">,</span> SAL <span class=\"token keyword\">INTO</span> V_ENAME<span class=\"token punctuation\">,</span> V_SAL<br>    <span class=\"token keyword\">FROM</span> EMP <span class=\"token keyword\">WHERE</span> EMPNO <span class=\"token operator\">=</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">;</span><br>    <br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'Nombre: '</span><span class=\"token operator\">||</span> v_ename<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'Salario: '</span><span class=\"token operator\">||</span> v_sal<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br></code></pre>\n<p><img src=\"/img/BD-P3.1.png\" alt=\"BD-P3.1.png\"></p>\n<h3 id=\"hacer-un-procedimiento-que-reciba-como-par%C3%A1metro-un-c%C3%B3digo-de-empleado-y-devuelva-su-nombre\" tabindex=\"-1\">Hacer un procedimiento que reciba como par√°metro un c√≥digo de empleado y devuelva su nombre</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MUESTRA_NOMBRE <span class=\"token punctuation\">(</span>P_EMPNO EMP<span class=\"token punctuation\">.</span>EMPNO<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>    V_NOMBRE EMP<span class=\"token punctuation\">.</span>ENAME<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token keyword\">SELECT</span> ENAME <span class=\"token keyword\">INTO</span> V_NOMBRE <br>    <span class=\"token keyword\">FROM</span> EMP <span class=\"token keyword\">WHERE</span> EMPNO<span class=\"token operator\">=</span>P_EMPNO<span class=\"token punctuation\">;</span><br><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'Nombre: '</span><span class=\"token operator\">||</span> V_NOMBRE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.2.png\" alt=\"BD-P3.2.png\"></p>\n<h3 id=\"hacer-un-procedimiento-que-devuelva-los-nombres-de-los-tres-empleados-m%C3%A1s-antiguos\" tabindex=\"-1\">Hacer un procedimiento que devuelva los nombres de los tres empleados m√°s antiguos</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> TRES_MAS_ANTIGUOS<br><span class=\"token keyword\">AS</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">FOR</span> emp <span class=\"token keyword\">IN</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">SELECT</span> ENAME<br>              <span class=\"token keyword\">FROM</span> EMP<br>              <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> HIREDATE <span class=\"token keyword\">ASC</span><br>              <span class=\"token keyword\">FETCH</span> <span class=\"token keyword\">FIRST</span> <span class=\"token number\">3</span> ROWS <span class=\"token keyword\">ONLY</span><span class=\"token punctuation\">)</span><br>  <span class=\"token keyword\">LOOP</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span>emp<span class=\"token punctuation\">.</span>ENAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.3.png\" alt=\"BD-P3.3.png\"></p>\n<h3 id=\"hacer-un-procedimiento-que-reciba-el-nombre-de-un-tablespace-y-muestre-los-nombres-de-los-usuarios-que-lo-tienen-como-tablespace-por-defecto-(vista-dba_users)\" tabindex=\"-1\">Hacer un procedimiento que reciba el nombre de un tablespace y muestre los nombres de los usuarios que lo tienen como tablespace por defecto (Vista DBA_USERS)</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MUESTRA_TABLESPACE <span class=\"token punctuation\">(</span>P_TABLESPACE VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>    <span class=\"token keyword\">CURSOR</span> C_NOMBRE <span class=\"token keyword\">IS</span><br>    <span class=\"token keyword\">SELECT</span> USERNAME<br>    <span class=\"token keyword\">FROM</span> DBA_USERS<br>    <span class=\"token keyword\">WHERE</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>P_TABLESPACE<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token keyword\">FOR</span> R_NAME <span class=\"token keyword\">IN</span> C_NOMBRE<br>    <span class=\"token keyword\">LOOP</span><br>        DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span>CHR<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token operator\">||</span><span class=\"token string\">'Nombre: '</span><span class=\"token operator\">||</span> R_NAME<span class=\"token punctuation\">.</span>USERNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.4.png\" alt=\"BD-P3.4.png\"></p>\n<h3 id=\"modificar-el-procedimiento-anterior-para-que-haga-lo-mismo-pero-devolviendo-el-n%C3%BAmero-de-usuarios-que-tienen-ese-tablespace-como-tablespace-por-defecto.-nota%3A-hay-que-convertir-el-procedimiento-en-funci%C3%B3n\" tabindex=\"-1\">Modificar el procedimiento anterior para que haga lo mismo pero devolviendo el n√∫mero de usuarios que tienen ese tablespace como tablespace por defecto. Nota: Hay que convertir el procedimiento en funci√≥n</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">FUNCTION</span> F_CUENTA_USUARIOS <span class=\"token punctuation\">(</span>P_TABLESPACE VARCHAR2<span class=\"token punctuation\">)</span><br> <span class=\"token keyword\">RETURN</span> NUMBER<br><span class=\"token keyword\">IS</span><br>  V_RESULTADO NUMBER<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">SELECT</span> <span class=\"token function\">COUNT</span><span class=\"token punctuation\">(</span>USERNAME<span class=\"token punctuation\">)</span> <span class=\"token keyword\">INTO</span> V_RESULTADO<br>  <span class=\"token keyword\">FROM</span> DBA_USERS <span class=\"token keyword\">WHERE</span> DEFAULT_TABLESPACE<span class=\"token operator\">=</span>P_TABLESPACE<span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">RETURN</span> V_RESULTADO<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.5.png\" alt=\"BD-P3.5.png\"></p>\n<h3 id=\"hacer-un-procedimiento-llamado-mostrar_usuarios_por_tablespace-que-muestre-por-pantalla-un-listado-de-los-tablespaces-existentes-con-la-lista-de-usuarios-de-cada-uno-y-el-n%C3%BAmero-de-los-mismos%2C-as%C3%AD%3A-(vistas-dba_tablespaces-y-dba_users)\" tabindex=\"-1\">Hacer un procedimiento llamado mostrar_usuarios_por_tablespace que muestre por pantalla un listado de los tablespaces existentes con la lista de usuarios de cada uno y el n√∫mero de los mismos, as√≠: (Vistas DBA_TABLESPACES y DBA_USERS)</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MOSTRAR_USUARIOS_POR_TABLESPACE<br><span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">CURSOR</span> C_TABLESPACE <span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">SELECT</span> TABLESPACE_NAME <br>  <span class=\"token keyword\">FROM</span> DBA_TABLESPACES<span class=\"token punctuation\">;</span><br>  V_CONT NUMBER<span class=\"token punctuation\">;</span><br>  V_CONT_TOTAL NUMBER <span class=\"token operator\">:=</span><span class=\"token number\">0</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">FOR</span> R_TABLESPACE <span class=\"token keyword\">IN</span> C_TABLESPACE<br>  <span class=\"token keyword\">LOOP</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">' Tablespace: '</span><span class=\"token operator\">||</span>R_TABLESPACE<span class=\"token punctuation\">.</span>TABLESPACE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    MUESTRA_TABLESPACE<span class=\"token punctuation\">(</span>R_TABLESPACE<span class=\"token punctuation\">.</span>TABLESPACE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <br>    V_CONT <span class=\"token operator\">:=</span> F_CUENTA_USUARIOS<span class=\"token punctuation\">(</span>R_TABLESPACE<span class=\"token punctuation\">.</span>TABLESPACE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    V_CONT_TOTAL <span class=\"token operator\">:=</span> V_CONT_TOTAL<span class=\"token operator\">+</span>V_CONT<span class=\"token punctuation\">;</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'El total de usuarios en el Tablespace es: '</span><span class=\"token operator\">||</span>V_CONT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br>  DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span>chr<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token operator\">||</span><span class=\"token string\">'El total de usuarios en la base de datos es: '</span><span class=\"token operator\">||</span>V_CONT_TOTAL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.6.png\" alt=\"BD-P3.6.png\"></p>\n<p><img src=\"/img/BD-P3.6.2.png\" alt=\"BD-P3.6.2.png\"></p>\n<h3 id=\"hacer-un-procedimiento-llamado-mostrar_codigo_fuente-que-reciba-el-nombre-de-otro-procedimiento-y-muestre-su-c%C3%B3digo-fuente.-(dba_source)\" tabindex=\"-1\">Hacer un procedimiento llamado mostrar_codigo_fuente  que reciba el nombre de otro procedimiento y muestre su c√≥digo fuente. (DBA_SOURCE)</h3>\n<p>Lo he hecho de 2 formas distintas:</p>\n<p>Si usamos una consulta con la tabla DBA_SOURCES lo he hecho as√≠.</p>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MUESTRA_CODIGO_FUENTE <span class=\"token punctuation\">(</span>P_NOMBREPROCEDURE VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>    <span class=\"token comment\">--CURSOR DONDE ALMACENAMOS EL PROCEDIMIENTO</span><br>    <span class=\"token keyword\">CURSOR</span> C_NOMBREPROCEDURE <span class=\"token keyword\">IS</span><br>    <span class=\"token keyword\">SELECT</span> TEXT<br>    <span class=\"token keyword\">FROM</span> DBA_SOURCE<br>    <span class=\"token keyword\">WHERE</span> <span class=\"token keyword\">NAME</span><span class=\"token operator\">=</span>P_NOMBREPROCEDURE<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token comment\">--RECORREMOS EL CURSOR PARA MOSTRAR EL PROCEDIMIENTO</span><br>    <span class=\"token keyword\">FOR</span> R_NAME <span class=\"token keyword\">IN</span> C_NOMBREPROCEDURE<br>    <span class=\"token keyword\">LOOP</span><br>        DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span>R_NAME<span class=\"token punctuation\">.</span>TEXT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p>Muestra el c√≥digo sin formato y con un salto de l√≠nea entre s√≠. He tenido que usar un cursor porque el c√≥digo lo divid√≠a en filas y no lo almacenaba en una sola.</p>\n<p>Para mostrarlo con formato he usado este procedimiento:</p>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">PROCEDURE</span> MOSTRAR_CODIGO_FUENTE <span class=\"token punctuation\">(</span>P_PROCEDIMIENTO VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>  <span class=\"token comment\">-- VARIABLE DONDE SE GUARDA EL CODIGO FUENTE</span><br>  V_CODIGOFUENTE CLOB<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token comment\">-- OBTIENE EL CODIGO FUENTE DEL PROCEDIMIENTO:</span><br>  <span class=\"token keyword\">SELECT</span> DBMS_METADATA<span class=\"token punctuation\">.</span>GET_DDL<span class=\"token punctuation\">(</span><span class=\"token string\">'PROCEDURE'</span><span class=\"token punctuation\">,</span> P_PROCEDIMIENTO<span class=\"token punctuation\">)</span><br>  <span class=\"token keyword\">INTO</span> V_CODIGOFUENTE <br>  <span class=\"token keyword\">FROM</span> DUAL<span class=\"token punctuation\">;</span><br>  DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span>V_CODIGOFUENTE<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.7.png\" alt=\"BD-P3.7.png\"></p>\n<h3 id=\"hacer-un-procedimiento-llamado-mostrar_privilegios_usuario-que-reciba-el-nombre-de-un-usuario-y-muestre-sus-privilegios-de-sistema-y-sus-privilegios-sobre-objetos.-(dba_sys_privs-y-dba_tab_privs)\" tabindex=\"-1\">Hacer un procedimiento llamado mostrar_privilegios_usuario que reciba el nombre de un usuario y muestre sus privilegios de sistema y sus privilegios sobre objetos. (DBA_SYS_PRIVS y DBA_TAB_PRIVS)</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">FUNCTION</span> SYSTEM_PRIVILEGES <span class=\"token punctuation\">(</span>P_USERNAME VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">RETURN</span> VARCHAR2<br><span class=\"token keyword\">IS</span><br>  <span class=\"token comment\">-- LA VARIABLE TIENE COMO TIPO DE DATO CLOB PORQUE ES UNA CADENA DE CARACTERES MUY GRANDE LO QUE PUEDE LLEGAR A ALMACENAR.</span><br>  V_PRIVILEGIOS CLOB<span class=\"token punctuation\">;</span><br>  <span class=\"token comment\">-- CREAMOS UN CURSOR QUE ALMACENA LOS PRIVILEGIOS DE LOS USUARIOS SEG√öN EL USUARIO QUE HEMOS PASADO POR PAR√ÅMETRO.</span><br>  <span class=\"token keyword\">CURSOR</span> C_PRIVILEGIOS <span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">SELECT</span> PRIVILEGE<br>  <span class=\"token keyword\">FROM</span> DBA_SYS_PRIVS<br>  <span class=\"token keyword\">WHERE</span> GRANTEE<span class=\"token operator\">=</span>P_USERNAME<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token comment\">--EN EL FOR LO QUE HACEMOS ES GUARDAR EN LA VARIABLE LOS PRIVILEGIOS SEPARADOS POR UNA COMA.</span><br>  <span class=\"token keyword\">FOR</span> R_SYS <span class=\"token keyword\">IN</span> C_PRIVILEGIOS<br>  <span class=\"token keyword\">LOOP</span><br>    V_PRIVILEGIOS <span class=\"token operator\">:=</span> V_PRIVILEGIOS<span class=\"token operator\">||</span> R_SYS<span class=\"token punctuation\">.</span>PRIVILEGE <span class=\"token operator\">||</span> <span class=\"token string\">', '</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br>  <span class=\"token comment\">-- CON EL RTRIM QUITAMOS LA √öLTIMA COMA Y ESPACIO.</span><br>  V_PRIVILEGIOS <span class=\"token operator\">:=</span> RTRIM<span class=\"token punctuation\">(</span>V_PRIVILEGIOS<span class=\"token punctuation\">,</span> <span class=\"token string\">', '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">RETURN</span> V_PRIVILEGIOS<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br><br><span class=\"token comment\">-- ESTA FUNCION NO LA COMENTO YA QUE ES LA MISMA QUE LA ANTERIOR CAMBIANDO LA CONSULTA.</span><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">FUNCTION</span> TABLES_PRIVILEGES <span class=\"token punctuation\">(</span>P_USERNAME VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">RETURN</span> VARCHAR2<br><span class=\"token keyword\">IS</span><br>  V_PRIVILEGIOS CLOB<span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">CURSOR</span> C_PRIVILEGIOS <span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">SELECT</span> PRIVILEGE<br>  <span class=\"token keyword\">FROM</span> DBA_TAB_PRIVS<br>  <span class=\"token keyword\">WHERE</span> GRANTOR<span class=\"token operator\">=</span>P_USERNAME<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">FOR</span> R_TAB <span class=\"token keyword\">IN</span> C_PRIVILEGIOS<br>  <span class=\"token keyword\">LOOP</span><br>    V_PRIVILEGIOS <span class=\"token operator\">:=</span> V_PRIVILEGIOS<span class=\"token operator\">||</span> R_TAB<span class=\"token punctuation\">.</span>PRIVILEGE <span class=\"token operator\">||</span> <span class=\"token string\">', '</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br>  V_PRIVILEGIOS <span class=\"token operator\">:=</span> RTRIM<span class=\"token punctuation\">(</span>V_PRIVILEGIOS<span class=\"token punctuation\">,</span> <span class=\"token string\">', '</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">RETURN</span> V_PRIVILEGIOS<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br><br><span class=\"token comment\">-- ESTE PROCEDIMIENTO ES MUY SENCILLO, ALMACENAMOS LAS FUNCIONES EN VARIABLES Y LAS MOSTRAMOS POR PANTALLA.</span><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MOSTRAR_PRIVILEGIOS_USUARIO <span class=\"token punctuation\">(</span>P_USERNAME VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>  V_SYS_PRIV CLOB<span class=\"token punctuation\">;</span><br>  V_TAB_PRIV CLOB<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  V_SYS_PRIV <span class=\"token operator\">:=</span> SYSTEM_PRIVILEGES<span class=\"token punctuation\">(</span>P_USERNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  V_TAB_PRIV <span class=\"token operator\">:=</span> TABLES_PRIVILEGES<span class=\"token punctuation\">(</span>P_USERNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'Los privilegios de sistema del usuario '</span><span class=\"token operator\">||</span> P_USERNAME <span class=\"token operator\">||</span><span class=\"token string\">' son: '</span><span class=\"token operator\">||</span> V_SYS_PRIV<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'Los privilegios sobre objetos del usuario '</span><span class=\"token operator\">||</span> P_USERNAME <span class=\"token operator\">||</span><span class=\"token string\">' son: '</span><span class=\"token operator\">||</span> V_TAB_PRIV<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.8.png\" alt=\"BD-P3.8.png\"></p>\n<h3 id=\"realiza-un-procedimiento-llamado-listar_comisiones-que-nos-muestre-por-pantalla-un-listado-de-las-comisiones-de-los-empleados-agrupados-seg%C3%BAn-la-localidad-donde-est%C3%A1-ubicado-su-departamento-con-el-siguiente-formato%3A\" tabindex=\"-1\">Realiza un procedimiento llamado listar_comisiones que nos muestre por pantalla un listado de las comisiones de los empleados agrupados seg√∫n la localidad donde est√° ubicado su departamento con el siguiente formato:</h3>\n<p>SIN TERMINAR. NO FUNCIONA.</p>\n<p>TOTAL DE COMISIONES POR LOCALIDAD:</p>\n<p>TOTAL DE COMISIONES POR DEPARTAMENTO:\nSELECT DNAME, NVL(SUM(COMM),0) FROM EMP, DEPT WHERE EMP.DEPTNO=DEPT.DEPTNO AND DEPT.DEPTNO=20 GROUP BY DNAME;</p>\n<p>TOTAL DE COMISIONES DE EMPLEADOS:\nSELECT ENAME, NVL(COMM,0) AS COMISION FROM EMP WHERE DEPTNO=30 ORDER BY ENAME ASC;</p>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token comment\">--TERMINAR</span><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> LISTAR_COMISIONES<br><span class=\"token keyword\">IS</span><br><span class=\"token keyword\">BEGIN</span><br>  LISTAR_DEPARTAMENTOS<span class=\"token punctuation\">;</span><br>  LISTAR_LOCALIDAD<span class=\"token punctuation\">;</span><br>  LISTAR_COMISION<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> LISTAR_DEPARTAMENTOS <span class=\"token punctuation\">(</span>P_DEPTNO <span class=\"token keyword\">OUT</span> DEPT<span class=\"token punctuation\">.</span>DEPTNO<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">CURSOR</span> C_DEPT <span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">SELECT</span> DNAME<span class=\"token punctuation\">,</span> DEPTNO <span class=\"token keyword\">FROM</span> DEPT<br>  <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> LOC <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">FOR</span> R_DEPT <span class=\"token keyword\">IN</span> C_DEPT <span class=\"token keyword\">LOOP</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'DEPARTAMENTO: '</span><span class=\"token operator\">||</span>R_DEPT<span class=\"token punctuation\">.</span>DNAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    P_DEPTNO<span class=\"token operator\">:=</span>R_DEPT<span class=\"token punctuation\">.</span>DEPTNO<span class=\"token punctuation\">;</span><br>    LISTAR_LOCALIDAD<span class=\"token punctuation\">(</span>P_DEPTNO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> LISTAR_LOCALIDAD <span class=\"token punctuation\">(</span>P_DEPTNO DEPT<span class=\"token punctuation\">.</span>DEPTNO<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">CURSOR</span> C_LOC <span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">SELECT</span> LOC <span class=\"token keyword\">FROM</span> DEPT<br>  <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> LOC <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">FOR</span> R_LOC <span class=\"token keyword\">IN</span> C_LOC <span class=\"token keyword\">LOOP</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'LOCALIDAD: '</span><span class=\"token operator\">||</span>R_LOC<span class=\"token punctuation\">.</span>LOC<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    LISTAR_COMISION<span class=\"token punctuation\">(</span>P_DEPTNO<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> LISTAR_COMISION <span class=\"token punctuation\">(</span>P_DEPTNO DEPT<span class=\"token punctuation\">.</span>DEPTNO<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">CURSOR</span> C_COMM <span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">SELECT</span> ENAME<span class=\"token punctuation\">,</span> NVL<span class=\"token punctuation\">(</span>COMM<span class=\"token punctuation\">,</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">AS</span> <span class=\"token string\">\"COMISION\"</span><br>  <span class=\"token keyword\">FROM</span> EMP <span class=\"token keyword\">WHERE</span> DEPTNO<span class=\"token operator\">=</span>P_DEPTNO<br>  <span class=\"token keyword\">ORDER</span> <span class=\"token keyword\">BY</span> ENAME <span class=\"token keyword\">ASC</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">FOR</span> R_COMM <span class=\"token keyword\">IN</span> C_COMM <span class=\"token keyword\">LOOP</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span>CHR<span class=\"token punctuation\">(</span><span class=\"token number\">9</span><span class=\"token punctuation\">)</span><span class=\"token operator\">||</span>R_COMM<span class=\"token punctuation\">.</span>ENAME<span class=\"token operator\">||</span><span class=\"token string\">' ------------- '</span><span class=\"token operator\">||</span>R_COMM<span class=\"token punctuation\">.</span>COMISION<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p>Nota: Los nombres de localidades, departamentos y empleados deben aparecer por orden alfab√©tico.</p>\n<p>Si alguno de los departamentos no tiene ning√∫n empleado con comisiones, aparecer√° un mensaje informando de ello en lugar de la lista de empleados.</p>\n<p>El procedimiento debe gestionar adecuadamente las siguientes excepciones:</p>\n<pre><code>a) La tabla Empleados est√° vac√≠a.\nb) Alguna comisi√≥n es mayor que 10000.\n</code></pre>\n<h3 id=\"realiza-un-procedimiento-que-reciba-el-nombre-de-una-tabla-y-muestre-los-nombres-de-las-restricciones-que-tiene%2C-a-qu%C3%A9-columna-afectan-y-en-qu%C3%A9-consisten-exactamente.-(dba_tables%2C-dba_constraints%2C-dba_cons_columns)\" tabindex=\"-1\">Realiza un procedimiento que reciba el nombre de una tabla y muestre los nombres de las restricciones que tiene, a qu√© columna afectan y en qu√© consisten exactamente. (DBA_TABLES, DBA_CONSTRAINTS, DBA_CONS_COLUMNS)</h3>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MUESTRA_NOMBRE_RESTRICCIONES <span class=\"token punctuation\">(</span>P_TABLA VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">CURSOR</span> C_NOMBRE <span class=\"token keyword\">IS</span><br>  <span class=\"token keyword\">SELECT</span> CONSTRAINT_NAME <br>  <span class=\"token keyword\">FROM</span> DBA_CONSTRAINTS <br>  <span class=\"token keyword\">WHERE</span> TABLE_NAME<span class=\"token operator\">=</span>P_TABLA<span class=\"token punctuation\">;</span><br>  V_COLUMNA VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  V_TIPO_CONSTRAINT VARCHAR2<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>  DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'El nombre de la tabla es: '</span><span class=\"token operator\">||</span>P_TABLA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">FOR</span> R_CONST <span class=\"token keyword\">IN</span> C_NOMBRE<br>  <span class=\"token keyword\">LOOP</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'El nombre de la restriccion es: '</span><span class=\"token operator\">||</span>R_CONST<span class=\"token punctuation\">.</span>CONSTRAINT_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">SELECT</span> COLUMN_NAME <span class=\"token keyword\">INTO</span> V_COLUMNA <span class=\"token keyword\">FROM</span> DBA_CONS_COLUMNS <span class=\"token keyword\">WHERE</span> TABLE_NAME<span class=\"token operator\">=</span>P_TABLA <span class=\"token keyword\">AND</span> CONSTRAINT_NAME<span class=\"token operator\">=</span>R_CONST<span class=\"token punctuation\">.</span>CONSTRAINT_NAME<span class=\"token punctuation\">;</span><br>    DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'La columna a la que afecta la restriccion es: '</span><span class=\"token operator\">||</span>V_COLUMNA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">SELECT</span> CONSTRAINT_TYPE <span class=\"token keyword\">INTO</span> V_TIPO_CONSTRAINT <span class=\"token keyword\">FROM</span> DBA_CONSTRAINTS <span class=\"token keyword\">WHERE</span> TABLE_NAME<span class=\"token operator\">=</span>P_TABLA <span class=\"token keyword\">AND</span> CONSTRAINT_NAME<span class=\"token operator\">=</span>R_CONST<span class=\"token punctuation\">.</span>CONSTRAINT_NAME<span class=\"token punctuation\">;</span><br>    EXPLICA_CONSTRAINT<span class=\"token punctuation\">(</span>V_TIPO_CONSTRAINT<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">LOOP</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span><br><br><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> EXPLICA_CONSTRAINT <span class=\"token punctuation\">(</span>P_TIPO_CONSTRAINT VARCHAR2<span class=\"token punctuation\">)</span><br><span class=\"token keyword\">IS</span><br><br><span class=\"token keyword\">BEGIN</span><br>  <span class=\"token keyword\">CASE</span><br>    <span class=\"token keyword\">WHEN</span> P_TIPO_CONSTRAINT <span class=\"token operator\">=</span> <span class=\"token string\">'P'</span> <span class=\"token keyword\">THEN</span><br>      DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'La restriccion es una clave primaria.'</span><span class=\"token operator\">||</span>CHR<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">WHEN</span> P_TIPO_CONSTRAINT <span class=\"token operator\">=</span> <span class=\"token string\">'C'</span> <span class=\"token keyword\">THEN</span><br>      DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'La restriccion es tipo CHECK y lo que hace es validar.'</span><span class=\"token operator\">||</span>CHR<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">WHEN</span> P_TIPO_CONSTRAINT <span class=\"token operator\">=</span> <span class=\"token string\">'R'</span> <span class=\"token keyword\">THEN</span><br>      DBMS_OUTPUT<span class=\"token punctuation\">.</span>PUT_LINE<span class=\"token punctuation\">(</span><span class=\"token string\">'La restriccion es una clave foranea o ajena.'</span><span class=\"token operator\">||</span>CHR<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><br>  <span class=\"token keyword\">END</span> <span class=\"token keyword\">CASE</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br><span class=\"token operator\">/</span></code></pre>\n<p><img src=\"/img/BD-P3.9.png\" alt=\"BD-P3.9.png\"></p>\n<h3 id=\"realiza-al-menos-dos-de-los-ejercicios-anteriores-en-postgres-usando-pl%2Fpgsql.\" tabindex=\"-1\">Realiza al menos dos de los ejercicios anteriores en Postgres usando PL/pgSQL.</h3>\n<h4 id=\"primer-ejercicio\" tabindex=\"-1\">Primer ejercicio</h4>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MUESTRANOMBREYSALARIO<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><br><span class=\"token keyword\">AS</span> $$<br><span class=\"token keyword\">DECLARE</span><br>    V_ENAME EMP<span class=\"token punctuation\">.</span>ENAME<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">;</span><br>    V_SAL EMP<span class=\"token punctuation\">.</span>SAL<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token keyword\">SELECT</span> ENAME<span class=\"token punctuation\">,</span> SAL <span class=\"token keyword\">INTO</span> V_ENAME<span class=\"token punctuation\">,</span> V_SAL<br>    <span class=\"token keyword\">FROM</span> EMP <span class=\"token keyword\">WHERE</span> EMPNO <span class=\"token operator\">=</span> <span class=\"token number\">7782</span><span class=\"token punctuation\">;</span><br>    <br>    <span class=\"token keyword\">RAISE</span> NOTICE <span class=\"token string\">'%'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Nombre: '</span><span class=\"token operator\">||</span> v_ename<span class=\"token punctuation\">;</span><br>    <span class=\"token keyword\">RAISE</span> NOTICE <span class=\"token string\">'%'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Salario: '</span><span class=\"token operator\">||</span> v_sal<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br>$$ <span class=\"token keyword\">LANGUAGE</span> plpgsql<span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-P3.10.png\" alt=\"BD-P3.10.png\"></p>\n<h4 id=\"segundo-ejercicio\" tabindex=\"-1\">Segundo ejercicio</h4>\n<pre class=\"language-plsql\"><code class=\"language-plsql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">OR</span> REPLACE <span class=\"token keyword\">PROCEDURE</span> MUESTRA_NOMBRE <span class=\"token punctuation\">(</span>P_EMPNO EMP<span class=\"token punctuation\">.</span>EMPNO<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">)</span><br><span class=\"token keyword\">AS</span> $$<br><span class=\"token keyword\">DECLARE</span><br>    V_NOMBRE EMP<span class=\"token punctuation\">.</span>ENAME<span class=\"token operator\">%</span><span class=\"token keyword\">TYPE</span><span class=\"token punctuation\">;</span><br><span class=\"token keyword\">BEGIN</span><br>    <span class=\"token keyword\">SELECT</span> ENAME <span class=\"token keyword\">INTO</span> V_NOMBRE <br>    <span class=\"token keyword\">FROM</span> EMP <span class=\"token keyword\">WHERE</span> EMPNO<span class=\"token operator\">=</span>P_EMPNO<span class=\"token punctuation\">;</span><br><br>    <span class=\"token keyword\">RAISE</span> NOTICE <span class=\"token string\">'%'</span><span class=\"token punctuation\">,</span><span class=\"token string\">'Nombre: '</span><span class=\"token operator\">||</span> V_NOMBRE<span class=\"token punctuation\">;</span><br><span class=\"token keyword\">END</span><span class=\"token punctuation\">;</span><br>$$ <span class=\"token keyword\">LANGUAGE</span> plpgsql<span class=\"token punctuation\">;</span></code></pre>\n<p><img src=\"/img/BD-P3.11.png\" alt=\"BD-P3.11.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-12-04T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/cifrado-asimetrico-con-gpg-y-openssl./",
      "url": "https://reeseschultz.github.io/post/cifrado-asimetrico-con-gpg-y-openssl./",
      "title": "Cifrado asim√©trico con gpg y openssl.",
      "content_html": "<h3 id=\"tarea-1%3A-generaci%C3%B3n-de-claves\" tabindex=\"-1\">Tarea 1: Generaci√≥n de claves</h3>\n<h4 id=\"genera-un-par-de-claves-(p%C3%BAblica-y-privada).-%C2%BFen-que-directorio-se-guarda-las-claves-de-un-usuario%3F\" tabindex=\"-1\">Genera un par de claves (p√∫blica y privada). ¬øEn que directorio se guarda las claves de un usuario?</h4>\n<p>Para generar un par de claves, usaremos el siguiente comando.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">$ gpg --gen-key</code></pre>\n<p><img src=\"/img/SAD-P3.1.png\" alt=\"SAD-P3.1.png\"></p>\n<p>Las claves p√∫blicas y privadas se guardan en <code>~/.gnupg</code></p>\n<h4 id=\"lista-las-claves-p%C3%BAblicas-que-tienes-en-tu-almac%C3%A9n-de-claves.-explica-los-distintos-datos-que-nos-muestra.-%C2%BFc%C3%B3mo-deber%C3%ADas-haber-generado-las-claves-para-indicar%2C-por-ejemplo%2C-que-tenga-un-1-mes-de-validez%3F\" tabindex=\"-1\">Lista las claves p√∫blicas que tienes en tu almac√©n de claves. Explica los distintos datos que nos muestra. ¬øC√≥mo deber√≠as haber generado las claves para indicar, por ejemplo, que tenga un 1 mes de validez?</h4>\n<p>El comando usado para listar las claves es:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">$ gpg --list-keys</code></pre>\n<p><img src=\"/img/SAD-P3.2.png\" alt=\"SAD-P3.2.png\"></p>\n<p>Para indicar el tiempo de validez al crear el par de claves, usamos el comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">$ gpg --full-gen-key</code></pre>\n<p><img src=\"/img/SAD-P3.4.png\" alt=\"SAD-P3.4.png\"></p>\n<p><img src=\"/img/SAD-P3.5.png\" alt=\"SAD-P3.5.png\"></p>\n<h4 id=\"lista-las-claves-privadas-de-tu-almac%C3%A9n-de-claves.\" tabindex=\"-1\">Lista las claves privadas de tu almac√©n de claves.</h4>\n<p>El comando usado para listar las claves privadas es:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">$ gpg --list-secret-keys</code></pre>\n<p><img src=\"/img/SAD-P3.3.png\" alt=\"SAD-P3.3.png\"></p>\n<hr>\n<h3 id=\"tarea-2%3A-importar-%2F-exportar-clave-p%C3%BAblica\" tabindex=\"-1\">Tarea 2: Importar / exportar clave p√∫blica</h3>\n<h4 id=\"exporta-tu-clave-p%C3%BAblica-en-formato-ascii-y-guardalo-en-un-archivo-nombre_apellido.asc-y-env%C3%ADalo-al-compa%C3%B1ero-con-el-que-vas-a-hacer-esta-pr%C3%A1ctica.\" tabindex=\"-1\">Exporta tu clave p√∫blica en formato ASCII y guardalo en un archivo nombre_apellido.asc y env√≠alo al compa√±ero con el que vas a hacer esta pr√°ctica.</h4>\n<p>El comando para generar el archivo con la clave p√∫blica en formato ASCII es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">$ gpg --armor --output alejandro_montes.asc --export aaleemd11@gmail.com</code></pre>\n<p>Le he enviado mi clave p√∫blica a mi compa√±ero Juan Jes√∫s.</p>\n<h4 id=\"importa-las-claves-p%C3%BAblicas-recibidas-de-vuestro-compa%C3%B1ero.\" tabindex=\"-1\">Importa las claves p√∫blicas recibidas de vuestro compa√±ero.</h4>\n<p>El comando para importar la clave p√∫blica de Juan Jes√∫s es el siguiente:</p>\n<p><img src=\"/img/SAD-P3.6.png\" alt=\"SAD-P3.6.png\"></p>\n<h4 id=\"comprueba-que-las-claves-se-han-incluido-correctamente-en-vuestro-keyring.\" tabindex=\"-1\">Comprueba que las claves se han incluido correctamente en vuestro keyring.</h4>\n<p>Muestro mi anillo de claves y se ve que la clave de Juan Jes√∫s est√° importada correctamente:</p>\n<p><img src=\"/img/SAD-P3.8.png\" alt=\"SAD-P3.8.png\"></p>\n<hr>\n<h3 id=\"tarea-3%3A-cifrado-asim%C3%A9trico-con-claves-p%C3%BAblicas\" tabindex=\"-1\">Tarea 3: Cifrado asim√©trico con claves p√∫blicas</h3>\n<h4 id=\"cifraremos-un-archivo-cualquiera-y-lo-remitiremos-por-email-a-uno-de-nuestros-compa%C3%B1eros-que-nos-proporcion%C3%B3-su-clave-p%C3%BAblica.\" tabindex=\"-1\">Cifraremos un archivo cualquiera y lo remitiremos por email a uno de nuestros compa√±eros que nos proporcion√≥ su clave p√∫blica.</h4>\n<p>Ciframos un archivo de ejemplo y se lo env√≠o a Iv√°n.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --encrypt --recipient githubemail1asir@gmail.com para_juanjesus.txt</code></pre>\n<h4 id=\"nuestro-compa%C3%B1ero%2C-a-su-vez%2C-nos-remitir%C3%A1-un-archivo-cifrado-para-que-nosotros-lo-descifremos.\" tabindex=\"-1\">Nuestro compa√±ero, a su vez, nos remitir√° un archivo cifrado para que nosotros lo descifremos.</h4>\n<p>El comando usado para desifrar el archivo que nos ha enviado nuestro compa√±ero es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --decrypt criptoarchivo.txt.gpg</code></pre>\n<p><img src=\"/img/SAD-P3.9.png\" alt=\"SAD-P3.9.png\"></p>\n<h4 id=\"tanto-nosotros-como-nuestro-compa%C3%B1ero-comprobaremos-que-hemos-podido-descifrar-los-mensajes-recibidos-respectivamente.\" tabindex=\"-1\">Tanto nosotros como nuestro compa√±ero comprobaremos que hemos podido descifrar los mensajes recibidos respectivamente.</h4>\n<p>Nuestro compa√±ero tambi√©n ha descifrado el archivo correctamente.</p>\n<p><img src=\"/img/SAD-P3.10.png\" alt=\"SAD-P3.10.png\"></p>\n<h4 id=\"por-%C3%BAltimo%2C-enviaremos-el-documento-cifrado-a-alguien-que-no-estaba-en-la-lista-de-destinatarios-y-comprobaremos-que-este-usuario-no-podr%C3%A1-descifrar-este-archivo.\" tabindex=\"-1\">Por √∫ltimo, enviaremos el documento cifrado a alguien que no estaba en la lista de destinatarios y comprobaremos que este usuario no podr√° descifrar este archivo.</h4>\n<p>No tengo captura pero lo he probado y mi compa√±ero no pod√≠a visualizar el contenido ni desencriptarlo.</p>\n<h4 id=\"para-terminar%2C-indica-los-comandos-necesarios-para-borrar-las-claves-p%C3%BAblicas-y-privadas-que-posees.\" tabindex=\"-1\">Para terminar, indica los comandos necesarios para borrar las claves p√∫blicas y privadas que posees.</h4>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --delete-secret-key \"Alejandro Montes Delgado\"</code></pre>\n<p><img src=\"/img/SAD-P3.11.png\" alt=\"SAD-P3.11.png\"></p>\n<hr>\n<h3 id=\"tarea-4%3A-exportar-clave-a-un-servidor-p%C3%BAblico-de-claves-pgp\" tabindex=\"-1\">Tarea 4: Exportar clave a un servidor p√∫blico de claves PGP</h3>\n<h4 id=\"genera-la-clave-de-revocaci%C3%B3n-de-tu-clave-p%C3%BAblica-para-utilizarla-en-caso-de-que-haya-problemas.\" tabindex=\"-1\">Genera la clave de revocaci√≥n de tu clave p√∫blica para utilizarla en caso de que haya problemas.</h4>\n<p>Para crear una  clave de rovaci√≥n usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --gen-revoke 0549F57086A3E680F1DD7F7DB99701ED0FAD4CEF</code></pre>\n<p><img src=\"/img/SAD-P3.12.png\" alt=\"SAD-P3.12.png\"></p>\n<h4 id=\"exporta-tu-clave-p%C3%BAblica-al-servidor-pgp.rediris.es\" tabindex=\"-1\">Exporta tu clave p√∫blica al servidor <a href=\"http://pgp.rediris.es\">pgp.rediris.es</a></h4>\n<p>He usado otro servidor de claves p√∫blicas debido a que rediris est√° caido.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --keyserver pgp.mit.edu --send-keys 0549F57086A3E680F1DD7F7DB99701ED0FAD4CEF</code></pre>\n<p><img src=\"/img/SAD-P3.13.png\" alt=\"SAD-P3.13.png\"></p>\n<p>Como podemos ver se ha subido correctamente.</p>\n<p><img src=\"/img/SAD-P3.14.png\" alt=\"SAD-P3.14.png\"></p>\n<h4 id=\"borra-la-clave-p%C3%BAblica-de-alguno-de-tus-compa%C3%B1eros-de-clase-e-imp%C3%B3rtala-ahora-del-servidor-p%C3%BAblico-de-rediris.\" tabindex=\"-1\">Borra la clave p√∫blica de alguno de tus compa√±eros de clase e imp√≥rtala ahora del servidor p√∫blico de rediris.</h4>\n<p>Borro la clave p√∫blica de mi compa√±ero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --delete-key \"Juan Jesus\"</code></pre>\n<p>Para importar la clave de Juan Jes√∫s usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">gpg --keyserver pgp.rediris.es --recv-keys 63DE4D1C7A7D69E8BB02F2F60D9A9FF1B5EE9093</code></pre>\n<p>Da error pero porque no funciona correctamente rediris.</p>\n<p><img src=\"/img/SAD-P3.15.png\" alt=\"SAD-P3.15.png\"></p>\n<hr>\n<h3 id=\"tarea-5%3A-cifrado-asim%C3%A9trico-con-openssl\" tabindex=\"-1\">Tarea 5: Cifrado asim√©trico con openssl</h3>\n<h4 id=\"genera-un-par-de-claves-(p%C3%BAblica-y-privada).\" tabindex=\"-1\">Genera un par de claves (p√∫blica y privada).</h4>\n<p>Para generar el par de claves, uso el siguiente comando:</p>\n<p><img src=\"/img/SAD-P3.16.png\" alt=\"SAD-P3.16.png\"></p>\n<p>Extraemos la clave p√∫blica y la insertamos en un fichero con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">openssl rsa -in alejandro-montes-ssl.pem -pubout > alejandro-montes-ssl.pub.pem</code></pre>\n<p><img src=\"/img/SAD-P3.17.png\" alt=\"SAD-P3.17.png\"></p>\n<h4 id=\"env%C3%ADa-tu-clave-p%C3%BAblica-a-un-compa%C3%B1ero.\" tabindex=\"-1\">Env√≠a tu clave p√∫blica a un compa√±ero.</h4>\n<p>Le he enviado mi clave a Juanje y √©l me ha enviado la suya.</p>\n<h4 id=\"utilizando-la-clave-p%C3%BAblica-cifra-un-fichero-de-texto-y-env%C3%ADalo-a-tu-compa%C3%B1ero.\" tabindex=\"-1\">Utilizando la clave p√∫blica cifra un fichero de texto y env√≠alo a tu compa√±ero.</h4>\n<p>Este es el fichero que yo he cifrado:</p>\n<p><img src=\"/img/SAD-P3.18.png\" alt=\"SAD-P3.18.png\"></p>\n<p>Este es el fichero que ha encriptado Juanje</p>\n<p><img src=\"/img/SAD-P3.19.png\" alt=\"SAD-P3.19.png\"></p>\n<h4 id=\"tu-compa%C3%B1ero-te-ha-mandado-un-fichero-cifrado%2C-muestra-el-proceso-para-el-descifrado.\" tabindex=\"-1\">Tu compa√±ero te ha mandado un fichero cifrado, muestra el proceso para el descifrado.</h4>\n<p>Para descifrarlo usamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">openssl rsautl -decrypt -inkey alejandro-montes-ssl.pem -in criptoarchivossl.txt.enc -out criptoarchivossl.txt</code></pre>\n<p><img src=\"/img/SAD-P3.20.png\" alt=\"SAD-P3.20.png\"></p>\n<p>Mi compa√±ero Juanje tambi√©n ha descifrado el m√≠o correctamente.</p>\n<p><img src=\"/img/SAD-P3.21.png\" alt=\"SAD-P3.21.png\"></p>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-12-02T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/migracion-de-aplicaciones-web-al-vps/",
      "url": "https://reeseschultz.github.io/post/migracion-de-aplicaciones-web-al-vps/",
      "title": "Migraci√≥n de Aplicaciones Web al VPS",
      "content_html": "<h3 id=\"glpi\" tabindex=\"-1\">GLPI</h3>\n<p>La primera aplicaci√≥n web que migraremos ser√° glpi, a continuaci√≥n detallo los pasos que he seguido para migrarla.</p>\n<h4 id=\"creaci%C3%B3n-del-virtual-host.\" tabindex=\"-1\">Creaci√≥n del virtual Host.</h4>\n<p>El primer paso que he dado para realizar la migraci√≥n es configurar un virtualhost en mi vps. Muestro la configuraci√≥n del virtual host:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">upstream php-handler {<br>    #server 127.0.0.1:9000;<br>    server unix:/var/run/php/php7.4-fpm.sock;<br>}<br><br>map $arg_v $asset_immutable {<br>    \"\" \"\";<br>    default \"immutable\";<br>}<br><br>server {<br>    listen 80;<br>    listen [::]:80;<br>    server_name www.alejandro-montes.es;<br>    rewrite ^/$ /portal;<br>    root /var/www/alejandromontes;<br><br>    location = /robots.txt {<br>        allow all;<br>        log_not_found off;<br>        access_log off;<br>    }<br><br>    location ^~ /.well-known {<br><br>        location = /.well-known/carddav { return 301 /cloud/remote.php/dav/; }<br>        location = /.well-known/caldav  { return 301 /cloud/remote.php/dav/; }<br><br>        location /.well-known/acme-challenge    { try_files $uri $uri/ =404; }<br>        location /.well-known/pki-validation    { try_files $uri $uri/ =404; }<br><br>        return 301 /cloud/index.php$request_uri;<br>    }<br>    location ^~ /portal {<br>        client_max_body_size 512M;<br>        client_body_timeout 300s;<br>        fastcgi_buffers 64 4K;<br><br>        gzip on;<br>        gzip_vary on;<br>        gzip_comp_level 4;<br>        gzip_min_length 256;<br>        gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;<br>        gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml appl<br>ication/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml a<br>pplication/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/v<br>tt text/x-component text/x-cross-domain-policy;<br><br>        client_body_buffer_size 512k;<br>        add_header Referrer-Policy                      \"no-referrer\"   always;<br>        add_header X-Content-Type-Options               \"nosniff\"       always;<br>        add_header X-Download-Options                   \"noopen\"        always;<br>        add_header X-Frame-Options                      \"SAMEORIGIN\"    always;<br>        add_header X-Permitted-Cross-Domain-Policies    \"none\"          always;<br>        add_header X-Robots-Tag                         \"none\"          always;<br>        add_header X-XSS-Protection                     \"1; mode=block\" always;<br><br>        fastcgi_hide_header X-Powered-By;<br><br>        index index.php index.html /portal/index.php$request_uri;<br><br>        location ~ \\.php(?:$|/) {<br><br>            fastcgi_split_path_info ^(.+?\\.php)(/.*)$;<br>            set $path_info $fastcgi_path_info;<br><br>            try_files $fastcgi_script_name =404;<br><br>            include fastcgi_params;<br>            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br>            fastcgi_param PATH_INFO $path_info;<br><br>            fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice<br>            fastcgi_param front_controller_ac8tive true;     # Enable pretty urls<br>            fastcgi_pass php-handler;<br><br>            fastcgi_intercept_errors on;<br>            fastcgi_request_buffering off;<br><br>            fastcgi_max_temp_file_size 0;<br>        }<br><br>        location /portal {<br>            try_files $uri $uri/ /portal/index.php$request_uri;<br>        }<br>    }<br>    location ~ /\\.ht {<br>          deny all;<br>         }<br><br>    location ^~ /cloud {<br>        client_max_body_size 513M;<br>        client_body_timeout 300s;<br>        fastcgi_buffers 64 4K;<br>        gzip on;<br>        gzip_vary on;<br>        gzip_vary on;<br>        gzip_comp_level 4;<br>        gzip_min_length 256;<br>        gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;<br>        gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml appl<br>ication/vnd.geo+json application/vnd.ms-fontobject application/wasm application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml a<br>pplication/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/v<br>tt text/x-component text/x-cross-domain-policy;<br>        add_header Referrer-Policy                      \"no-referrer\"   always;<br>        add_header X-Content-Type-Options               \"nosniff\"       always;<br>        add_header X-Download-Options                   \"noopen\"        always;<br>        add_header X-Frame-Options                      \"SAMEORIGIN\"    always;<br>        add_header X-Permitted-Cross-Domain-Policies    \"none\"          always;<br>        add_header X-Robots-Tag                         \"none\"          always;<br>        add_header X-XSS-Protection                     \"1; mode=block\" always;<br>        fastcgi_hide_header X-Powered-By;<br>        index index.php index.html /cloud/index.php$request_uri;<br><br>        location = /cloud {<br>            if ( $http_user_agent ~ ^DavClnt ) {<br>                return 302 /cloud/remote.php/webdav/$is_args$args;<br>            }<br>        }<br><br>        location ~ ^/cloud/(?:build|tests|config|lib|3rdparty|templates|data)(?:$|/)    { return 404; }<br>        location ~ ^/cloud/(?:\\.|autotest|occ|issue|indie|db_|console)                  { return 404; }<br>        location ~ \\.php(?:$|/) {<br>            rewrite ^/cloud/(?!index|remote|public|cron|core\\/ajax\\/update|status|ocs\\/v[12]|updater\\/.+|oc[ms]-provider\\/.+|.+\\/richdocumentscode\\/pr<br>oxy) /cloud/index.php$request_uri;<br><br>            fastcgi_split_path_info ^(.+?\\.php)(/.*)$;<br>            set $path_info $fastcgi_path_info;<br>            try_files $fastcgi_script_name =404;<br>            include fastcgi_params;<br>            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;<br>            fastcgi_param PATH_INFO $path_info;<br>           # fastcgi_param HTTPS on;<br><br>            fastcgi_param modHeadersAvailable true;         # Avoid sending the security headers twice<br>            fastcgi_param front_controller_active true;     # Enable pretty urls<br>            fastcgi_pass php-handler;<br><br>            fastcgi_intercept_errors on;<br>            fastcgi_request_buffering off;<br><br>            fastcgi_max_temp_file_size 0;<br>        }<br>        location ~ \\.(?:css|js|svg|gif|png|jpg|ico|wasm|tflite|map)$ {<br>            try_files $uri /cloud/index.php$request_uri;<br>            add_header Cache-Control \"public, max-age=15778463, $asset_immutable\";<br>            access_log off;     # Optional: Don't log access to assets<br><br>            location ~ \\.wasm$ {<br>                default_type application/wasm;<br>            }<br>        }<br>        location ~ \\.woff2?$ {<br>            try_files $uri /cloud/index.php$request_uri;<br>            expires 7d;         # Cache-Control policy borrowed from `.htaccess`<br>            access_log off;     # Optional: Don't log access to assets<br>        }<br>        location /cloud/remote {<br>            return 301 /cloud/remote.php$request_uri;<br>        }<br>        location /cloud {<br>            try_files $uri $uri/ /cloud/index.php$request_uri;<br>        }<br>    }<br>}</code></pre>\n<p>Activamos el virtualhost.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/etc/nginx/sites-enabled# sudo ln -s /etc/nginx/sites-available/alejandromontes.conf /etc/nginx/sites-enabled/</code></pre>\n<p>Reiniciamos nginx.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/etc/nginx/sites-enabled# systemctl reload nginx</code></pre>\n<h4 id=\"creaci%C3%B3n-y-configuraci%C3%B3n-de-la-base-de-datos.\" tabindex=\"-1\">Creaci√≥n y configuraci√≥n de la base de datos.</h4>\n<p>Una vez creado el virtualhost, configuraremos la base de datos del vps, para ello, lo primero que debemos de hacer es a√±adir un nombre de dominio en el /etc/hosts.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">nano /etc/hosts</code></pre>\n<p>a√±adimos la siguiente l√≠nea:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">127.0.0.1       bd.alejandro-montes.es</code></pre>\n<p>Ahora, accederemos al servidor mariadb. Crearemos un usuario, una base de datos y daremos privilegios al usuario sobre la base de datos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">MariaDB [(none)]> CREATE DATABASE glpi;<br>Query OK, 1 row affected (0.005 sec)</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">MariaDB [(none)]> CREATE USER 'alemd'@'localhost' IDENTIFIED BY 'passwd';</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">MariaDB [(none)]> GRANT ALL PRIVILEGES ON glpi.* TO 'alemd'@'LOCALHOST';<br>Query OK, 0 rows affected (0.003 sec)<br><br>MariaDB [(none)]> FLUSH PRIVILEGES;<br>Query OK, 0 rows affected (0.004 sec)</code></pre>\n<h4 id=\"realizando-la-migraci%C3%B3n.\" tabindex=\"-1\">Realizando la migraci√≥n.</h4>\n<p>En el escenario vagrant, ten√≠amos una m√°quina que actuaba de servidor web y otra del servidor de base de datos. Empezaremos la migraci√≥n con la m√°quina que actuaba como servidor de base de datos. Crearemos una copia de seguridad del servidor de base de datos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidorbd-alejandro:/home/vagrant# mysqldump glpi > ./backup.sql<br>root@servidorbd-alejandro:/home/vagrant# ls -lah<br>total 772K<br>drwxr-xr-x 3 vagrant vagrant 4.0K Nov 24 09:42 .<br>drwxr-xr-x 3 root    root    4.0K Sep 12 05:17 ..<br>-rw------- 1 vagrant vagrant  406 Nov 22 19:18 .bash_history<br>-rw-r--r-- 1 vagrant vagrant  220 Mar 27  2022 .bash_logout<br>-rw-r--r-- 1 vagrant vagrant 3.5K Mar 27  2022 .bashrc<br>-rw------- 1 vagrant vagrant   33 Nov 22 18:05 .mysql_history<br>-rw-r--r-- 1 vagrant vagrant  807 Mar 27  2022 .profile<br>drwx------ 2 vagrant vagrant 4.0K Nov 17 08:59 .ssh<br>-rw-r--r-- 1 root    root    739K Nov 24 09:42 backup.sql</code></pre>\n<p>Ahora mediante scp mandamos la copia de seguridad. Tenemos que tener en cuenta que en nuestro vps no est√° la clave p√∫blica del servidor de base de datos, lo que har√© ser√° enviarlo a mi m√°quina y despu√©s al vps.</p>\n<p>Primero lo enviamos a mi m√°quina:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidorbd-alejandro:/home/vagrant# scp ./backup.sql alemd@192.168.122.1:<br>The authenticity of host '192.168.122.1 (192.168.122.1)' can't be established.<br>ECDSA key fingerprint is SHA256:P4VynMzXNSUoRSzuUrFgWShiT4hYwT/y6DqQ7Sf/ujs.<br>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br>Warning: Permanently added '192.168.122.1' (ECDSA) to the list of known hosts.<br>alemd@192.168.122.1's password: <br>backup.sql                                    100%  739KB  39.9MB/s   00:00  </code></pre>\n<p>desde mi m√°quina lo enviamos al servidor vps.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ scp backup.sql alemd@nabil.alejandro-montes.es:~/<br>backup.sql                                    100%  739KB 622.3KB/s   00:01 </code></pre>\n<p>Ahora el directorio donde est√° alojada la aplicaci√≥n web lo comprimiremos y lo enviaremos por scp al vps.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@servidorweb-alejandro:/var/www$ sudo tar -zcf glpi.tar.gz alejandromontes/*<br>vagrant@servidorweb-alejandro:/var/www$ sudo scp ./glpi.tar.gz alemd@192.168.122.1:~/<br>alemd@debian:~$ scp glpi.tar.gz alemd@nabil.alejandro-montes.es:~/<br>glpi.tar.gz                                   100%   55MB   2.7MB/s   00:20 </code></pre>\n<p>Ahora restauraremos la copia de seguridad de la base de datos indicando cual es la base de datos que queremos que recupere.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd# mysql glpi &lt; backup.sql</code></pre>\n<p>Una vez restaurada la copia de seguridad, extraeremos la aplicaci√≥n web.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:/var/www/glpi$ sudo tar -zxf ~/glpi.tar.gz </code></pre>\n<p>Le cambiamos el due√±o al host virtual.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@nabil:/var/www$ sudo chown www-data:www-data glpi/</code></pre>\n<p>La aplicaci√≥n web est√° configurada para que acceda a una base de datos remota. Cambiaremos la configuraci√≥n haciendo los siguientes pasos:</p>\n<p>Nos movemos a la carpeta config y editamos el archivo config_db.php.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/var/www/glpi# cd /var/www/glpi/config<br>root@nabil:/var/www/glpi/config# nano config_db.php </code></pre>\n<p>Lo editamos y queda de la siguiente manera:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">&lt;?php<br>class DB extends DBmysql {<br>   public $dbhost = 'bd.alejandro-montes.es';<br>   public $dbuser = 'alemd';<br>   public $dbpassword = 'passwd_user';<br>   public $dbdefault = 'glpi';<br>   public $use_utf8mb4 = true;<br>   public $allow_myisam = false;<br>   public $allow_datetime = false;<br>   public $allow_signed_keys = false;<br>}</code></pre>\n<p>Antes de entrar al sitio, instalaremos las librer√≠as que necesitamos en el escenario local.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/var/www/glpi/config# apt install  php7.4-mbstring php7.4-curl php7.4-gd php7.4-xml php7.4-intl php7.4-bz2 php7.4-ldap php7.4-xmlrpc php7.4-zip <br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following packages were automatically installed and are no longer required:<br>  apache2-bin apache2-data apache2-utils libapr1 libaprutil1<br>  libaprutil1-dbd-sqlite3 libaprutil1-ldap libjansson4 liblua5.3-0<br>Use 'sudo apt autoremove' to remove them.<br>The following additional packages will be installed:<br>  libonig5 libxmlrpc-epi0 libzip4<br>The following NEW packages will be installed:<br>  libonig5 libxmlrpc-epi0 libzip4 php7.4-bz2 php7.4-curl php7.4-gd php7.4-intl<br>  php7.4-ldap php7.4-mbstring php7.4-xml php7.4-xmlrpc php7.4-zip<br>0 upgraded, 12 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 1025 kB of archives.</code></pre>\n<p>reiniciamos el servicio para que funcione correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/var/www/glpi/config# systemctl reload php7.4-fpm</code></pre>\n<h3 id=\"nextcloud\" tabindex=\"-1\">Nextcloud</h3>\n<h4 id=\"creaci%C3%B3n-y-configuraci%C3%B3n-de-la-base-de-datos.-1\" tabindex=\"-1\">Creaci√≥n y configuraci√≥n de la base de datos.</h4>\n<p>En el vps creamos la base de datos, el usuario y damos al usuario privilegios sobre la base de datos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">MariaDB [(none)]> CREATE USER 'nextclouduser'@'localhost' IDENTIFIED BY 'PASSWORD';<br>Query OK, 0 rows affected (0.004 sec)<br>MariaDB [(none)]> CREATE DATABASE nextcloud_db;<br>Query OK, 1 row affected (0.000 sec)<br>MariaDB [(none)]> GRANT ALL PRIVILEGES ON nextcloud_db.* TO 'nextclouduser'@'localhost';<br>Query OK, 0 rows affected (0.002 sec)</code></pre>\n<p>Nos vamos al servidor del anterior escenario y exportamos la base de datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@servidorbd-alejandro:/home/vagrant# mysqldump nextcloud_db > backup_nextcloud.sql</code></pre>\n<p>Exportamos el archivo generado al vps.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ scp backup_nextcloud.sql alemd@nabil.alejandro-montes.es:~/<br>backup_nextcloud.sql                                                                                                100%  197KB 189.8KB/s   00:01    </code></pre>\n<h4 id=\"realizando-la-migraci%C3%B3n.-1\" tabindex=\"-1\">Realizando la migraci√≥n.</h4>\n<p>Una vez exportada la base de datos, exportaremos el nextcloud, para ello lo comprimiremos y lo enviaremos por scp al vps.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vagrant@servidorweb-alejandro:/var/www$ sudo tar -zcf nextcloud.tar.gz nextcloud<br>vagrant@servidorweb-alejandro:/var/www$ sudo scp ./nextcloud.tar.gz alemd@192.168.122.1:~/<br>alemd@192.168.122.1's password: <br>nextcloud.tar.gz                                                                                                    100%  246MB  69.7MB/s   00:03   <br>alemd@debian:~$ scp nextcloud.tar.gz alemd@nabil.alejandro-montes.es:~/<br>nextcloud.tar.gz                                                                                                    100%  246MB   4.6MB/s   00:53 </code></pre>\n<p>Regeneramos la base de datos de nextcloud.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/home/alemd# mysql nextcloud_bd &lt; backup.sql</code></pre>\n<p>extraemos el nexcloud.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/var/www/alejandromontes/cloud# tar -zxf nextcloud.tar.gz</code></pre>\n<p>editamos el fichero de configuraci√≥n en el que indica donde est√° alojada la base de datos.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@nabil:/var/www/alejandromontes/cloud# nano config/config.php </code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">&lt;?php<br>7$CONFIG = array (<br>  'instanceid' => 'ocku5u9frj18',<br>  'passwordsalt' => 'cVo/fptYzJDN8NjvuFh1ey5IoxZ18R',<br>  'secret' => 'ZKcMNlQ1H4uE+J2u95cg7LSnM+/KkLHP0NbvtE8VEYfskTBR',<br>  'trusted_domains' => <br>  array (<br>    0 => 'www.alejandro-montes.es',<br>  ),<br>  'datadirectory' => '/var/www/alejandromontes/cloud/data',<br>  'dbtype' => 'mysql',<br>  'version' => '22.1.1.2',<br>  'overwrite.cli.url' => 'http://www.alejandro-montes.es/cloud',<br>  'dbname' => 'nextcloud_db',<br>  'dbhost' => 'localhost',<br>  'dbport' => '',<br>  'dbtableprefix' => 'oc_',<br>  'mysql.utf8mb4' => true,<br>  'dbuser' => 'nextclouduser',<br>  'dbpassword' => 'password',<br>  'installed' => true,<br>);</code></pre>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-11-24T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/migrar-centos-a-otra-distribucion./",
      "url": "https://reeseschultz.github.io/post/migrar-centos-a-otra-distribucion./",
      "title": "Migrar CentOS a otra distribuci√≥n.",
      "content_html": "<p>Debido al anuncio del fin de soporte por parte de Red Hat de Centos8 el pasado 31 de diciembre de 2021, y teniendo en cuentas que el fin de vida de centos 7 est√° programada para el 30 de junio de 2024. Han salido m√∫ltiples distribuciones que cubren el hueco dejado por esta distribuci√≥n tan extendida y tan usada en el √°mbito de servidores.</p>\n<p>En la presente pr√°ctica, analiza posibles versiones candidatas y opciones desplegadas para la migraci√≥n de tus servidores CentOS.</p>\n<p>El espectro es amplio:</p>\n<ul>\n<li>\n<p>Cambiar el rumbo a una nueva distribuci√≥n, debian, opensuse, slakware, etc.</p>\n</li>\n<li>\n<p>Soluciones aportadas por Red Hat: Red Hat Enterprise Linux, CentOS Stream.</p>\n</li>\n<li>\n<p>Soluci√≥n aportada por Oracle Linux.</p>\n</li>\n</ul>\n<p>Nuevas distribuciones surgidas para paliar el hueco dejado:</p>\n<ul>\n<li>AlmaLinux.</li>\n<li>Rocky Linux.</li>\n<li>VZLinux.</li>\n<li>euroLinux.</li>\n</ul>\n<h3 id=\"analiza-el-desencadenante-de-la-retirada-de-centos-8-del-mercado.-%C2%BFqu%C3%A9-opini%C3%B3n-tienes-al-respecto%3F\" tabindex=\"-1\">Analiza el desencadenante de la retirada de centOS 8 del mercado. ¬øQu√© opini√≥n tienes al respecto?</h3>\n<p>Al final, creo que la comunidad ha convertido algo que en un principio era malo, en algo muy positivo, ya que gracias a la descontinuaci√≥n de CentOS han aparecido muchas distribuciones y buenas para usar.</p>\n<p>CentOS 8 se ha convertido en el nuevo CentOS Stream, este cambio supone un fin a una gran trayectoria o legado, aunque a grandes rasgos nada o poco ha cambiado o vaya a cambiar.</p>\n<h3 id=\"crea-una-cuenta-en-red-hat-y-desc%C3%A1rgate-la-iso-de-red-hat-enterprise-linux-(rel)-y-eval%C3%BAa-el-producto.-comenta-el-procedimiento-de-alta.\" tabindex=\"-1\">Crea una cuenta en Red Hat y desc√°rgate la iso de Red Hat Enterprise Linux (REL) y eval√∫a el producto. Comenta el procedimiento de alta.</h3>\n<p>Lo primero que debemos de hacer es acceder a la p√°gina oficial de <a href=\"https://www.redhat.com/es/technologies/linux-platforms/enterprise-linux/server/trial?sc_cid=7013a000002pdRFAAY&amp;gclid=Cj0KCQiAg_KbBhDLARIsANx7wAz-LbYyFuxRlM2fU6aFLoXtvGOLRanBnxNm6uBHRNATDa0XvyGdkggaApVJEALw_wcB&amp;gclsrc=aw.ds\">Red Hat</a>\npara iniciar el registro. Para el registro debemos de poner nuestra informaci√≥n personal y en el apartado de la organizaci√≥n no dejaba ponerlo en blanco y he puesto Gonzalo Nazareno.</p>\n<p>Una vez hecho el registro, se descargar√° autom√°ticamente. Cuando se haya descargado la iso, Detallar√© por encima la instalaci√≥n de RHEL. Una vez descargada la iso la insertaremos en una m√°quina virtual. Al arrancar la m√°quina virtual, aparecer√° el t√≠pico instalador de linux.</p>\n<p><img src=\"/img/aso5.3.png\" alt=\"aso5.3.png\"></p>\n<p>Simplemente tenemos que elegir el destino de la instalaci√≥n, a√±adir una contrase√±a de root y comenzar√° la instalaci√≥n.</p>\n<p><img src=\"/img/aso5.4.png\" alt=\"aso5.4.png\"></p>\n<h4 id=\"evaluaci%C3%B3n-del-producto.\" tabindex=\"-1\">Evaluaci√≥n del producto.</h4>\n<p>Red Hat Enterprise Linux es la version comercial de Red Hat basada en Fedora que a su vez est√° basada en el anterior Red Hat linux. Mientras que las versiones de fedora salen cada 6 meses aproximadamente, las de RHEL suelen hacerlo cada 18 o 24 meses. Cada una de estas versiones cuenta con una serie de servicios de valor a√±adido sobre la base de los que basa su negocio ya sea como soporte, formaci√≥n, consultor√≠a, certificaci√≥n etc.</p>\n<p>Cada versi√≥n lanzada de RHEL cuenta por el momento con soporte durante al menos 10 a√±os desde la fecha de lanzamiento de la GA (version que acaba en 0).</p>\n<p>En cuanto a la interfaz gr√°fica, podemos ver una interfaz gnome, bastante familiar ya que es la interfaz gr√°fica m√°s usada o de las m√°s usada en linux, la podemos ver comumente en debian.</p>\n<p>El gestor de paquetes de RHEL es yum y el administrador de paquetes RPM, no apt o dpkg como ser√≠a en el caso de Debian respectivamente. RHEL tiene muy pocos paquetes disponibles en su repositorio, si se quiere instalar alg√∫n paquete como el libreoffice por ejemplo, se debe de instalar desde repositorios de terceros o descargando directamente el paquete. Los paquetes de RHEL son RPM.</p>\n<p>Como conclusi√≥n propia, me parece la distribuci√≥n de linux id√≥nea para instalar en una empresa grande y con un buen desarrollo tecnol√≥gico aunque no debemos de pasar por alto que es un sistema operativo caro ya que no te ‚Äúvenden‚Äù √∫nicamente el sistema operativo si no que te dan soportes, asesor√≠as, formaci√≥n y dem√°s. Otro aspecto a tener en cuenta es que al ser un sistema operativo pensado para servidores pueden ser demasiado estables y quiz√°s necesitemos que nuestros paquetes se actualicen m√°s a menudo.</p>\n<h3 id=\"descarga-la-iso-de-centos-stream-y-eval%C3%BAa-el-producto.\" tabindex=\"-1\">Descarga la iso de CentOS Stream y eval√∫a el producto.</h3>\n<p>Descargaremos la iso de la p√°gina oficial de <a href=\"https://www.centos.org/centos-stream/#tab-3\">CentOS</a>. No pondr√© los pasos de la instalaci√≥n ya que es exactamente igual que RHEL. Esperaremos a que se instale.</p>\n<p><img src=\"/img/aso5.5.png\" alt=\"aso5.5.png\"></p>\n<h4 id=\"evaluaci%C3%B3n-del-producto.-1\" tabindex=\"-1\">Evaluaci√≥n del producto.</h4>\n<p>CentOS ya no es una distribuci√≥n estable como RHEL, se ha convertido en una distribuci√≥n de lanzamiento cont√≠nuo entonces para entornos de producci√≥n como servidores de empresas es inviable, la distribuci√≥n de CentOS a pasado mas a un entorno de desarrollo o tambi√©n a nivel usuario.</p>\n<p>Independientemente de que se actualice continuamente, el SO est√° basado en Red Hat por lo que es muy similar a RHEL.</p>\n<h3 id=\"descarga-iso-de-una-de-las-otras-distribuciones-candidatas%2C-indica-criterios-para-la-elecci%C3%B3n-de-la-nueva-distribuci%C3%B3n-y-eval%C3%BAa-el-producto.\" tabindex=\"-1\">Descarga iso de una de las otras distribuciones candidatas, indica criterios para la elecci√≥n de la nueva distribuci√≥n y eval√∫a el producto.</h3>\n<p>La distribuci√≥n que he elegido para migrar desde CentOS es Rocky Linux, ya que es una distribuci√≥n muy estable y no recibe tantas actualizaciones como CentOS Stream por ejemplo, que estar√≠a m√°s enfocado a un entorno de desarrollo.</p>\n<h4 id=\"evaluaci%C3%B3n-del-producto.-2\" tabindex=\"-1\">Evaluaci√≥n del producto.</h4>\n<p>En cuanto a sistema operativo es muy similar al resto de sistemas operativos que hemos visto anteriormente. Rocky Linux es un punto intermedio entre CentOS Stream y RHEL es decir, no es un sistema para un entorno de desarrollo ni tampoco es tan estable como RHEL.</p>\n<h3 id=\"instala-centos-7%2C-y-eval%C3%BAa-la-herramientas-que-ofrecen-la-distribuci%C3%B3n-del-punto-3.\" tabindex=\"-1\">Instala CentOS 7, y eval√∫a la herramientas que ofrecen la distribuci√≥n del punto 3.</h3>\n<p>A continuaci√≥n, realizar√© una migraci√≥n de CentOS 8 a Rocky Linux 8. Detallar√© todos los pasos que he seguido para realizar de forma correcta la migraci√≥n.</p>\n<p>En nuestro servidor CentOS 8, como los repositorios de Centos 8 no funcionan, he pasado al servidor el script por correo.</p>\n<p>Cambiamos los permisos del script con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@localhost usuario]# chmod u+x migrate2rocky.sh</code></pre>\n<p>Ejecutamos el script:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">[root@localhost usuario]# ./migrate2rocky.sh -r</code></pre>\n<p><img src=\"/img/aso5.6.png\" alt=\"aso5.6.png\"></p>\n<p>Esperamos que el script se termine de ejecutar y se habr√° actualizado correctamente.</p>\n<p><img src=\"/img/aso5.7.png\" alt=\"aso5.7.png\"></p>\n<p>como podemos apreciar el sistema se ha migrado correctamente a rocky linux.</p>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-11-18T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/interconexion-de-servidores-de-bases-de-datos/",
      "url": "https://reeseschultz.github.io/post/interconexion-de-servidores-de-bases-de-datos/",
      "title": "Interconexi√≥n de Servidores de Bases de datos",
      "content_html": "<h3 id=\"realizar-un-enlace-entre-dos-servidores-de-bases-de-datos-oracle%2C-explicando-la-configuraci%C3%B3n-necesaria-en-ambos-extremos-y-demostrando-su-funcionamiento.\" tabindex=\"-1\">Realizar un enlace entre dos servidores de bases de datos ORACLE, explicando la configuraci√≥n necesaria en ambos extremos y demostrando su funcionamiento.</h3>\n<p>En el escenario, tenemos 2 servidores Oracle, uno creado en mi propio sistema debian y otro en una m√°quina virtual debian. Ambos se conectan a trav√©s de una red virtual. Lo primero que haremos, es crear un usuario en cada servidor con los privilegios suficientes para poder realizar la interconexi√≥n. (Solo muestro la creaci√≥n de un usuario para no repetir informaci√≥n.)</p>\n<p><img src=\"/img/BD-P2.2.png\" alt=\"BD-P2.2.png\"></p>\n<p>He a√±adido como ejemplo el esquema SCOTT para poder visualizar algunas tablas. Vamos a configurar el archivo <code>tnsnames.ora</code>:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">sudo nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">ORCLCDB =<br>  (DESCRIPTION =<br>    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.122.97)(PORT = 1521))<br>    (CONNECT_DATA =<br>      (SERVER = DEDICATED)<br>      (SERVICE_NAME = ORCLCDB)<br>    )<br>  )</code></pre>\n<p>Una vez modificado el fichero tnsnames.ora en ambos servidores, probaremos que ambos servidores se ven correctamente con el <code>tnsping</code>.</p>\n<p><img src=\"/img/BD-P2.4.png\" alt=\"BD-P2.4.png\"></p>\n<p>A continuaci√≥n, crearemos el enlace de ambas bases de datos, la sintaxis del comando para realizar el enlace es la siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">CREATE DATABASE LINK nombreenlace <br>CONNECT to usuario IDENTIFIED BY contrase√±a <br>using 'alias-conexion-tnsora';</code></pre>\n<p><img src=\"/img/BD-P2.3.png\" alt=\"BD-P2.3.png\"></p>\n<p>Ahora, verificaremos el correcto funcionamiento del enlace que hemos creado anteriormente. Hacemos una consulta donde muestra el DEPTNO de un servidor y el DNAME de otro.</p>\n<p><img src=\"/img/BD-P2.5.png\" alt=\"BD-P2.5.png\"></p>\n<hr>\n<h3 id=\"realizar-un-enlace-entre-dos-servidores-de-bases-de-datos-postgres%2C-explicando-la-configuraci%C3%B3n-necesaria-en-ambos-extremos-y-demostrando-su-funcionamiento.\" tabindex=\"-1\">Realizar un enlace entre dos servidores de bases de datos Postgres, explicando la configuraci√≥n necesaria en ambos extremos y demostrando su funcionamiento.</h3>\n<p>Lo primero que har√© ser√° crear la base de datos en ambos servidores.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@PostgreSQL:~$ su - postgres<br>Contrase√±a: <br>postgres@PostgreSQL:~$ psql<br>psql (11.17 (Debian 11.17-0+deb10u1))<br>Digite ¬´help¬ª para obtener ayuda.<br><br>postgres=# CREATE DATABASE SERVIDOR1;<br>CREATE DATABASE</code></pre>\n<p>Una vez creado las bases de datos en los 2 servidores, crearemos un usuario para cada base de datos y le otorgaremos los privilegios correspondientes.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres=# CREATE USER alejandro1 WITH PASSWORD 'usuario';<br>CREATE ROLE<br>postgres=# GRANT ALL PRIVILEGES ON DATABASE SERVIDOR1 to alejandro1;<br>GRANT</code></pre>\n<p>Nos conectaremos a la base de datos con el usuario que hemos creado para comprobar que funciona correctamente.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ psql -h localhost -U alejandro1 -d servidor1;<br>Contrase√±a para usuario alejandro1: <br>psql (11.17 (Debian 11.17-0+deb10u1))<br>conexi√≥n SSL (protocolo: TLSv1.3, cifrado: TLS_AES_256_GCM_SHA384, bits: 256, compresi√≥n: desactivado)<br>Digite ¬´help¬ª para obtener ayuda.<br><br>servidor1=> <br></code></pre>\n<p>En las bases de datos, introducir√© algunas tablas y registros para mostrar el funcionamiento del enlace posteriormente. He a√±adido el esquema scott en ambas bases de datos como hice en el anterior ejercicio.</p>\n<p>Una vez que hemos creado las tablas y hemos insertados los registros, modificaremos el fichero de configuraci√≥n de postgres para que acepte conexiones de forma remota. El fichero que tenemos que editar es el siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@PostgreSQL:~$ sudo nano /etc/postgresql/11/main/postgresql.conf</code></pre>\n<p>Editamos la l√≠nea que empieza por:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">listen_addresses = 'localhost'</code></pre>\n<p>Y lo cambiamos por lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">listen_addresses = '*'</code></pre>\n<p>Ahora, editaremos un segundo fichero que se ubica en:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@PostgreSQL:~$ sudo nano /etc/postgresql/11/main/pg_hba.conf </code></pre>\n<p>Buscamos la siguiente l√≠nea:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">host    all             all             127.0.0.1/32            md5</code></pre>\n<p>Y ponemos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">host    all             all              192.168.122.0/24       md5</code></pre>\n<p>Podemos cambiar la direcci√≥n de red por <code>all</code> y as√≠ permitir√° el trafico desde cualquier red.</p>\n<p>Una vez modificados ambos ficheros reiniciaremos el servicio para que se apliquen los cambios.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@PostgreSQL:~$ sudo systemctl restart postgresql</code></pre>\n<p>Esta ser√≠a la configuraci√≥n para un servidor, tenemos que hacer exactamente los mismos pasos en el otro servidor, cambiando los nombres necesarios.</p>\n<p>Instalaremos el paquete <code>postgresql-contrib</code>, ejecuntando el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@PostgreSQL:~$ sudo apt install postgresql-contrib</code></pre>\n<p>Nos cambiaremos al usuario postgres y nos conectaremos a la base de datos que hemos creado anteriormente.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@PostgreSQL:~$ su - postgres<br>Contrase√±a: <br>postgres@PostgreSQL:~$ psql -d servidor1<br>psql (11.17 (Debian 11.17-0+deb10u1))<br>Digite ¬´help¬ª para obtener ayuda.<br><br>servidor1=# </code></pre>\n<p>Creamos la extension con la que nos conectaremos a la base de datos remota con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">servidor1=# CREATE EXTENSION dblink;<br>CREATE EXTENSION</code></pre>\n<p>Ahora probar√© a hacer una consulta del DNAME y DEPTNO del servidor2 desde el servidor1:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SELECT * FROM dblink('dbname=servidor2 host=192.168.122.218 user=alejandro2 password=usuario', 'select DNAME, DEPTNO FROM DEPT') as DEPT (DNAME VARCHAR, DEPTNO NUMERIC);</code></pre>\n<p><img src=\"/img/BD-P2.8.png\" alt=\"BD-P2.8.png\"></p>\n<p>Repetiremos el proceso en el servidor 2 ya que el dblink es unidireccional y si queremos conectar el servidor2 con el servidor1 debemos repetir los pasos que hemos hecho anteriormente en el servidor1.</p>\n<p>Ahora probar√© a hacer una consulta del DNAME y DEPTNO del servidor1 desde el servidor2:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SELECT * FROM dblink('dbname=servidor1 host=192.168.122.98 user=alejandro1 password=usuario', 'select DNAME, DEPTNO FROM DEPT') as DEPT (DNAME VARCHAR, DEPTNO NUMERIC);</code></pre>\n<p><img src=\"/img/BD-P2.9.png\" alt=\"BD-P2.9.png\"></p>\n<hr>\n<h3 id=\"realizar-un-enlace-entre-un-servidor-oracle-y-otro-postgres-o-mysql-empleando-heterogeneus-services%2C-explicando-la-configuraci%C3%B3n-necesaria-en-ambos-extremos-y-demostrando-su-funcionamiento.\" tabindex=\"-1\">Realizar un enlace entre un servidor ORACLE y otro Postgres o MySQL empleando Heterogeneus Services, explicando la configuraci√≥n necesaria en ambos extremos y demostrando su funcionamiento.</h3>\n<h4 id=\"oracle-a-postgresql.\" tabindex=\"-1\">Oracle a PostgreSQL.</h4>\n<p>El primer paso que haremos en la m√°quina oracle consistir√° en instalar la paquet√©ria para crear dicho enlace:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo apt install odbc-postgresql unixodbc               </code></pre>\n<p><img src=\"/img/BD-P2.10.png\" alt=\"BD-P2.10.png\"></p>\n<p>Cuando ya est√© instalado, procederemos a realizar la configuraci√≥n en el servidor oracle. Modificaremos el archivo odbcinst.ini:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo nano /etc/odbc.ini<br>---<br><br>Tenemos que dejar el siguiente contenido:<br><br>```txt<br>[PostgreSQL ANSI]<br>Description=PostgreSQL ODBC driver (ANSI version)<br>Driver=psqlodbca.so<br>Setup=libodbcpsqlS.so<br>Debug=0<br>CommLog=1<br>UsageCount=1<br><br>[PostgreSQL Unicode]<br>Description=PostgreSQL ODBC driver (Unicode version)<br>Driver=psqlodbcw.so<br>Setup=libodbcpsqlS.so<br>Debug=0<br>CommLog=1<br>UsageCount=1</code></pre>\n<p>Ahora editaremos otro fichero para terminar de configurar el servidor oracle:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo nano /etc/odbc.ini </code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">[PSQLA]<br>Debug = 0<br>CommLog = 0<br>ReadOnly = 1<br>Driver = PostgreSQL ANSI   <br>Servername = 192.168.122.218<br>Username = alejandro2<br>Password = usuario<br>Port = 5432<br>Database = servidor2<br>Trace = 0<br>TraceFile = /tmp/sql.log<br><br>[PSQLU]<br>Debug = 0<br>CommLog = 0<br>ReadOnly = 0<br>Driver = PostgreSQL Unicode<br>Servername = 192.168.122.218<br>Username = alejandro2<br>Password = usuario<br>Port = 5432<br>Database = servidor2<br>Trace = 0<br>TraceFile = /tmp/sql.log<br><br>[Default]<br> Driver = /usr/lib/x86_64-linux-gnu/odbc/liboplodbcS.so<br></code></pre>\n<p>Para comprobar que hemos configurado correctamente el fichero <code>odbcinst.ini</code> ejecutamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ odbcinst -q -d<br>[PostgreSQL ANSI]<br>[PostgreSQL Unicode]</code></pre>\n<p>Para comprobar que hemos configurado correctamente el fichero <code>odbc.ini</code> ejecutamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ odbcinst -q -s<br>[PSQLA]<br>[PSQLU]<br>[Default]</code></pre>\n<p>Con este comando probamos la conexi√≥n a postgres;</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo isql -v PSQLU                                      <br>[sudo] password for usuario:                                              <br>+---------------------------------------+<br>| Connected!                            |<br>|                                       |<br>| sql-statement                         |<br>| help [tablename]                      |<br>| quit                                  |<br>|                                       |<br>+---------------------------------------+<br>SQL> quit<br>usuario@oracle:~$ sudo isql -v PSQLA<br>+---------------------------------------+<br>| Connected!                            |<br>|                                       |<br>| sql-statement                         |<br>| help [tablename]                      |<br>| quit                                  |<br>|                                       |<br>+---------------------------------------+</code></pre>\n<p>Una vez comprobado que las conexiones funcionan correctamente, vamos a configurar el <code>heterogeneus services</code>. Tendremos que crear un fichero dentro de uno de los directorios de oracle y a√±adiremos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo nano /opt/oracle/product/19c/dbhome_1/hs/admin/initPSQLU.ora</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">HS_FDS_CONNECT_INFO = PSQLU<br>HS_FDS_TRACE_LEVEL = Debug<br>HS_FDS_SHAREABLE_NAME = /usr/lib/x86_64-linux-gnu/odbc/psqlodbcw.so<br>HS_LANGUAGE = AMERICAN_AMERICA.WE8ISO8859P1<br>set ODBCINI=/etc/odbc.ini</code></pre>\n<p>Ahora modificaremos el <code>listener.ora</code> a√±adiendo lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo nano /opt/oracle/product/19c/dbhome_1/network/admin/listener.ora</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">SID_LIST_LISTENER=<br> (SID_LIST=<br> (SID_DESC=<br> (SID_NAME=PSQLU)<br> (ORACLE_HOME=/opt/oracle/product/19c/dbhome_1)<br> (PROGRAM=dg4odbc)<br> )<br> )</code></pre>\n<p>Tambi√©n modificaremos el <code>tnsnames.ora</code> a√±adiendo lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo nano /opt/oracle/product/19c/dbhome_1/network/admin/tnsnames.ora</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">PSQLU =<br> (DESCRIPTION=<br>   (ADDRESS=(PROTOCOL=tcp)(HOST=localhost)(PORT=1521))<br>   (CONNECT_DATA=(SID=PSQLU))<br> (HS=OK)<br> )</code></pre>\n<p>Una vez tengamo todo configurado guardaremos los cambios y reiniciaremos el servidor:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@oracle:~$ sudo systemctl restart oracledb_ORCLCDB-19c.service</code></pre>\n<p>En el servidor postgres, tenemos que permitir conexiones remotas no documentar√© nuevamente como se hace ya que est√° explicado mas arriba.</p>\n<p>Cuando hayamos terminado de configurar ambos servidores correctamente, procederenis a realizar la creaci√≥n del enlace de la base de datos en oracle para que se pueda consultar la de postgres.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">CREATE PUBLIC DATABASE LINK psql1 <br>CONNECT TO \"alejandro2\" IDENTIFIED BY \"usuario\"<br>USING 'PSQLU'</code></pre>\n<p><img src=\"/img/BD-P2.11.png\" alt=\"BD-P2.11.png\"></p>\n<p>Ahora hacemos una prueba para comprobar que funciona:</p>\n<p><img src=\"/img/BD-P2.12.png\" alt=\"BD-P2.12.png\"></p>\n<h4 id=\"postgres-a-oracle.\" tabindex=\"-1\">Postgres a Oracle.</h4>\n<p>Para realizar la conexi√≥n desde un servidor Postgres a un servidor oracle, primero, debemos de instalar los siguientes paquetes:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">usuario@PostgreSQL:~$ sudo apt install libaio1 postgresql-server-dev-all build-e<br>ssential git                                                                    <br>[sudo] password for usuario:                                                    <br>Leyendo lista de paquetes... Hecho                                              <br>Creando √°rbol de dependencias                                                   <br>Leyendo la informaci√≥n de estado... Hecho                                       <br>build-essential ya est√° en su versi√≥n m√°s reciente (12.6).                      <br>fijado build-essential como instalado manualmente.                              <br>libaio1 ya est√° en su versi√≥n m√°s reciente (0.3.112-3).                         <br>Se instalar√°n los siguientes paquetes adicionales:                              <br>  binfmt-support clang-7 dctrl-tools git-man lib32gcc1 lib32stdc++6 libc6-i386  <br>  libclang-common-7-dev libclang1-7 liberror-perl libffi-dev libgc1c2<br>  libncurses-dev libncurses6 libncursesw6 libobjc-8-dev libobjc4 libomp-7-dev<br>  libomp5-7 libpq-dev libtinfo-dev libtinfo6 llvm-7 llvm-7-dev llvm-7-runtime<br>  postgresql-server-dev-11<br></code></pre>\n<p>Ahora descargaremos los paquetes oficiales de <code>Oracle Instant Client</code>:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ wget https://download.oracle.com/otn_software/linux/instantclient/211000/instantclient-basic-linux.x64-21.1.0.0.0.zip<br>postgres@PostgreSQL:~$ wget https://download.oracle.com/otn_software/linux/instantclient/211000/instantclient-sdk-linux.x64-21.1.0.0.0.zip<br>postgres@PostgreSQL:~$ wget https://download.oracle.com/otn_software/linux/instantclient/211000/instantclient-sqlplus-linux.x64-21.1.0.0.0.zip<br></code></pre>\n<p>Extraemos los archivos .zip con el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ unzip instantclient-basic-linux.x64-21.1.0.0.0.zip<br>postgres@PostgreSQL:~$ unzip instantclient-sdk-linux.x64-21.1.0.0.0.zip<br>postgres@PostgreSQL:~$ unzip instantclient-sqlplus-linux.x64-21.1.0.0.0.zip</code></pre>\n<p>Tenemos que usar las siguientes variables para que funcione correctamente el cliente de oracle:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:/$ export ORACLE_HOME=/var/lib/postgresql/instantclient_21_1/<br>postgres@PostgreSQL:/$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME<br>postgres@PostgreSQL:/$ export PATH=$PATH:$ORACLE_HOME</code></pre>\n<p>como podemos ver, ya nos devuelve la ruta cuando hacemos un which:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:/$ which sqlplus<br>/var/lib/postgresql/instantclient_21_1/sqlplus</code></pre>\n<p>Y si probamos a hacer una conexi√≥n remota desde posgres funciona correctamente.</p>\n<p><img src=\"/img/BD-P2.13.png\" alt=\"BD-P2.13.png\"></p>\n<p>Ahora instalaremos el paquete <code>oracle_fdw</code>, para ellos tendremos que clonar el siguiente repositorio de github:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">git clone https://github.com/laurenz/oracle_fdw.git</code></pre>\n<p>entramos en la carpeta del repositorio clonado y a continuaci√≥n, compilaremos el paquete. Ejecutamos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~/oracle_fdw$ make                                          <br>gcc -Wall -Wmissing-prototypes -Wpointer-arith -Wdeclaration-after-statement -Wendif-labels -Wmissing-format-attribute -Wformat-security -fno-strict-aliasing -fwrapv -fexcess-precision=standard -Wno-format-truncation -Wno-stringop-truncation -g -g -O2 -fstack-protector-strong -Wformat -Werror=format-security -fno-omit-frame-pointer -fPIC -I\"/var/lib/postgresql/instantclient_21_1/sdk/include\" -I\"/var/lib/postgresql/instantclient_21_1/oci/include\" -I\"/var/lib/postgresql/instantclient_21_1/rdbms/public\" -I\"/var/lib/postgresql/instantclient_21_1/\"  -I. -I./ -I/usr/include/postgresql/11/server -I/usr/include/postgresql/internal  -Wdate-time -D_FORTIFY_SOURCE=2 -D_GNU_SOURCE -I/usr/include/libxml2  -I/usr/include/mit-krb5  -c -o oracle_fdw.o oracle_fdw.c                                          </code></pre>\n<p>Una vez haya terminado, ejecutamos el make install.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~/oracle_fdw$ sudo make install<br>[sudo] password for postgres: <br>/bin/mkdir -p '/usr/lib/postgresql/11/lib'<br>/bin/mkdir -p '/usr/share/postgresql/11/extension'<br>/bin/mkdir -p '/usr/share/postgresql/11/extension'<br>/bin/mkdir -p '/usr/share/doc/postgresql-doc-11/extension'<br>/usr/bin/install -c -m 755  oracle_fdw.so '/usr/lib/postgresql/11/lib/oracle_fdw.so'<br>/usr/bin/install -c -m 644 .//oracle_fdw.control '/usr/share/postgresql/11/extension/'<br>/usr/bin/install -c -m 644 .//oracle_fdw--1.2.sql .//oracle_fdw--1.0--1.1.sql .//oracle_fdw--1.1--1.2.sql  '/usr/share/postgresql/11/extension/'<br>/usr/bin/install -c -m 644 .//README.oracle_fdw '/usr/share/doc/postgresql-doc-11/extension/'</code></pre>\n<p>Con el siguiente comando, generaremos los enlaces necesarios y cargaremos en memorai las nuevas librer√≠as compartidas que hemos introducido:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~/oracle_fdw$ sudo ldconfig</code></pre>\n<p>Ya hemos terminado toda la configuraci√≥n necesaria, ahora crearemos el enlace y empezaremos a usarlo. Para ello, debemos de acceder a nuestra base de datos de postgres.</p>\n<p>Al crear la extensi√≥n me daba el siguiente fallo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">servidor1=# CREATE EXTENSION oracle_fdw;<br>ERROR:  no se pudo cargar la biblioteca ¬´/usr/lib/postgresql/11/lib/oracle_fdw.so¬ª: libclntsh.so.21.1: no se puede abrir el fichero del objeto compartido: No existe el fichero o el directorio</code></pre>\n<p>Lo he solucionado a√±adiendo al siguiente fichero lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ sudo nano /etc/ld.so.conf<br>```txt<br><br>a√±adimos la siguiente ruta:<br><br>```txt<br>/var/lib/postgresql/instantclient_21_1/</code></pre>\n<p>Y ahora ya podemos crear el enlace correctamente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ psql -d servidor1<br>psql (11.17 (Debian 11.17-0+deb10u1))<br>Digite ¬´help¬ª para obtener ayuda.<br><br>servidor1=# CREATE EXTENSION oracle_fdw;<br>CREATE EXTENSION</code></pre>\n<p>Una vez creado el enlace crearemos el schema donde importaremos la base de datos de oracle:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">servidor1=# CREATE SCHEMA oracle;<br>CREATE SCHEMA</code></pre>\n<p>Ahora que est√° creado el schema, tendremos que importar las tablas de la base de datos de oracle ya que actualmente el schema est√° vac√≠o:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">servidor1=# CREATE SERVER oracle FOREIGN DATA WRAPPER oracle_fdw OPTIONS (dbserver '//192.168.122.1/ORCLCDB');<br>CREATE SERVER</code></pre>\n<p>Tambi√©n tenemos que mapear nuestro usuario local a un usuario en el otro servidor para que pueda acceder y tenga privilegios sobre las tablas.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">servidor1=# CREATE USER MAPPING FOR alejandro1 SERVER oracle OPTIONS (user 'c##servidor1', password 'usuario');<br>CREATE USER MAPPING</code></pre>\n<p>Por √∫ltimo, le daremos privilegios a nuestro usuario del servidor sobre el nuevo esquema y el servidor remoto.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">servidor1=# GRANT ALL PRIVILEGES ON SCHEMA oracle to alejandro1;<br>GRANT<br>servidor1=# GRANT ALL PRIVILEGES ON FOREIGN SERVER oracle TO alejandro1;<br>GRANT</code></pre>\n<p>Ahora accederemos a la base de datos con el usuario al que le hemos dado privilegios.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">postgres@PostgreSQL:~$ psql -h localhost -U alejandro1 -d servidor1<br>Contrase√±a para usuario alejandro1: <br>psql (11.17 (Debian 11.17-0+deb10u1))<br>conexi√≥n SSL (protocolo: TLSv1.3, cifrado: TLS_AES_256_GCM_SHA384, bits: 256, compresi√≥n: desactivado)<br>Digite ¬´help¬ª para obtener ayuda.</code></pre>\n<p>Ahora importaremos el schema que hemos creado anteriormente.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">servidor1=> IMPORT FOREIGN SCHEMA \"C##SERVIDOR1\" FROM SERVER \"oracle\" INTO oracle;<br>IMPORT FOREIGN SCHEMA</code></pre>\n<p>Vamos a realizar una consulta para demostrar que funciona correctamente.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"> SELECT DEPT.DNAME AS Departamento, EMP.ENAME AS Nombre<br> FROM oracle.EMP EMP, DEPT<br> WHERE EMP.DEPTNO = DEPT.DEPTNO;</code></pre>\n<p><img src=\"/img/BD-P2.14.png\" alt=\"BD-P2.14.png\"></p>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-11-16T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/compilar-un-kernel-linux-a-medida./",
      "url": "https://reeseschultz.github.io/post/compilar-un-kernel-linux-a-medida./",
      "title": "Compilar un Kernel linux a medida.",
      "content_html": "<p>Antes que nada, crearemos un directorio de trabajo, donde descargaremos el k√©rnel y trabajaremos con √©l.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> ~/kernel<br><span class=\"token builtin class-name\">cd</span> ~/kernel</code></pre>\n<p>Instalamos las herramientas de compilaci√≥n:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> build-essential qtbase5-dev</code></pre>\n<p>A√±adimos al <code>sources.list</code> el repositorio de bullseye-backports y con el siguiente comando podremos ver las versiones disponibles del kernel:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">      ~/kernel$ sudo apt policy linux-source<br>linux-source:<br>  Instalados: (ninguno)<br>  Candidato:  5.10.149-2<br>  Tabla de versi√≥n:<br>     6.0.3-1~bpo11+1 100<br>        100 http://deb.debian.org/debian bullseye-backports/main amd64 Packages<br>     5.19.11-1~bpo11+1 100<br>        100 http://deb.debian.org/debian bullseye-backports/main amd64 Packages<br>     5.18.16-1~bpo11+1 100<br>        100 http://deb.debian.org/debian bullseye-backports/main amd64 Packages<br>     5.10.149-2 500<br>        500 http://security.debian.org/debian-security bullseye-security/main amd64 Packages<br>     5.10.140-1 500<br>        500 http://deb.debian.org/debian bullseye/main amd64 Packages<br>     5.10.136-1 500<br>        500 http://security.debian.org/debian-security bullseye-security/main amd64 Packages<br>     5.10.127-2 500<br>        500 http://deb.debian.org/debian bullseye/main amd64 Packages<br>        500 http://security.debian.org/debian-security bullseye-security/main amd64 Packages<br>     5.10.120-1 500<br>        500 http://security.debian.org/debian-security bullseye-security/main amd64 Packages<br>     5.10.113-1 500<br>        500 http://security.debian.org/debian-security bullseye-security/main amd64 Packages<br>     5.10.103-1 500<br>        500 http://security.debian.org/debian-security bullseye-security/main amd64 Packages</code></pre>\n<p>usaremos la versi√≥n del kernel 6.0.3.1. Para descargar el kernel con la versi√≥n que vamos a utilizar, usamos el siguiente comando:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> linux-source<span class=\"token operator\">=</span><span class=\"token number\">6.0</span>.3-1~bpo11+1</code></pre>\n<p>movemos a nuestro directorio el archivo que se ha descargado. A m√≠ se me ha descargado en <em>/usr/src</em>:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">mv</span> /usr/src/linux-source-6.0.tar.xz ./</code></pre>\n<p>Tenemos que desempaquetarlo, para ello usaremos tar:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">tar</span> -xf ./linux-source-6.0.tar.xz</code></pre>\n<p>Como podemos ver, ya tenemos listo el kernel para trabajar con √©l.</p>\n<p><img src=\"/img/ASO-P6.1.png\" alt=\"ASO-P6.1.png\"></p>\n<p>A la hora de compilar el kernel, necesitamos el archivo .config el cual se van a cargar de forma est√°tica los modulos del kernel. Cogeremos de referencia el <code>.config</code> de nuestro kernel. Ejecutaremos el siguiente comando para ello:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> oldconfig</code></pre>\n<p>Al ejecutar el make, nos pregunta si queremos incluir componentes adicionales, como la idea es hacer el kernel lo m√°s peque√±o posible, le daremos a todo que no. Como podemos ver, en el primer comando muestra los m√≥dulos que se han enlazado est√°ticamente(=y) y el segundo los que se han enlazado din√°micamente(=m).</p>\n<p><img src=\"/img/ASO-P6.2.png\" alt=\"ASO-P6.2.png\"></p>\n<p>Como podemos apreciar son un total de unos 5700 m√≥dulos enlazados, para seguir quitando m√≥dulos, usaremos el siguiente comando para quitar aquellos que no est√°n activos:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">make</span> localmodconfig</code></pre>\n<p>Cuando se ejecuta el comando, vuelve a preguntar si queremos enlazar algun componente, para seguir descartando componentes, le he seguido dando a no. Volvemos a contar cuantos m√≥dulos tenemos:</p>\n<p><img src=\"/img/ASO-P6.3.png\" alt=\"ASO-P6.3.png\"></p>\n<p>Ahora, ya tenemos menos de 2000 m√≥dulos enlazados, sigue siendo una cantidad alta pero hemos reducido a m√°s de la mitad los m√≥dulos enlazados.</p>\n<p>Dicho esto, empezaremos nuestra primera compilaci√≥n, as√≠ verificaremos que funciona todo.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">alemd@debian:~/kernel/linux-source-6.0$ <span class=\"token function\">make</span> -j4 bindeb-pkg<br>  SYNC    include/config/auto.conf.cmd<br>  UPD     include/config/kernel.release<br><span class=\"token function\">sh</span> ./scripts/package/mkdebian<br>dpkg-buildpackage -r<span class=\"token string\">\"fakeroot -u\"</span> -a<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">cat</span> debian/arch<span class=\"token variable\">)</span></span>  -b -nc -uc<br>dpkg-buildpackage: informaci√≥n: paquete fuente linux-upstream<br>dpkg-buildpackage: informaci√≥n: versi√≥n de las fuentes <span class=\"token number\">6.0</span>.3-1<br>dpkg-buildpackage: informaci√≥n: distribuci√≥n de las fuentes bullseye<br>dpkg-buildpackage: informaci√≥n: fuentes modificadas por alemd <span class=\"token operator\">&lt;</span>alemd@debian<span class=\"token operator\">></span><br>dpkg-buildpackage: informaci√≥n: arquitectura del sistema amd64<br> dpkg-source --before-build <span class=\"token builtin class-name\">.</span><br> debian/rules binary<br><span class=\"token function\">make</span> <span class=\"token assign-left variable\">KERNELRELEASE</span><span class=\"token operator\">=</span><span class=\"token number\">6.0</span>.3 <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span>x86 \t<span class=\"token assign-left variable\">KBUILD_BUILD_VERSION</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> -f ./Makefile<br>  SYSHDR  arch/x86/include/generated/uapi/asm/unistd_32.h<br>  SYSHDR  arch/x86/include/generated/uapi/asm/unistd_64.h<br>  WRAP    arch/x86/include/generated/uapi/asm/bpf_perf_event.h<br>  WRAP    arch/x86/include/generated/uapi/asm/errno.h<br>  HOSTCC  arch/x86/tools/relocs_32.o<br>  WRAP    arch/x86/include/generated/uapi/asm/fcntl.h<br>  WRAP    arch/x86/include/generated/uapi/asm/ioctl.h<br>  WRAP    arch/x86/include/generated/uapi/asm/ioctls.h<br>  WRAP    arch/x86/include/generated/uapi/asm/ipcbuf.h<br>  WRAP    arch/x86/include/generated/uapi/asm/param.h<br>  WRAP    arch/x86/include/generated/uapi/asm/poll.h<br>  WRAP    arch/x86/include/generated/uapi/asm/resource.h<br></code></pre>\n<p>Una vez compilado el kernel, instalaremos el paquete .deb que se ha generado con el siguiente comando:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> dpkg -i <span class=\"token punctuation\">..</span>/linux-image-6.0.3_6.0.3-1_amd64.deb</code></pre>\n<p>Ahora que est√° instalado el kernel, probaremos que funciona, para ello tendremos que reiniciar nuestra m√°quina y en <em>Advanced Options for Debian GNU/Linux</em> seleccionaremos el nuevo kernel. Probaremos que todo funciona correctamente y volveremos a reiniciar y entraremos con el kernel que usamos habitualmente. Como podemos comprobar despu√©s de reiniciar, estamos usando el kernel 6.0.3.</p>\n<p><img src=\"/img/ASO-P6.4.png\" alt=\"ASO-P6.4.png\"></p>\n<p>Ahora, realizaremos una nueva compilaci√≥n y antes que nada, eliminaremos los ficheros residuales de la compilaci√≥n. Para ello utilizaremos el siguiente comando.</p>\n<p><img src=\"/img/ASO-P6.5.png\" alt=\"ASO-P6.5.png\"></p>\n<p>Para esta compilaci√≥n, no vamos a usar los parametros <em>oldconfig</em> ni <em>localmodconfig</em>, usaremos <em>xconfig</em> que es una aplicaci√≥n gr√°fica para instalar los componentes a mano. Primero que nada instalaremos una dependencia:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> pkg-config</code></pre>\n<p>Ahora procederemos a hacer el make xconfig, nos aparecer√° una ventana como la de la siguiente imagen y simplemente tenemos que quitar los m√≥dulos que no vayamos a usar en el kernel desenmarcando las casillas. Es un proceso largo y lento pero es sencillo de hacer.</p>\n<p><img src=\"/img/ASO-P6.6.png\" alt=\"ASO-P6.6.png\"></p>\n<p>Volvemos a contar cuantos m√≥dulos tiene el kernel:</p>\n<p><img src=\"/img/ASO-P6.7.png\" alt=\"ASO-P6.7.png\"></p>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-11-10T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-modificacion-de-parametros-del-kernel/",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-modificacion-de-parametros-del-kernel/",
      "title": "Ejercicios de modificaci√≥n de par√°metros del k√©rnel",
      "content_html": "<h3 id=\"1.-deshabilita-apparmor-en-el-arranque.\" tabindex=\"-1\">1. Deshabilita apparmor en el arranque.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> systemctl disable apparmor</code></pre>\n<h3 id=\"2.-deshabilita-si-es-posible-el-kernel-mode-setting-(ksm)-de-la-tarjeta-gr%C3%A1fica.\" tabindex=\"-1\">2. Deshabilita si es posible el Kernel Mode Setting (KSM) de la tarjeta gr√°fica.</h3>\n<p>Viene desactivado por defecto ya que mi tarjeta gr√°fica es amd.</p>\n<h3 id=\"3.-cambia-provisionalmente-la-swappiness-para-que-la-swap-de-tu-equipo-se-active-cuando-se-use-m%C3%A1s-de-un-90%25-de-la-ram.\" tabindex=\"-1\">3. Cambia provisionalmente la swappiness para que la swap de tu equipo se active cuando se use m√°s de un 90% de la RAM.</h3>\n<p>Con el cat vemos el valor por defecto y con el siguiente comando lo cambiamos:</p>\n<p><img src=\"/img/ASO-P5.1.png\" alt=\"img\"></p>\n<h3 id=\"4.-haz-que-el-cambio-de-la-swappiness-sea-permanente.\" tabindex=\"-1\">4. Haz que el cambio de la swappiness sea permanente.</h3>\n<p>Para hacer el cambio permanente, tenemos que editar el fichero <code>sysctl.conf</code>:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/sysctl.conf</code></pre>\n<p>a√±adimos la siguiente l√≠nea en el archivo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">vm.swappiness = 90</code></pre>\n<h3 id=\"5.-muestra-el-valor-del-bit-de-forward-para-ipv6.\" tabindex=\"-1\">5. Muestra el valor del bit de forward para IPv6.</h3>\n<p>cat /proc/sys/net/ipv6/conf/all/forwarding\n<img src=\"/img/ASO-P5.2.png\" alt=\"img\"></p>\n<h3 id=\"6.-deshabilita-completamente-las-magic-sysrq-en-el-arranque-y-vuelve-a-habilitarlas-despu%C3%A9s-de-reiniciar.\" tabindex=\"-1\">6. Deshabilita completamente las Magic Sysrq en el arranque y vuelve a habilitarlas despu√©s de reiniciar.</h3>\n<p>Para deshabilitar las Magic Sysrq usamos el siguiente comando.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ sysctl -w kernel.sysrq<span class=\"token operator\">=</span><span class=\"token number\">0</span></code></pre>\n<p>Si lo queremos volver a activar simplemente lo ponemos a 1 de nuevo:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ sysctl -w kernel.sysrq<span class=\"token operator\">=</span><span class=\"token number\">1</span></code></pre>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-11-08T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-de-manejo-de-modulos/",
      "url": "https://reeseschultz.github.io/post/ejercicios-de-manejo-de-modulos/",
      "title": "Ejercicios de manejo de m√≥dulos",
      "content_html": "<h3 id=\"1.-comprueba-los-m%C3%B3dulos-cargados-en-tu-equipo.\" tabindex=\"-1\">1. Comprueba los m√≥dulos cargados en tu equipo.</h3>\n<p>Para ver los m√≥dulos cargados de mi equipo, usamos el siguiente comando:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ lsmod</code></pre>\n<p><img src=\"/img/ASO-P4.1.png\" alt=\"Imagen no encontrada: /img/ASO-P4.1.png\" title=\"Imagen no encontrada: /img/ASO-P4.1.png\">\nlsmod, lo que hace es leer el contenido del archivo /proc/modules.</p>\n<h3 id=\"2.-cuenta-el-n%C3%BAmero-de-m%C3%B3dulos-disponibles-en-el-n%C3%BAcleo-que-est%C3%A1s-usando.\" tabindex=\"-1\">2. Cuenta el n√∫mero de m√≥dulos disponibles en el n√∫cleo que est√°s usando.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">ls</span> -R /lib/modules/<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> -r<span class=\"token variable\">)</span></span> <span class=\"token operator\">|</span> <span class=\"token function\">wc</span> -l</code></pre>\n<p><img src=\"/img/ASO-P4.2.png\" alt=\"ASO-P4.2.png\"></p>\n<h3 id=\"3.-conecta-un-l%C3%A1piz-usb-y-observa-la-salida-de-la-instrucci%C3%B3n-sudo-dmesg.\" tabindex=\"-1\">3. Conecta un l√°piz USB y observa la salida de la instrucci√≥n sudo dmesg.</h3>\n<p>he ejecutado el siguiente comando:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">dmesg</span> -w</code></pre>\n<p>lo que hace el parametro -w es que se actualiza en el momento el comando, y al a√±adir el Pen-Drive se han a√±adido estas l√≠neas:</p>\n<p><img src=\"/img/ASO-P4-3.png\" alt=\"ASO-P4.3.png\"></p>\n<h3 id=\"4.-elimina-el-m%C3%B3dulo-correspondiente-a-alg%C3%BAn-dispotivo-no-esencial-y-comprueba-qu%C3%A9-ocurre.-vuelve-a-cargarlo.\" tabindex=\"-1\">4. Elimina el m√≥dulo correspondiente a alg√∫n dispotivo no esencial y comprueba qu√© ocurre. Vuelve a cargarlo.</h3>\n<p>Vamos a eliminar el modulo usb storage, pero al hacer un lsmod vemos que usb_storage depende de uas, entonces, tenemos que eliminar el modulo uas primero y despues el de usb-storage.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ modprobe -r uas<br>$ modprobe -r usb_storage</code></pre>\n<p><img src=\"/img/ASO-P4.4.png\" alt=\"ASO-P4.4.png\"></p>\n<h3 id=\"5.-selecciona-un-m%C3%B3dulo-que-est%C3%A9-en-uso-en-tu-equipo-y-configura-el-arranque-para-que-no-se-cargue-autom%C3%A1ticamente.\" tabindex=\"-1\">5. Selecciona un m√≥dulo que est√© en uso en tu equipo y configura el arranque para que no se cargue autom√°ticamente.</h3>\n<p>Editamos el siguiente fichero:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/modprobe.d/blacklist.conf</code></pre>\n<p>A√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">blacklist [nombre_modulo]</code></pre>\n<p>Una vez hecho esto ejecutamos el siguiente comando para actualizar:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> update-initramfs -u</code></pre>\n<h3 id=\"6.-carga-el-m%C3%B3dulo-loop%2C-obt%C3%A9n-informaci%C3%B3n-de-qu%C3%A9-es-y-para-qu%C3%A9-sirve.-lista-el-contenido-de-%2Fsys%2Fmodules%2Floop%2Fparameters-y-configura-el-equipo-para-que-se-puedan-cargar-como-m%C3%A1ximo-12-dispositvos-loop-la-pr%C3%B3xima-vez-que-se-arranque.\" tabindex=\"-1\">6. Carga el m√≥dulo loop, obt√©n informaci√≥n de qu√© es y para qu√© sirve. Lista el contenido de /sys/modules/loop/parameters y configura el equipo para que se puedan cargar como m√°ximo 12 dispositvos loop la pr√≥xima vez que se arranque.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> modprobe loop</code></pre>\n<p><img src=\"/img/ASO-P4.6.png\" alt=\"ASO-P4.6.png\"></p>\n<p><img src=\"/img/ASO-P4.7.png\" alt=\"ASO-P4.7.png\"></p>\n<p>editamos el siguiente fichero:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/modules</code></pre>\n<p>a√±adimos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">options loop max_loop=12</code></pre>\n<p>Una vez hecho esto ejecutamos el siguiente comando para actualizar:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> update-initramfs -u</code></pre>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-11-03T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/creacion-de-instancias-desde-osc/",
      "url": "https://reeseschultz.github.io/post/creacion-de-instancias-desde-osc/",
      "title": "Creaci√≥n de instancias desde OSC",
      "content_html": "<ol>\n<li>Instala el cliente de l√≠nea de comando de OpenStack c√≥mo se muestra en <a href=\"https://github.com/josedom24/curso_openstack_ies/blob/main/modulo1/osc.md\">Instalaci√≥n y uso b√°sico de OpenStack client (OSC)</a>.</li>\n</ol>\n<p>Primero vamos a crear un entorno virtual donde vamos a trabajar con OpenStack client, para ello instalaremos python y venv si es necesario.</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> python3 python3-venv<br><span class=\"token function\">mkdir</span> venv<br><span class=\"token builtin class-name\">cd</span> venv</code></pre>\n<p>Activamos el entorno virtual con el siguiente comando:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> osc<br>python3 -m venv osc</code></pre>\n<p>Usamos el siguiente comando para instalar en el entorno virtual el cliente de openstack:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">pip <span class=\"token function\">install</span> python-openstackclient<span class=\"token operator\">==</span><span class=\"token number\">5.8</span>.0</code></pre>\n<ol start=\"3\">\n<li>Descarga de Horizon tu fichero de credenciales, carg√°lo y ejecuta la instrucci√≥n <code>openstack server list</code> para visualizar tus instancias.</li>\n</ol>\n<p>Una vez descargado el fichero, realizamos lo siguiente:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">source</span> crendenciales.sh</code></pre>\n<p>tendr√≠amos que insertar la contrase√±a con la que entramos a openstack y ya podr√≠amos interactuar con el servidor openstack.</p>\n<ol start=\"5\">\n<li>Vamos a crear una instancia y la vamos a configurar con <a href=\"https://github.com/josedom24/curso_openstack_ies/blob/main/modulo3/cloudinit.md\"><strong>cloud-init</strong></a>, para ello crea un fichero <code>cloud-config.yaml</code> con el siguiente contenido:</li>\n</ol>\n<pre class=\"language-yaml\"><code class=\"language-yaml\">    <span class=\"token comment\">#cloud-config</span><br>         <span class=\"token key atrule\">package_update</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><br>         <span class=\"token key atrule\">package_upgrade</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span><br>         <span class=\"token key atrule\">preserve_hostname</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span><br>         <span class=\"token key atrule\">fqdn</span><span class=\"token punctuation\">:</span> test1.gonzalonazareno.org<br>         <span class=\"token key atrule\">hostname</span><span class=\"token punctuation\">:</span> prueba<span class=\"token punctuation\">-</span>alemd<br>         <span class=\"token comment\"># Crear un usuario y a√±adir clave p√∫blica ssh</span><br>         <span class=\"token key atrule\">users</span><span class=\"token punctuation\">:</span><br>           <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> jose<br>             <span class=\"token key atrule\">sudo</span><span class=\"token punctuation\">:</span> ALL=(ALL) NOPASSWD<span class=\"token punctuation\">:</span>ALL<br>             <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> /bin/bash<br>             <span class=\"token key atrule\">passwd</span><span class=\"token punctuation\">:</span> asdasd<br>             <span class=\"token key atrule\">ssh_authorized_keys</span><span class=\"token punctuation\">:</span><br>             <span class=\"token comment\"># Clave p√∫blica de nuestra m√°quina.</span><br>               <span class=\"token punctuation\">-</span> ssh<span class=\"token punctuation\">-</span>rsa <br>           <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> alemd<br>             <span class=\"token key atrule\">sudo</span><span class=\"token punctuation\">:</span> ALL=(ALL) NOPASSWD<span class=\"token punctuation\">:</span>ALL<br>             <span class=\"token key atrule\">shell</span><span class=\"token punctuation\">:</span> /bin/bash<br>             <span class=\"token key atrule\">passwd</span><span class=\"token punctuation\">:</span> usuario<br>           <span class=\"token comment\">#  ssh_authorized_keys:</span><br>             <span class=\"token comment\"># Clave p√∫blica de nuestra m√°quina.</span><br>             <span class=\"token comment\">#  - ssh-rsa </span><br><br>         <span class=\"token key atrule\">chpasswd</span><span class=\"token punctuation\">:</span><br>           <span class=\"token key atrule\">list</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"><br>             root:asdasd</span><br>           <span class=\"token key atrule\">expire</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">False</span></code></pre>\n<p>Modifica el fichero e indica un nombre a la m√°quina, crea otro usuario y cambia las contrase√±as.</p>\n<p>Este fichero actualizar√° la paqueter√≠a de la instancia, configurar√° el FQDN de la instancia, crear√° un nuevo usuario y cambiar√° la contrase√±a del usuario <code>root</code>.</p>\n<ol start=\"4\">\n<li>Siguiendo el apartado <a href=\"https://github.com/josedom24/curso_openstack_ies/blob/main/modulo3/osc_nova.md\">Gesti√≥n de instancia con OpenStack client (OSC)</a>, visualiza con el OSC los flavors disponibles, im√°genes disponibles, claves disponibles, reglas de cortafuegos,‚Ä¶</li>\n<li>Crea una nueva instancia usando el comando que encontrar√°s en la secci√≥n <a href=\"https://github.com/josedom24/curso_openstack_ies/blob/main/modulo1/osc.md\">Configuraci√≥n de instancias con cloud-init</a>.</li>\n<li>A√±ade una IP flotante a la instancia para ello puedes usar los comandos que encuentras en <a href=\"https://github.com/josedom24/curso_openstack_ies/blob/main/modulo3/osc_nova.md\">Gesti√≥n de instancia con OpenStack client (OSC)</a>.</li>\n<li>Accede por ssh (recuerda usar el usuario que has creado con cloud-init) a la instancia.</li>\n</ol>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-11-03T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/ejercicios-gestion-de-paqueteria/",
      "url": "https://reeseschultz.github.io/post/ejercicios-gestion-de-paqueteria/",
      "title": "Ejercicios gesti√≥n de paqueter√≠a",
      "content_html": "<h1 id=\"trabajo-con-apt%2C-aptitude%2C-dpkg\" tabindex=\"-1\">Trabajo con apt, aptitude, dpkg</h1>\n<h4 id=\"prepara-una-m%C3%A1quina-virtual-con-debian-bullseye%2C-realizar-las-siguientes-acciones%3A\" tabindex=\"-1\">Prepara una m√°quina virtual con Debian bullseye, realizar las siguientes acciones:</h4>\n<h3 id=\"1.-que-acciones-consigo-al-realizar-apt-update-y-apt-upgrade.-explica-detalladamente.\" tabindex=\"-1\">1. Que acciones consigo al realizar apt update y apt upgrade. Explica detalladamente.</h3>\n<p>Al hacer un apt update, actualizas la lista de paquetes que hay disponible y sus versiones en los repositorios aunque no realiza ninguna instalaci√≥n.\nDespu√©s de hacer un apt update, hay que hacer un apt upgrade, permite instalar si no tiene instalado y actualiza versiones de los paquetes ya instalados.</p>\n<h3 id=\"2.-lista-la-relaci%C3%B3n-de-paquetes-que-pueden-ser-actualizados.-%C2%BFqu%C3%A9-informaci%C3%B3n-puedes-sacar-a-tenor-de-lo-mostrado-en-el-listado%3F.\" tabindex=\"-1\">2. Lista la relaci√≥n de paquetes que pueden ser actualizados. ¬øQu√© informaci√≥n puedes sacar a tenor de lo mostrado en el listado?.</h3>\n<p>Para mostrar los paquetes que pueden ser instalados, se usa el siguiente comando:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> list --upgradable</code></pre>\n<p>Muestro captura del comando ejecutado en mi m√°quina.\n<img src=\"/img/ASO-P3.1.png\" alt=\"img\"></p>\n<p>En la l√≠nea el resaltado verde apunta al nombre del paquete. oldstable indica que no es de la versi√≥n stable de debian(esa m√°quina es debian buster). Los n√∫meros siguientes indican la versi√≥n del paquete y lo siguiente a la arquitectura del paquete(amd64).</p>\n<h3 id=\"3.-indica-la-versi%C3%B3n-instalada%2C-candidata-as%C3%AD-como-la-prioridad-del-paquete-openssh-client.\" tabindex=\"-1\">3. Indica la versi√≥n instalada, candidata as√≠ como la prioridad del paquete openssh-client.</h3>\n<p>Para ver la versi√≥n instalada y la candidata de un paquete usamos el siguiente comando:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> policy openssh-client</code></pre>\n<p>En la siguiente captura veremos la ejecuci√≥n del comando:\n<img src=\"/img/ASO-P3.2.png\" alt=\"img\"></p>\n<p>Como indica la imagen, la versi√≥n instalada es la 1.7.9, la candidata es la misma y la prioridad es 500.</p>\n<h3 id=\"4.-%C2%BFc%C3%B3mo-puedes-sacar-informaci%C3%B3n-de-un-paquete-oficial-instalado-o-que-no-este-instalado%3F\" tabindex=\"-1\">4. ¬øC√≥mo puedes sacar informaci√≥n de un paquete oficial instalado o que no este instalado?</h3>\n<p>para ver informaci√≥n de un paquete oficial instalado, usariamos dpkg -s nombre_paquete.</p>\n<p>Si no est√° instalado, se puede ver informaci√≥n de un paquete usando apt show nombre_paquete</p>\n<h3 id=\"5.-saca-toda-la-informaci%C3%B3n-que-puedas-del-paquete-openssh-client-que-tienes-actualmente-instalado-en-tu-m%C3%A1quina.\" tabindex=\"-1\">5. Saca toda la informaci√≥n que puedas del paquete openssh-client que tienes actualmente instalado en tu m√°quina.</h3>\n<p>Para ver mucha informaci√≥n del paquete podemos usar <em>dpkg -s openssh-client</em>.</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Package: openssh-client<br>Status: install ok installed<br>Priority: standard<br>Section: net<br>Installed-Size: 4298<br>Maintainer: Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org><br>Architecture: amd64<br>Multi-Arch: foreign<br>Source: openssh<br>Version: 1:8.4p1-5+deb11u1<br>Replaces: openssh-sk-helper, ssh, ssh-krb5<br>Provides: rsh-client, ssh-client<br>Depends: adduser (>= 3.10), dpkg (>= 1.7.0), passwd, libc6 (>= 2.26), libedit2 (>= 2.11-20080614-0), libfido2-1 (>= 1.5.0), libgssapi-krb5-2 (>= 1.17), libselinux1 (>= 3.1~), libssl1.1 (>= 1.1.1), zlib1g (>= 1:1.1.4)<br>Recommends: xauth<br>Suggests: keychain, libpam-ssh, monkeysphere, ssh-askpass<br>Breaks: openssh-sk-helper<br>Conflicts: sftp<br>Conffiles:<br> /etc/ssh/ssh_config 8a5bddc82befb71d8ef34cc903d3d077<br>Description: secure shell (SSH) client, for secure access to remote machines<br> This is the portable version of OpenSSH, a free implementation of<br> the Secure Shell protocol as specified by the IETF secsh working<br> group.<br> .<br> Ssh (Secure Shell) is a program for logging into a remote machine<br> and for executing commands on a remote machine.<br> It provides secure encrypted communications between two untrusted<br> hosts over an insecure network. X11 connections and arbitrary TCP/IP<br> ports can also be forwarded over the secure channel.<br> It can be used to provide applications with a secure communication<br> channel.<br> .<br> This package provides the ssh, scp and sftp clients, the ssh-agent<br> and ssh-add programs to make public key authentication more convenient,<br> and the ssh-keygen, ssh-keyscan, ssh-copy-id and ssh-argv0 utilities.<br> .<br> In some countries it may be illegal to use any encryption at all<br> without a special permit.<br> .<br> ssh replaces the insecure rsh, rcp and rlogin programs, which are<br> obsolete for most purposes.<br>Homepage: http://www.openssh.com/<br></code></pre>\n<p>Como podemos ver, nos muestra una descripci√≥n, si est√° instalado, la prioridad, el directorio del fichero de configuraci√≥n‚Ä¶</p>\n<h3 id=\"6.-saca-toda-la-informaci%C3%B3n-que-puedas-del-paquete-openssh-client-candidato-a-actualizar-en-tu-m%C3%A1quina.\" tabindex=\"-1\">6. Saca toda la informaci√≥n que puedas del paquete openssh-client candidato a actualizar en tu m√°quina.</h3>\n<h3 id=\"7.-lista-todo-el-contenido-referente-al-paquete-openssh-client-actual-de-tu-m%C3%A1quina.-utiliza-para-ello-tanto-dpkg-como-apt.\" tabindex=\"-1\">7. Lista todo el contenido referente al paquete openssh-client actual de tu m√°quina. Utiliza para ello tanto dpkg como apt.</h3>\n<p>Para listar el contenido del paquete con dpkg usamos el siguiente comando:</p>\n<p><img src=\"/img/ASO-P3.3.png\" alt=\"imagen\"></p>\n<p>Para listar el contenido del paquete con apt usamos el siguiente comando:</p>\n<p><img src=\"/img/ASO-P3.4.png\" alt=\"imagen\"></p>\n<h3 id=\"8.-listar-el-contenido-de-un-paquete-sin-la-necesidad-de-instalarlo-o-descargarlo.\" tabindex=\"-1\">8. Listar el contenido de un paquete sin la necesidad de instalarlo o descargarlo.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> apt-file list nombre_paquete</code></pre>\n<h3 id=\"9.-simula-la-instalaci%C3%B3n-del-paquete-openssh-client.\" tabindex=\"-1\">9. Simula la instalaci√≥n del paquete openssh-client.</h3>\n<p>Para simular una instalaci√≥n con apt, se usa el par√°metro -s. A continuaci√≥n, muestro la ejecuci√≥n del comando:</p>\n<p><img src=\"/img/ASO-P3.5.png\" alt=\"imagen\"></p>\n<h3 id=\"10.-%C2%BFqu%C3%A9-comando-te-informa-de-los-posible-bugs-que-presente-un-determinado-paquete%3F\" tabindex=\"-1\">10. ¬øQu√© comando te informa de los posible bugs que presente un determinado paquete?</h3>\n<p>El comando que informa sobre los posibles bugs de un paquete es el siguiente:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> apt-listbugs -s all nombre_paquete</code></pre>\n<h3 id=\"11.-despu%C3%A9s-de-realizar-un-apt-update-%26%26-apt-upgrade.-si-quisieras-actualizar-%C3%BAnicamente-los-paquetes-que-tienen-de-cadena-openssh.-%C2%BFqu%C3%A9-procedimiento-seguir%C3%ADas%3F.-realiza-esta-acci%C3%B3n%2C-con-las-estructuras-repetitivas-que-te-ofrece-bash%2C-as%C3%AD-como-con-el-comando-xargs.\" tabindex=\"-1\">11. Despu√©s de realizar un apt update &amp;&amp; apt upgrade. Si quisieras actualizar √∫nicamente los paquetes que tienen de cadena openssh. ¬øQu√© procedimiento seguir√≠as?. Realiza esta acci√≥n, con las estructuras repetitivas que te ofrece bash, as√≠ como con el comando xargs.</h3>\n<h3 id=\"12.-%C2%BFc%C3%B3mo-encontrar%C3%ADas-qu%C3%A9-paquetes-dependen-de-un-paquete-espec%C3%ADfico.\" tabindex=\"-1\">12. ¬øC√≥mo encontrar√≠as qu√© paquetes dependen de un paquete espec√≠fico.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-cache</span> depends nombre_paquete</code></pre>\n<p>Y para dependencias inversas:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-cache</span> rdepends nombre_paquete</code></pre>\n<h3 id=\"13.-%C2%BFc%C3%B3mo-proceder%C3%ADas-para-encontrar-el-paquete-al-que-pertenece-un-determinado-fichero%3F\" tabindex=\"-1\">13. ¬øC√≥mo proceder√≠as para encontrar el paquete al que pertenece un determinado fichero?</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ apt-file search ruta</code></pre>\n<h3 id=\"14.-%C2%BFque-procedimientos-emplear%C3%ADas-para-liberar-la-cach%C3%A9-en-cuanto-a-descargas-de-paqueter%C3%ADa%3F\" tabindex=\"-1\">14. ¬øQue procedimientos emplear√≠as para liberar la cach√© en cuanto a descargas de paqueter√≠a?</h3>\n<p>Con <code>apt autoclean</code> elimina paquetes de la cach√© que tiene una versi√≥n mas moderna.</p>\n<h3 id=\"15.-realiza-la-instalaci%C3%B3n-del-paquete-keyboard-configuration-pasando-previamente-los-valores-de-los-par%C3%A1metros-de-configuraci%C3%B3n-como-variables-de-entorno.\" tabindex=\"-1\">15. Realiza la instalaci√≥n del paquete keyboard-configuration pasando previamente los valores de los par√°metros de configuraci√≥n como variables de entorno.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ debconf keyboard-configuration</code></pre>\n<h3 id=\"16.-reconfigura-el-paquete-locales-de-tu-equipo%2C-a%C3%B1adiendo-una-localizaci%C3%B3n-que-no-exista-previamente.-comprueba-a-modificar-las-variables-de-entorno-correspondientes-para-que-la-sesi%C3%B3n-del-usuario-utilice-otra-localizaci%C3%B3n.\" tabindex=\"-1\">16. Reconfigura el paquete locales de tu equipo, a√±adiendo una localizaci√≥n que no exista previamente. Comprueba a modificar las variables de entorno correspondientes para que la sesi√≥n del usuario utilice otra localizaci√≥n.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LANG</span></span><span class=\"token operator\">=</span>en_GB.utf8<br>$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LANGUAGE</span></span><span class=\"token operator\">=</span>en_GB.utf8<br>$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">LC_ALL</span></span><span class=\"token operator\">=</span>en_GB.utf8</code></pre>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> dpkg-reconfigure locales -f --frontend Noninteractive</code></pre>\n<h3 id=\"17.-interrumpe-la-configuraci%C3%B3n-de-un-paquete-y-explica-los-pasos-a-dar-para-continuar-la-instalaci%C3%B3n.\" tabindex=\"-1\">17. Interrumpe la configuraci√≥n de un paquete y explica los pasos a dar para continuar la instalaci√≥n.</h3>\n<p>Probariamos con dpkg --configure -a. Si no funciona, tendr√≠amos que limpiar la cach√©, apt clean y apt autoclean. Har√≠amos un apt-get update --fix-missing y apt-get install -f para recuperar las dependencias da√±adas.</p>\n<h3 id=\"18.-explica-la-instrucci%C3%B3n-que-utilizar%C3%ADas-para-hacer-una-actualizaci%C3%B3n-completa-de-todos-los-paquetes-de-tu-sistema-de-manera-completamente-no-interactiva\" tabindex=\"-1\">18. Explica la instrucci√≥n que utilizar√≠as para hacer una actualizaci√≥n completa de todos los paquetes de tu sistema de manera completamente no interactiva</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> upgrade -y</code></pre>\n<h3 id=\"19.-bloquea-la-actualizaci%C3%B3n-de-determinados-paquetes.\" tabindex=\"-1\">19. Bloquea la actualizaci√≥n de determinados paquetes.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">apt</span> mark hold paquete</code></pre>\n<h1 id=\"trabajo-con-ficheros-.deb\" tabindex=\"-1\">Trabajo con ficheros .deb</h1>\n<h3 id=\"1.-descarga-un-paquete-sin-instalarlo%2C-es-decir%2C-descarga-el-fichero-.deb-correspondiente.-indica-diferentes-formas-de-hacerlo.\" tabindex=\"-1\">1. Descarga un paquete sin instalarlo, es decir, descarga el fichero .deb correspondiente. Indica diferentes formas de hacerlo.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">wget</span> url_paquete<br><br>$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt-get</span> download nombrepaquete</code></pre>\n<h3 id=\"2.-%C2%BFc%C3%B3mo-puedes-ver-el-contenido%2C-que-no-extraerlo%2C-de-lo-que-se-instalar%C3%A1-en-el-sistema-de-un-paquete-deb%3F\" tabindex=\"-1\">2. ¬øC√≥mo puedes ver el contenido, que no extraerlo, de lo que se instalar√° en el sistema de un paquete deb?</h3>\n<p>si es un .deb:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ dpkg -c nombrepaquete</code></pre>\n<p>O con tar:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">tar</span> -tf nombre_paquete.tar.gz</code></pre>\n<h3 id=\"3.-sobre-el-fichero-.deb-descargado%2C-utiliza-el-comando-ar.-ar-permite-extraer-el-contenido-de-una-paquete-deb.-indica-el-procedimiento-para-visualizar-con-ar-el-contenido-del-paquete-deb.-con-el-paquete-que-has-descargado-y-utilizando-el-comando-ar%2C-descomprime-el-paquete.-%C2%BFqu%C3%A9-informaci%C3%B3n-dispones-despu%C3%A9s-de-la-extracci%C3%B3n%3F.-indica-la-finalidad-de-lo-extra%C3%ADdo.\" tabindex=\"-1\">3. Sobre el fichero .deb descargado, utiliza el comando ar. ar permite extraer el contenido de una paquete deb. Indica el procedimiento para visualizar con ar el contenido del paquete deb. Con el paquete que has descargado y utilizando el comando ar, descomprime el paquete. ¬øQu√© informaci√≥n dispones despu√©s de la extracci√≥n?. Indica la finalidad de lo extra√≠do.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ ar -tvx *.deb</code></pre>\n<p>Se extrae:</p>\n<ul>\n<li><em>debian-binary</em> que indica la versi√≥n del archivo.</li>\n<li><em>control.tar.xz</em> que tiene scritps de preinstalaci√≥n, postinstalaci√≥n, preborrado, postborrado, configuraci√≥n‚Ä¶</li>\n<li>data.tar.xz en este paquete se encuentra todos los archivos que ser√°n extra√≠dos con dpkg.</li>\n</ul>\n<h3 id=\"4.-indica-el-procedimiento-para-descomprimir-lo-extra%C3%ADdo-por-ar-del-punto-anterior.-%C2%BFqu%C3%A9-informaci%C3%B3n-contiene%3F\" tabindex=\"-1\">4. Indica el procedimiento para descomprimir lo extra√≠do por ar del punto anterior. ¬øQu√© informaci√≥n contiene?</h3>\n<p>tar xvf nombrearchivo.</p>\n<h1 id=\"trabajo-con-repositorios\" tabindex=\"-1\">Trabajo con repositorios</h1>\n<h3 id=\"1.-a%C3%B1ade-a-tu-fichero-sources.list-los-repositorios-de-bullseye-backports-y-sid.\" tabindex=\"-1\">1. A√±ade a tu fichero sources.list los repositorios de bullseye-backports y sid.</h3>\n<p>Tenemos que editar el fichero sources.list:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">nano</span> /etc/apt/sources.list</code></pre>\n<p>A√±adimos al sources.list lo siguiente:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">deb https://deb.debian.org/debian bullseye-backports main<br>deb https://deb.debian.org/debian sid main</code></pre>\n<h3 id=\"2.-configura-el-sistema-apt-para-que-los-paquetes-de-debian-bullseye-tengan-mayor-prioridad-y-por-tanto-sean-los-que-se-instalen-por-defecto.\" tabindex=\"-1\">2. Configura el sistema APT para que los paquetes de debian bullseye tengan mayor prioridad y por tanto sean los que se instalen por defecto.</h3>\n<p>Para dar prioridad a los paquetes de debian bullseye, tenemos que crear un archivo llamado <code>preferences.pref</code> y debe contener lo siguiente:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">nano</span> /etc/apt/preferences.d/preferences.p</code></pre>\n<pre class=\"language-txt\"><code class=\"language-txt\">Package: *<br>Pin: release a=stable<br>Pin-Priority: 1000</code></pre>\n<h3 id=\"3.-configura-el-sistema-apt-para-que-los-paquetes-de-bullseye-backports-tengan-mayor-prioridad-que-los-de-unstable.\" tabindex=\"-1\">3. Configura el sistema APT para que los paquetes de bullseye-backports tengan mayor prioridad que los de unstable.</h3>\n<p>Tenemos que hacer lo mismo que antes pero cambiando lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Pin: release a=stable</code></pre>\n<p>Por esto:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">Pin: release a=bullseye-backports</code></pre>\n<h3 id=\"4.-%C2%BFc%C3%B3mo-a%C3%B1ades-la-posibilidad-de-descargar-paqueter%C3%ADa-de-la-arquitectura-i386-en-tu-sistema.-%C2%BFque-comando-has-empleado%3F.-lista-arquitecturas-no-nativas.-%C2%BFc%C3%B3mo-proceder%C3%ADas-para-desechar-la-posibilidad-de-descargar-paqueter%C3%ADa-de-la-arquitectura-i386%3F\" tabindex=\"-1\">4. ¬øC√≥mo a√±ades la posibilidad de descargar paqueter√≠a de la arquitectura i386 en tu sistema. ¬øQue comando has empleado?. Lista arquitecturas no nativas. ¬øC√≥mo proceder√≠as para desechar la posibilidad de descargar paqueter√≠a de la arquitectura i386?</h3>\n<p>El siguiente comando es para a√±adir:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> dpkg --add-architecture i386</code></pre>\n<p>Este comando lista las arquitecturas soportadas por nuestro sistema:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ dpkg --prin-architectures</code></pre>\n<p>este comando elimina las arquitecturas:</p>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ dpkg --remove-architecture i386</code></pre>\n<h3 id=\"5.-si-quisieras-descargar-un-paquete%2C-%C2%BFc%C3%B3mo-puedes-saber-todas-las-versiones-disponible-de-dicho-paquete%3F\" tabindex=\"-1\">5. Si quisieras descargar un paquete, ¬øc√≥mo puedes saber todas las versiones disponible de dicho paquete?</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> show --all-versions nombrepaquete</code></pre>\n<h3 id=\"6.-indica-el-procedimiento-para-descargar-un-paquete-del-repositorio-stable.\" tabindex=\"-1\">6. Indica el procedimiento para descargar un paquete del repositorio stable.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -t stable nombrepaquete</code></pre>\n<h3 id=\"7.-indica-el-procedimiento-para-descargar-un-paquete-del-repositorio-de-buster-backports.\" tabindex=\"-1\">7. Indica el procedimiento para descargar un paquete del repositorio de buster-backports.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -t bullseye-backports nombrepaquete</code></pre>\n<h3 id=\"8.-indica-el-procedimiento-para-descargar-un-paquete-del-repositorio-de-sid.\" tabindex=\"-1\">8. Indica el procedimiento para descargar un paquete del repositorio de sid.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> -t sid nombrepaquete</code></pre>\n<h3 id=\"9.-indica-el-procedimiento-para-descargar-un-paquete-de-arquitectura-i386.\" tabindex=\"-1\">9. Indica el procedimiento para descargar un paquete de arquitectura i386.</h3>\n<pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> nombrepaquete:i386</code></pre>\n<h1 id=\"trabajo-con-directorios\" tabindex=\"-1\">Trabajo con directorios</h1>\n<h3 id=\"1.-que-cometidos-tienen%3A\" tabindex=\"-1\">1. Que cometidos tienen:</h3>\n<ul>\n<li>\n<p><strong>/var/lib/apt/lists/</strong>: En este directorio contiene caracter√≠sticas sobre los repositorios.</p>\n</li>\n<li>\n<p><strong>/var/lib/dpkg/available</strong>: Lista con los paquetes que hay disponibles.</p>\n</li>\n<li>\n<p><strong>/var/lib/dpkg/status</strong>: En este directorio, hay informaci√≥n sobre los paquetes instalados en el sistema.</p>\n</li>\n<li>\n<p><strong>/var/cache/apt/archives/</strong>: Aqu√≠ hay los archivos <code>.deb</code> que estan instalados.</p>\n</li>\n</ul>\n<p>&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</p>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-10-18T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/prueba:-introduccion-a-la-implantacion-de-aplicaciones-web./",
      "url": "https://reeseschultz.github.io/post/prueba:-introduccion-a-la-implantacion-de-aplicaciones-web./",
      "title": "Prueba: Introducci√≥n a la implantaci√≥n de aplicaciones web.",
      "content_html": "<h1 id=\"alejandro-montes-delgado.\" tabindex=\"-1\">Alejandro Montes Delgado.</h1>\n<p><img src=\"/img/ipasen.png\" alt=\"ipasen.png\"></p>\n",
      "date_published": "2022-10-10T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/talleres-unidad-1-servicios./",
      "url": "https://reeseschultz.github.io/post/talleres-unidad-1-servicios./",
      "title": "Talleres unidad 1 Servicios.",
      "content_html": "<h1 id=\"taller-1%3A-ansible---playbook-sencillo\" tabindex=\"-1\">Taller 1: Ansible - Playbook sencillo</h1>\n<ol>\n<li>Entrega los ficheros: site.yaml, hosts y template/index.j2.</li>\n</ol>\n<p><a href=\"/files/site.yaml\">site.yml</a> <a href=\"/files/host\">host</a> <a href=\"/files/index.j2\">index.j2</a></p>\n<ol start=\"2\">\n<li>Entrega una captura de pantalla donde se vea que se ha finalizado la ejecuci√≥n del playbook.</li>\n</ol>\n<p><img src=\"/img/SRI.png\" alt=\"SRI.png\"></p>\n<ol start=\"3\">\n<li>Responde: ¬øC√≥mo se llama la propiedad que permite que las tareas que ya se han realizado no se vuelvan a ejecutar?</li>\n</ol>\n<p>Idempotencia</p>\n<ol start=\"4\">\n<li>Captura de pantalla, donde se vea el fichero foo.txt en el servidor configurado.</li>\n</ol>\n<p><img src=\"/img/SRI2.png\" alt=\"SRI2.png\"></p>\n<ol start=\"5\">\n<li>Captura de pantalla donde se vea el acceso desde el navegador al servidor web, y se vea el contenido del fichero index.html.</li>\n</ol>\n<p><img src=\"/img/SRI3.png\" alt=\"SRI3.png\"></p>\n<ol start=\"6\">\n<li>Entrega la URL de tu repositorio con el que estas trabajando.</li>\n</ol>\n<p><a href=\"https://github.com/alemd01/taller_ansible_vagrant/\">Github</a></p>\n<h1 id=\"taller-2%3A-ansible---playbook-con-roles\" tabindex=\"-1\">Taller 2: Ansible - Playbook con roles</h1>\n<ol>\n<li>Entrega una captura de pantalla donde se vea que se ha finalizado la ejecuci√≥n del playbook.</li>\n</ol>\n<p><img src=\"/img/SRI-T2.1.png\" alt=\"SRI-T2.1.png\"></p>\n<ol start=\"2\">\n<li>Captura de pantalla donde se vea el acceso desde el navegador al servidor web, y se vea el contenido del fichero index.html.</li>\n</ol>\n<p><img src=\"/img/SRI-T2.2.png\" alt=\"SRI-T2.2.png\"></p>\n<ol start=\"3\">\n<li>Captura de pantalla donde se vea el acceso a la base de datos.</li>\n</ol>\n<p><img src=\"/img/SRI-T2.3.png\" alt=\"SRI-T2.3.png\"></p>\n<ol start=\"4\">\n<li>Realiza un cambio en la receta que necesite ejecutar el reinicio del servicio. Ejecuta de nuevo el playbook y comprueba que se ha ejecutado el handler correspondiente.</li>\n</ol>\n<p><img src=\"/img/SRI-T2.4.png\" alt=\"SRI-T2.4.png\"></p>\n<ol start=\"5\">\n<li>Entrega la URL de tu repositorio con el que est√°s trabajando.</li>\n</ol>\n<p><a href=\"https://github.com/alemd01/taller_ansible_vagrant/\">Github</a></p>\n<h1 id=\"taller-3%3A-vagrant---creaci%C3%B3n-de-una-m%C3%A1quina-virtual\" tabindex=\"-1\">Taller 3: Vagrant - Creaci√≥n de una m√°quina virtual</h1>\n<ol>\n<li>El fichero Vagrantfile con el que has trabajado.</li>\n</ol>\n<p>Subido el <a href=\"/files/Vagrantfile\">fichero</a></p>\n<ol start=\"2\">\n<li>Una captura de pantalla donde se vea la instrucci√≥n de creaci√≥n de la m√°quina y el acceso a la m√°quina virtual.</li>\n</ol>\n<p><img src=\"/img/SRI-T3.2.png\" alt=\"SRI-T3.2.png\"></p>\n<ol start=\"3\">\n<li>Capturas de pantallas donde se vean la memoria RAM y las CPU asignadas.</li>\n</ol>\n<p><img src=\"/img/SRI-T3.3.png\" alt=\"SRI-T3.3.png\"></p>\n<ol start=\"4\">\n<li>Captura de pantalla donde se vean la m√°quina KVM que se ha creado, la red que se ha creado y el volumen que est√° usando la m√°quina usa aprovisionamiento ligero.</li>\n</ol>\n<p><img src=\"/img/SRI-T3.4.png\" alt=\"SRI-T3.4.png\"></p>\n",
      "date_published": "2022-10-05T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/creacion-de-un-sistema-automatizado-de-instalacion./",
      "url": "https://reeseschultz.github.io/post/creacion-de-un-sistema-automatizado-de-instalacion./",
      "title": "Creaci√≥n de un sistema automatizado de instalaci√≥n.",
      "content_html": "<p><em>Instalaci√≥n automatizada basada en medio de almacenamiento extra√≠ble.</em></p>\n<p>Usaremos 7z para descomprimir la iso.</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\"><span class=\"token coord\">7z x /mnt/Archivos/ISOs/debian-10.6.0-amd64-xfce-CD-1.iso</span></code></pre>\n<p><img src=\"/img/ASO-P1.8.png\" alt=\"ASO-P1.8.png\"></p>\n<p>descomprimimos el initrd. Damos permisos a la carpeta que vamos a modificar, ponemos el preseed en el initrd, volvemos a comprimir y ponemos los permisos de antes</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\"><span class=\"token coord\">7z x initrd.gz</span><br>chmod +w -R install.amd/<br>echo preseed.cfg | cpio -H newc -o -A -F install.amd/initrd<br>gzip install.amd/initrd<br>chmod -w -R install.amd/</code></pre>\n<p>Regeneramos el md5sum.txt</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">chmod +w md5sum.txt<br>find -follow -type f ! -name md5sum.txt -print0 | xargs -0 md5sum > md5sum.txt<br>chmod -w md5sum.txt</code></pre>\n<p>Creamos una nueva iso booteable con el comando <em>genisoimage</em></p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">sudo genisoimage -r -J -b isolinux/isolinux.bin -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table -o ../debian-10.6.0-amd64-xfce-CD-1.iso </code></pre>\n<p>Ya tenemos la iso lista, ahora haremos una instalaci√≥n desatendida. Ponemos el disco con la iso e iniciamos la m√°quina. Le damos a <em>Advanced options</em>.\n<img src=\"/img/ASO-P1.9.png\" alt=\"imagen\"></p>\n<p>Ahora le damos a <em>Automated install</em> y empezar√° la instalaci√≥n\n<img src=\"/img/ASO-P1.10.png\" alt=\"imagen\"></p>\n<p>ponemos contrase√±a de root y del usuario(me da problemas en el preseed y he decidido ponerla antes de la instalaci√≥n).\n<img src=\"/img/ASO-P1.11.png\" alt=\"imagen\"></p>\n<p>Ahora empieza la instalaci√≥n desatendida.\n<img src=\"/img/ASO-P1.12.png\" alt=\"imagen\"></p>\n<p>Aqu√≠ muestro la salida del comando <em>df -h</em>\n<img src=\"/img/ASO-P1.14.png\" alt=\"imagen\"></p>\n",
      "date_published": "2022-10-05T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/instalacion-de-debian-11-en-el-equipo-de-trabajo/",
      "url": "https://reeseschultz.github.io/post/instalacion-de-debian-11-en-el-equipo-de-trabajo/",
      "title": "Instalaci√≥n de Debian 11 en el equipo de trabajo",
      "content_html": "<p>He instalado en mi equipo de trabajo debian 11 con lvm, a continuaci√≥n, explico de forma detallada como lo he instalado, configurado y los problemas e inconvenientes que me han surgido a lo largo de la instalaci√≥n. En mi equipo tengo 2 discos duros, un HDD de 1 Tb de capacidad y un SSD de 240 Gb, al poner lvm en mi equipo lo he estructurado de la siguiente manera:</p>\n<p>El SSD esta particionado por la mitad, y una partici√≥n est√° reservada para windows la otra partici√≥n la he usado como volumen f√≠sico. En el caso del disco duro es exactamente igual est√° particionado en 2, 500gb cada partici√≥n, una de ellas est√° reservada para los archivos y la otra la he usado como otro volumen f√≠sico. He hecho 2 vol√∫menes de grupo, uno por disco, para que no interfiera en el rendimiento del ssd. En el ssd puse 2 vol√∫menes l√≥gicos, uno la ra√≠z con 30 Gb y el otro volumen l√≥gico est√° el boot al que le di 1Gb.\nEn el HDD, tengo 2 particiones, una de ellas la he usado como volumen f√≠sico, he creado un grupo de vol√∫menes con este volumen f√≠sico y en el grupo de vol√∫menes he hecho 2 vol√∫menes l√≥gicos, uno de 100Gb en el que he puesto la raiz y otro volumen l√≥gico de 230Gb en el que he puesto el var.</p>\n<p>Una vez instalado el S.O he tenido los siguientes problemas con los drivers:\nLa tarjeta Wi-FI no me funcionaba, para solucionarlo hice el siguiente comando:</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">sudo apt install firmware-atheros</code></pre>\n<p>por √∫ltimo us√© este comando para instalar firmware de linux.</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">sudo apt-get install firmware-linux firmware-linux-free firmware-linux-nonfree firmware-misc-nonfree</code></pre>\n",
      "date_published": "2022-10-05T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/talleres-unidad-1-implantacion-aplicaciones-web./",
      "url": "https://reeseschultz.github.io/post/talleres-unidad-1-implantacion-aplicaciones-web./",
      "title": "Talleres unidad 1 Implantaci√≥n Aplicaciones Web.",
      "content_html": "<p>##TALLER 1: Introducci√≥n a git y GitHub</p>\n<ol>\n<li>Una captura de pantalla donde se vea que has creado el repositorio.</li>\n</ol>\n<p><img src=\"/img/TALLER1-IAW.png\" alt=\"TALLER1-IAW.png\"></p>\n<ol start=\"2\">\n<li>El contenido del fichero .git/config para que se vea que has clonado el repositorio con la URL ssh.</li>\n</ol>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">[core]<br>\trepositoryformatversion = 0<br>\tfilemode = true<br>\tbare = false<br>\tlogallrefupdates = true<br>[remote \"origin\"]<br>\turl = git@github.com:alemd01/2ASIR.git<br>\tfetch = +refs/heads/*:refs/remotes/origin/*<br>[branch \"main\"]<br>\tremote = origin<br>\tmerge = refs/heads/main</code></pre>\n<ol start=\"3\">\n<li>La salida de la instrucci√≥n git log para ver los commits que has realizado (debe aparecer como autor tu nombre completo).</li>\n</ol>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\">commit 421dec9a6988d91a1ac7c871ca9e4b042e803df7<br>Author: alemd01 &lt;aaleemd11@gmail.com><br>Date:   Mon Sep 19 10:28:31 2022 +0200<br><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span> He borrado el fichero prueba<span class=\"token punctuation\">.</span>txt<br></span><br>commit d584d99ece167dedc0b8b649471c11a453652d2b<br>Author: alemd01 &lt;aaleemd11@gmail.com><br>Date:   Mon Sep 19 10:27:57 2022 +0200<br><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span> He cambiado el nombre al fichero<br></span><br>commit 2793b586ee7a7d89184f7313ec4d92ced9f2c64a<br>Author: alemd01 &lt;aaleemd11@gmail.com><br>Date:   Mon Sep 19 10:26:59 2022 +0200<br><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span> He modificado el fichero prueba<span class=\"token punctuation\">.</span>txt<br></span><br>commit e6195890e08484aa86eb1fc9c7c93d8448328c33<br>Author: alemd01 &lt;aaleemd11@gmail.com><br>Date:   Mon Sep 19 10:17:13 2022 +0200<br><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span> He creado el fichero prueba<span class=\"token punctuation\">.</span>txt<br></span><br>commit 2093f3e2515054c1d7223d79b373c89526beebc4<br>Author: alemd01 &lt;78356101+alemd01@users.noreply.github.com><br>Date:   Mon Sep 19 10:15:13 2022 +0200<br><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span> Initial commit</code></pre>\n<ol start=\"4\">\n<li>buscar informaci√≥n para crear un nuevo repositorio llamado prueba2_tu_nombre. en esta ocasi√≥n, crea primero el repositorio local (usando git init) y luego busca informaci√≥n para sincronizarlo y crear el repositorio remoto en GitHub. Comenta los pasos que has realizado y manda alguna prueba de funcionamiento.\nPrimero hay que crear un repositorio en Github, despu√©s hay que crear un directorio en nuestra m√°quina local. Creamos por ejemplo el archivo README. Entramos en la carpeta y hacemos un git init.</li>\n</ol>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\"><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span>    mkdir prueba2_AlejandroMontes<br><span class=\"token prefix unchanged\"> </span><br><span class=\"token prefix unchanged\"> </span>    cd prueba2_AlejandroMontes<span class=\"token operator\">/</span><br></span><br><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span>    echo <span class=\"token string\">\"# prueba2_AlejandroMontes\"</span> <span class=\"token operator\">>></span> <span class=\"token constant\">README</span><span class=\"token punctuation\">.</span>md</code></pre>\n<p><img src=\"/img/taller1-2.png\" alt=\"taller1-2.png\"></p>\n<p>Una vez hecho esto, hacemos un git add y un commit.</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\"><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span>    git add <span class=\"token constant\">README</span><span class=\"token punctuation\">.</span>md<br></span><br><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span>    git commit <span class=\"token operator\">-</span>m <span class=\"token string\">\"primer commit\"</span></code></pre>\n<p><img src=\"/img/taller1-3.png\" alt=\"taller1-3.png\"></p>\n<p>Ahora usamos este comando</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\"><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span>    git branch <span class=\"token operator\">-</span><span class=\"token constant\">M</span> main</code></pre>\n<p>A continuaci√≥n, tenemos que hacer un git remote add origin</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\"><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span>    git remote add origin git@github<span class=\"token punctuation\">.</span>com<span class=\"token operator\">:</span>alemd01<span class=\"token operator\">/</span>prueba2_AlejandroMontes<span class=\"token punctuation\">.</span>git<br></span></code></pre>\n<p>por √∫ltimo hacemos un git push</p>\n<pre class=\"language-diff-js\"><code class=\"language-diff-js\"><span class=\"token unchanged language-js\"><span class=\"token prefix unchanged\"> </span>     git push <span class=\"token operator\">-</span>u origin main</code></pre>\n<p><img src=\"/img/taller1-4.png\" alt=\"taller1-4.png\"></p>\n",
      "date_published": "2022-10-05T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/copias-de-seguridad-en-distintos-sgbd./",
      "url": "https://reeseschultz.github.io/post/copias-de-seguridad-en-distintos-sgbd./",
      "title": "Copias de seguridad en distintos SGBD.",
      "content_html": "<h3 id=\"1.-realiza-una-copia-de-seguridad-l%C3%B3gica-de-tu-base-de-datos-completa%2C-teniendo-en-cuenta-los-siguientes-requisitos%3A\" tabindex=\"-1\">1. Realiza una copia de seguridad l√≥gica de tu base de datos completa, teniendo en cuenta los siguientes requisitos:</h3>\n<ul>\n<li><strong>La copia debe estar encriptada y comprimida.</strong></li>\n<li><strong>Debe realizarse en un conjunto de ficheros con un tama√±o m√°ximo de 60 MB.</strong></li>\n<li><strong>Programa la operaci√≥n para que se repita cada d√≠a a una hora determinada.</strong></li>\n</ul>\n<p>Para la correcta resoluci√≥n del ejercicio, he creado un trabajo en el scheduler de oracle que se ejecuta todos los d√≠as y realiza una copia de seguridad compimida y encriptada y de m√°ximo de 60MB, para ello, he tenido que crear un procedimiento que crea el trabajo:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">BEGIN<br>DBMS_SCHEDULER.create_job (<br>job_name => 'Export_db',<br>job_type => 'executable',<br>job_action => 'expdp SYSTEM/usuario directory=BD_EXPORT dumpfile=bkdb_$(date +%d-%m-%Y).dmp encryption=all compression=all filesize=60M encryption_password=usuario',<br>start_date => SYSDATE,<br>repeat_interval => 'FREQ=DAILY; BYHOUR=13; BYMINUTE=10',<br>end_date => NULL,<br>enabled => TRUE,<br>comments => 'export_db_DAILY');<br>END;<br>/</code></pre>\n<p>Este procedimiento ejecuta el comando que se encuentra en <code>job_action</code> empezando hoy con una frecuencia diaria indicando que la hora del backup es a las 13 y 10. A continuaci√≥n muestro una consulta de la tabla donde se almacenan todos los trabajos del scheduler que muestra el nombre del trabajo y el intervalo de repetici√≥n:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT JOB_NAME, REPEAT_INTERVAL FROM ALL_SCHEDULER_JOBS WHERE JOB_NAME = 'EXPORT_DB';<br><br>JOB_NAME<br>--------------------------------------------------------------------------------<br>REPEAT_INTERVAL<br>--------------------------------------------------------------------------------<br>EXPORT_DB<br>FREQ=DAILY; BYHOUR=13; BYMINUTE=10<br></code></pre>\n<h3 id=\"2.-restaura-la-copia-de-seguridad-l%C3%B3gica-creada-en-el-punto-anterior.\" tabindex=\"-1\">2. Restaura la copia de seguridad l√≥gica creada en el punto anterior.</h3>\n<h3 id=\"3.-pon-tu-base-de-datos-en-modo-archivelog-y-realiza-con-rman-una-copia-de-seguridad-f%C3%ADsica-en-caliente.\" tabindex=\"-1\">3. Pon tu base de datos en modo ArchiveLog y realiza con RMAN una copia de seguridad f√≠sica en caliente.</h3>\n<p>Primero comprobaremos que nuestra base de datos no est√° en modo archive log, para ello ejecutaremos el siguiente comando:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> ARCHIVE LOG LIST<br>Modo log de la base de datos\t\t  Modo de No Archivado<br>Archivado automatico\t\t Desactivado<br>Destino del archivo\t       /opt/oracle/product/19c/dbhome_1/dbs/arch<br>Secuencia de log en linea mas antigua\t  139<br>Secuencia de log actual \t  141</code></pre>\n<p>Como nos indica el modo log no est√° activado. Para activarlo tenemos que apagar la base de datos, arrancarla en modo mount, activar el modo archivelog y abrir la base de datos. A continuaci√≥n dejo la secuencia de comandos completa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> shutdown immediate<br>Base de datos cerrada.<br>Base de datos desmontada.<br>Instancia ORACLE cerrada.<br>SQL> startup mount;<br>Instancia ORACLE iniciada.<br><br>Total System Global Area 3573545736 bytes<br>Fixed Size\t\t    9141000 bytes<br>Variable Size\t\t  973078528 bytes<br>Database Buffers\t 2583691264 bytes<br>Redo Buffers\t\t    7634944 bytes<br>Base de datos montada.<br>SQL> alter database archivelog;<br><br>Base de datos modificada.<br><br>SQL> alter database open;<br><br>Base de datos modificada.<br></code></pre>\n<p>Ahora volvemos a comprobar que se ha activado correctamente el modo archivelog:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> archive log list<br>Modo log de la base de datos\t\t  Modo de Archivado<br>Archivado automatico\t\t Activado<br>Destino del archivo\t       /opt/oracle/product/19c/dbhome_1/dbs/arch<br>Secuencia de log en linea mas antigua\t  139<br>Siguiente secuencia de log para archivar   141<br>Secuencia de log actual \t  141</code></pre>\n<p>Ahora procederemos a crear un cat√°logo de RMAN, con esta estrategia crearemos un repositorio de informaci√≥n, un tablespace con un usuario y haremos que toda la informaci√≥n para gestionar copias se guarde all√≠ y la maneje el usuario creado. Ahora crearemos el tablespace y el usuario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> CREATE TABLESPACE TS_RMAN DATAFILE '/opt/oracle/oradata/ORCLCDB/TS_RAMN.dbf' SIZE 300M;<br><br>Tablespace creado.<br><br>SQL> CREATE USER USUARIO_RMAN IDENTIFIED BY usuario DEFAULT TABLESPACE TS_RMAN QUOTA UNLIMITED ON TS_RMAN;<br><br>Usuario creado.<br></code></pre>\n<p>Le damos privilegios al usuario creado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> GRANT RECOVERY_CATALOG_OWNER TO USUARIO_RMAN;<br><br>Concesion terminada correctamente.<br><br>SQL> GRANT CONNECT, RESOURCE TO USUARIO_RMAN;<br><br>Concesion terminada correctamente.<br><br></code></pre>\n<p>Ahora nos conectamos con el usuario que hemos creado a RMAN:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ rman<br><br>Recovery Manager: Release 19.0.0.0.0 - Production on Fri Mar 3 17:05:19 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>RMAN> CONNECT CATALOG USUARIO_RMAN<br><br>recovery catalog database Password: <br>connected to recovery catalog database<br><br>RMAN> <br><br></code></pre>\n<p>Creamos un cat√°logo en el tablespace que hemos creado anteriormente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">RMAN> CREATE CATALOG TABLESPACE TS_RMAN;<br><br>recovery catalog created<br></code></pre>\n<p>Ahora nos saldremos y nos conectaremos con nuestro usuario:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ rman target=/ catalog USUARIO_RMAN<br><br>Recovery Manager: Release 19.0.0.0.0 - Production on Fri Mar 3 17:10:37 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>connected to target database: ORCLCDB (DBID=2889830663)<br>recovery catalog database Password: <br>connected to recovery catalog database<br><br>RMAN> <br></code></pre>\n<p>Ahora registramos nuestra base de datos:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">RMAN> REGISTER DATABASE;<br><br>database registered in recovery catalog<br>starting full resync of recovery catalog<br>full resync complete<br></code></pre>\n<p>Ya tendr√≠amos nuestra base de datos registrada y preparada. Ahora nos queda lanzar una copia de seguridad:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">RMAN> BACKUP DATABASE;<br><br>Starting backup at 03-MAR-23<br>allocated channel: ORA_DISK_1<br>channel ORA_DISK_1: SID=147 device type=DISK<br>channel ORA_DISK_1: starting full datafile backup set<br>channel ORA_DISK_1: specifying datafile(s) in backup set<br>input datafile file number=00004 name=/opt/oracle/oradata/ORCLCDB/undotbs01.dbf<br>input datafile file number=00007 name=/opt/oracle/oradata/ORCLCDB/users01.dbf<br>input datafile file number=00003 name=/opt/oracle/oradata/ORCLCDB/sysaux01.dbf<br>input datafile file number=00001 name=/opt/oracle/oradata/ORCLCDB/system01.dbf<br>input datafile file number=00019 name=/opt/oracle/oradata/ORCLCDB/TS_RAMN.dbf<br>input datafile file number=00018 name=/opt/oracle/product/19c/dbhome_1/dbs/index.dbf<br>input datafile file number=00017 name=/opt/oracle/product/19c/dbhome_1/dbs/ts1.dbf<br>input datafile file number=00014 name=/opt/oracle/oradata/ORCLCDB/ts2.dbf<br>input datafile file number=00015 name=/opt/oracle/oradata/ts2.dbf<br>channel ORA_DISK_1: starting piece 1 at 03-MAR-23<br>channel ORA_DISK_1: finished piece 1 at 03-MAR-23<br>piece handle=/opt/oracle/product/19c/dbhome_1/dbs/021m4n1b_1_1 tag=TAG20230303T171314 comment=NONE<br>channel ORA_DISK_1: backup set complete, elapsed time: 00:00:35<br>channel ORA_DISK_1: starting full datafile backup set<br>channel ORA_DISK_1: specifying datafile(s) in backup set<br>input datafile file number=00010 name=/opt/oracle/oradata/ORCLCDB/ORCLPDB1/sysaux01.dbf<br>input datafile file number=00009 name=/opt/oracle/oradata/ORCLCDB/ORCLPDB1/system01.dbf<br>input datafile file number=00011 name=/opt/oracle/oradata/ORCLCDB/ORCLPDB1/undotbs01.dbf<br>input datafile file number=00012 name=/opt/oracle/oradata/ORCLCDB/ORCLPDB1/users01.dbf<br>channel ORA_DISK_1: starting piece 1 at 03-MAR-23<br>channel ORA_DISK_1: finished piece 1 at 03-MAR-23<br>piece handle=/opt/oracle/product/19c/dbhome_1/dbs/031m4n2f_1_1 tag=TAG20230303T171314 comment=NONE<br>channel ORA_DISK_1: backup set complete, elapsed time: 00:00:07<br>channel ORA_DISK_1: starting full datafile backup set<br>channel ORA_DISK_1: specifying datafile(s) in backup set<br>input datafile file number=00006 name=/opt/oracle/oradata/ORCLCDB/pdbseed/sysaux01.dbf<br>input datafile file number=00005 name=/opt/oracle/oradata/ORCLCDB/pdbseed/system01.dbf<br>input datafile file number=00008 name=/opt/oracle/oradata/ORCLCDB/pdbseed/undotbs01.dbf<br>channel ORA_DISK_1: starting piece 1 at 03-MAR-23<br>channel ORA_DISK_1: finished piece 1 at 03-MAR-23<br>piece handle=/opt/oracle/product/19c/dbhome_1/dbs/041m4n2m_1_1 tag=TAG20230303T171314 comment=NONE<br>channel ORA_DISK_1: backup set complete, elapsed time: 00:00:07<br>Finished backup at 03-MAR-23<br><br>Starting Control File and SPFILE Autobackup at 03-MAR-23<br>piece handle=/opt/oracle/product/19c/dbhome_1/dbs/c-2889830663-20230303-01 comment=NONE<br>Finished Control File and SPFILE Autobackup at 03-MAR-23<br><br></code></pre>\n<p>Y una vez finalizado ya habr√≠amos hecho la copia de seguridad en caliente con RMAN.</p>\n<h3 id=\"4.-borra-un-fichero-de-datos-de-un-tablespace-e-intenta-recuperar-la-instancia-de-la-base-de-datos-a-partir-de-la-copia-de-seguridad-creada-en-el-punto-anterior.\" tabindex=\"-1\">4. Borra un fichero de datos de un tablespace e intenta recuperar la instancia de la base de datos a partir de la copia de seguridad creada en el punto anterior.</h3>\n<p>He decidido borrar el fichero del tablespace USERS, para ello ejecutar√© una consulta que me mostrar√° la ruta del fichero de dicho tablespace:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> SELECT FILE_NAME FROM DBA_DATA_FILES WHERE TABLESPACE_NAME = 'USERS';<br><br>FILE_NAME<br>--------------------------------------------------------------------------------<br>/opt/oracle/oradata/ORCLCDB/users01.dbf<br><br></code></pre>\n<p>En nuestra terminal, como root, ejecutamos lo siguiente:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@debian:~# rm /opt/oracle/oradata/ORCLCDB/users01.dbf<br>root@debian:~# ls /opt/oracle/oradata/ORCLCDB/<br>control01.ctl  pdbseed\t   redo03.log\t temp01.dbf   undotbs01.dbf<br>control02.ctl  redo01.log  sysaux01.dbf  ts2.dbf<br>ORCLPDB1       redo02.log  system01.dbf  TS_RAMN.dbf</code></pre>\n<p>Ya hemos borrado el fichero del tablespace, para ello me conectar√© a un usuario con ese tablespace y veremos que da error:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> select * from emp;<br>select * from emp<br>              *<br>ERROR en linea 1:<br>ORA-01116: error al abrir el archivo de base de datos 7<br>ORA-01110: archivo de datos 7: '/opt/oracle/oradata/ORCLCDB/users01.dbf'<br>ORA-27041: no se ha podido abrir el archivo<br>Linux-x86_64 Error: 2: No such file or directory<br>Additional information: 3<br></code></pre>\n<p>Ahora nos conectamos con nuestro usuario a RMAN:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ rman target=/ catalog USUARIO_RMAN<br><br>Recovery Manager: Release 19.0.0.0.0 - Production on Fri Mar 3 17:56:57 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>connected to target database: ORCLCDB (DBID=2889830663)<br>recovery catalog database Password: <br>connected to recovery catalog database<br><br>RMAN> <br></code></pre>\n<p>Desactivamos el tablespace:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">RMAN> SQL \"ALTER TABLESPACE USERS OFFLINE IMMEDIATE\";<br><br>sql statement: ALTER TABLESPACE USERS OFFLINE IMMEDIATE<br></code></pre>\n<p>Ahora, restauramos el fichero:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">RMAN> RESTORE TABLESPACE USERS;<br><br>Starting restore at 03-MAR-23<br>allocated channel: ORA_DISK_1<br>channel ORA_DISK_1: SID=261 device type=DISK<br><br>channel ORA_DISK_1: starting datafile backup set restore<br>channel ORA_DISK_1: specifying datafile(s) to restore from backup set<br>channel ORA_DISK_1: restoring datafile 00007 to /opt/oracle/oradata/ORCLCDB/users01.dbf<br>channel ORA_DISK_1: reading from backup piece /opt/oracle/product/19c/dbhome_1/dbs/021m4n1b_1_1<br>channel ORA_DISK_1: piece handle=/opt/oracle/product/19c/dbhome_1/dbs/021m4n1b_1_1 tag=TAG20230303T171314<br>channel ORA_DISK_1: restored backup piece 1<br>channel ORA_DISK_1: restore complete, elapsed time: 00:00:15<br>Finished restore at 03-MAR-23<br></code></pre>\n<p>Lo recuperamos y lo volvemos a activar:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">RMAN> RECOVER TABLESPACE USERS;<br><br>Starting recover at 03-MAR-23<br>using channel ORA_DISK_1<br><br>starting media recovery<br>media recovery complete, elapsed time: 00:00:00<br><br>Finished recover at 03-MAR-23<br><br>RMAN> SQL \"ALTER TABLESPACE USERS ONLINE\";<br><br>sql statement: ALTER TABLESPACE USERS ONLINE<br></code></pre>\n<p>Para verificar que se ha realizado correctamente, me conectar√© de nuevo al usuario SCOTT y realizar√© la misma consulta:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ sqlplus SCOTT/TIGER<br><br>SQL*Plus: Release 19.0.0.0.0 - Production on Fri Mar 3 18:01:22 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle.  All rights reserved.<br><br>Hora de Ultima Conexion Correcta: Vie Mar 03 2023 17:55:53 +01:00<br><br>Conectado a:<br>Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production<br>Version 19.3.0.0.0<br><br>SQL> SELECT * FROM DEPT;<br><br>    DEPTNO DNAME\t  LOC<br>---------- -------------- -------------<br>\t10 ACCOUNTING\t  NEW YORK<br>\t20 RESEARCH\t  DALLAS<br>\t30 SALES\t  CHICAGO<br>\t40 OPERATIONS\t  BOSTON<br></code></pre>\n<h3 id=\"5.-borra-un-fichero-de-control-e-intenta-recuperar-la-base-de-datos-a-partir-de-la-copia-de-seguridad-creada-en-el-punto-anterior.\" tabindex=\"-1\">5. Borra un fichero de control e intenta recuperar la base de datos a partir de la copia de seguridad creada en el punto anterior.</h3>\n<p>Ahora borraremos un fichero de control y procederemos a restaurar la base de datos completa:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">root@debian:/opt/oracle/oradata/ORCLCDB# rm control01.ctl <br>root@debian:/opt/oracle/oradata/ORCLCDB# rm control02.ctl </code></pre>\n<p>Forzamos el apagado:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> shutdown abort<br>Instancia ORACLE cerrada.</code></pre>\n<p>Le ponemos el modo no montada:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">SQL> startup nomount<br>Instancia ORACLE iniciada.<br><br>Total System Global Area 3573545736 bytes<br>Fixed Size\t\t    9141000 bytes<br>Variable Size\t\t  973078528 bytes<br>Database Buffers\t 2583691264 bytes<br>Redo Buffers\t\t    7634944 bytes</code></pre>\n<p>Ahora entramos en RMAN:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\">alemd@debian:~$ rman target=/ catalog USUARIO_RMAN<br><br>Recovery Manager: Release 19.0.0.0.0 - Production on Sat Mar 4 11:52:40 2023<br>Version 19.3.0.0.0<br><br>Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.<br><br>connected to target database: ORCLCDB (not mounted)<br>recovery catalog database Password: <br>RMAN-00571: ===========================================================<br>RMAN-00569: =============== ERROR MESSAGE STACK FOLLOWS ===============<br>RMAN-00571: ===========================================================<br>RMAN-00554: initialization of internal recovery manager package failed<br>RMAN-04004: error from recovery catalog database: ORA-01033: inicializacion o cierre de ORACLE en curso</code></pre>\n<p>Como vemos se ha borrado el fichero de control donde se encontraba nuestro cat√°logo. Tenemos que decirle a RMAN que restaure los controlfile desde los ficheros de la copia de seguridad:</p>\n<pre class=\"language-txt\"><code class=\"language-txt\"></code></pre>\n<h3 id=\"6.-documenta-el-empleo-de-las-herramientas-de-copia-de-seguridad-y-restauraci%C3%B3n-de-postgres.\" tabindex=\"-1\">6. Documenta el empleo de las herramientas de copia de seguridad y restauraci√≥n de Postgres.</h3>\n<h3 id=\"7.-documenta-el-empleo-de-las-herramientas-de-copia-de-seguridad-y-restauraci%C3%B3n-de-mysql.\" tabindex=\"-1\">7. Documenta el empleo de las herramientas de copia de seguridad y restauraci√≥n de MySQL.</h3>\n<h3 id=\"8.-documenta-el-empleo-de-las-herramientas-de-copia-de-seguridad-y-restauraci%C3%B3n-de-mongodb.\" tabindex=\"-1\">8. Documenta el empleo de las herramientas de copia de seguridad y restauraci√≥n de MongoDB.</h3>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-01-03T00:00:00Z"
    },{
      "id": "https://reeseschultz.github.io/post/sistema-de-copias-de-seguridad./",
      "url": "https://reeseschultz.github.io/post/sistema-de-copias-de-seguridad./",
      "title": "Sistema de copias de seguridad.",
      "content_html": "<p>Implementar un sistema de copias de seguridad para las instancias del cloud, teniendo en cuenta las siguientes caracter√≠sticas:</p>\n<ul>\n<li>Selecciona una aplicaci√≥n para realizar el proceso: bacula, amanda, shell script con tar, rsync, dar, afio, etc.</li>\n<li>Utiliza una de las instancias como servidor de copias de seguridad, a√±adi√©ndole un volumen y almacenando localmente las copias de seguridad que consideres adecuadas en √©l.</li>\n<li>El proceso debe realizarse de forma completamente autom√°tica</li>\n<li>Selecciona qu√© informaci√≥n es necesaria guardar (listado de paquetes, ficheros de configuraci√≥n, documentos, datos, etc.)</li>\n<li>Realiza semanalmente una copia completa</li>\n<li>Realiza diariamente una copia incremental o diferencial (decidir cual es m√°s adecuada)</li>\n<li>Implementa una planificaci√≥n del almacenamiento de copias de seguridad para una ejecuci√≥n prevista de varios a√±os, detallando qu√© copias completas se almacenar√°n de forma permanente y cuales se ir√°n borrando</li>\n<li>Selecciona un directorio de datos ‚Äúcr√≠ticos‚Äù que deber√° almacenarse cifrado en la copia de seguridad, bien encarg√°ndote de hacer la copia manualmente o incluyendo la contrase√±a de cifrado en el sistema</li>\n<li>Incluye en la copia los datos de las nuevas aplicaciones que se vayan instalando durante el resto del curso</li>\n<li>Utiliza una ubicaci√≥n secundaria para almacenar las copias de seguridad. Solicita acceso o la instalaci√≥n de las aplicaciones que sean precisas.\nLa correcci√≥n consistir√° tanto en la restauraci√≥n puntual de un fichero en cualquier fecha como la restauraci√≥n completa de una de las instancias la √∫ltima semana de curso.</li>\n</ul>\n<hr>\n<hr>\n<h2 id=\"documento-realizado-por%3A\" tabindex=\"-1\"><strong>Documento realizado por:</strong></h2>\n<p>‚úíÔ∏è <strong>Alejandro Montes Delgado</strong> - <em>2¬∫ ASIR</em></p>\n",
      "date_published": "2022-01-03T00:00:00Z"
    }
  ]
}