<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    
    <meta itemprop="name" content="Configurar servidor VPN en OpenVPN y WireGuard. | Cutreblog">
    <meta itemprop="description" content="En esta práctica veremos como configurar servidores VPN.">

    
    <meta name="twitter:title" content="Configurar servidor VPN en OpenVPN y WireGuard. | Cutreblog">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:description" content="En esta práctica veremos como configurar servidores VPN.">
    <meta name="twitter:site" content="@ReeseCodes">
    <meta name="twitter:creator" content="@ReeseCodes">
    <meta name="twitter:image:src" content="https://reeseschultz.github.io/twitter.jpg">

    
    <meta name="og:title" content="Configurar servidor VPN en OpenVPN y WireGuard. | Cutreblog">
    <meta name="og:description" content="En esta práctica veremos como configurar servidores VPN.">
    <meta name="og:image" content="https://reeseschultz.github.io/og.jpg">
    <meta name="og:url" content="https://reeseschultz.github.io/">
    <meta name="og:site_name" content="Cutreblog">
    <meta name="og:locale" content="en_GB">
    <meta name="og:type" content="website">

    <link rel="icon" type="image/x-icon" href="/logo.png" />

    <title>Configurar servidor VPN en OpenVPN y WireGuard. | Cutreblog</title>

    <link rel="stylesheet" href="/assets/main.bundle.css">

    
  </head>
  <body class="flex flex-col min-h-screen">
    <header>
  <nav class="container mx-auto max-w-3xl px-8 pt-2 flex flex-wrap justify-between">
    <div>
      <h1>
        <a href="/">Cutreblog</a>
      </h1>
      <p>Blog de Alejandro Montes</p>
    </div>

    <ul class="flex flex-wrap sm:w-32 w-full mt-6 md:justify-between justify-evenly">
      <li>
        <a href="/404.html">404</a>
      </li>

      <li>
        <a href="/about">About</a>
      </li>
    </ul>
  </nav>
</header>
    <main class="container mx-auto max-w-3xl p-8 grow">
      
    <p></p>
    <div>
        <h2>Configurar servidor VPN en OpenVPN y WireGuard.</h2>

        
            <p class="excerpt">En esta práctica veremos como configurar servidores VPN.</p>
        

        
            <div class="mb-2">
                <a class="tag SAD" href="/tag/SAD">SAD</a>
            </div>
        

        
            
                <p class="text-sm italic">Creado en
                    <span datetime="Tue Jan 10 2023 01:00:00 GMT+0100 (hora estándar de Europa central)">January 10, 2023</span>.</p>
            
        

        <div class="content post">
            
                <hr />

                <h3>Tabla de Contenido.</h3>

                <nav class="toc">
                <ol>
                    
                    <li><a href="#openvpn">OpenVPN</a>
            
                <ol>
                    
                    <li><a href="#1.1.-vpn-de-acceso-remoto-con-openvpn-y-certificados-x509.-(5-puntos)">1.1. VPN de acceso remoto con OpenVPN y certificados x509. (5 puntos)</a>
            
                <ol>
                    
                    <li><a href="#configuraci%C3%B3n-del-servidor.">Configuración del servidor.</a>
            		</li>

                    <li><a href="#configuraci%C3%B3n-del-cliente-vpn.">Configuración del cliente VPN.</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#1.2.-vpn-sitio-a-sitio-con-openvpn-y-certificados-x509.-(10-puntos)">1.2. VPN sitio a sitio con OpenVPN y certificados x509. (10 puntos)</a>
            		</li>
                </ol>
            		</li>

                    <li><a href="#wireguard">WireGuard</a>
            
                <ol>
                    
                    <li><a href="#2.1.-vpn-de-acceso-remoto-con-wireguard.-(5-puntos)">2.1. VPN de acceso remoto con WireGuard. (5 puntos)</a>
            		</li>

                    <li><a href="#2.2.-vpn-sitio-a-sitio-con-wireguard.-(10-puntos)">2.2. VPN sitio a sitio con WireGuard. (10 puntos)</a>
            		</li>
                </ol>
            		</li>
                </ol>
            </nav>

                <hr />
            

            <h3 id="openvpn" tabindex="-1">OpenVPN</h3>
<h4 id="1.1.-vpn-de-acceso-remoto-con-openvpn-y-certificados-x509.-(5-puntos)" tabindex="-1">1.1. VPN de acceso remoto con OpenVPN y certificados x509. (5 puntos)</h4>
<p><strong>Configura una conexión VPN de acceso remoto entre dos equipos del cloud:</strong></p>
<ul>
<li><strong>Uno de los dos equipos (el que actuará como servidor) estará conectado a dos redes</strong></li>
<li><strong>Para la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con  los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación.</strong></li>
<li><strong>Se utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN. La dirección 10.99.99.1 se asignará al servidor VPN.</strong></li>
<li><strong>Los ficheros de configuración del servidor y del cliente se crearán en el directorio /etc/openvpn de cada máquina, y se llamarán servidor.conf y cliente.conf respectivamente.</strong></li>
<li><strong>Tras el establecimiento de la VPN, la máquina cliente debe ser capaz de acceder a una máquina que esté en la otra red a la que está conectado el servidor.</strong>
<strong>Documenta el proceso detalladamente.</strong></li>
</ul>
<p>Antes que nada, tendremos que tener un escenario donde realizaremos la práctica. Crearé dos instancias en OpenStack, y el equipo servidor estará conectado a 2 redes distintas.</p>
<p><img src="/img/SAD-P6.1.png" alt="SAD-P6.1.png"></p>
<p>Una vez creado el escenario, empezaremos con la práctica.</p>
<h5 id="configuraci%C3%B3n-del-servidor." tabindex="-1">Configuración del servidor.</h5>
<p>Lo primero que haremos será instalar openvpn.</p>
<p><img src="/img/SAD-P6.2.png" alt="SAD-P6.2.png"></p>
<p>Ahora, activaremos el bit de forwarding en el servidor.</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:~$  nano /etc/sysctl.conf</code></pre>
<p>editamos la siguiente línea:</p>
<pre class="language-txt"><code class="language-txt"># Uncomment the next line to enable packet forwarding for IPv4<br>net.ipv4.ip_forward=1</code></pre>
<p>Por precaución, copiaremos la configuración que se encuentra en <code>/usr/share/easy-rsa</code> a <code>/etc/openvpn</code> para evitar que en una próxima actualización del paquete sobreescriba los cambios que hagamos:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:~$  cp -r /usr/share/easy-rsa /etc/openvpn</code></pre>
<p>Ahora dentro del directorio <code>/etc/openvpn/easy-rsa/</code>, ejecutaremos el siguiente script para inicializar el directorio PKI:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa init-pki<br><br>init-pki complete; you may now create a CA or requests.<br>Your newly created PKI dir is: /etc/openvpn/easy-rsa/pki<br><br><br></code></pre>
<p>A continuación, vamos a generar el certificado de la CA y la clave con la que firmaremos los certificados. Tendremos que introducir una contraseña para el certificado y un nombre para la autoridad certificadora.</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa build-ca<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br><br>Enter New CA Key Passphrase: <br>Re-Enter New CA Key Passphrase: <br>Generating RSA private key, 2048 bit long modulus (2 primes)<br>..............+++++<br>................................+++++<br>e is 65537 (0x010001)<br>You are about to be asked to enter information that will be incorporated<br>into your certificate request.<br>What you are about to enter is what is called a Distinguished Name or a DN.<br>There are quite a few fields but you can leave some blank<br>For some fields there will be a default value,<br>If you enter '.', the field will be left blank.<br>-----<br>Common Name (eg: your user, host, or server name) [Easy-RSA CA]:alejandro-montes<br><br>CA creation complete and you may now import and sign cert requests.<br>Your new CA certificate file for publishing is at:<br>/etc/openvpn/easy-rsa/pki/ca.crt</code></pre>
<p>Como indica la salida del comando, el certificado se ha generado en la ruta <code>/etc/openvpn/easy-rsa/pki/ca.crt</code> mientras que la clave privada se encuentra en <code>/etc/openvpn/easy-rsa/pki/private/ca.key</code>. Ahora tendremos que generar los parámetros Diffie-Hellman, los cuáles se usan para el intercambio de claves entre el servidor de openvpn y los clientes.</p>
<p><img src="/img/SAD-P6.3.png" alt="SAD-P6.3.png"></p>
<p>El archivo ha sido generado en el directorio <code>/etc/openvpn/easy-rsa/pki/dh.pem</code>.</p>
<p>Ahora generaremos el certificado y la clave privada del servidor openvpn:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa build-server-full server nopass<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br>Generating a RSA private key<br>.........................+++++<br>.......................+++++<br>writing new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-22061.NS9Bww/tmp.gmhUC5'<br>-----<br>Using configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-22061.NS9Bww/tmp.xcbWer<br>Enter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject's Distinguished Name is as follows<br>commonName            :ASN.1 12:'server'<br>Certificate is to be certified until Apr 17 11:03:08 2025 GMT (825 days)<br><br>Write out database with 1 new entries<br>Data Base Updated</code></pre>
<p>El certificado ha sido guardado en la ruta <code>/etc/openvpn/easy-rsa/pki/issued/server.crt</code> y la clave privada se ha generado en <code>/etc/openvpn/easy-rsa/pki/private/server.key</code>. La opción nopass es para deshabilitar la frase de paso.</p>
<p>Una vez hecho esto, generaremos el certificado y la clave privada del cliente de la vpn:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/etc/openvpn/easy-rsa# ./easyrsa build-client-full cliente-vpn nopass<br>Using SSL: openssl OpenSSL 1.1.1n  15 Mar 2022<br>Generating a RSA private key<br>.................................+++++<br>..........+++++<br>writing new private key to '/etc/openvpn/easy-rsa/pki/easy-rsa-22138.MZyJbQ/tmp.MWGIDo'<br>-----<br>Using configuration from /etc/openvpn/easy-rsa/pki/easy-rsa-22138.MZyJbQ/tmp.1G19BJ<br>Enter pass phrase for /etc/openvpn/easy-rsa/pki/private/ca.key:<br>Check that the request matches the signature<br>Signature ok<br>The Subject's Distinguished Name is as follows<br>commonName            :ASN.1 12:'cliente-vpn'<br>Certificate is to be certified until Apr 17 11:06:42 2025 GMT (825 days)<br><br>Write out database with 1 new entries<br>Data Base Updated<br><br></code></pre>
<p>El certificado esta generado en <code>etc/openvpn/easy-rsa/pki/issued/Clientevpn1.crt</code> y la clave privada en <code>/etc/openvpn/easy-rsa/pki/private/Clientevpn1.key</code>.</p>
<p>Ahora pasaremos al cliente los ficheros necesarios. Para ello, primero en el servidor crearemos una carpeta con los ficheros del cliente vpn y posteriormente lo pasaremos al cliente por scp mediante mi máquina local:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/etc/openvpn/easy-rsa# mkdir /home/debian/cliente-vpn<br>root@servidor-vpn:/etc/openvpn/easy-rsa# cp -rp /etc/openvpn/easy-rsa/pki/{ca.crt,issued/cliente-vpn.crt,private/cliente-vpn.key} /home/debian/cliente-vpn/<br>root@servidor-vpn:/etc/openvpn/easy-rsa# chown debian: /home/debian/cliente-vpn/<br>alemd@172.22.0.161's password: <br>cliente-vpn.key                           100% 1704   201.0KB/s   00:00    <br>ca.crt                                    100% 1224   138.4KB/s   00:00    <br>cliente-vpn.crt                           100% 4525   325.1KB/s   00:00   <br><br><br>alemd@debian:~$ scp -r cliente-vpn/ debian@172.22.201.177:<br>cliente-vpn.key                           100% 1704   125.8KB/s   00:00    <br>ca.crt                                    100% 1224     5.1KB/s   00:00    <br>cliente-vpn.crt                           100% 4525   329.6KB/s   00:00  </code></pre>
<p>Una vez hecho esto, desde el lado del servidor aún, crearemos el archivo de configuración del tunel que crearemos a partir del fichero de ejemplo:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/home/debian# cp /usr/share/doc/openvpn/examples/sample-config-files/server.conf /etc/openvpn/server/servidor.conf</code></pre>
<p>Lo editamos y el resultado es el siguiente:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/home/debian# nano /etc/openvpn/server/servidor.conf</code></pre>
<pre class="language-txt"><code class="language-txt"><br>port 1194<br>proto udp<br>dev tun<br><br>ca /etc/openvpn/easy-rsa/pki/ca.crt<br>cert /etc/openvpn/easy-rsa/pki/issued/server.crt<br>key /etc/openvpn/easy-rsa/pki/private/server.key  # This file should be kept<br> secret<br>dh  /etc/openvpn/easy-rsa/pki/dh.pem<br><br>topology subnet<br><br>server 10.100.200.0 255.255.255.0<br>ifconfig-pool-persist /var/log/openvpn/ipp.txt<br><br>push "route 192.168.100.0 255.255.255.0"<br><br>keepalive 10 120<br>cipher AES-256-CBC<br>persist-key<br>persist-tun<br>status /var/log/openvpn/openvpn-status.log<br>verb 3<br><br>explicit-exit-notify 1</code></pre>
<p>Ahora que hemos terminado de crear el fichero de configuración, habilitaremos el servicio:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/home/debian# systemctl enable --now openvpn-server@servidor<br>Created symlink /etc/systemd/system/multi-user.target.wants/openvpn-server@servidor.service → /lib/systemd/system/openvpn-server@.service.</code></pre>
<p>Muestro el estado del servicio:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/home/debian# systemctl status openvpn-server@servidor<br><br>● openvpn-server@servidor.service - OpenVPN service for servidor<br>     Loaded: loaded (/lib/systemd/system/openvpn-server@.service; enabled; vendor preset: enabled)<br>     Active: active (running) since Fri 2023-01-13 11:37:51 UTC; 1min 8s ago<br>       Docs: man:openvpn(8)<br>             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage<br>             https://community.openvpn.net/openvpn/wiki/HOWTO<br>   Main PID: 22260 (openvpn)<br>     Status: "Initialization Sequence Completed"<br>      Tasks: 1 (limit: 527)<br>     Memory: 988.0K<br>        CPU: 14ms<br>     CGroup: /system.slice/system-openvpn\x2dserver.slice/openvpn-server@servidor.service<br>             └─22260 /usr/sbin/openvpn --status /run/openvpn-server/status-servidor.log --status-version 2 --suppress-timestamps --config servidor.conf<br><br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: net_iface_up: set tun0 up<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: net_addr_v4_add: 10.100.200.1/24 dev tun0<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: Could not determine IPv4/IPv6 protocol. Using AF_INET<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: Socket Buffers: R=[212992->212992] S=[212992->212992]<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: UDPv4 link local (bound): [AF_INET][undef]:1194<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: UDPv4 link remote: [AF_UNSPEC]<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: MULTI: multi_init called, r=256 v=256<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: IFCONFIG POOL IPv4: base=10.100.200.2 size=252<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: IFCONFIG POOL LIST<br>Jan 13 11:37:51 servidor-vpn openvpn[22260]: Initialization Sequence Completed<br></code></pre>
<h5 id="configuraci%C3%B3n-del-cliente-vpn." tabindex="-1">Configuración del cliente VPN.</h5>
<p>Ahora tomaremos el control del cliente e instalaremos openvpn:</p>
<pre class="language-txt"><code class="language-txt">debian@cliente-vpn:~$ sudo apt install openvpn<br>Reading package lists... Done<br>Building dependency tree... Done<br>Reading state information... Done<br>The following additional packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 pcscd<br>Suggested packages:<br>  pcmciautils openvpn-systemd-resolved<br>The following NEW packages will be installed:<br>  easy-rsa libccid liblzo2-2 libpcsclite1 libpkcs11-helper1 libusb-1.0-0<br>  opensc opensc-pkcs11 openvpn pcscd<br>0 upgraded, 10 newly installed, 0 to remove and 0 not upgraded.<br>Need to get 2551 kB of archives.<br>After this operation, 7667 kB of additional disk space will be used.<br>Do you want to continue? [Y/n] y</code></pre>
<p>Movemos el contenido del directorio que nos hemos pasado anteriormente por scp:</p>
<pre class="language-txt"><code class="language-txt">root@cliente-vpn:/home/debian# mv cliente-vpn/* /etc/openvpn/client/</code></pre>
<p>Le cambiamos el propietario a root a los archivos que hemos movido:</p>
<pre class="language-txt"><code class="language-txt">root@cliente-vpn:/home/debian# chown root: /etc/openvpn/client/*</code></pre>
<p>Creamos el siguiente archivo:</p>
<pre class="language-txt"><code class="language-txt">root@cliente-vpn:/home/debian# nano /etc/openvpn/client/cliente.conf</code></pre>
<p>Le añadimos lo siguiente:</p>
<pre class="language-txt"><code class="language-txt">client<br>dev tun<br>proto udp<br><br>remote 10.0.0.15 1194<br>resolv-retry infinite<br>nobind<br>persist-key<br>persist-tun<br><br>ca /etc/openvpn/client/ca.crt<br>cert /etc/openvpn/client/cliente-vpn.crt<br>key /etc/openvpn/client/cliente-vpn.key<br><br>remote-cert-tls server<br>cipher AES-256-CBC<br>verb 3<br></code></pre>
<p>Ahora miramos si el servicio está funcionando correctamente:</p>
<pre class="language-txt"><code class="language-txt">root@cliente-vpn:/etc/openvpn/client# systemctl status openvpn-client@cliente<br>● openvpn-client@cliente.service - OpenVPN tunnel for cliente<br>     Loaded: loaded (/lib/systemd/system/openvpn-client@.service; enabled; vendor preset: enabled)<br>     Active: active (running) since Fri 2023-01-13 19:44:09 UTC; 15s ago<br>       Docs: man:openvpn(8)<br>             https://community.openvpn.net/openvpn/wiki/Openvpn24ManPage<br>             https://community.openvpn.net/openvpn/wiki/HOWTO<br>   Main PID: 22514 (openvpn)<br>     Status: "Initialization Sequence Completed"<br>      Tasks: 1 (limit: 527)<br>     Memory: 1004.0K<br>        CPU: 22ms<br>     CGroup: /system.slice/system-openvpn\x2dclient.slice/openvpn-client@cliente.service<br>             └─22514 /usr/sbin/openvpn --suppress-timestamps --nobind --config cliente.conf<br><br>Jan 13 19:44:09 cliente-vpn openvpn[22514]: net_route_v4_best_gw query: dst 0.0.0.0<br>Jan 13 19:44:09 cliente-vpn openvpn[22514]: net_route_v4_best_gw result: via 10.0.0.1 dev ens3<br>Jan 13 19:44:09 cliente-vpn openvpn[22514]: ROUTE_GATEWAY 10.0.0.1/255.255.255.0 IFACE=ens3 HWADDR=fa:16:3e:7a:78:88<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: TUN/TAP device tun0 opened<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_iface_mtu_set: mtu 1500 for tun0<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_iface_up: set tun0 up<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_addr_v4_add: 10.100.200.2/24 dev tun0<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: net_route_v4_add: 192.168.100.0/24 via 10.100.200.1 dev [NULL] table 0 metric -1<br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: WARNING: this configuration may cache passwords in memory -- use the auth-nocache option to prevent ><br>Jan 13 19:44:10 cliente-vpn openvpn[22514]: Initialization Sequence Completed</code></pre>
<p>Como podemos ver, el servicio está activo y el servidor le ha asignado una ip correctamente. Ahora mostraré las interfaces de red del cliente y veremos que se ha creado un tun0 con la dirección ip de la vpn:</p>
<pre class="language-txt"><code class="language-txt">root@cliente-vpn:/etc/openvpn/client# ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether fa:16:3e:7a:78:88 brd ff:ff:ff:ff:ff:ff<br>    altname enp0s3<br>    inet 10.0.0.186/24 brd 10.0.0.255 scope global dynamic ens3<br>       valid_lft 68878sec preferred_lft 68878sec<br>    inet6 fe80::f816:3eff:fe7a:7888/64 scope link <br>       valid_lft forever preferred_lft forever<br>3: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500<br>    link/none <br>    inet 10.100.200.2/24 scope global tun0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::e7f5:181c:a293:e455/64 scope link stable-privacy <br>       valid_lft forever preferred_lft forever</code></pre>
<p>Ahora muestro las interfaces de red del servidor:</p>
<pre class="language-txt"><code class="language-txt">root@servidor-vpn:/home/debian# ip a<br>1: lo: &lt;LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000<br>    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00<br>    inet 127.0.0.1/8 scope host lo<br>       valid_lft forever preferred_lft forever<br>    inet6 ::1/128 scope host <br>       valid_lft forever preferred_lft forever<br>2: ens3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether fa:16:3e:b6:d0:79 brd ff:ff:ff:ff:ff:ff<br>    altname enp0s3<br>    inet 192.168.100.66/24 brd 192.168.100.255 scope global dynamic ens3<br>       valid_lft 78208sec preferred_lft 78208sec<br>    inet6 fe80::f816:3eff:feb6:d079/64 scope link <br>       valid_lft forever preferred_lft forever<br>3: ens4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc pfifo_fast state UP group default qlen 1000<br>    link/ether fa:16:3e:23:26:50 brd ff:ff:ff:ff:ff:ff<br>    altname enp0s4<br>    inet 10.0.0.15/24 brd 10.0.0.255 scope global dynamic ens4<br>       valid_lft 83174sec preferred_lft 83174sec<br>    inet6 fe80::f816:3eff:fe23:2650/64 scope link <br>       valid_lft forever preferred_lft forever<br>4: tun0: &lt;POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 500<br>    link/none <br>    inet 10.100.200.1/24 scope global tun0<br>       valid_lft forever preferred_lft forever<br>    inet6 fe80::c656:fa09:7f9c:ffb4/64 scope link stable-privacy <br>       valid_lft forever preferred_lft forever</code></pre>
<p>Ahora añadiremos un cliente conectado a la red de la vpn. Añadiremos una ruta estática por defecto para que use el servidor:</p>
<pre class="language-txt"><code class="language-txt">ip route del default<br>ip route add default via 192.168.11.10</code></pre>
<h4 id="1.2.-vpn-sitio-a-sitio-con-openvpn-y-certificados-x509.-(10-puntos)" tabindex="-1">1.2. VPN sitio a sitio con OpenVPN y certificados x509. (10 puntos)</h4>
<p><strong>Configura una conexión VPN sitio a sitio entre dos equipos del cloud:</strong></p>
<ul>
<li><strong>Cada equipo estará conectado a dos redes, una de ellas en común.</strong></li>
<li><strong>Para la autenticación de los extremos se usarán obligatoriamente certificados digitales, que se generarán utilizando openssl y se almacenarán en el directorio /etc/openvpn, junto con con los parámetros Diffie-Helman y el certificado de la propia Autoridad de Certificación.</strong></li>
<li><strong>Se utilizarán direcciones de la red 10.99.99.0/24 para las direcciones virtuales de la VPN.</strong></li>
<li><strong>Tras el establecimiento de la VPN, una máquina de cada red detrás de cada servidor VPN debe ser capaz de acceder a una máquina del otro extremo.</strong>
<strong>Documenta el proceso detalladamente.</strong></li>
</ul>
<h3 id="wireguard" tabindex="-1">WireGuard</h3>
<h4 id="2.1.-vpn-de-acceso-remoto-con-wireguard.-(5-puntos)" tabindex="-1">2.1. VPN de acceso remoto con WireGuard. (5 puntos)</h4>
<p><strong>Monta una VPN de acceso remoto usando Wireguard. Intenta probarla con clientes Windows, Linux y Android. Documenta el proceso adecuadamente y compáralo con el del apartado A.</strong></p>
<h4 id="2.2.-vpn-sitio-a-sitio-con-wireguard.-(10-puntos)" tabindex="-1">2.2. VPN sitio a sitio con WireGuard. (10 puntos)</h4>
<p><strong>Configura una VPN sitio a sitio usando WireGuard. Documenta el proceso adecuadamente y compáralo con el del apartado B.</strong></p>
<hr>
<h2 id="documento-realizado-por%3A" tabindex="-1"><strong>Documento realizado por:</strong></h2>
<p>✒️ <strong>Alejandro Montes Delgado</strong> - <em>2º ASIR</em></p>

        </div>
            <p class="uppercase text-xs mt-6">Siguiente post</p>
            <p class="font-bold mb-2">
                <a href="/post/servidores-web-base-de-datos-y-dns-en-nuestros-escenario-de-openstack/">Servidores Web, Base de Datos y DNS en nuestros escenario de OpenStack</a>
            </p>
        
            <p class="uppercase text-xs mt-6">Post anterior.</p>

            <p class="font-bold">
                <a href="/post/criptografia-iii.-certificados-digitales.-https./">Criptografía III. Certificados Digitales. HTTPS.</a>
            </p>
        
    </div>

    </main>
    <footer class="bg-gray-900 pb-10">
  <p class="block text-center text-sm mb-6">
    Built by
    <a target="_blank" href="https://github.com/reeseschultz">
      Reese Schultz
    </a>
  </p>

  <a class="block text-center text-sm" href="/privacy-policy">Privacy Policy</a>
</footer>
    <script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
    <script src="/assets/main.bundle.js"></script>
  </body>
</html>
